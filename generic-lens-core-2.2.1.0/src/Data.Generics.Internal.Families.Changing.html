<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes    #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds              #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances      #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GADTs                  #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds              #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies           #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators          #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances   #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Generics.Internal.Families.Changing</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Indexed"><span class="hs-identifier">Indexed</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Infer"><span class="hs-identifier">Infer</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier">PTag</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#P"><span class="hs-identifier">P</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier">LookupParam</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgAt"><span class="hs-identifier">ArgAt</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgCount"><span class="hs-identifier">ArgCount</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier">UnifyHead</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Nat</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(+)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ErrorMessage</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-comment">{-
  Note [Changing type parameters]
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  To get good type inference for type-changing lenses, we want to be able
  map the field's type back to the type argument it corresponds to. This way,
  when the field is changed, we know what the result type of the structure is
  going to be.

  However, for a given type @t@, its representation @Rep t@ forgets which types
  in the structure came from type variables, and which didn't. An @Int@ that
  results from the instantiation of the type paremeter and an @Int@ that was
  monomorphically specified in the structure are indistinguishable.

  The solution is to replace the type arguments in the type with unique
  proxies, like: @T a b@ -&gt; @T (P 1 a) (P 0 b)@. This way, if looking up
  a field's type yields something of shape @P _ _@, we know it came from a type
  parameter, and also know which.

  If the field's type is a proxy, then its type is allowed to change, otherwise
  not. This also allows us to satisfy the functional dependency @s field b -&gt; t@.
  If after doing the conversion on @s@, @field@'s type is @(P _ a), then @t@ is
  @s[b/a]@, otherwise @t ~ s@ and @b ~ a@.
-}</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- `P` can be used in place of any type parameter, which means that it can have</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- any kind, not just *, so a data type won't work.</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- (this caused https://github.com/kcsongor/generic-lens/issues/23)</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- Instead, we use a matchable type family to wrap any `k` - however, we can no longer directly</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- pattern match on `P`, as it's not a type constructor. But we can still take it apart as a polymorphic</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- application form. In order to distinguish between applications of P and other type constructors, we use a tag, `PTag`</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- to fake a type constructor.</span><span>
</span><span id="line-56"></span><span class="hs-keyword">data</span><span> </span><span id="PTag"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier hs-var">PTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PTag"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier hs-var">PTag</span></a></span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="P"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#P"><span class="hs-identifier hs-var">P</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679074281"><span class="annot"><a href="#local-6989586621679074281"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier hs-type">PTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679074281"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">type</span><span> </span><span id="Indexed"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Indexed"><span class="hs-identifier hs-var">Indexed</span></a></span></span><span> </span><span id="local-6989586621679074280"><span class="annot"><a href="#local-6989586621679074280"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Indexed%27"><span class="hs-identifier hs-type">Indexed'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074280"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Indexed%27"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Indexed%27"><span class="hs-identifier hs-var">Indexed'</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074278"><span class="annot"><a href="#local-6989586621679074278"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074277"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074276"><span class="annot"><a href="#local-6989586621679074276"><span class="hs-identifier hs-type">next</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074277"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>  </span><span id="Indexed%27"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Indexed%27"><span class="hs-identifier hs-var">Indexed'</span></a></span></span><span> </span><span id="local-6989586621679074271"><span id="local-6989586621679074272"><span id="local-6989586621679074273"><span id="local-6989586621679074274"><span id="local-6989586621679074275"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074275"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074274"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074273"><span class="hs-identifier hs-type">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074272"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074271"><span class="hs-identifier hs-type">next</span></a></span></span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Indexed%27"><span class="hs-identifier hs-type">Indexed'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074275"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074271"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074271"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074274"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier hs-type">PTag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span id="Indexed%27"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Indexed%27"><span class="hs-identifier hs-var">Indexed'</span></a></span></span><span> </span><span id="local-6989586621679074270"><span class="annot"><a href="#local-6989586621679074270"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074270"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">data</span><span> </span><span id="Sub"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-var">Sub</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-66"></span><span>  </span><span id="local-6989586621679074268"><span id="Sub"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-var">Sub</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679074268"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-type">Sub</span></a></span></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Unify"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-var">Unify</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074265"><span class="annot"><a href="#local-6989586621679074265"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074264"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074263"><span class="annot"><a href="#local-6989586621679074263"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074264"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-type">Sub</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-69"></span><span>  </span><span id="Unify"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-var">Unify</span></a></span></span><span> </span><span id="local-6989586621679074260"><span id="local-6989586621679074261"><span id="local-6989586621679074262"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074262"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074261"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier hs-type">PTag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074260"><span class="hs-identifier hs-type">a'</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-type">Sub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074261"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074260"><span class="hs-identifier hs-type">a'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-70"></span><span>  </span><span id="Unify"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-var">Unify</span></a></span></span><span> </span><span id="local-6989586621679074256"><span id="local-6989586621679074257"><span id="local-6989586621679074258"><span id="local-6989586621679074259"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074259"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074258"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074257"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074256"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-type">Unify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074258"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074256"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#%2B%2B"><span class="hs-operator hs-type">++</span></a></span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-type">Unify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074259"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074257"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span id="Unify"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-var">Unify</span></a></span></span><span> </span><span id="local-6989586621679074254"><span class="annot"><a href="#local-6989586621679074254"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074254"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span>  </span><span id="Unify"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-var">Unify</span></a></span></span><span> </span><span id="local-6989586621679074252"><span id="local-6989586621679074253"><span class="annot"><a href="#local-6989586621679074253"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074252"><span class="hs-identifier hs-type">b</span></a></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span>
</span><span id="line-73"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Couldn't match type &quot;</span></span><span>
</span><span id="line-74"></span><span>                  </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ShowType</span></span><span> </span><span class="annot"><a href="#local-6989586621679074253"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-75"></span><span>                  </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot; with &quot;</span></span><span>
</span><span id="line-76"></span><span>                  </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ShowType</span></span><span> </span><span class="annot"><a href="#local-6989586621679074252"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-77"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074251"><span class="annot"><a href="#local-6989586621679074251"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679074250"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="%2B%2B"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074249"><span class="annot"><a href="#local-6989586621679074249"><span class="hs-identifier hs-type">ys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679074250"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679074250"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-80"></span><span>  </span><span id="local-6989586621679074248"><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="%2B%2B"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679074248"><span class="hs-identifier hs-type">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074248"><span class="hs-identifier hs-type">ys</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span id="local-6989586621679074245"><span id="local-6989586621679074246"><span id="local-6989586621679074247"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074247"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679074246"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span id="%2B%2B"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679074245"><span class="hs-identifier hs-type">ys</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074247"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074246"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#%2B%2B"><span class="hs-operator hs-type">++</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074245"><span class="hs-identifier hs-type">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Infer"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Infer"><span class="hs-identifier hs-var">Infer</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074244"><span class="annot"><a href="#local-6989586621679074244"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074243"><span class="annot"><a href="#local-6989586621679074243"><span class="hs-identifier hs-type">a'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074242"><span class="annot"><a href="#local-6989586621679074242"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-84"></span><span>  </span><span id="Infer"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Infer"><span class="hs-identifier hs-var">Infer</span></a></span></span><span> </span><span id="local-6989586621679074238"><span id="local-6989586621679074239"><span id="local-6989586621679074240"><span id="local-6989586621679074241"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074241"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074240"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074239"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074238"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArgs"><span class="hs-identifier hs-type">ReplaceArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074241"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074240"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-type">Unify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074239"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074238"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span id="Infer"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Infer"><span class="hs-identifier hs-var">Infer</span></a></span></span><span> </span><span id="local-6989586621679074236"><span class="annot"><a href="#local-6989586621679074236"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074236"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- [TODO]: work this out</span><span>
</span><span id="line-91"></span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span class="hs-comment">--type family ArgKind (t :: k) (pos :: Nat) :: * where</span><span>
</span><span id="line-93"></span><span class="hs-comment">--  ArgKind (t (a :: k)) 'Z = k</span><span>
</span><span id="line-94"></span><span class="hs-comment">--  ArgKind (t _) ('S pos) = ArgKind t pos</span><span>
</span><span id="line-95"></span><span class="hs-comment">--</span><span>
</span><span id="line-96"></span><span class="hs-comment">--type family ReplaceArg (t :: k) (pos :: Nat) (to :: ArgKind t pos) :: k where</span><span>
</span><span id="line-97"></span><span class="hs-comment">--  ReplaceArg (t a) 'Z to = t to</span><span>
</span><span id="line-98"></span><span class="hs-comment">--  ReplaceArg (t a) ('S pos) to = ReplaceArg t pos to a</span><span>
</span><span id="line-99"></span><span class="hs-comment">--  ReplaceArg t _ _ = t</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="ReplaceArg"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArg"><span class="hs-identifier hs-var">ReplaceArg</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074234"><span class="annot"><a href="#local-6989586621679074234"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074233"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span id="local-6989586621679074232"><span id="local-6989586621679074233"><span> </span><span class="hs-special">(</span><span id="local-6989586621679074231"><span class="annot"><a href="#local-6989586621679074231"><span class="hs-identifier hs-type">pos</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074230"><span class="annot"><a href="#local-6989586621679074230"><span class="hs-identifier hs-type">to</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074232"><span class="hs-identifier hs-type">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074233"><span class="hs-identifier hs-type">k</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>  </span><span id="ReplaceArg"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArg"><span class="hs-identifier hs-var">ReplaceArg</span></a></span></span><span> </span><span id="local-6989586621679074227"><span id="local-6989586621679074228"><span id="local-6989586621679074229"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074229"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074228"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621679074227"><span class="hs-identifier hs-type">to</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074229"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074227"><span class="hs-identifier hs-type">to</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span id="ReplaceArg"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArg"><span class="hs-identifier hs-var">ReplaceArg</span></a></span></span><span> </span><span id="local-6989586621679074223"><span id="local-6989586621679074224"><span id="local-6989586621679074225"><span id="local-6989586621679074226"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074226"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074225"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074224"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074223"><span class="hs-identifier hs-type">to</span></a></span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArg"><span class="hs-identifier hs-type">ReplaceArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074226"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074224"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074223"><span class="hs-identifier hs-type">to</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074225"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span id="ReplaceArg"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArg"><span class="hs-identifier hs-var">ReplaceArg</span></a></span></span><span> </span><span id="local-6989586621679074222"><span class="annot"><a href="#local-6989586621679074222"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074222"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="ReplaceArgs"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArgs"><span class="hs-identifier hs-var">ReplaceArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074221"><span class="annot"><a href="#local-6989586621679074221"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074220"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">subs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-type">Sub</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074220"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>  </span><span id="ReplaceArgs"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArgs"><span class="hs-identifier hs-var">ReplaceArgs</span></a></span></span><span> </span><span id="local-6989586621679074219"><span class="annot"><a href="#local-6989586621679074219"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074219"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span id="ReplaceArgs"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArgs"><span class="hs-identifier hs-var">ReplaceArgs</span></a></span></span><span> </span><span id="local-6989586621679074215"><span id="local-6989586621679074216"><span id="local-6989586621679074217"><span id="local-6989586621679074218"><span class="annot"><a href="#local-6989586621679074218"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-type">Sub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074217"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074216"><span class="hs-identifier hs-type">arg</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679074215"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArgs"><span class="hs-identifier hs-type">ReplaceArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArg"><span class="hs-identifier hs-type">ReplaceArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074218"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074217"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074216"><span class="hs-identifier hs-type">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074215"><span class="hs-identifier hs-type">ss</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="LookupParam"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-var">LookupParam</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074214"><span class="annot"><a href="#local-6989586621679074214"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074213"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Nat</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>  </span><span id="LookupParam"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-var">LookupParam</span></a></span></span><span> </span><span id="local-6989586621679074210"><span id="local-6989586621679074211"><span id="local-6989586621679074212"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074212"><span class="hs-identifier hs-type">param</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074211"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074210"><span class="hs-identifier hs-type">m</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-112"></span><span>  </span><span id="LookupParam"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-var">LookupParam</span></a></span></span><span> </span><span id="local-6989586621679074207"><span id="local-6989586621679074208"><span id="local-6989586621679074209"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074209"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074208"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074207"><span class="hs-identifier hs-type">n</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#IfEq"><span class="hs-identifier hs-type">IfEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074208"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074207"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#MaybeAdd"><span class="hs-identifier hs-type">MaybeAdd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-type">LookupParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074209"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074207"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>  </span><span id="LookupParam"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-var">LookupParam</span></a></span></span><span> </span><span id="local-6989586621679074203"><span id="local-6989586621679074204"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074204"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074203"><span class="hs-identifier hs-type">n</span></a></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#MaybeAdd"><span class="hs-identifier hs-type">MaybeAdd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-type">LookupParam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074204"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074203"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-114"></span><span>  </span><span id="LookupParam"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-var">LookupParam</span></a></span></span><span> </span><span id="local-6989586621679074202"><span class="annot"><a href="#local-6989586621679074202"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="MaybeAdd"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#MaybeAdd"><span class="hs-identifier hs-var">MaybeAdd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074201"><span class="annot"><a href="#local-6989586621679074201"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074200"><span class="annot"><a href="#local-6989586621679074200"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-117"></span><span>  </span><span id="MaybeAdd"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#MaybeAdd"><span class="hs-identifier hs-var">MaybeAdd</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-118"></span><span>  </span><span id="MaybeAdd"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#MaybeAdd"><span class="hs-identifier hs-var">MaybeAdd</span></a></span></span><span> </span><span id="local-6989586621679074198"><span id="local-6989586621679074199"><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679074199"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074198"><span class="hs-identifier hs-type">b</span></a></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074199"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621679074198"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="IfEq"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#IfEq"><span class="hs-identifier hs-var">IfEq</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074197"><span class="annot"><a href="#local-6989586621679074197"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074196"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span id="local-6989586621679074195"><span id="local-6989586621679074196"><span> </span><span class="hs-special">(</span><span id="local-6989586621679074194"><span class="annot"><a href="#local-6989586621679074194"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074196"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074193"><span class="annot"><a href="#local-6989586621679074193"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074195"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074192"><span class="annot"><a href="#local-6989586621679074192"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074195"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074195"><span class="hs-identifier hs-type">l</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>  </span><span id="IfEq"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#IfEq"><span class="hs-identifier hs-var">IfEq</span></a></span></span><span> </span><span id="local-6989586621679074190"><span id="local-6989586621679074191"><span class="annot"><a href="#local-6989586621679074191"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074191"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074190"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074190"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span id="IfEq"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#IfEq"><span class="hs-identifier hs-var">IfEq</span></a></span></span><span> </span><span id="local-6989586621679074189"><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="#local-6989586621679074189"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074189"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="ArgCount"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgCount"><span class="hs-identifier hs-var">ArgCount</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074188"><span id="local-6989586621679074187"><span class="annot"><a href="#local-6989586621679074187"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074188"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-125"></span><span>  </span><span id="ArgCount"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgCount"><span class="hs-identifier hs-var">ArgCount</span></a></span></span><span> </span><span id="local-6989586621679074185"><span id="local-6989586621679074186"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074186"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074185"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgCount"><span class="hs-identifier hs-type">ArgCount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074186"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span id="ArgCount"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgCount"><span class="hs-identifier hs-var">ArgCount</span></a></span></span><span> </span><span id="local-6989586621679074184"><span class="annot"><a href="#local-6989586621679074184"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="ArgAt"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgAt"><span class="hs-identifier hs-var">ArgAt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074183"><span class="annot"><a href="#local-6989586621679074183"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074182"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074181"><span class="annot"><a href="#local-6989586621679074181"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074180"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>  </span><span id="ArgAt"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgAt"><span class="hs-identifier hs-var">ArgAt</span></a></span></span><span> </span><span id="local-6989586621679074178"><span id="local-6989586621679074179"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074179"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074178"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">0</span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679074178"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span id="ArgAt"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgAt"><span class="hs-identifier hs-var">ArgAt</span></a></span></span><span> </span><span id="local-6989586621679074175"><span id="local-6989586621679074176"><span id="local-6989586621679074177"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074177"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074176"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074175"><span class="hs-identifier hs-type">n</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#ArgAt"><span class="hs-identifier hs-type">ArgAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074177"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074175"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">-- | Ensure that the types @a@ and @b@ are both applications of the same</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- constructor. The arguments may be different.</span><span>
</span><span id="line-135"></span><span class="hs-keyword">class</span><span> </span><span id="UnifyHead"><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier hs-var">UnifyHead</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679074313"><span class="annot"><a href="#local-6989586621679074313"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679074314"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">k</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPING</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span id="local-6989586621679074298"><span id="local-6989586621679074299"><span id="local-6989586621679074300"><span id="local-6989586621679074301"><span id="local-6989586621679074302"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074302"><span class="hs-identifier hs-type">gb</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="#local-6989586621679074301"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074300"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier hs-type">UnifyHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074299"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074301"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier hs-type">UnifyHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074299"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074298"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679074302"><span class="hs-identifier hs-type">gb</span></a></span></span></span></span></span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679074292"><span id="local-6989586621679074293"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679074293"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="#local-6989586621679074292"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier hs-type">UnifyHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074293"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679074292"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-138"></span></pre></body></html>