<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">{- |
Sometimes incoming requests don't stick to the
&quot;no duplicate headers&quot; invariant, for a number
of possible reasons (e.g. proxy servers blindly
adding headers), or your application (or other
middleware) blindly adds headers.

In those cases, you can use this 'Middleware'
to make sure that headers that /can/ be combined
/are/ combined. (e.g. applications might only
check the first \&quot;Accept\&quot; header and fail, while
there might be another one that would match)
    -}</span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.Wai.Middleware.CombineHeaders</span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaders"><span class="hs-identifier">combineHeaders</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier">CombineSettings</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#defaultCombineSettings"><span class="hs-identifier">defaultCombineSettings</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HeaderMap"><span class="hs-identifier">HeaderMap</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HandleType"><span class="hs-identifier">HandleType</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#defaultHeaderMap"><span class="hs-identifier">defaultHeaderMap</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Adjusting the settings</span></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#setHeader"><span class="hs-identifier">setHeader</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#removeHeader"><span class="hs-identifier">removeHeader</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#setHeaderMap"><span class="hs-identifier">setHeaderMap</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#regular"><span class="hs-identifier">regular</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#keepOnly"><span class="hs-identifier">keepOnly</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#setRequestHeaders"><span class="hs-identifier">setRequestHeaders</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#setResponseHeaders"><span class="hs-identifier">setResponseHeaders</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">reverse</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_comma</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_space</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_tab</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Header</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HeaderName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RequestHeaders</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types.Header</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Middleware</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">requestHeaders</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapResponseHeaders</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Wai.Util.html"><span class="hs-identifier">Network.Wai.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Wai.Util.html#dropWhileEnd"><span class="hs-identifier">dropWhileEnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- | The mapping of 'HeaderName' to 'HandleType'</span><span>
</span><span id="line-43"></span><span class="hs-keyword">type</span><span> </span><span id="HeaderMap"><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HeaderMap"><span class="hs-identifier hs-var">HeaderMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeaderName</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HandleType"><span class="hs-identifier hs-type">HandleType</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- | These settings define which headers should be combined,</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- if the combining should happen on incoming (request) headers</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- and if it should happen on outgoing (response) headers.</span><span>
</span><span id="line-48"></span><span class="hs-comment">--</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- Any header you put in the header map *will* be used to</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- combine those headers with commas. There's no check to see</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- if it is a header that allows comma-separated lists, so if</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- you want to combine custom headers, go ahead.</span><span>
</span><span id="line-53"></span><span class="hs-comment">--</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- (You can check the documentation of 'defaultCombineSettings'</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- to see which standard headers are specified to be able to be</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- combined)</span><span>
</span><span id="line-57"></span><span class="hs-comment">--</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-59"></span><span class="hs-keyword">data</span><span> </span><span id="CombineSettings"><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-var">CombineSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CombineSettings"><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-var">CombineSettings</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-60"></span><span>    </span><span id="combineHeaderMap"><span class="annot"><span class="annottext">CombineSettings -&gt; HeaderMap
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaderMap"><span class="hs-identifier hs-var hs-var">combineHeaderMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HeaderMap"><span class="hs-identifier hs-type">HeaderMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-comment">-- ^ Which headers should be combined? And how? (cf. 'HandleType')</span><span>
</span><span id="line-62"></span><span>    </span><span id="combineRequestHeaders"><span class="annot"><span class="annottext">CombineSettings -&gt; Bool
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineRequestHeaders"><span class="hs-identifier hs-var hs-var">combineRequestHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-comment">-- ^ Should request headers be combined?</span><span>
</span><span id="line-64"></span><span>    </span><span id="combineResponseHeaders"><span class="annot"><span class="annottext">CombineSettings -&gt; Bool
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineResponseHeaders"><span class="hs-identifier hs-var hs-var">combineResponseHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-comment">-- ^ Should response headers be combined?</span><span>
</span><span id="line-66"></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679125228"><span id="local-6989586621679125237"><span class="annot"><span class="annottext">CombineSettings -&gt; CombineSettings -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CombineSettings -&gt; CombineSettings -&gt; Bool
$c/= :: CombineSettings -&gt; CombineSettings -&gt; Bool
== :: CombineSettings -&gt; CombineSettings -&gt; Bool
$c== :: CombineSettings -&gt; CombineSettings -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125209"><span id="local-6989586621679125211"><span id="local-6989586621679125222"><span class="annot"><span class="annottext">Int -&gt; CombineSettings -&gt; ShowS
[CombineSettings] -&gt; ShowS
CombineSettings -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CombineSettings] -&gt; ShowS
$cshowList :: [CombineSettings] -&gt; ShowS
show :: CombineSettings -&gt; String
$cshow :: CombineSettings -&gt; String
showsPrec :: Int -&gt; CombineSettings -&gt; ShowS
$cshowsPrec :: Int -&gt; CombineSettings -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | Settings that combine request headers,</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- but don't touch response headers.</span><span>
</span><span id="line-70"></span><span class="hs-comment">--</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- All types of headers that /can/ be combined</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- (as defined in the spec) /will/ be combined.</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- To be exact, this is the list:</span><span>
</span><span id="line-75"></span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- * Accept</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- * Accept-CH</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- * Accept-Charset</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- * Accept-Encoding</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- * Accept-Language</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- * Accept-Post</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- * Access-Control-Allow-Headers</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- * Access-Control-Allow-Methods</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- * Access-Control-Expose-Headers</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- * Access-Control-Request-Headers</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- * Allow</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- * Alt-Svc @(KeepOnly \&quot;clear\&quot;&quot;)@</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- * Cache-Control</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- * Clear-Site-Data @(KeepOnly \&quot;*\&quot;)@</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- * Connection</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- * Content-Encoding</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- * Content-Language</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- * Digest</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- * If-Match</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- * If-None-Match @(KeepOnly \&quot;*\&quot;)@</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- * Link</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- * Permissions-Policy</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- * TE</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- * Timing-Allow-Origin @(KeepOnly \&quot;*\&quot;)@</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- * Trailer</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- * Transfer-Encoding</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- * Upgrade</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- * Via</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- * Vary @(KeepOnly \&quot;*\&quot;)@</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- * Want-Digest</span><span>
</span><span id="line-106"></span><span class="hs-comment">--</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- N.B. Any header name that has \&quot;KeepOnly\&quot; after it</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- will be combined like normal, unless one of the values</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- is the one mentioned (\&quot;*\&quot; most of the time), then</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- that value is used and all others are dropped.</span><span>
</span><span id="line-111"></span><span class="hs-comment">--</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-113"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#defaultCombineSettings"><span class="hs-identifier hs-type">defaultCombineSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span>
</span><span id="line-114"></span><span id="defaultCombineSettings"><span class="annot"><span class="annottext">defaultCombineSettings :: CombineSettings
</span><a href="Network.Wai.Middleware.CombineHeaders.html#defaultCombineSettings"><span class="hs-identifier hs-var hs-var">defaultCombineSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="annottext">combineHeaderMap :: HeaderMap
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaderMap"><span class="hs-identifier hs-var">combineHeaderMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderMap
</span><a href="Network.Wai.Middleware.CombineHeaders.html#defaultHeaderMap"><span class="hs-identifier hs-var">defaultHeaderMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">combineRequestHeaders :: Bool
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineRequestHeaders"><span class="hs-identifier hs-var">combineRequestHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">combineResponseHeaders :: Bool
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineResponseHeaders"><span class="hs-identifier hs-var">combineResponseHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-118"></span><span class="hs-special">}</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">-- | Override the 'HeaderMap' of the 'CombineSettings'</span><span>
</span><span id="line-121"></span><span class="hs-comment">--  (default: 'defaultHeaderMap')</span><span>
</span><span id="line-122"></span><span class="hs-comment">--</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-124"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#setHeaderMap"><span class="hs-identifier hs-type">setHeaderMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HeaderMap"><span class="hs-identifier hs-type">HeaderMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span>
</span><span id="line-125"></span><span id="setHeaderMap"><span class="annot"><span class="annottext">setHeaderMap :: HeaderMap -&gt; CombineSettings -&gt; CombineSettings
</span><a href="Network.Wai.Middleware.CombineHeaders.html#setHeaderMap"><span class="hs-identifier hs-var hs-var">setHeaderMap</span></a></span></span><span> </span><span id="local-6989586621679125204"><span class="annot"><span class="annottext">HeaderMap
</span><a href="#local-6989586621679125204"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span id="local-6989586621679125203"><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125203"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125203"><span class="hs-identifier hs-var">set</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">combineHeaderMap :: HeaderMap
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaderMap"><span class="hs-identifier hs-var">combineHeaderMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderMap
</span><a href="#local-6989586621679125204"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | Set whether the combining of headers should be applied to</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- the incoming request headers. (default: True)</span><span>
</span><span id="line-129"></span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-131"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#setRequestHeaders"><span class="hs-identifier hs-type">setRequestHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span>
</span><span id="line-132"></span><span id="setRequestHeaders"><span class="annot"><span class="annottext">setRequestHeaders :: Bool -&gt; CombineSettings -&gt; CombineSettings
</span><a href="Network.Wai.Middleware.CombineHeaders.html#setRequestHeaders"><span class="hs-identifier hs-var hs-var">setRequestHeaders</span></a></span></span><span> </span><span id="local-6989586621679125202"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679125202"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679125201"><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125201"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125201"><span class="hs-identifier hs-var">set</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">combineRequestHeaders :: Bool
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineRequestHeaders"><span class="hs-identifier hs-var">combineRequestHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679125202"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- | Set whether the combining of headers should be applied to</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- the outgoing response headers. (default: False)</span><span>
</span><span id="line-136"></span><span class="hs-comment">--</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-138"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#setResponseHeaders"><span class="hs-identifier hs-type">setResponseHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span>
</span><span id="line-139"></span><span id="setResponseHeaders"><span class="annot"><span class="annottext">setResponseHeaders :: Bool -&gt; CombineSettings -&gt; CombineSettings
</span><a href="Network.Wai.Middleware.CombineHeaders.html#setResponseHeaders"><span class="hs-identifier hs-var hs-var">setResponseHeaders</span></a></span></span><span> </span><span id="local-6989586621679125200"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679125200"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679125199"><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125199"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125199"><span class="hs-identifier hs-var">set</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">combineResponseHeaders :: Bool
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineResponseHeaders"><span class="hs-identifier hs-var">combineResponseHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679125200"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Convenience function to add a header to the header map or,</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- if it is already in the map, to change the 'HandleType'.</span><span>
</span><span id="line-143"></span><span class="hs-comment">--</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-145"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#setHeader"><span class="hs-identifier hs-type">setHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeaderName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HandleType"><span class="hs-identifier hs-type">HandleType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span>
</span><span id="line-146"></span><span id="setHeader"><span class="annot"><span class="annottext">setHeader :: HeaderName -&gt; HandleType -&gt; CombineSettings -&gt; CombineSettings
</span><a href="Network.Wai.Middleware.CombineHeaders.html#setHeader"><span class="hs-identifier hs-var hs-var">setHeader</span></a></span></span><span> </span><span id="local-6989586621679125198"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125198"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679125197"><span class="annot"><span class="annottext">HandleType
</span><a href="#local-6989586621679125197"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621679125196"><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125196"><span class="hs-identifier hs-var">settings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125196"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">combineHeaderMap :: HeaderMap
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaderMap"><span class="hs-identifier hs-var">combineHeaderMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125198"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="#local-6989586621679125197"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CombineSettings -&gt; HeaderMap
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaderMap"><span class="hs-identifier hs-var">combineHeaderMap</span></a></span><span> </span><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125196"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">-- | Convenience function to remove a header from the header map.</span><span>
</span><span id="line-152"></span><span class="hs-comment">--</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-154"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#removeHeader"><span class="hs-identifier hs-type">removeHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeaderName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span>
</span><span id="line-155"></span><span id="removeHeader"><span class="annot"><span class="annottext">removeHeader :: HeaderName -&gt; CombineSettings -&gt; CombineSettings
</span><a href="Network.Wai.Middleware.CombineHeaders.html#removeHeader"><span class="hs-identifier hs-var hs-var">removeHeader</span></a></span></span><span> </span><span id="local-6989586621679125194"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125194"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679125193"><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125193"><span class="hs-identifier hs-var">settings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125193"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><span class="annottext">combineHeaderMap :: HeaderMap
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaderMap"><span class="hs-identifier hs-var">combineHeaderMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.delete</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125194"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CombineSettings -&gt; HeaderMap
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaderMap"><span class="hs-identifier hs-var">combineHeaderMap</span></a></span><span> </span><span class="annot"><span class="annottext">CombineSettings
</span><a href="#local-6989586621679125193"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- | This middleware will reorganize the incoming and/or outgoing</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- headers in such a way that it combines any duplicates of</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- headers that, on their own, can normally have more than one</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- value, and any other headers will stay untouched.</span><span>
</span><span id="line-164"></span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- This middleware WILL change the global order of headers</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- (they will be put in alphabetical order), but keep the</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- order of the same type of header. I.e. if there are 3</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- \&quot;Set-Cookie\&quot; headers, the first one will still be first,</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- the second one will still be second, etc. But now they are</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- guaranteed to be next to each other.</span><span>
</span><span id="line-171"></span><span class="hs-comment">--</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- N.B. This 'Middleware' assumes the headers it combines</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- are correctly formatted. If one of the to-be-combined</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- headers is malformed, the new combined header will also</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- (probably) be malformed.</span><span>
</span><span id="line-176"></span><span class="hs-comment">--</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-178"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaders"><span class="hs-identifier hs-type">combineHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Middleware</span></span><span>
</span><span id="line-179"></span><span id="combineHeaders"><span class="annot"><span class="annottext">combineHeaders :: CombineSettings -&gt; Middleware
</span><a href="Network.Wai.Middleware.CombineHeaders.html#combineHeaders"><span class="hs-identifier hs-var hs-var">combineHeaders</span></a></span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#CombineSettings"><span class="hs-identifier hs-type">CombineSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679125189"><span id="local-6989586621679125190"><span id="local-6989586621679125191"><span class="annot"><span class="annottext">Bool
HeaderMap
combineResponseHeaders :: Bool
combineRequestHeaders :: Bool
combineHeaderMap :: HeaderMap
combineResponseHeaders :: CombineSettings -&gt; Bool
combineRequestHeaders :: CombineSettings -&gt; Bool
combineHeaderMap :: CombineSettings -&gt; HeaderMap
</span><a href="#local-6989586621679125189"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679125188"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679125188"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span id="local-6989586621679125187"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679125187"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621679125186"><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679125186"><span class="hs-identifier hs-var">resFunc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679125188"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679125185"><span class="hs-identifier hs-var">newReq</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679125186"><span class="hs-identifier hs-var">resFunc</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Response -&gt; Response
</span><a href="#local-6989586621679125183"><span class="hs-identifier hs-var">adjustRes</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679125185"><span class="annot"><span class="annottext">newReq :: Request
</span><a href="#local-6989586621679125185"><span class="hs-identifier hs-var hs-var">newReq</span></a></span></span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679125190"><span class="hs-identifier hs-var">combineRequestHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679125187"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">requestHeaders :: RequestHeaders
</span><span class="hs-identifier hs-var">requestHeaders</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RequestHeaders -&gt; RequestHeaders
</span><a href="#local-6989586621679125182"><span class="hs-identifier hs-var">mkNewHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHeaders
</span><a href="#local-6989586621679125181"><span class="hs-identifier hs-var">oldHeaders</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679125187"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621679125181"><span class="annot"><span class="annottext">oldHeaders :: RequestHeaders
</span><a href="#local-6989586621679125181"><span class="hs-identifier hs-var hs-var">oldHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; RequestHeaders
</span><span class="hs-identifier hs-var">requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679125187"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621679125183"><span class="annot"><span class="annottext">adjustRes :: Response -&gt; Response
</span><a href="#local-6989586621679125183"><span class="hs-identifier hs-var hs-var">adjustRes</span></a></span></span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679125189"><span class="hs-identifier hs-var">combineResponseHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RequestHeaders -&gt; RequestHeaders) -&gt; Response -&gt; Response
</span><span class="hs-identifier hs-var">mapResponseHeaders</span></span><span> </span><span class="annot"><span class="annottext">RequestHeaders -&gt; RequestHeaders
</span><a href="#local-6989586621679125182"><span class="hs-identifier hs-var">mkNewHeaders</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621679125182"><span class="annot"><span class="annottext">mkNewHeaders :: RequestHeaders -&gt; RequestHeaders
</span><a href="#local-6989586621679125182"><span class="hs-identifier hs-var hs-var">mkNewHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><span class="annottext">forall k a b. (k -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Map k a -&gt; b
</span><span class="hs-identifier hs-var">M.foldrWithKey'</span></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; HeaderHandling -&gt; RequestHeaders -&gt; RequestHeaders
</span><a href="Network.Wai.Middleware.CombineHeaders.html#finishHeaders"><span class="hs-identifier hs-var">finishHeaders</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">L.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map HeaderName HeaderHandling
-&gt; (HeaderName, ByteString) -&gt; Map HeaderName HeaderHandling
</span><a href="#local-6989586621679125172"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621679125172"><span class="annot"><span class="annottext">go :: Map HeaderName HeaderHandling
-&gt; (HeaderName, ByteString) -&gt; Map HeaderName HeaderHandling
</span><a href="#local-6989586621679125172"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679125169"><span class="annot"><span class="annottext">Map HeaderName HeaderHandling
</span><a href="#local-6989586621679125169"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679125168"><span class="annot"><span class="annottext">hdr :: (HeaderName, ByteString)
</span><a href="#local-6989586621679125168"><span class="hs-identifier hs-var">hdr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679125167"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125167"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-192"></span><span>        </span><span class="annot"><span class="annottext">forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.alter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HeaderName, ByteString)
-&gt; Maybe HeaderHandling -&gt; Maybe HeaderHandling
</span><a href="#local-6989586621679125165"><span class="hs-identifier hs-var">checkHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(HeaderName, ByteString)
</span><a href="#local-6989586621679125168"><span class="hs-identifier hs-var">hdr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125167"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Map HeaderName HeaderHandling
</span><a href="#local-6989586621679125169"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><a href="#local-6989586621679125165"><span class="hs-identifier hs-type">checkHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Header</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HeaderHandling"><span class="hs-identifier hs-type">HeaderHandling</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HeaderHandling"><span class="hs-identifier hs-type">HeaderHandling</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679125165"><span class="annot"><span class="annottext">checkHeader :: (HeaderName, ByteString)
-&gt; Maybe HeaderHandling -&gt; Maybe HeaderHandling
</span><a href="#local-6989586621679125165"><span class="hs-identifier hs-var hs-var">checkHeader</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679125164"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125164"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125163"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125163"><span class="hs-identifier hs-var">newVal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">Maybe HeaderHandling
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125164"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`M.lookup`</span></span><span> </span><span class="annot"><span class="annottext">HeaderMap
</span><a href="#local-6989586621679125191"><span class="hs-identifier hs-var">combineHeaderMap</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125163"><span class="hs-identifier hs-var">newVal</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-comment">-- Yes, this reverses the order of headers, but these</span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-comment">-- will be reversed again in 'finishHeaders'</span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679125161"><span class="annot"><span class="annottext">Maybe HandleType
</span><a href="#local-6989586621679125161"><span class="hs-identifier hs-var">mHandleType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125160"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679125160"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe HandleType
</span><a href="#local-6989586621679125161"><span class="hs-identifier hs-var">mHandleType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125163"><span class="hs-identifier hs-var">newVal</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679125160"><span class="hs-identifier hs-var">hdrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- | Unpack 'HeaderHandling' back into 'Header's again</span><span>
</span><span id="line-201"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#finishHeaders"><span class="hs-identifier hs-type">finishHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeaderName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HeaderHandling"><span class="hs-identifier hs-type">HeaderHandling</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequestHeaders</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequestHeaders</span></span><span>
</span><span id="line-202"></span><span id="finishHeaders"><span class="annot"><span class="annottext">finishHeaders :: HeaderName -&gt; HeaderHandling -&gt; RequestHeaders -&gt; RequestHeaders
</span><a href="Network.Wai.Middleware.CombineHeaders.html#finishHeaders"><span class="hs-identifier hs-var hs-var">finishHeaders</span></a></span></span><span> </span><span id="local-6989586621679125159"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125159"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679125158"><span class="annot"><span class="annottext">Maybe HandleType
</span><a href="#local-6989586621679125158"><span class="hs-identifier hs-var">shouldCombine</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125157"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679125157"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679125156"><span class="annot"><span class="annottext">RequestHeaders
</span><a href="#local-6989586621679125156"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HandleType
</span><a href="#local-6989586621679125158"><span class="hs-identifier hs-var">shouldCombine</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679125155"><span class="annot"><span class="annottext">HandleType
</span><a href="#local-6989586621679125155"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125159"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType -&gt; ByteString
</span><a href="#local-6989586621679125154"><span class="hs-identifier hs-var">combinedHeader</span></a></span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="#local-6989586621679125155"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">RequestHeaders
</span><a href="#local-6989586621679125156"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">Maybe HandleType
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-206"></span><span>            </span><span class="hs-comment">-- Yes, this reverses the headers, but they</span><span>
</span><span id="line-207"></span><span>            </span><span class="hs-comment">-- were already reversed by 'checkHeader'</span><span>
</span><span id="line-208"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">L.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679125153"><span class="annot"><span class="annottext">RequestHeaders
</span><a href="#local-6989586621679125153"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679125152"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125152"><span class="hs-identifier hs-var">el</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679125159"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125152"><span class="hs-identifier hs-var">el</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">RequestHeaders
</span><a href="#local-6989586621679125153"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RequestHeaders
</span><a href="#local-6989586621679125156"><span class="hs-identifier hs-var">hdrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679125157"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621679125154"><span class="annot"><span class="annottext">combinedHeader :: HandleType -&gt; ByteString
</span><a href="#local-6989586621679125154"><span class="hs-identifier hs-var hs-var">combinedHeader</span></a></span></span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="#local-6989586621679125148"><span class="hs-identifier hs-var">combineHdrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679125157"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="#local-6989586621679125154"><span class="hs-identifier hs-var">combinedHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#KeepOnly"><span class="hs-identifier hs-type">KeepOnly</span></a></span><span> </span><span id="local-6989586621679125146"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125146"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125146"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679125157"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125146"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="#local-6989586621679125148"><span class="hs-identifier hs-var">combineHdrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679125157"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- headers were reversed, so do 'reverse' before combining</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621679125148"><span class="annot"><span class="annottext">combineHdrs :: [ByteString] -&gt; ByteString
</span><a href="#local-6989586621679125148"><span class="hs-identifier hs-var hs-var">combineHdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.intercalate</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679125140"><span class="hs-identifier hs-var">clean</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.reverse</span></span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621679125140"><span class="annot"><span class="annottext">clean :: ByteString -&gt; ByteString
</span><a href="#local-6989586621679125140"><span class="hs-identifier hs-var hs-var">clean</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Bool) -&gt; ByteString -&gt; ByteString
</span><a href="Network.Wai.Util.html#dropWhileEnd"><span class="hs-identifier hs-var">dropWhileEnd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679125135"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679125135"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679125135"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier hs-var">_comma</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679125135"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier hs-var">_space</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679125135"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier hs-var">_tab</span></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-keyword">type</span><span> </span><span id="HeaderHandling"><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HeaderHandling"><span class="hs-identifier hs-var">HeaderHandling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HandleType"><span class="hs-identifier hs-type">HandleType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- | Both will concatenate with @,@ (commas), but 'KeepOnly' will drop all</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- values except the given one if present (e.g. in case of wildcards/special values)</span><span>
</span><span id="line-222"></span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- For example: If there are multiple @&quot;Clear-Site-Data&quot;@ headers, but one of</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- them is the wildcard @\&quot;*\&quot;@ value, using @'KeepOnly' &quot;*&quot;@ will cause all</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- others to be dropped and only the wildcard value to remain.</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- (The @\&quot;*\&quot;@ wildcard in this case means /ALL site data/ should be cleared,</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- so no need to include more)</span><span>
</span><span id="line-228"></span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-230"></span><span class="hs-keyword">data</span><span> </span><span id="HandleType"><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HandleType"><span class="hs-identifier hs-var">HandleType</span></a></span></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Regular"><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="KeepOnly"><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#KeepOnly"><span class="hs-identifier hs-var">KeepOnly</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-233"></span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679125129"><span id="local-6989586621679125132"><span class="annot"><span class="annottext">HandleType -&gt; HandleType -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: HandleType -&gt; HandleType -&gt; Bool
$c/= :: HandleType -&gt; HandleType -&gt; Bool
== :: HandleType -&gt; HandleType -&gt; Bool
$c== :: HandleType -&gt; HandleType -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125121"><span id="local-6989586621679125123"><span id="local-6989586621679125127"><span class="annot"><span class="annottext">Int -&gt; HandleType -&gt; ShowS
[HandleType] -&gt; ShowS
HandleType -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [HandleType] -&gt; ShowS
$cshowList :: [HandleType] -&gt; ShowS
show :: HandleType -&gt; String
$cshow :: HandleType -&gt; String
showsPrec :: Int -&gt; HandleType -&gt; ShowS
$cshowsPrec :: Int -&gt; HandleType -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-comment">-- | Use the regular strategy when combining headers.</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- (i.e. merge into one header and separate values with commas)</span><span>
</span><span id="line-237"></span><span class="hs-comment">--</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-239"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#regular"><span class="hs-identifier hs-type">regular</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HandleType"><span class="hs-identifier hs-type">HandleType</span></a></span><span>
</span><span id="line-240"></span><span id="regular"><span class="annot"><span class="annottext">regular :: HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#regular"><span class="hs-identifier hs-var hs-var">regular</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | Use the regular strategy when combining headers,</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- but if the exact supplied 'ByteString' is encountered</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- then discard all other values and only keep that value.</span><span>
</span><span id="line-245"></span><span class="hs-comment">--</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- e.g. @keepOnly &quot;*&quot;@ will drop all other encountered values</span><span>
</span><span id="line-247"></span><span class="hs-comment">--</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-249"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#keepOnly"><span class="hs-identifier hs-type">keepOnly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HandleType"><span class="hs-identifier hs-type">HandleType</span></a></span><span>
</span><span id="line-250"></span><span id="keepOnly"><span class="annot"><span class="annottext">keepOnly :: ByteString -&gt; HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#keepOnly"><span class="hs-identifier hs-var hs-var">keepOnly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#KeepOnly"><span class="hs-identifier hs-var">KeepOnly</span></a></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- | The default collection of HTTP headers that can be combined</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- in case there are multiples in one request or response.</span><span>
</span><span id="line-254"></span><span class="hs-comment">--</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- See the documentation of 'defaultCombineSettings' for the exact list.</span><span>
</span><span id="line-256"></span><span class="hs-comment">--</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- @since 3.1.13.0</span><span>
</span><span id="line-258"></span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#defaultHeaderMap"><span class="hs-identifier hs-type">defaultHeaderMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.CombineHeaders.html#HeaderMap"><span class="hs-identifier hs-type">HeaderMap</span></a></span><span>
</span><span id="line-259"></span><span id="defaultHeaderMap"><span class="annot"><span class="annottext">defaultHeaderMap :: HeaderMap
</span><a href="Network.Wai.Middleware.CombineHeaders.html#defaultHeaderMap"><span class="hs-identifier hs-var hs-var">defaultHeaderMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hAccept</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Accept-CH&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hAcceptCharset</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hAcceptEncoding</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hAcceptLanguage</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Accept-Post&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Access-Control-Allow-Headers&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- wildcard? yes, but can just add to list</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Access-Control-Allow-Methods&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- wildcard? yes, but can just add to list</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Access-Control-Expose-Headers&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- wildcard? yes, but can just add to list</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Access-Control-Request-Headers&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hAllow</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Alt-Svc&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#KeepOnly"><span class="hs-identifier hs-var">KeepOnly</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;clear&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- special &quot;clear&quot; value (if any is &quot;clear&quot;, only keep that one)</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hCacheControl</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Clear-Site-Data&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#KeepOnly"><span class="hs-identifier hs-var">KeepOnly</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- wildcard (if any is &quot;*&quot;, only keep that one)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-comment">-- If &quot;close&quot; and anything else is used together, it's already F-ed,</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-comment">-- so just combine them.</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hConnection</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hContentEncoding</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hContentLanguage</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Digest&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-comment">-- We could handle this, but it's experimental AND</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-comment">-- will be replaced by &quot;Permissions-Policy&quot;</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-comment">-- , &quot;Feature-Policy&quot; -- &quot;semicolon ';' separated&quot;</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hIfMatch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hIfNoneMatch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#KeepOnly"><span class="hs-identifier hs-var">KeepOnly</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- wildcard? (if any is &quot;*&quot;, only keep that one)</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Link&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Permissions-Policy&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hTE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Timing-Allow-Origin&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#KeepOnly"><span class="hs-identifier hs-var">KeepOnly</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- wildcard? (if any is &quot;*&quot;, only keep that one)</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hTrailer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hTransferEncoding</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hUpgrade</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hVia</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-identifier hs-var">H.hVary</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#KeepOnly"><span class="hs-identifier hs-var">KeepOnly</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- wildcard? (if any is &quot;*&quot;, only keep that one)</span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Want-Digest&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandleType
</span><a href="Network.Wai.Middleware.CombineHeaders.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-300"></span></pre></body></html>