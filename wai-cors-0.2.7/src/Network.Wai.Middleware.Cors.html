<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE PatternGuards #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE UnicodeSyntax #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Module: Network.Wai.Middleware.Cors</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Description: Cross-Origin resource sharing (CORS) for WAI</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Copyright:</span><span>
</span><span id="line-12"></span><span class="hs-comment">--     &#169; 2015-2019 Lars Kuhtz &lt;lakuhtz@gmail.com,</span><span>
</span><span id="line-13"></span><span class="hs-comment">--     &#169; 2014 AlephCloud Systems, Inc.</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- License: MIT</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Maintainer: Lars Kuhtz &lt;lakuhtz@gmail.com&gt;</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- Stability: stable</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- An implemenation of Cross-Origin resource sharing (CORS) for WAI that</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- aims to be compliant with &lt;http://www.w3.org/TR/cors&gt;.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- The function 'simpleCors' enables support of simple cross-origin requests. More</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- advanced CORS policies can be enabled by passing a 'CorsResourcePolicy' to the</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- 'cors' middleware.</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- = Note On Security</span><span>
</span><span id="line-26"></span><span class="hs-comment">--</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- This implementation doens't include any server side enforcement. By</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- complying with the CORS standard it enables the client (i.e. the web</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- browser) to enforce the CORS policy. For application authors it is strongly</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- recommended to take into account the security considerations in section 6.3</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- of &lt;http://www.w3.org/TR/cors&gt;. In particular the application should check</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- that the value of the @Origin@ header matches it's expectations.</span><span>
</span><span id="line-33"></span><span class="hs-comment">--</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- = Websockets</span><span>
</span><span id="line-35"></span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- Websocket connections don't support CORS and are ignored by this CORS</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- implementation. However Websocket requests usually (at least for some</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- browsers) include the @Origin@ header. Applications are expected to check</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- the value of this header and respond with an error in case that its content</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- doesn't match the expectations.</span><span>
</span><span id="line-41"></span><span class="hs-comment">--</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- = Example</span><span>
</span><span id="line-43"></span><span class="hs-comment">--</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- The following is an example how to enable support for simple cross-origin requests</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- for a &lt;http://hackage.haskell.org/package/scotty scotty&gt; application.</span><span>
</span><span id="line-46"></span><span class="hs-comment">--</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- &gt; {-# LANGUAGE UnicodeSyntax #-}</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- &gt; {-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- &gt; module Main</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- &gt; ( main</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- &gt; ) where</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- &gt; import Network.Wai.Middleware.Cors</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- &gt; import Web.Scotty</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- &gt; main &#8759; IO ()</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- &gt; main = scotty 8080 $ do</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- &gt;     middleware simpleCors</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- &gt;     matchAny  &quot;/&quot; $ text &quot;Success&quot;</span><span>
</span><span id="line-61"></span><span class="hs-comment">--</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- The result of following curl command will include the HTTP response header</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- @Access-Control-Allow-Origin: *@.</span><span>
</span><span id="line-64"></span><span class="hs-comment">--</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- &gt; curl -i http://127.0.0.1:8888 -H 'Origin: 127.0.0.1' -v</span><span>
</span><span id="line-66"></span><span class="hs-comment">--</span><span>
</span><span id="line-67"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.Wai.Middleware.Cors</span><span>
</span><span id="line-68"></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#Origin"><span class="hs-identifier">Origin</span></a></span><span>
</span><span id="line-69"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier">CorsResourcePolicy</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleCorsResourcePolicy"><span class="hs-identifier">simpleCorsResourcePolicy</span></a></span><span>
</span><span id="line-71"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#cors"><span class="hs-identifier">cors</span></a></span><span>
</span><span id="line-72"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleCors"><span class="hs-identifier">simpleCors</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="annot"><span class="hs-comment">-- * Utils</span></span><span>
</span><span id="line-75"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#isSimple"><span class="hs-identifier">isSimple</span></a></span><span>
</span><span id="line-76"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleResponseHeaders"><span class="hs-identifier">simpleResponseHeaders</span></a></span><span>
</span><span id="line-77"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleHeaders"><span class="hs-identifier">simpleHeaders</span></a></span><span>
</span><span id="line-78"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleContentTypes"><span class="hs-identifier">simpleContentTypes</span></a></span><span>
</span><span id="line-79"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleMethods"><span class="hs-identifier">simpleMethods</span></a></span><span>
</span><span id="line-80"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Error.Class</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Except</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Attoparsec.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B8</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LB8</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.CaseInsensitive</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CI</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">intersect</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(\\)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">union</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid.Unicode</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WAI</span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude.Unicode</span></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Origins are expected to be formated as described in</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- &lt;https://www.ietf.org/rfc/rfc6454.txt RFC6454&gt; (section 6.2).</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- In particular the string @*@ is not a valid origin (but the string</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- @null@ is).</span><span>
</span><span id="line-103"></span><span class="hs-comment">--</span><span>
</span><span id="line-104"></span><span class="hs-keyword">type</span><span> </span><span id="Origin"><span class="annot"><a href="Network.Wai.Middleware.Cors.html#Origin"><span class="hs-identifier hs-var">Origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">data</span><span> </span><span id="CorsResourcePolicy"><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-var">CorsResourcePolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CorsResourcePolicy"><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-var">CorsResourcePolicy</span></a></span></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">{</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-comment">-- | HTTP origins that are allowed in CORS requests.</span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-comment">-- A value of 'Nothing' indicates unrestricted cross-origin sharing and</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- results in @*@ as value for the @Access-Control-Allow-Origin@ HTTP</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- response header. Note if you send @*@, credentials cannot be sent with the request.</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-comment">-- A value other than 'Nothing' is a tuple that consists of a list of</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-comment">-- origins and a Boolean flag that indicates if credentials are used</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-comment">-- to access the resource via CORS.</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-comment">-- Origins must be formated as described in</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-comment">-- &lt;https://www.ietf.org/rfc/rfc6454.txt RFC6454&gt; (section 6.2). In</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-comment">-- particular the string @*@ is not a valid origin (but the string @null@</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-comment">-- is).</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-comment">-- Credentials include cookies, authorization headers and TLS client certificates.</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-comment">-- For credentials to be sent with requests, the @withCredentials@ setting of</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-comment">-- @XmlHttpRequest@ in the browser must be set to @true@.</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-128"></span><span>       </span><span id="corsOrigins"><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Maybe ([ByteString], Bool)
</span><a href="Network.Wai.Middleware.Cors.html#corsOrigins"><span class="hs-identifier hs-var hs-var">corsOrigins</span></a></span></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#Origin"><span class="hs-identifier hs-type">Origin</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-comment">-- | HTTP methods that are allowed in CORS requests.</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="corsMethods"><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; [ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#corsMethods"><span class="hs-identifier hs-var hs-var">corsMethods</span></a></span></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Method</span></span><span class="hs-special">]</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-comment">-- | Field names of HTTP request headers that are allowed in CORS requests.</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-comment">-- Header names that are included in 'simpleHeaders', except for</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">-- @content-type@, are implicitly included and thus optional in this list.</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="corsRequestHeaders"><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#corsRequestHeaders"><span class="hs-identifier hs-var hs-var">corsRequestHeaders</span></a></span></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- | Field names of HTTP headers that are exposed to the client in the response.</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="corsExposedHeaders"><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Maybe [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#corsExposedHeaders"><span class="hs-identifier hs-var hs-var">corsExposedHeaders</span></a></span></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-comment">-- | Number of seconds that the OPTIONS preflight response may be cached by the client.</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">-- Tip: Set this to 'Nothing' while testing your CORS implementation, then increase</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">-- it once you deploy to production.</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="corsMaxAge"><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Maybe Int
</span><a href="Network.Wai.Middleware.Cors.html#corsMaxAge"><span class="hs-identifier hs-var hs-var">corsMaxAge</span></a></span></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-comment">-- | If the resource is shared by multiple origins but</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- @Access-Control-Allow-Origin@ is not set to @*@ this may be set to</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">-- 'True' to cause the server to include a @Vary: Origin@ header in the</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">-- response, thus indicating that the value of the</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">-- @Access-Control-Allow-Origin@ header may vary between different requests</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- for the same resource. This prevents caching of the responses which may</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- not apply accross different origins.</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="corsVaryOrigin"><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#corsVaryOrigin"><span class="hs-identifier hs-var hs-var">corsVaryOrigin</span></a></span></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-comment">-- | If this is 'True' and the request does not include an @Origin@ header</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- the response has HTTP status 400 (bad request) and the body contains</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- a short error message.</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">-- If this is 'False' and the request does not include an @Origin@ header</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- the request is passed on unchanged to the application.</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-comment">-- @since 0.2</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="corsRequireOrigin"><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#corsRequireOrigin"><span class="hs-identifier hs-var hs-var">corsRequireOrigin</span></a></span></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- | In the case that</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- * the request contains an @Origin@ header and</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- * the client does not conform with the CORS protocol</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">--   (/request is out of scope/)</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">-- then</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- * the request is passed on unchanged to the application if this field is</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">--   'True' or</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-comment">-- * an response with HTTP status 400 (bad request) and short</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-comment">--   error message is returned if this field is 'False'.</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">-- Note: Your application needs to will receive preflight OPTIONS requests if set to 'True'.</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-comment">-- @since 0.2</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="corsIgnoreFailures"><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#corsIgnoreFailures"><span class="hs-identifier hs-var hs-var">corsIgnoreFailures</span></a></span></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679055716"><span id="local-6989586621679055718"><span id="local-6989586621679055737"><span class="annot"><span class="annottext">Int -&gt; CorsResourcePolicy -&gt; ShowS
[CorsResourcePolicy] -&gt; ShowS
CorsResourcePolicy -&gt; [Char]
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CorsResourcePolicy] -&gt; ShowS
$cshowList :: [CorsResourcePolicy] -&gt; ShowS
show :: CorsResourcePolicy -&gt; [Char]
$cshow :: CorsResourcePolicy -&gt; [Char]
showsPrec :: Int -&gt; CorsResourcePolicy -&gt; ShowS
$cshowsPrec :: Int -&gt; CorsResourcePolicy -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679055665"><span id="local-6989586621679055702"><span id="local-6989586621679055705"><span id="local-6989586621679055707"><span class="annot"><span class="annottext">ReadPrec [CorsResourcePolicy]
ReadPrec CorsResourcePolicy
Int -&gt; ReadS CorsResourcePolicy
ReadS [CorsResourcePolicy]
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
readListPrec :: ReadPrec [CorsResourcePolicy]
$creadListPrec :: ReadPrec [CorsResourcePolicy]
readPrec :: ReadPrec CorsResourcePolicy
$creadPrec :: ReadPrec CorsResourcePolicy
readList :: ReadS [CorsResourcePolicy]
$creadList :: ReadS [CorsResourcePolicy]
readsPrec :: Int -&gt; ReadS CorsResourcePolicy
$creadsPrec :: Int -&gt; ReadS CorsResourcePolicy
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679055640"><span id="local-6989586621679055655"><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
$c/= :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
== :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
$c== :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679055589"><span id="local-6989586621679055591"><span id="local-6989586621679055594"><span id="local-6989586621679055597"><span id="local-6989586621679055600"><span id="local-6989586621679055615"><span id="local-6989586621679055632"><span class="annot"><span class="annottext">Eq CorsResourcePolicy
CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Ordering
CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; CorsResourcePolicy
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; CorsResourcePolicy
$cmin :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; CorsResourcePolicy
max :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; CorsResourcePolicy
$cmax :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; CorsResourcePolicy
&gt;= :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
$c&gt;= :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
&gt; :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
$c&gt; :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
&lt;= :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
$c&lt;= :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
&lt; :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
$c&lt; :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Bool
compare :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Ordering
$ccompare :: CorsResourcePolicy -&gt; CorsResourcePolicy -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- | A 'CorsResourcePolicy' that supports /simple cross-origin requests/ as defined</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- in &lt;http://www.w3.org/TR/cors/&gt;.</span><span>
</span><span id="line-196"></span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- * The HTTP header @Access-Control-Allow-Origin@ is set to @*@.</span><span>
</span><span id="line-198"></span><span class="hs-comment">--</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- * Request methods are constraint to /simple methods/ (@GET@, @HEAD@, @POST@).</span><span>
</span><span id="line-200"></span><span class="hs-comment">--</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- * Request headers are constraint to /simple request headers/</span><span>
</span><span id="line-202"></span><span class="hs-comment">--   (@Accept@, @Accept-Language@, @Content-Language@, @Content-Type@).</span><span>
</span><span id="line-203"></span><span class="hs-comment">--</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- * If the request is a @POST@ request the content type is constraint to</span><span>
</span><span id="line-205"></span><span class="hs-comment">--    /simple content types/</span><span>
</span><span id="line-206"></span><span class="hs-comment">--    (@application/x-www-form-urlencoded@, @multipart/form-data@, @text/plain@),</span><span>
</span><span id="line-207"></span><span class="hs-comment">--</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- * Only /simple response headers/ may be exposed on the client</span><span>
</span><span id="line-209"></span><span class="hs-comment">--   (@Cache-Control@, @Content-Language@, @Content-Type@, @Expires@, @Last-Modified@,  @Pragma@)</span><span>
</span><span id="line-210"></span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- * The @Vary-Origin@ header is left unchanged (possibly unset).</span><span>
</span><span id="line-212"></span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- * If the request doesn't include an @Origin@ header the request is passed unchanged to</span><span>
</span><span id="line-214"></span><span class="hs-comment">--   the application.</span><span>
</span><span id="line-215"></span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- * If the request includes an @Origin@ header but does not conform to the CORS</span><span>
</span><span id="line-217"></span><span class="hs-comment">--   protocol (/request is out of scope/) an response with HTTP status 400 (bad request)</span><span>
</span><span id="line-218"></span><span class="hs-comment">--   and a short error message is returned.</span><span>
</span><span id="line-219"></span><span class="hs-comment">--</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- For /simple cross-origin requests/ a preflight request is not required. However, if</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- the client chooses to make a preflight request it is answered in accordance with</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- the policy for /simple cross-origin requests/.</span><span>
</span><span id="line-223"></span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleCorsResourcePolicy"><span class="hs-identifier hs-type">simpleCorsResourcePolicy</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-type">CorsResourcePolicy</span></a></span><span>
</span><span id="line-225"></span><span id="simpleCorsResourcePolicy"><span class="annot"><span class="annottext">simpleCorsResourcePolicy :: CorsResourcePolicy
</span><a href="Network.Wai.Middleware.Cors.html#simpleCorsResourcePolicy"><span class="hs-identifier hs-var hs-var">simpleCorsResourcePolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-type">CorsResourcePolicy</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">corsOrigins :: Maybe ([ByteString], Bool)
</span><a href="Network.Wai.Middleware.Cors.html#corsOrigins"><span class="hs-identifier hs-var">corsOrigins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">corsMethods :: [ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#corsMethods"><span class="hs-identifier hs-var">corsMethods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleMethods"><span class="hs-identifier hs-var">simpleMethods</span></a></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">corsRequestHeaders :: [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#corsRequestHeaders"><span class="hs-identifier hs-var">corsRequestHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">corsExposedHeaders :: Maybe [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#corsExposedHeaders"><span class="hs-identifier hs-var">corsExposedHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">corsMaxAge :: Maybe Int
</span><a href="Network.Wai.Middleware.Cors.html#corsMaxAge"><span class="hs-identifier hs-var">corsMaxAge</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">corsVaryOrigin :: Bool
</span><a href="Network.Wai.Middleware.Cors.html#corsVaryOrigin"><span class="hs-identifier hs-var">corsVaryOrigin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">corsRequireOrigin :: Bool
</span><a href="Network.Wai.Middleware.Cors.html#corsRequireOrigin"><span class="hs-identifier hs-var">corsRequireOrigin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">corsIgnoreFailures :: Bool
</span><a href="Network.Wai.Middleware.Cors.html#corsIgnoreFailures"><span class="hs-identifier hs-var">corsIgnoreFailures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | A Cross-Origin resource sharing (CORS) middleware.</span><span>
</span><span id="line-237"></span><span class="hs-comment">--</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- The middleware is given a function that serves as a pattern to decide</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- whether a requested resource is available for CORS. If the match fails with</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- 'Nothing' the request is passed unmodified to the inner application.</span><span>
</span><span id="line-241"></span><span class="hs-comment">--</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- The current version of this module does only aim at compliance with the CORS</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- protocol as specified in &lt;http://www.w3.org/TR/cors/&gt;. In accordance with</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- that standard the role of the server side is to support the client to</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- enforce CORS restrictions. This module does not implement any enforcement of</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- authorization policies that are possibly implied by the</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- 'CorsResourcePolicy'. It is up to the inner WAI application to enforce such</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- policy and make sure that it is in accordance with the configuration of the</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- 'cors' middleware.</span><span>
</span><span id="line-250"></span><span class="hs-comment">--</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- Matches are done as follows: @*@ matches every origin. For all other cases a</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- match succeeds if and only if the ASCII serializations (as described in</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- RCF6454 section 6.2) are equal.</span><span>
</span><span id="line-254"></span><span class="hs-comment">--</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- The OPTIONS method may return options for resources that are not actually</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- available. In particular for preflight requests the implementation returns</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- for the HTTP response headers @Access-Control-Allow-Headers@ and</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- @Access-Control-Allow-Methods@ all values specified in the</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- 'CorsResourcePolicy' together with the respective values for simple requests</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- (except @content-type@). This does not imply that the application actually</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- supports the respective values are for the requested resource. Thus,</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- depending on the application, an actual request may still fail with 404 even</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- if the preflight request /supported/ the usage of the HTTP method with CORS.</span><span>
</span><span id="line-264"></span><span class="hs-comment">--</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- The implementation does not distinguish between simple requests and requests</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- that require preflight. The client is free to omit a preflight request or do</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- a preflight request in cases when it wouldn't be required.</span><span>
</span><span id="line-268"></span><span class="hs-comment">--</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- For application authors it is strongly recommended to take into account the</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- security considerations in section 6.3 of &lt;http://www.w3.org/TR/cors&gt;.</span><span>
</span><span id="line-271"></span><span class="hs-comment">--</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- /TODO/</span><span>
</span><span id="line-273"></span><span class="hs-comment">--</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- * We may consider adding optional enforcment aspects to this module: we may</span><span>
</span><span id="line-275"></span><span class="hs-comment">--   check if a request respects our origin restrictions and we may check that a</span><span>
</span><span id="line-276"></span><span class="hs-comment">--   CORS request respects the restrictions that we publish in the preflight</span><span>
</span><span id="line-277"></span><span class="hs-comment">--   responses.</span><span>
</span><span id="line-278"></span><span class="hs-comment">--</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- * Even though slightly out of scope we may (optionally) check if</span><span>
</span><span id="line-280"></span><span class="hs-comment">--   host header matches the actual host of the resource, since clients</span><span>
</span><span id="line-281"></span><span class="hs-comment">--   using CORS may expect this, since this check is recommended in</span><span>
</span><span id="line-282"></span><span class="hs-comment">--   &lt;http://www.w3.org/TR/cors&gt;.</span><span>
</span><span id="line-283"></span><span class="hs-comment">--</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- * We may consider integrating CORS policy handling more closely with the</span><span>
</span><span id="line-285"></span><span class="hs-comment">--   handling of the source, for instance by integrating with 'ActionM' from</span><span>
</span><span id="line-286"></span><span class="hs-comment">--   scotty.</span><span>
</span><span id="line-287"></span><span class="hs-comment">--</span><span>
</span><span id="line-288"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#cors"><span class="hs-identifier hs-type">cors</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WAI.Request</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-type">CorsResourcePolicy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ A value of 'Nothing' indicates that the resource is not available for CORS</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WAI.Middleware</span></span><span>
</span><span id="line-291"></span><span id="cors"><span class="annot"><span class="annottext">cors :: (Request -&gt; Maybe CorsResourcePolicy) -&gt; Middleware
</span><a href="Network.Wai.Middleware.Cors.html#cors"><span class="hs-identifier hs-var hs-var">cors</span></a></span></span><span> </span><span id="local-6989586621679055581"><span class="annot"><span class="annottext">Request -&gt; Maybe CorsResourcePolicy
</span><a href="#local-6989586621679055581"><span class="hs-identifier hs-var">policyPattern</span></a></span></span><span> </span><span id="local-6989586621679055580"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679055580"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span id="local-6989586621679055579"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055579"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679055578"><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055578"><span class="hs-identifier hs-var">respond</span></a></span></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-comment">-- We don't handle websockets, even if they include an @Origin@ header</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#isWebSocketsReq"><span class="hs-identifier hs-var">isWebSocketsReq</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055579"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ResponseReceived
</span><a href="#local-6989586621679055576"><span class="hs-identifier hs-var">runApp</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679055575"><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055575"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">&#8592;</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Maybe CorsResourcePolicy
</span><a href="#local-6989586621679055581"><span class="hs-identifier hs-var">policyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055579"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679055574"><span class="hs-identifier hs-var">hdrOrigin</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-comment">-- No origin header: reject request</span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#corsRequireOrigin"><span class="hs-identifier hs-var">corsRequireOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055575"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055573"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Response
</span><a href="Network.Wai.Middleware.Cors.html#corsFailure"><span class="hs-identifier hs-var">corsFailure</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Origin header is missing&quot;</span></span><span>
</span><span id="line-300"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO ResponseReceived
</span><a href="#local-6989586621679055576"><span class="hs-identifier hs-var">runApp</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-comment">-- Origin header: apply CORS policy to request</span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679055571"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055571"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; ByteString -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055570"><span class="hs-identifier hs-var">applyCorsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055575"><span class="hs-identifier hs-var">policy</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055571"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ResponseReceived
</span><a href="#local-6989586621679055576"><span class="hs-identifier hs-var">runApp</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621679055573"><span class="annot"><span class="annottext">res :: Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055573"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055578"><span class="hs-identifier hs-var">respond</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621679055576"><span class="annot"><span class="annottext">runApp :: IO ResponseReceived
</span><a href="#local-6989586621679055576"><span class="hs-identifier hs-var hs-var">runApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679055580"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055579"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055578"><span class="hs-identifier hs-var">respond</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-comment">-- Lookup the HTTP origin request header</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-312"></span><span>    </span><span id="local-6989586621679055574"><span class="annot"><span class="annottext">hdrOrigin :: Maybe ByteString
</span><a href="#local-6989586621679055574"><span class="hs-identifier hs-var hs-var">hdrOrigin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;origin&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ResponseHeaders
</span><span class="hs-identifier hs-var">WAI.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055579"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">-- Process a CORS request</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621679055570"><span class="annot"><span class="annottext">applyCorsPolicy :: CorsResourcePolicy -&gt; ByteString -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055570"><span class="hs-identifier hs-var hs-var">applyCorsPolicy</span></a></span></span><span> </span><span id="local-6989586621679055567"><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055567"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span id="local-6989586621679055566"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055566"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>        </span><span class="hs-comment">-- The error continuation</span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679055565"><span class="annot"><span class="annottext">err :: [Char] -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055565"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679055564"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679055564"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#corsIgnoreFailures"><span class="hs-identifier hs-var">corsIgnoreFailures</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055567"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-320"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO ResponseReceived
</span><a href="#local-6989586621679055576"><span class="hs-identifier hs-var">runApp</span></a></span><span>
</span><span id="line-321"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055573"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Response
</span><a href="Network.Wai.Middleware.Cors.html#corsFailure"><span class="hs-identifier hs-var">corsFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.pack</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679055564"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-comment">-- Match request origin with corsOrigins from policy</span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679055562"><span class="annot"><span class="annottext">respOriginOrErr :: Either [Char] (Maybe (ByteString, Bool))
</span><a href="#local-6989586621679055562"><span class="hs-identifier hs-var hs-var">respOriginOrErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Maybe ([ByteString], Bool)
</span><a href="Network.Wai.Middleware.Cors.html#corsOrigins"><span class="hs-identifier hs-var">corsOrigins</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055567"><span class="hs-identifier hs-var">policy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-325"></span><span>                </span><span class="annot"><span class="annottext">Maybe ([ByteString], Bool)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-326"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679055561"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679055561"><span class="hs-identifier hs-var">originList</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679055560"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679055560"><span class="hs-identifier hs-var">withCreds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055566"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679055561"><span class="hs-identifier hs-var">originList</span></a></span><span>
</span><span id="line-327"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055566"><span class="hs-identifier hs-var">origin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679055560"><span class="hs-identifier hs-var">withCreds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unsupported origin: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055566"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either [Char] (Maybe (ByteString, Bool))
</span><a href="#local-6989586621679055562"><span class="hs-identifier hs-var">respOriginOrErr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-331"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679055556"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679055556"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055565"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679055556"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-332"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679055555"><span class="annot"><span class="annottext">Maybe (ByteString, Bool)
</span><a href="#local-6989586621679055555"><span class="hs-identifier hs-var">respOrigin</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>                </span><span class="hs-comment">-- Determine headers that are common to actuall responses and preflight responses</span><span>
</span><span id="line-335"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679055554"><span class="annot"><span class="annottext">ch :: ResponseHeaders
</span><a href="#local-6989586621679055554"><span class="hs-identifier hs-var hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ByteString, Bool) -&gt; Bool -&gt; ResponseHeaders
</span><a href="#local-6989586621679055553"><span class="hs-identifier hs-var">commonCorsHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ByteString, Bool)
</span><a href="#local-6989586621679055555"><span class="hs-identifier hs-var">respOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#corsVaryOrigin"><span class="hs-identifier hs-var">corsVaryOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055567"><span class="hs-identifier hs-var">policy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><span class="hs-identifier hs-var">WAI.requestMethod</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055579"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>                    </span><span class="hs-comment">-- Preflight CORS request</span><span>
</span><span id="line-340"></span><span>                    </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;OPTIONS&quot;</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (&#956; :: * -&gt; *).
(Functor &#956;, Monad &#956;) =&gt;
CorsResourcePolicy -&gt; ExceptT [Char] &#956; ResponseHeaders
</span><a href="#local-6989586621679055550"><span class="hs-identifier hs-var">preflightHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055567"><span class="hs-identifier hs-var">policy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-341"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679055549"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679055549"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055565"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679055549"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-342"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679055548"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055548"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055573"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ByteString -&gt; Response
</span><span class="hs-identifier hs-var">WAI.responseLBS</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">HTTP.ok200</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055554"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055548"><span class="hs-identifier hs-var">headers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>                    </span><span class="hs-comment">-- Actual CORS request</span><span>
</span><span id="line-345"></span><span>                    </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">ResponseHeaders -&gt; Middleware
</span><a href="Network.Wai.Middleware.Cors.html#addHeaders"><span class="hs-identifier hs-var">addHeaders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055554"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; ResponseHeaders
</span><a href="#local-6989586621679055544"><span class="hs-identifier hs-var">respCorsHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055567"><span class="hs-identifier hs-var">policy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679055580"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055579"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055578"><span class="hs-identifier hs-var">respond</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-comment">-- Compute HTTP response headers for a preflight request</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621679055959"><span class="annot"><a href="#local-6989586621679055550"><span class="hs-identifier hs-type">preflightHeaders</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679055959"><span class="hs-identifier hs-type">&#956;</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679055959"><span class="hs-identifier hs-type">&#956;</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&#8658;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-type">CorsResourcePolicy</span></a></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679055959"><span class="hs-identifier hs-type">&#956;</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.ResponseHeaders</span></span></span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621679055550"><span class="annot"><span class="annottext">preflightHeaders :: forall (&#956; :: * -&gt; *).
(Functor &#956;, Monad &#956;) =&gt;
CorsResourcePolicy -&gt; ExceptT [Char] &#956; ResponseHeaders
</span><a href="#local-6989586621679055550"><span class="hs-identifier hs-var hs-var">preflightHeaders</span></a></span></span><span> </span><span id="local-6989586621679055531"><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055531"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span>
</span><span id="line-351"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall (&#956; :: * -&gt; *).
Monad &#956; =&gt;
CorsResourcePolicy -&gt; ExceptT [Char] &#956; ResponseHeaders
</span><a href="#local-6989586621679055527"><span class="hs-identifier hs-var">hdrReqMethod</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055531"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (&#956; :: * -&gt; *).
Monad &#956; =&gt;
CorsResourcePolicy -&gt; ExceptT [Char] &#956; ResponseHeaders
</span><a href="#local-6989586621679055526"><span class="hs-identifier hs-var">hdrRequestHeader</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055531"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (&#956; :: * -&gt; *).
Monad &#956; =&gt;
CorsResourcePolicy -&gt; ExceptT [Char] &#956; ResponseHeaders
</span><a href="#local-6989586621679055525"><span class="hs-identifier hs-var">hdrMaxAge</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055531"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-354"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621679055524"><span class="annot"><a href="#local-6989586621679055525"><span class="hs-identifier hs-type">hdrMaxAge</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679055524"><span class="hs-identifier hs-type">&#956;</span></a></span><span> </span><span class="hs-glyph">&#8658;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-type">CorsResourcePolicy</span></a></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679055524"><span class="hs-identifier hs-type">&#956;</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.ResponseHeaders</span></span></span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621679055525"><span class="annot"><span class="annottext">hdrMaxAge :: forall (&#956; :: * -&gt; *).
Monad &#956; =&gt;
CorsResourcePolicy -&gt; ExceptT [Char] &#956; ResponseHeaders
</span><a href="#local-6989586621679055525"><span class="hs-identifier hs-var hs-var">hdrMaxAge</span></a></span></span><span> </span><span id="local-6989586621679055517"><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055517"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Maybe Int
</span><a href="Network.Wai.Middleware.Cors.html#corsMaxAge"><span class="hs-identifier hs-var">corsMaxAge</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055517"><span class="hs-identifier hs-var">policy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679055516"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679055516"><span class="hs-identifier hs-var">secs</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Access-Control-Max-Age&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall &#945; &#946;. (IsString &#945;, Show &#946;) =&gt; &#946; -&gt; &#945;
</span><a href="Network.Wai.Middleware.Cors.html#sshow"><span class="hs-identifier hs-var">sshow</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679055516"><span class="hs-identifier hs-var">secs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>    </span><span id="local-6989586621679055942"><span class="annot"><a href="#local-6989586621679055527"><span class="hs-identifier hs-type">hdrReqMethod</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679055942"><span class="hs-identifier hs-type">&#956;</span></a></span><span> </span><span class="hs-glyph">&#8658;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-type">CorsResourcePolicy</span></a></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679055942"><span class="hs-identifier hs-type">&#956;</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.ResponseHeaders</span></span></span><span>
</span><span id="line-362"></span><span>    </span><span id="local-6989586621679055527"><span class="annot"><span class="annottext">hdrReqMethod :: forall (&#956; :: * -&gt; *).
Monad &#956; =&gt;
CorsResourcePolicy -&gt; ExceptT [Char] &#956; ResponseHeaders
</span><a href="#local-6989586621679055527"><span class="hs-identifier hs-var hs-var">hdrReqMethod</span></a></span></span><span> </span><span id="local-6989586621679055495"><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055495"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Access-Control-Request-Method&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ResponseHeaders
</span><span class="hs-identifier hs-var">WAI.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055579"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-363"></span><span>        </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Access-Control-Request-Method header is missing in CORS preflight request&quot;</span></span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679055493"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055493"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-keyword">if</span><span>  </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055493"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679055492"><span class="hs-identifier hs-var">supportedMethods</span></a></span><span>
</span><span id="line-365"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Access-Control-Allow-Methods&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="Network.Wai.Middleware.Cors.html#hdrL"><span class="hs-identifier hs-var">hdrL</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679055492"><span class="hs-identifier hs-var">supportedMethods</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-366"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-367"></span><span>                </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Method requested in Access-Control-Request-Method of CORS request is not supported; requested: &quot;</span></span><span>
</span><span id="line-368"></span><span>                </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055493"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-369"></span><span>                </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;; supported are &quot;</span></span><span>
</span><span id="line-370"></span><span>                </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="Network.Wai.Middleware.Cors.html#hdrL"><span class="hs-identifier hs-var">hdrL</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679055492"><span class="hs-identifier hs-var">supportedMethods</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>                </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-372"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-373"></span><span>         </span><span id="local-6989586621679055492"><span class="annot"><span class="annottext">supportedMethods :: [ByteString]
</span><a href="#local-6989586621679055492"><span class="hs-identifier hs-var hs-var">supportedMethods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; [ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#corsMethods"><span class="hs-identifier hs-var">corsMethods</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055495"><span class="hs-identifier hs-var">policy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`union`</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleMethods"><span class="hs-identifier hs-var">simpleMethods</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>    </span><span id="local-6989586621679055490"><span class="annot"><a href="#local-6989586621679055526"><span class="hs-identifier hs-type">hdrRequestHeader</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679055490"><span class="hs-identifier hs-type">&#956;</span></a></span><span> </span><span class="hs-glyph">&#8658;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-type">CorsResourcePolicy</span></a></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679055490"><span class="hs-identifier hs-type">&#956;</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.ResponseHeaders</span></span></span><span>
</span><span id="line-376"></span><span>    </span><span id="local-6989586621679055526"><span class="annot"><span class="annottext">hdrRequestHeader :: forall (&#956; :: * -&gt; *).
Monad &#956; =&gt;
CorsResourcePolicy -&gt; ExceptT [Char] &#956; ResponseHeaders
</span><a href="#local-6989586621679055526"><span class="hs-identifier hs-var hs-var">hdrRequestHeader</span></a></span></span><span> </span><span id="local-6989586621679055470"><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055470"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Access-Control-Request-Headers&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ResponseHeaders
</span><span class="hs-identifier hs-var">WAI.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055579"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-377"></span><span>        </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679055469"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055469"><span class="hs-identifier hs-var">hdrsBytes</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-379"></span><span>            </span><span id="local-6989586621679055468"><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055468"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&#8592;</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Parser a -&gt; ByteString -&gt; Either [Char] a
</span><span class="hs-identifier hs-var">P.parseOnly</span></span><span> </span><span class="annot"><span class="annottext">Parser [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#httpHeaderNameListParser"><span class="hs-identifier hs-var">httpHeaderNameListParser</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055469"><span class="hs-identifier hs-var">hdrsBytes</span></a></span><span>
</span><span id="line-380"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055468"><span class="hs-identifier hs-var">hdrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall &#945;. Eq &#945; =&gt; [&#945;] -&gt; [&#945;] -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#isSubsetOf"><span class="hs-operator hs-var">`isSubsetOf`</span></a></span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055463"><span class="hs-identifier hs-var">supportedHeaders</span></a></span><span>
</span><span id="line-381"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Access-Control-Allow-Headers&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CI ByteString] -&gt; ByteString
</span><a href="Network.Wai.Middleware.Cors.html#hdrLI"><span class="hs-identifier hs-var">hdrLI</span></a></span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055463"><span class="hs-identifier hs-var">supportedHeaders</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-382"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-383"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;HTTP header requested in Access-Control-Request-Headers of CORS request is not supported; requested: &quot;</span></span><span>
</span><span id="line-384"></span><span>                    </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CI ByteString] -&gt; ByteString
</span><a href="Network.Wai.Middleware.Cors.html#hdrLI"><span class="hs-identifier hs-var">hdrLI</span></a></span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055468"><span class="hs-identifier hs-var">hdrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>                    </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;; supported are &quot;</span></span><span>
</span><span id="line-386"></span><span>                    </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CI ByteString] -&gt; ByteString
</span><a href="Network.Wai.Middleware.Cors.html#hdrLI"><span class="hs-identifier hs-var">hdrLI</span></a></span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055463"><span class="hs-identifier hs-var">supportedHeaders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>                    </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-389"></span><span>        </span><span id="local-6989586621679055463"><span class="annot"><span class="annottext">supportedHeaders :: [CI ByteString]
</span><a href="#local-6989586621679055463"><span class="hs-identifier hs-var hs-var">supportedHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#corsRequestHeaders"><span class="hs-identifier hs-var">corsRequestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055470"><span class="hs-identifier hs-var">policy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`union`</span></span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055461"><span class="hs-identifier hs-var">simpleHeadersWithoutContentType</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>    </span><span id="local-6989586621679055461"><span class="annot"><span class="annottext">simpleHeadersWithoutContentType :: [CI ByteString]
</span><a href="#local-6989586621679055461"><span class="hs-identifier hs-var hs-var">simpleHeadersWithoutContentType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleHeaders"><span class="hs-identifier hs-var">simpleHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">\\</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;content-type&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-comment">-- HTTP response headers that are common to normal and preflight CORS responses</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><a href="#local-6989586621679055553"><span class="hs-identifier hs-type">commonCorsHeaders</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#Origin"><span class="hs-identifier hs-type">Origin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.ResponseHeaders</span></span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621679055553"><span class="annot"><span class="annottext">commonCorsHeaders :: Maybe (ByteString, Bool) -&gt; Bool -&gt; ResponseHeaders
</span><a href="#local-6989586621679055553"><span class="hs-identifier hs-var hs-var">commonCorsHeaders</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (ByteString, Bool)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Access-Control-Allow-Origin&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><a href="#local-6989586621679055553"><span class="hs-identifier hs-var">commonCorsHeaders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679055455"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055455"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679055454"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679055454"><span class="hs-identifier hs-var">creds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679055453"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679055453"><span class="hs-identifier hs-var">vary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {a}.
(Applicative f, Monoid (f a)) =&gt;
Bool -&gt; a -&gt; f a
</span><a href="#local-6989586621679055452"><span class="hs-operator hs-var">??</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Access-Control-Allow-Origin&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055455"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>        </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679055454"><span class="hs-identifier hs-var">creds</span></a></span><span> </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {a}.
(Applicative f, Monoid (f a)) =&gt;
Bool -&gt; a -&gt; f a
</span><a href="#local-6989586621679055452"><span class="hs-operator hs-var">??</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Access-Control-Allow-Credentials&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;true&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>        </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679055453"><span class="hs-identifier hs-var">vary</span></a></span><span> </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {a}.
(Applicative f, Monoid (f a)) =&gt;
Bool -&gt; a -&gt; f a
</span><a href="#local-6989586621679055452"><span class="hs-operator hs-var">??</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Vary&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Origin&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-402"></span><span>        </span><span id="local-6989586621679055452"><span class="annot"><span class="annottext">?? :: Bool -&gt; a -&gt; f a
</span><a href="#local-6989586621679055452"><span class="hs-operator hs-var hs-var">(??)</span></a></span></span><span> </span><span id="local-6989586621679055447"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679055447"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679055446"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679055446"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679055447"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679055446"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-comment">-- HTTP response headers that are only used with normal CORS responses</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><a href="#local-6989586621679055544"><span class="hs-identifier hs-type">respCorsHeaders</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#CorsResourcePolicy"><span class="hs-identifier hs-type">CorsResourcePolicy</span></a></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.ResponseHeaders</span></span><span>
</span><span id="line-407"></span><span>    </span><span id="local-6989586621679055544"><span class="annot"><span class="annottext">respCorsHeaders :: CorsResourcePolicy -&gt; ResponseHeaders
</span><a href="#local-6989586621679055544"><span class="hs-identifier hs-var hs-var">respCorsHeaders</span></a></span></span><span> </span><span id="local-6989586621679055445"><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055445"><span class="hs-identifier hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span>
</span><span id="line-408"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679055444"><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055444"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Access-Control-Expose-Headers&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CI ByteString] -&gt; ByteString
</span><a href="Network.Wai.Middleware.Cors.html#hdrLI"><span class="hs-identifier hs-var">hdrLI</span></a></span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055444"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CorsResourcePolicy -&gt; Maybe [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#corsExposedHeaders"><span class="hs-identifier hs-var">corsExposedHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="#local-6989586621679055445"><span class="hs-identifier hs-var">policy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-comment">-- | A CORS middleware that supports simple cross-origin requests for all</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- resources.</span><span>
</span><span id="line-413"></span><span class="hs-comment">--</span><span>
</span><span id="line-414"></span><span class="hs-comment">-- This middleware does not check if the resource corresponds to the</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- restrictions for simple requests. This is in accordance with</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- &lt;http://www.w3.org/TR/cors/&gt;. It is the responsibility of the</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- client (user-agent) to enforce CORS policy. The role of the server</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- is to provide the client with the respective policy constraints.</span><span>
</span><span id="line-419"></span><span class="hs-comment">--</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- It is out of the scope of the this module if the server chooses to</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- enforce rules on its resources in relation to CORS policy itself.</span><span>
</span><span id="line-422"></span><span class="hs-comment">--</span><span>
</span><span id="line-423"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleCors"><span class="hs-identifier hs-type">simpleCors</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WAI.Middleware</span></span><span>
</span><span id="line-424"></span><span id="simpleCors"><span class="annot"><span class="annottext">simpleCors :: Middleware
</span><a href="Network.Wai.Middleware.Cors.html#simpleCors"><span class="hs-identifier hs-var hs-var">simpleCors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Request -&gt; Maybe CorsResourcePolicy) -&gt; Middleware
</span><a href="Network.Wai.Middleware.Cors.html#cors"><span class="hs-identifier hs-var">cors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CorsResourcePolicy
</span><a href="Network.Wai.Middleware.Cors.html#simpleCorsResourcePolicy"><span class="hs-identifier hs-var">simpleCorsResourcePolicy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- Definition from Standards</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="hs-comment">-- | Simple HTTP response headers as defined in &lt;https://www.w3.org/TR/cors/#simple-response-header&gt;</span><span>
</span><span id="line-430"></span><span class="hs-comment">--</span><span>
</span><span id="line-431"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleResponseHeaders"><span class="hs-identifier hs-type">simpleResponseHeaders</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span class="hs-special">]</span><span>
</span><span id="line-432"></span><span id="simpleResponseHeaders"><span class="annot"><span class="annottext">simpleResponseHeaders :: [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleResponseHeaders"><span class="hs-identifier hs-var hs-var">simpleResponseHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Cache-Control&quot;</span></span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Content-Language&quot;</span></span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Expires&quot;</span></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Last-Modified&quot;</span></span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Pragma&quot;</span></span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="hs-comment">-- | Simple HTTP headers are defined in &lt;https://www.w3.org/TR/cors/#simple-header&gt;</span><span>
</span><span id="line-442"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleHeaders"><span class="hs-identifier hs-type">simpleHeaders</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span class="hs-special">]</span><span>
</span><span id="line-443"></span><span id="simpleHeaders"><span class="annot"><span class="annottext">simpleHeaders :: [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleHeaders"><span class="hs-identifier hs-var hs-var">simpleHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-444"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Accept&quot;</span></span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Accept-Language&quot;</span></span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Content-Language&quot;</span></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="hs-comment">-- | Simple content types are defined in &lt;https://www.w3.org/TR/cors/#simple-header&gt;</span><span>
</span><span id="line-451"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleContentTypes"><span class="hs-identifier hs-type">simpleContentTypes</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">CI.CI</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span class="hs-special">]</span><span>
</span><span id="line-452"></span><span id="simpleContentTypes"><span class="annot"><span class="annottext">simpleContentTypes :: [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleContentTypes"><span class="hs-identifier hs-var hs-var">simpleContentTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;application/x-www-form-urlencoded&quot;</span></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;multipart/form-data&quot;</span></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;text/plain&quot;</span></span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span class="hs-comment">-- | Simple HTTP methods as defined in &lt;https://www.w3.org/TR/cors/#simple-method&gt;</span><span>
</span><span id="line-460"></span><span class="hs-comment">--</span><span>
</span><span id="line-461"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#simpleMethods"><span class="hs-identifier hs-type">simpleMethods</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Method</span></span><span class="hs-special">]</span><span>
</span><span id="line-462"></span><span id="simpleMethods"><span class="annot"><span class="annottext">simpleMethods :: [ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleMethods"><span class="hs-identifier hs-var hs-var">simpleMethods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;GET&quot;</span></span><span>
</span><span id="line-464"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;HEAD&quot;</span></span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;POST&quot;</span></span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span class="hs-comment">-- | Whether the given method and headers constitute a simple request,</span><span>
</span><span id="line-469"></span><span class="hs-comment">-- i.e. the method is simple, all headers are simple, and, if a POST request,</span><span>
</span><span id="line-470"></span><span class="hs-comment">-- the content-type is simple.</span><span>
</span><span id="line-471"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#isSimple"><span class="hs-identifier hs-type">isSimple</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.Method</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.RequestHeaders</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-472"></span><span id="isSimple"><span class="annot"><span class="annottext">isSimple :: ByteString -&gt; ResponseHeaders -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#isSimple"><span class="hs-identifier hs-var hs-var">isSimple</span></a></span></span><span> </span><span id="local-6989586621679055441"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055441"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621679055440"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055440"><span class="hs-identifier hs-var">headers</span></a></span></span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055441"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleMethods"><span class="hs-identifier hs-var">simpleMethods</span></a></span><span>
</span><span id="line-474"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&#8743;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055440"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">forall &#945;. Eq &#945; =&gt; [&#945;] -&gt; [&#945;] -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#isSubsetOf"><span class="hs-operator hs-var">`isSubsetOf`</span></a></span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleHeaders"><span class="hs-identifier hs-var">simpleHeaders</span></a></span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&#8743;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055441"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;content-type&quot;</span></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055440"><span class="hs-identifier hs-var">headers</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;POST&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679055438"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055438"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">forall s. FoldCase s =&gt; s -&gt; CI s
</span><span class="hs-identifier hs-var">CI.mk</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055438"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#simpleContentTypes"><span class="hs-identifier hs-var">simpleContentTypes</span></a></span><span>
</span><span id="line-477"></span><span>        </span><span class="annot"><span class="annottext">(ByteString, Maybe ByteString)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="hs-comment">-- | Valid characters for HTTP header names according to RFC2616 (section 4.2)</span><span>
</span><span id="line-480"></span><span class="hs-comment">--</span><span>
</span><span id="line-481"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#isHttpHeaderNameChar"><span class="hs-identifier hs-type">isHttpHeaderNameChar</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-482"></span><span id="isHttpHeaderNameChar"><span class="annot"><span class="annottext">isHttpHeaderNameChar :: Char -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#isHttpHeaderNameChar"><span class="hs-identifier hs-var hs-var">isHttpHeaderNameChar</span></a></span></span><span> </span><span id="local-6989586621679055435"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679055435"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679055435"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall &#945;. Ord &#945; =&gt; &#945; -&gt; &#945; -&gt; Bool
</span><span class="hs-operator hs-var">&#8805;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">33</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679055435"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall &#945;. Ord &#945; =&gt; &#945; -&gt; &#945; -&gt; Bool
</span><span class="hs-operator hs-var">&#8804;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">126</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Char -&gt; Bool
</span><span class="hs-identifier hs-var">P.notInClass</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;()&lt;&gt;@,;:\\\&quot;/[]?={}&quot;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679055435"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#httpHeaderNameParser"><span class="hs-identifier hs-type">httpHeaderNameParser</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Parser</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span>
</span><span id="line-485"></span><span id="httpHeaderNameParser"><span class="annot"><span class="annottext">httpHeaderNameParser :: Parser (CI ByteString)
</span><a href="Network.Wai.Middleware.Cors.html#httpHeaderNameParser"><span class="hs-identifier hs-var hs-var">httpHeaderNameParser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. IsString a =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f [a]
</span><span class="hs-identifier hs-var">P.many1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser Char
</span><span class="hs-identifier hs-var">P.satisfy</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#isHttpHeaderNameChar"><span class="hs-identifier hs-var">isHttpHeaderNameChar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall i a. Parser i a -&gt; [Char] -&gt; Parser i a
</span><span class="hs-operator hs-var">P.&lt;?&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;HTTP Header Name&quot;</span></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">-- -------------------------------------------------------------------------- --</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- Generic Tools</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="hs-comment">-- | A comma separated list of whitespace surounded HTTP header names.</span><span>
</span><span id="line-491"></span><span class="hs-comment">--</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- Note that 'P.space' includes @SP@ (32), @HT@ (9), @LF@ (10), @VT@ (11),</span><span>
</span><span id="line-493"></span><span class="hs-comment">-- @NP@ (12), and @CR@ (13). RFC 2616 (2.2) only defines @SP@ (32) and</span><span>
</span><span id="line-494"></span><span class="hs-comment">-- @LWS = [CRLF] 1*(SP | HT)@ as whitespace. That's fine here since neither</span><span>
</span><span id="line-495"></span><span class="hs-comment">-- of these characters is allowed in header names.</span><span>
</span><span id="line-496"></span><span class="hs-comment">--</span><span>
</span><span id="line-497"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#httpHeaderNameListParser"><span class="hs-identifier hs-type">httpHeaderNameListParser</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Parser</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span class="hs-special">]</span><span>
</span><span id="line-498"></span><span id="httpHeaderNameListParser"><span class="annot"><span class="annottext">httpHeaderNameListParser :: Parser [CI ByteString]
</span><a href="Network.Wai.Middleware.Cors.html#httpHeaderNameListParser"><span class="hs-identifier hs-var hs-var">httpHeaderNameListParser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser ByteString [Char]
</span><a href="#local-6989586621679055425"><span class="hs-identifier hs-var">spaces</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a s. Alternative f =&gt; f a -&gt; f s -&gt; f [a]
</span><span class="hs-identifier hs-var">P.sepBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser (CI ByteString)
</span><a href="Network.Wai.Middleware.Cors.html#httpHeaderNameParser"><span class="hs-identifier hs-var">httpHeaderNameParser</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString [Char]
</span><a href="#local-6989586621679055425"><span class="hs-identifier hs-var">spaces</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Parser Char
</span><span class="hs-identifier hs-var">P.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">','</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString [Char]
</span><a href="#local-6989586621679055425"><span class="hs-identifier hs-var">spaces</span></a></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-500"></span><span>    </span><span id="local-6989586621679055425"><span class="annot"><span class="annottext">spaces :: Parser ByteString [Char]
</span><a href="#local-6989586621679055425"><span class="hs-identifier hs-var hs-var">spaces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">P.many'</span></span><span> </span><span class="annot"><span class="annottext">Parser Char
</span><span class="hs-identifier hs-var">P.space</span></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span id="local-6989586621679055939"><span id="local-6989586621679055940"><span class="annot"><a href="Network.Wai.Middleware.Cors.html#sshow"><span class="hs-identifier hs-type">sshow</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621679055940"><span class="hs-identifier hs-type">&#945;</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679055939"><span class="hs-identifier hs-type">&#946;</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&#8658;</span><span> </span><span class="annot"><a href="#local-6989586621679055939"><span class="hs-identifier hs-type">&#946;</span></a></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><a href="#local-6989586621679055940"><span class="hs-identifier hs-type">&#945;</span></a></span></span></span><span>
</span><span id="line-503"></span><span id="sshow"><span class="annot"><span class="annottext">sshow :: forall &#945; &#946;. (IsString &#945;, Show &#946;) =&gt; &#946; -&gt; &#945;
</span><a href="Network.Wai.Middleware.Cors.html#sshow"><span class="hs-identifier hs-var hs-var">sshow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. IsString a =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">forall &#946; &#947; &#945;. (&#946; -&gt; &#947;) -&gt; (&#945; -&gt; &#946;) -&gt; &#945; -&gt; &#947;
</span><span class="hs-operator hs-var">&#8728;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span id="local-6989586621679055924"><span class="annot"><a href="Network.Wai.Middleware.Cors.html#isSubsetOf"><span class="hs-identifier hs-type">isSubsetOf</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055924"><span class="hs-identifier hs-type">&#945;</span></a></span><span> </span><span class="hs-glyph">&#8658;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679055924"><span class="hs-identifier hs-type">&#945;</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679055924"><span class="hs-identifier hs-type">&#945;</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-506"></span><span id="isSubsetOf"><span class="annot"><span class="annottext">isSubsetOf :: forall &#945;. Eq &#945; =&gt; [&#945;] -&gt; [&#945;] -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#isSubsetOf"><span class="hs-identifier hs-var hs-var">isSubsetOf</span></a></span></span><span> </span><span id="local-6989586621679055408"><span class="annot"><span class="annottext">[&#945;]
</span><a href="#local-6989586621679055408"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621679055407"><span class="annot"><span class="annottext">[&#945;]
</span><a href="#local-6989586621679055407"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">intersect</span></span><span> </span><span class="annot"><span class="annottext">[&#945;]
</span><a href="#local-6989586621679055408"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">[&#945;]
</span><a href="#local-6989586621679055407"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">forall &#945;. Eq &#945; =&gt; &#945; -&gt; &#945; -&gt; Bool
</span><span class="hs-operator hs-var">&#8801;</span></span><span> </span><span class="annot"><span class="annottext">[&#945;]
</span><a href="#local-6989586621679055408"><span class="hs-identifier hs-var">l1</span></a></span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="hs-comment">-- | Add HTTP headers to a WAI response</span><span>
</span><span id="line-509"></span><span class="hs-comment">--</span><span>
</span><span id="line-510"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#addHeaders"><span class="hs-identifier hs-type">addHeaders</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HTTP.ResponseHeaders</span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WAI.Middleware</span></span><span>
</span><span id="line-511"></span><span id="addHeaders"><span class="annot"><span class="annottext">addHeaders :: ResponseHeaders -&gt; Middleware
</span><a href="Network.Wai.Middleware.Cors.html#addHeaders"><span class="hs-identifier hs-var hs-var">addHeaders</span></a></span></span><span> </span><span id="local-6989586621679055405"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055405"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span id="local-6989586621679055404"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679055404"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span id="local-6989586621679055403"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055403"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621679055402"><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055402"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679055404"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055403"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679055401"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679055401"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679055400"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679055400"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679055399"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055399"><span class="hs-identifier hs-var">headers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679055398"><span class="annot"><span class="annottext">(StreamingBody -&gt; IO ResponseReceived) -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055398"><span class="hs-identifier hs-var">streamHandle</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
Response
-&gt; (Status, ResponseHeaders, (StreamingBody -&gt; IO a) -&gt; IO a)
</span><span class="hs-identifier hs-var">WAI.responseToStream</span></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679055401"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-513"></span><span>    </span><span class="annot"><span class="annottext">(StreamingBody -&gt; IO ResponseReceived) -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055398"><span class="hs-identifier hs-var">streamHandle</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679055396"><span class="annot"><span class="annottext">StreamingBody
</span><a href="#local-6989586621679055396"><span class="hs-identifier hs-var">streamBody</span></a></span></span><span> </span><span class="hs-glyph">&#8594;</span><span>
</span><span id="line-514"></span><span>        </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679055402"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; StreamingBody -&gt; Response
</span><span class="hs-identifier hs-var">WAI.responseStream</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679055400"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055399"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">forall &#945;. Monoid &#945; =&gt; &#945; -&gt; &#945; -&gt; &#945;
</span><span class="hs-operator hs-var">&#8853;</span></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679055405"><span class="hs-identifier hs-var">hdrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StreamingBody
</span><a href="#local-6989586621679055396"><span class="hs-identifier hs-var">streamBody</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="hs-comment">-- | Format a list of 'HTTP.HeaderName's such that it can be used as</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- an HTTP header value</span><span>
</span><span id="line-518"></span><span class="hs-comment">--</span><span>
</span><span id="line-519"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#hdrLI"><span class="hs-identifier hs-type">hdrLI</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HTTP.HeaderName</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span>
</span><span id="line-520"></span><span id="hdrLI"><span class="annot"><span class="annottext">hdrLI :: [CI ByteString] -&gt; ByteString
</span><a href="Network.Wai.Middleware.Cors.html#hdrLI"><span class="hs-identifier hs-var hs-var">hdrLI</span></a></span></span><span> </span><span id="local-6989586621679055394"><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055394"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.intercalate</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall s. CI s -&gt; s
</span><span class="hs-identifier hs-var">CI.original</span></span><span> </span><span class="annot"><span class="annottext">[CI ByteString]
</span><a href="#local-6989586621679055394"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="hs-comment">-- | Format a list of 'B8.ByteString's such that it can be used as</span><span>
</span><span id="line-523"></span><span class="hs-comment">-- an HTTP header value</span><span>
</span><span id="line-524"></span><span class="hs-comment">--</span><span>
</span><span id="line-525"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#hdrL"><span class="hs-identifier hs-type">hdrL</span></a></span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span>
</span><span id="line-526"></span><span id="hdrL"><span class="annot"><span class="annottext">hdrL :: [ByteString] -&gt; ByteString
</span><a href="Network.Wai.Middleware.Cors.html#hdrL"><span class="hs-identifier hs-var hs-var">hdrL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.intercalate</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;, &quot;</span></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#corsFailure"><span class="hs-identifier hs-type">corsFailure</span></a></span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B8.ByteString</span></span><span> </span><span class="hs-comment">-- ^ body</span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WAI.Response</span></span><span>
</span><span id="line-531"></span><span id="corsFailure"><span class="annot"><span class="annottext">corsFailure :: ByteString -&gt; Response
</span><a href="Network.Wai.Middleware.Cors.html#corsFailure"><span class="hs-identifier hs-var hs-var">corsFailure</span></a></span></span><span> </span><span id="local-6989586621679055391"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055391"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ByteString -&gt; Response
</span><span class="hs-identifier hs-var">WAI.responseLBS</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">HTTP.status400</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;text/html; charset-utf-8&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">LB8.fromStrict</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679055391"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="hs-comment">-- Copied from the [wai-websocket package](https://github.com/yesodweb/wai/blob/master/wai-websockets/Network/Wai/Handler/WebSockets.hs#L21)</span><span>
</span><span id="line-534"></span><span class="hs-comment">--</span><span>
</span><span id="line-535"></span><span class="annot"><a href="Network.Wai.Middleware.Cors.html#isWebSocketsReq"><span class="hs-identifier hs-type">isWebSocketsReq</span></a></span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-glyph">&#8759;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WAI.Request</span></span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-glyph">&#8594;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-538"></span><span id="isWebSocketsReq"><span class="annot"><span class="annottext">isWebSocketsReq :: Request -&gt; Bool
</span><a href="Network.Wai.Middleware.Cors.html#isWebSocketsReq"><span class="hs-identifier hs-var hs-var">isWebSocketsReq</span></a></span></span><span> </span><span id="local-6989586621679055388"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055388"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-539"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall s. FoldCase s =&gt; s -&gt; CI s
</span><span class="hs-identifier hs-var">CI.mk</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;upgrade&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; ResponseHeaders
</span><span class="hs-identifier hs-var">WAI.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679055388"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall &#945;. Eq &#945; =&gt; &#945; -&gt; &#945; -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CI ByteString
</span><span class="hs-string">&quot;websocket&quot;</span></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span></pre></body></html>