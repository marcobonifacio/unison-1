<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- Copyright (C) 2013, 2014, 2015, 2016, 2017  Fraser Tweedale</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- you may not use this file except in compliance with the License.</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- You may obtain a copy of the License at</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">--      http://www.apache.org/licenses/LICENSE-2.0</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Unless required by applicable law or agreed to in writing, software</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- See the License for the specific language governing permissions and</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- limitations under the License.</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE MonoLocalBinds #-}</span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-comment">{-|

JSON Web Token implementation (RFC 7519). A JWT is a JWS
with a payload of /claims/ to be transferred between two
parties.

JWTs use the JWS /compact serialisation/.
See &quot;Crypto.JOSE.Compact&quot; for details.

@
mkClaims :: IO 'ClaimsSet'
mkClaims = do
  t &lt;- 'currentTime'
  pure $ 'emptyClaimsSet'
    &amp; 'claimIss' ?~ &quot;alice&quot;
    &amp; 'claimAud' ?~ 'Audience' [&quot;bob&quot;]
    &amp; 'claimIat' ?~ 'NumericDate' t

doJwtSign :: 'JWK' -&gt; 'ClaimsSet' -&gt; IO (Either 'JWTError' 'SignedJWT')
doJwtSign jwk claims = runExceptT $ do
  alg \&lt;- 'bestJWSAlg' jwk
  'signClaims' jwk ('newJWSHeader' ((), alg)) claims

doJwtVerify :: 'JWK' -&gt; 'SignedJWT' -&gt; IO (Either 'JWTError' 'ClaimsSet')
doJwtVerify jwk jwt = runExceptT $ do
  let config = 'defaultJWTValidationSettings' (== &quot;bob&quot;)
  'verifyClaims' config jwk jwt
@

Some JWT libraries have a function that takes two strings: the
&quot;secret&quot; (a symmetric key) and the raw JWT.  The following function
achieves the same:

@
verify :: L.ByteString -&gt; L.ByteString -&gt; IO (Either 'JWTError' 'ClaimsSet')
verify k s = runExceptT $ do
  let
    k' = 'fromOctets' k      -- turn raw secret into symmetric JWK
    audCheck = const True  -- should be a proper audience check
  s' &lt;- 'decodeCompact' s    -- decode JWT
  'verifyClaims' ('defaultJWTValidationSettings' audCheck) k' s'
@

-}</span><span>
</span><span id="line-68"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto.JWT</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Creating a JWT</span></span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="Crypto.JWT.html#signClaims"><span class="hs-identifier">signClaims</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#SignedJWT"><span class="hs-identifier">SignedJWT</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Validating a JWT and extracting claims</span></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#defaultJWTValidationSettings"><span class="hs-identifier">defaultJWTValidationSettings</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#verifyClaims"><span class="hs-identifier">verifyClaims</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#verifyClaimsAt"><span class="hs-identifier">verifyClaimsAt</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAllowedSkew"><span class="hs-identifier">HasAllowedSkew</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAudiencePredicate"><span class="hs-identifier">HasAudiencePredicate</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasIssuerPredicate"><span class="hs-identifier">HasIssuerPredicate</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasCheckIssuedAt"><span class="hs-identifier">HasCheckIssuedAt</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#JWTValidationSettings"><span class="hs-identifier">JWTValidationSettings</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasJWTValidationSettings"><span class="hs-identifier">HasJWTValidationSettings</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Claims Set</span></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier">ClaimsSet</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#claimAud"><span class="hs-identifier">claimAud</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#claimExp"><span class="hs-identifier">claimExp</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#claimIat"><span class="hs-identifier">claimIat</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#claimIss"><span class="hs-identifier">claimIss</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#claimJti"><span class="hs-identifier">claimJti</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#claimNbf"><span class="hs-identifier">claimNbf</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#claimSub"><span class="hs-identifier">claimSub</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#unregisteredClaims"><span class="hs-identifier">unregisteredClaims</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#addClaim"><span class="hs-identifier">addClaim</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#emptyClaimsSet"><span class="hs-identifier">emptyClaimsSet</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#validateClaimsSet"><span class="hs-identifier">validateClaimsSet</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><span class="hs-comment">-- * JWT errors</span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#JWTError"><span class="hs-identifier">JWTError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#AsJWTError"><span class="hs-identifier">AsJWTError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Miscellaneous</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#Audience"><span class="hs-identifier">Audience</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier">StringOrURI</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#stringOrUri"><span class="hs-identifier">stringOrUri</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#string"><span class="hs-identifier">string</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#uri"><span class="hs-identifier">uri</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier">NumericDate</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Crypto.JOSE.html"><span class="hs-identifier">Crypto.JOSE</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Time</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadTime</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">traverse_</span></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Identity</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="hs-identifier">makeClassy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makeClassyPrisms</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makePrisms</span></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="hs-identifier">Lens'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_Just</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">over</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">preview</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">view</span></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="hs-identifier">Prism'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">prism'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Cons</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">iso</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">AsEmpty</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens.Cons.Extras</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">recons</span></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Error.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwing_</span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadError</span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">asks</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runReaderT</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Key</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Key</span></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.KeyMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KeyMap</span></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NominalDiffTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">UTCTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">addUTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock.POSIX</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">posixSecondsToUTCTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">utcTimeToPOSIXSeconds</span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.URI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">parseURI</span></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.JOSE.html"><span class="hs-identifier">Crypto.JOSE</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Crypto.JOSE.Types.html"><span class="hs-identifier">Crypto.JOSE.Types</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-keyword">data</span><span> </span><span id="JWTError"><span class="annot"><a href="Crypto.JWT.html#JWTError"><span class="hs-identifier hs-var">JWTError</span></a></span></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="JWSError"><span class="annot"><a href="Crypto.JWT.html#JWSError"><span class="hs-identifier hs-var">JWSError</span></a></span></span><span> </span><span class="annot"><a href="Crypto.JOSE.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-comment">-- ^ A JOSE error occurred while processing the JWT</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="JWTClaimsSetDecodeError"><span class="annot"><a href="Crypto.JWT.html#JWTClaimsSetDecodeError"><span class="hs-identifier hs-var">JWTClaimsSetDecodeError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-comment">-- ^ The JWT payload is not a JWT Claims Set</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="JWTExpired"><span class="annot"><a href="Crypto.JWT.html#JWTExpired"><span class="hs-identifier hs-var">JWTExpired</span></a></span></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="JWTNotYetValid"><span class="annot"><a href="Crypto.JWT.html#JWTNotYetValid"><span class="hs-identifier hs-var">JWTNotYetValid</span></a></span></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="JWTNotInIssuer"><span class="annot"><a href="Crypto.JWT.html#JWTNotInIssuer"><span class="hs-identifier hs-var">JWTNotInIssuer</span></a></span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="JWTNotInAudience"><span class="annot"><a href="Crypto.JWT.html#JWTNotInAudience"><span class="hs-identifier hs-var">JWTNotInAudience</span></a></span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="JWTIssuedAtFuture"><span class="annot"><a href="Crypto.JWT.html#JWTIssuedAtFuture"><span class="hs-identifier hs-var">JWTIssuedAtFuture</span></a></span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679406492"><span id="local-6989586621679406499"><span class="annot"><span class="annottext">JWTError -&gt; JWTError -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: JWTError -&gt; JWTError -&gt; Bool
$c/= :: JWTError -&gt; JWTError -&gt; Bool
== :: JWTError -&gt; JWTError -&gt; Bool
$c== :: JWTError -&gt; JWTError -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679406476"><span id="local-6989586621679406478"><span id="local-6989586621679406488"><span class="annot"><span class="annottext">Int -&gt; JWTError -&gt; ShowS
[JWTError] -&gt; ShowS
JWTError -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [JWTError] -&gt; ShowS
$cshowList :: [JWTError] -&gt; ShowS
show :: JWTError -&gt; String
$cshow :: JWTError -&gt; String
showsPrec :: Int -&gt; JWTError -&gt; ShowS
$cshowsPrec :: Int -&gt; JWTError -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span id="_JWTIssuedAtFuture"><span id="_JWTNotInAudience"><span id="_JWTNotInIssuer"><span id="_JWTNotYetValid"><span id="_JWTExpired"><span id="_JWTClaimsSetDecodeError"><span id="_JWSError"><span id="_JWTError"><span id="local-6989586621679406367"><span id="local-6989586621679406373"><span id="local-6989586621679406379"><span id="local-6989586621679406385"><span id="local-6989586621679406391"><span id="local-6989586621679406397"><span id="local-6989586621679406403"><span id="local-6989586621679406407"><span id="local-6989586621679406417"><span id="local-6989586621679406426"><span id="local-6989586621679406435"><span id="local-6989586621679406444"><span id="local-6989586621679406453"><span id="local-6989586621679406462"><span id="local-6989586621679406472"><span id="AsJWTError"><span id="local-6989586621679407041"><span class="hs-identifier">makeClassyPrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">JWTError</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406311"><span id="local-6989586621679406313"><span id="local-6989586621679406315"><span id="local-6989586621679406317"><span id="local-6989586621679406319"><span id="local-6989586621679406321"><span id="local-6989586621679406323"><span id="local-6989586621679406325"><span id="local-6989586621679406327"><span id="local-6989586621679406329"><span id="local-6989586621679406331"><span id="local-6989586621679406333"><span id="local-6989586621679406335"><span id="local-6989586621679406337"><span class="annot"><a href="Crypto.JOSE.Error.html#AsError"><span class="hs-identifier hs-type">AsError</span></a></span><span> </span><span class="annot"><a href="Crypto.JWT.html#JWTError"><span class="hs-identifier hs-type">JWTError</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621679406304"><span class="annot"><span class="annottext">_Error :: Prism' JWTError Error
</span><a href="Crypto.JOSE.Error.html#_Error"><span class="hs-identifier hs-var hs-var hs-var hs-var">_Error</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. AsJWTError r =&gt; Prism' r Error
</span><a href="Crypto.JWT.html#_JWSError"><span class="hs-identifier hs-var">_JWSError</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- RFC 7519 &#167;2.  Terminology</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">-- | A JSON string value, with the additional requirement that while</span><span>
</span><span id="line-166"></span><span class="hs-comment">--   arbitrary string values MAY be used, any value containing a @:@</span><span>
</span><span id="line-167"></span><span class="hs-comment">--   character MUST be a URI.</span><span>
</span><span id="line-168"></span><span class="hs-comment">--</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- __Note__: the 'IsString' instance will fail if the string</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- contains a @:@ but does not parse as a 'URI'.  Use 'stringOrUri'</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- directly in this situation.</span><span>
</span><span id="line-172"></span><span class="hs-comment">--</span><span>
</span><span id="line-173"></span><span class="hs-keyword">data</span><span> </span><span id="StringOrURI"><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-var">StringOrURI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Arbitrary"><span class="annot"><a href="Crypto.JWT.html#Arbitrary"><span class="hs-identifier hs-var">Arbitrary</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="OrURI"><span class="annot"><a href="Crypto.JWT.html#OrURI"><span class="hs-identifier hs-var">OrURI</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">URI</span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679406293"><span id="local-6989586621679406299"><span class="annot"><span class="annottext">StringOrURI -&gt; StringOrURI -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: StringOrURI -&gt; StringOrURI -&gt; Bool
$c/= :: StringOrURI -&gt; StringOrURI -&gt; Bool
== :: StringOrURI -&gt; StringOrURI -&gt; Bool
$c== :: StringOrURI -&gt; StringOrURI -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679406281"><span id="local-6989586621679406283"><span id="local-6989586621679406291"><span class="annot"><span class="annottext">Int -&gt; StringOrURI -&gt; ShowS
[StringOrURI] -&gt; ShowS
StringOrURI -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [StringOrURI] -&gt; ShowS
$cshowList :: [StringOrURI] -&gt; ShowS
show :: StringOrURI -&gt; String
$cshow :: StringOrURI -&gt; String
showsPrec :: Int -&gt; StringOrURI -&gt; ShowS
$cshowsPrec :: Int -&gt; StringOrURI -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- | Non-total.  A string with a @':'@ in it MUST parse as a URI</span><span>
</span><span id="line-176"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data.String.IsString</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-177"></span><span>  </span><span id="local-6989586621679406263"><span class="annot"><span class="annottext">fromString :: String -&gt; StringOrURI
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fromString</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">forall s. (Cons s s Char Char, AsEmpty s) =&gt; Prism' s StringOrURI
</span><a href="Crypto.JWT.html#stringOrUri"><span class="hs-identifier hs-var">stringOrUri</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span id="local-6989586621679406972"><span class="annot"><a href="Crypto.JWT.html#stringOrUri"><span class="hs-identifier hs-type">stringOrUri</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cons</span></span><span> </span><span class="annot"><a href="#local-6989586621679406972"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406972"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AsEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679406972"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Prism'</span></span><span> </span><span class="annot"><a href="#local-6989586621679406972"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span></span><span>
</span><span id="line-180"></span><span id="stringOrUri"><span class="annot"><span class="annottext">stringOrUri :: forall s. (Cons s s Char Char, AsEmpty s) =&gt; Prism' s StringOrURI
</span><a href="Crypto.JWT.html#stringOrUri"><span class="hs-identifier hs-var hs-var">stringOrUri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s a b t. (s -&gt; a) -&gt; (b -&gt; t) -&gt; Iso s t a b
</span><span class="hs-identifier hs-var">iso</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall s1 a s2.
(Cons s1 s1 a a, Cons s2 s2 a a, AsEmpty s2) =&gt;
Getter s1 s2
</span><span class="hs-identifier hs-var">recons</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall s1 a s2.
(Cons s1 s1 a a, Cons s2 s2 a a, AsEmpty s2) =&gt;
Getter s1 s2
</span><span class="hs-identifier hs-var">recons</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall b s a. (b -&gt; s) -&gt; (s -&gt; Maybe a) -&gt; Prism s s a b
</span><span class="hs-identifier hs-var">prism'</span></span><span> </span><span class="annot"><span class="annottext">StringOrURI -&gt; Text
</span><a href="#local-6989586621679406233"><span class="hs-identifier hs-var">rev</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe StringOrURI
</span><a href="#local-6989586621679406232"><span class="hs-identifier hs-var">fwd</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621679406233"><span class="annot"><span class="annottext">rev :: StringOrURI -&gt; Text
</span><a href="#local-6989586621679406233"><span class="hs-identifier hs-var hs-var">rev</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#Arbitrary"><span class="hs-identifier hs-type">Arbitrary</span></a></span><span> </span><span id="local-6989586621679406230"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406230"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406230"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><a href="#local-6989586621679406233"><span class="hs-identifier hs-var">rev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#OrURI"><span class="hs-identifier hs-type">OrURI</span></a></span><span> </span><span id="local-6989586621679406229"><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679406229"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679406229"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>  </span><span id="local-6989586621679406232"><span class="annot"><span class="annottext">fwd :: Text -&gt; Maybe StringOrURI
</span><a href="#local-6989586621679406232"><span class="hs-identifier hs-var hs-var">fwd</span></a></span></span><span> </span><span id="local-6989586621679406221"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406221"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">':'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406221"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">URI -&gt; StringOrURI
</span><a href="Crypto.JWT.html#OrURI"><span class="hs-identifier hs-var">OrURI</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe URI
</span><span class="hs-identifier hs-var">parseURI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406221"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; StringOrURI
</span><a href="Crypto.JWT.html#Arbitrary"><span class="hs-identifier hs-var">Arbitrary</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406221"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Crypto.JWT.html#stringOrUri"><span class="hs-pragma hs-type">stringOrUri</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="Crypto.JWT.html#string"><span class="hs-identifier hs-type">string</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Prism'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-190"></span><span id="string"><span class="annot"><span class="annottext">string :: Prism' StringOrURI Text
</span><a href="Crypto.JWT.html#string"><span class="hs-identifier hs-var hs-var">string</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b s a. (b -&gt; s) -&gt; (s -&gt; Maybe a) -&gt; Prism s s a b
</span><span class="hs-identifier hs-var">prism'</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; StringOrURI
</span><a href="Crypto.JWT.html#Arbitrary"><span class="hs-identifier hs-var">Arbitrary</span></a></span><span> </span><span class="annot"><span class="annottext">StringOrURI -&gt; Maybe Text
</span><a href="#local-6989586621679406213"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621679406213"><span class="annot"><span class="annottext">f :: StringOrURI -&gt; Maybe Text
</span><a href="#local-6989586621679406213"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#Arbitrary"><span class="hs-identifier hs-type">Arbitrary</span></a></span><span> </span><span id="local-6989586621679406212"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406212"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406212"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><a href="#local-6989586621679406213"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">StringOrURI
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="annot"><a href="Crypto.JWT.html#uri"><span class="hs-identifier hs-type">uri</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Prism'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">URI</span></span><span>
</span><span id="line-195"></span><span id="uri"><span class="annot"><span class="annottext">uri :: Prism' StringOrURI URI
</span><a href="Crypto.JWT.html#uri"><span class="hs-identifier hs-var hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b s a. (b -&gt; s) -&gt; (s -&gt; Maybe a) -&gt; Prism s s a b
</span><span class="hs-identifier hs-var">prism'</span></span><span> </span><span class="annot"><span class="annottext">URI -&gt; StringOrURI
</span><a href="Crypto.JWT.html#OrURI"><span class="hs-identifier hs-var">OrURI</span></a></span><span> </span><span class="annot"><span class="annottext">StringOrURI -&gt; Maybe URI
</span><a href="#local-6989586621679406207"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621679406207"><span class="annot"><span class="annottext">f :: StringOrURI -&gt; Maybe URI
</span><a href="#local-6989586621679406207"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#OrURI"><span class="hs-identifier hs-type">OrURI</span></a></span><span> </span><span id="local-6989586621679406206"><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679406206"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679406206"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="#local-6989586621679406207"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">StringOrURI
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406203"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>  </span><span id="local-6989586621679406191"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser StringOrURI
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; (Text -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withText</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;StringOrURI&quot;</span></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;failed to parse StringOrURI&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">forall s. (Cons s s Char Char, AsEmpty s) =&gt; Prism' s StringOrURI
</span><a href="Crypto.JWT.html#stringOrUri"><span class="hs-identifier hs-var">stringOrUri</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406181"><span id="local-6989586621679406183"><span id="local-6989586621679406185"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621679406172"><span class="annot"><span class="annottext">toJSON :: StringOrURI -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#Arbitrary"><span class="hs-identifier hs-type">Arbitrary</span></a></span><span> </span><span id="local-6989586621679406170"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406170"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679406170"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#OrURI"><span class="hs-identifier hs-type">OrURI</span></a></span><span> </span><span id="local-6989586621679406169"><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679406169"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">URI
</span><a href="#local-6989586621679406169"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | A JSON numeric value representing the number of seconds from</span><span>
</span><span id="line-209"></span><span class="hs-comment">--   1970-01-01T0:0:0Z UTC until the specified UTC date\/time.</span><span>
</span><span id="line-210"></span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span class="hs-keyword">newtype</span><span> </span><span id="NumericDate"><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-var">NumericDate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NumericDate"><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-var">NumericDate</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679406161"><span id="local-6989586621679406166"><span class="annot"><span class="annottext">NumericDate -&gt; NumericDate -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: NumericDate -&gt; NumericDate -&gt; Bool
$c/= :: NumericDate -&gt; NumericDate -&gt; Bool
== :: NumericDate -&gt; NumericDate -&gt; Bool
$c== :: NumericDate -&gt; NumericDate -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679406129"><span id="local-6989586621679406133"><span id="local-6989586621679406137"><span id="local-6989586621679406141"><span id="local-6989586621679406145"><span id="local-6989586621679406149"><span id="local-6989586621679406154"><span class="annot"><span class="annottext">Eq NumericDate
NumericDate -&gt; NumericDate -&gt; Bool
NumericDate -&gt; NumericDate -&gt; Ordering
NumericDate -&gt; NumericDate -&gt; NumericDate
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: NumericDate -&gt; NumericDate -&gt; NumericDate
$cmin :: NumericDate -&gt; NumericDate -&gt; NumericDate
max :: NumericDate -&gt; NumericDate -&gt; NumericDate
$cmax :: NumericDate -&gt; NumericDate -&gt; NumericDate
&gt;= :: NumericDate -&gt; NumericDate -&gt; Bool
$c&gt;= :: NumericDate -&gt; NumericDate -&gt; Bool
&gt; :: NumericDate -&gt; NumericDate -&gt; Bool
$c&gt; :: NumericDate -&gt; NumericDate -&gt; Bool
&lt;= :: NumericDate -&gt; NumericDate -&gt; Bool
$c&lt;= :: NumericDate -&gt; NumericDate -&gt; Bool
&lt; :: NumericDate -&gt; NumericDate -&gt; Bool
$c&lt; :: NumericDate -&gt; NumericDate -&gt; Bool
compare :: NumericDate -&gt; NumericDate -&gt; Ordering
$ccompare :: NumericDate -&gt; NumericDate -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679406116"><span id="local-6989586621679406118"><span id="local-6989586621679406123"><span class="annot"><span class="annottext">Int -&gt; NumericDate -&gt; ShowS
[NumericDate] -&gt; ShowS
NumericDate -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [NumericDate] -&gt; ShowS
$cshowList :: [NumericDate] -&gt; ShowS
show :: NumericDate -&gt; String
$cshow :: NumericDate -&gt; String
showsPrec :: Int -&gt; NumericDate -&gt; ShowS
$cshowsPrec :: Int -&gt; NumericDate -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span id="_NumericDate"><span class="hs-identifier">makePrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">NumericDate</span></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406106"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-type">NumericDate</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621679406100"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser NumericDate
</span><a href="#local-6989586621679406100"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; (Scientific -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withScientific</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NumericDate&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; NumericDate
</span><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-var">NumericDate</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">posixSecondsToUTCTime</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Real a =&gt; a -&gt; Rational
</span><span class="hs-identifier hs-var">toRational</span></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406092"><span id="local-6989586621679406094"><span id="local-6989586621679406096"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-type">NumericDate</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>  </span><span id="local-6989586621679406087"><span class="annot"><span class="annottext">toJSON :: NumericDate -&gt; Value
</span><a href="#local-6989586621679406087"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-type">NumericDate</span></a></span><span> </span><span id="local-6989586621679406086"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679406086"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Value
</span><span class="hs-identifier hs-var">Number</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Real a =&gt; a -&gt; Rational
</span><span class="hs-identifier hs-var">toRational</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; NominalDiffTime
</span><span class="hs-identifier hs-var">utcTimeToPOSIXSeconds</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679406086"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | Audience data.  In the general case, the /aud/ value is an</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- array of case-sensitive strings, each containing a 'StringOrURI'</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- value.  In the special case when the JWT has one audience, the</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- /aud/ value MAY be a single case-sensitive string containing a</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- 'StringOrURI' value.</span><span>
</span><span id="line-228"></span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- The 'ToJSON' instance formats an 'Audience' with one value as a</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- string (some non-compliant implementations require this.)</span><span>
</span><span id="line-231"></span><span class="hs-comment">--</span><span>
</span><span id="line-232"></span><span class="hs-keyword">newtype</span><span> </span><span id="Audience"><span class="annot"><a href="Crypto.JWT.html#Audience"><span class="hs-identifier hs-var">Audience</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Audience"><span class="annot"><a href="Crypto.JWT.html#Audience"><span class="hs-identifier hs-var">Audience</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679406077"><span id="local-6989586621679406082"><span class="annot"><span class="annottext">Audience -&gt; Audience -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Audience -&gt; Audience -&gt; Bool
$c/= :: Audience -&gt; Audience -&gt; Bool
== :: Audience -&gt; Audience -&gt; Bool
$c== :: Audience -&gt; Audience -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679406064"><span id="local-6989586621679406066"><span id="local-6989586621679406071"><span class="annot"><span class="annottext">Int -&gt; Audience -&gt; ShowS
[Audience] -&gt; ShowS
Audience -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Audience] -&gt; ShowS
$cshowList :: [Audience] -&gt; ShowS
show :: Audience -&gt; String
$cshow :: Audience -&gt; String
showsPrec :: Int -&gt; Audience -&gt; ShowS
$cshowsPrec :: Int -&gt; Audience -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span id="_Audience"><span class="hs-identifier">makePrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Audience</span></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406054"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#Audience"><span class="hs-identifier hs-type">Audience</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-236"></span><span>  </span><span id="local-6989586621679406044"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser Audience
</span><a href="#local-6989586621679406044"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span id="local-6989586621679406043"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679406043"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StringOrURI] -&gt; Audience
</span><a href="Crypto.JWT.html#Audience"><span class="hs-identifier hs-var">Audience</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679406043"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679406043"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406035"><span id="local-6989586621679406037"><span id="local-6989586621679406039"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#Audience"><span class="hs-identifier hs-type">Audience</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621679406032"><span class="annot"><span class="annottext">toJSON :: Audience -&gt; Value
</span><a href="#local-6989586621679406032"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#Audience"><span class="hs-identifier hs-type">Audience</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679406031"><span class="annot"><span class="annottext">StringOrURI
</span><a href="#local-6989586621679406031"><span class="hs-identifier hs-var">aud</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">StringOrURI
</span><a href="#local-6989586621679406031"><span class="hs-identifier hs-var">aud</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#Audience"><span class="hs-identifier hs-type">Audience</span></a></span><span> </span><span id="local-6989586621679406030"><span class="annot"><span class="annottext">[StringOrURI]
</span><a href="#local-6989586621679406030"><span class="hs-identifier hs-var">auds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">[StringOrURI]
</span><a href="#local-6989586621679406030"><span class="hs-identifier hs-var">auds</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- | The JWT Claims Set represents a JSON object whose members are</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- the registered claims defined by RFC 7519.  Unrecognised</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- claims are gathered into the 'unregisteredClaims' map.</span><span>
</span><span id="line-246"></span><span class="hs-comment">--</span><span>
</span><span id="line-247"></span><span class="hs-keyword">data</span><span> </span><span id="ClaimsSet"><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-var">ClaimsSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ClaimsSet"><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-var">ClaimsSet</span></a></span></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_claimIss"><span class="annot"><span class="annottext">ClaimsSet -&gt; Maybe StringOrURI
</span><a href="Crypto.JWT.html#_claimIss"><span class="hs-identifier hs-var hs-var">_claimIss</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_claimSub"><span class="annot"><span class="annottext">ClaimsSet -&gt; Maybe StringOrURI
</span><a href="Crypto.JWT.html#_claimSub"><span class="hs-identifier hs-var hs-var">_claimSub</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_claimAud"><span class="annot"><span class="annottext">ClaimsSet -&gt; Maybe Audience
</span><a href="Crypto.JWT.html#_claimAud"><span class="hs-identifier hs-var hs-var">_claimAud</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#Audience"><span class="hs-identifier hs-type">Audience</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_claimExp"><span class="annot"><span class="annottext">ClaimsSet -&gt; Maybe NumericDate
</span><a href="Crypto.JWT.html#_claimExp"><span class="hs-identifier hs-var hs-var">_claimExp</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-type">NumericDate</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_claimNbf"><span class="annot"><span class="annottext">ClaimsSet -&gt; Maybe NumericDate
</span><a href="Crypto.JWT.html#_claimNbf"><span class="hs-identifier hs-var hs-var">_claimNbf</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-type">NumericDate</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_claimIat"><span class="annot"><span class="annottext">ClaimsSet -&gt; Maybe NumericDate
</span><a href="Crypto.JWT.html#_claimIat"><span class="hs-identifier hs-var hs-var">_claimIat</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-type">NumericDate</span></a></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_claimJti"><span class="annot"><span class="annottext">ClaimsSet -&gt; Maybe Text
</span><a href="Crypto.JWT.html#_claimJti"><span class="hs-identifier hs-var hs-var">_claimJti</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_unregisteredClaims"><span class="annot"><span class="annottext">ClaimsSet -&gt; Map Text Value
</span><a href="Crypto.JWT.html#_unregisteredClaims"><span class="hs-identifier hs-var hs-var">_unregisteredClaims</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679406002"><span id="local-6989586621679406019"><span class="annot"><span class="annottext">ClaimsSet -&gt; ClaimsSet -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ClaimsSet -&gt; ClaimsSet -&gt; Bool
$c/= :: ClaimsSet -&gt; ClaimsSet -&gt; Bool
== :: ClaimsSet -&gt; ClaimsSet -&gt; Bool
$c== :: ClaimsSet -&gt; ClaimsSet -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405979"><span id="local-6989586621679405981"><span id="local-6989586621679405999"><span class="annot"><span class="annottext">Int -&gt; ClaimsSet -&gt; ShowS
[ClaimsSet] -&gt; ShowS
ClaimsSet -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ClaimsSet] -&gt; ShowS
$cshowList :: [ClaimsSet] -&gt; ShowS
show :: ClaimsSet -&gt; String
$cshow :: ClaimsSet -&gt; String
showsPrec :: Int -&gt; ClaimsSet -&gt; ShowS
$cshowsPrec :: Int -&gt; ClaimsSet -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-comment">-- | The issuer claim identifies the principal that issued the</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- JWT.  The processing of this claim is generally application</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- specific.</span><span>
</span><span id="line-262"></span><span class="annot"><a href="Crypto.JWT.html#claimIss"><span class="hs-identifier hs-type">claimIss</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span id="claimIss"><span class="annot"><span class="annottext">claimIss :: Lens' ClaimsSet (Maybe StringOrURI)
</span><a href="Crypto.JWT.html#claimIss"><span class="hs-identifier hs-var hs-var">claimIss</span></a></span></span><span> </span><span id="local-6989586621679405975"><span class="annot"><span class="annottext">Maybe StringOrURI -&gt; f (Maybe StringOrURI)
</span><a href="#local-6989586621679405975"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679405974"><span class="annot"><span class="annottext">h :: ClaimsSet
</span><a href="#local-6989586621679405974"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimIss :: ClaimsSet -&gt; Maybe StringOrURI
</span><a href="Crypto.JWT.html#_claimIss"><span class="hs-identifier hs-var">_claimIss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679405973"><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405973"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405972"><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405972"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405974"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimIss :: Maybe StringOrURI
</span><a href="Crypto.JWT.html#_claimIss"><span class="hs-identifier hs-var">_claimIss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405972"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe StringOrURI -&gt; f (Maybe StringOrURI)
</span><a href="#local-6989586621679405975"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405973"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">-- | The subject claim identifies the principal that is the</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- subject of the JWT.  The Claims in a JWT are normally</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- statements about the subject.  The subject value MAY be scoped</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- to be locally unique in the context of the issuer or MAY be</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- globally unique.  The processing of this claim is generally</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- application specific.</span><span>
</span><span id="line-272"></span><span class="annot"><a href="Crypto.JWT.html#claimSub"><span class="hs-identifier hs-type">claimSub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span id="claimSub"><span class="annot"><span class="annottext">claimSub :: Lens' ClaimsSet (Maybe StringOrURI)
</span><a href="Crypto.JWT.html#claimSub"><span class="hs-identifier hs-var hs-var">claimSub</span></a></span></span><span> </span><span id="local-6989586621679405969"><span class="annot"><span class="annottext">Maybe StringOrURI -&gt; f (Maybe StringOrURI)
</span><a href="#local-6989586621679405969"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679405968"><span class="annot"><span class="annottext">h :: ClaimsSet
</span><a href="#local-6989586621679405968"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimSub :: ClaimsSet -&gt; Maybe StringOrURI
</span><a href="Crypto.JWT.html#_claimSub"><span class="hs-identifier hs-var">_claimSub</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679405967"><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405967"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405966"><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405966"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405968"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimSub :: Maybe StringOrURI
</span><a href="Crypto.JWT.html#_claimSub"><span class="hs-identifier hs-var">_claimSub</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405966"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe StringOrURI -&gt; f (Maybe StringOrURI)
</span><a href="#local-6989586621679405969"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405967"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- | The audience claim identifies the recipients that the JWT is</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- intended for.  Each principal intended to process the JWT MUST</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- identify itself with a value in the audience claim.  If the</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- principal processing the claim does not identify itself with a</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- value in the /aud/ claim when this claim is present, then the</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- JWT MUST be rejected.</span><span>
</span><span id="line-282"></span><span class="annot"><a href="Crypto.JWT.html#claimAud"><span class="hs-identifier hs-type">claimAud</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#Audience"><span class="hs-identifier hs-type">Audience</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span id="claimAud"><span class="annot"><span class="annottext">claimAud :: Lens' ClaimsSet (Maybe Audience)
</span><a href="Crypto.JWT.html#claimAud"><span class="hs-identifier hs-var hs-var">claimAud</span></a></span></span><span> </span><span id="local-6989586621679405963"><span class="annot"><span class="annottext">Maybe Audience -&gt; f (Maybe Audience)
</span><a href="#local-6989586621679405963"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679405962"><span class="annot"><span class="annottext">h :: ClaimsSet
</span><a href="#local-6989586621679405962"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimAud :: ClaimsSet -&gt; Maybe Audience
</span><a href="Crypto.JWT.html#_claimAud"><span class="hs-identifier hs-var">_claimAud</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679405961"><span class="annot"><span class="annottext">Maybe Audience
</span><a href="#local-6989586621679405961"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405960"><span class="annot"><span class="annottext">Maybe Audience
</span><a href="#local-6989586621679405960"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405962"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimAud :: Maybe Audience
</span><a href="Crypto.JWT.html#_claimAud"><span class="hs-identifier hs-var">_claimAud</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Audience
</span><a href="#local-6989586621679405960"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Audience -&gt; f (Maybe Audience)
</span><a href="#local-6989586621679405963"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Audience
</span><a href="#local-6989586621679405961"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- | The expiration time claim identifies the expiration time on</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- or after which the JWT MUST NOT be accepted for processing.</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- The processing of /exp/ claim requires that the current</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- date\/time MUST be before expiration date\/time listed in the</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- /exp/ claim.  Implementers MAY provide for some small leeway,</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- usually no more than a few minutes, to account for clock skew.</span><span>
</span><span id="line-292"></span><span class="annot"><a href="Crypto.JWT.html#claimExp"><span class="hs-identifier hs-type">claimExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-type">NumericDate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span id="claimExp"><span class="annot"><span class="annottext">claimExp :: Lens' ClaimsSet (Maybe NumericDate)
</span><a href="Crypto.JWT.html#claimExp"><span class="hs-identifier hs-var hs-var">claimExp</span></a></span></span><span> </span><span id="local-6989586621679405957"><span class="annot"><span class="annottext">Maybe NumericDate -&gt; f (Maybe NumericDate)
</span><a href="#local-6989586621679405957"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679405956"><span class="annot"><span class="annottext">h :: ClaimsSet
</span><a href="#local-6989586621679405956"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimExp :: ClaimsSet -&gt; Maybe NumericDate
</span><a href="Crypto.JWT.html#_claimExp"><span class="hs-identifier hs-var">_claimExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679405955"><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405955"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405954"><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405954"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405956"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimExp :: Maybe NumericDate
</span><a href="Crypto.JWT.html#_claimExp"><span class="hs-identifier hs-var">_claimExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405954"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe NumericDate -&gt; f (Maybe NumericDate)
</span><a href="#local-6989586621679405957"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405955"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- | The not before claim identifies the time before which the JWT</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- MUST NOT be accepted for processing.  The processing of the</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- /nbf/ claim requires that the current date\/time MUST be after</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- or equal to the not-before date\/time listed in the /nbf/</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- claim.  Implementers MAY provide for some small leeway, usually</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- no more than a few minutes, to account for clock skew.</span><span>
</span><span id="line-302"></span><span class="annot"><a href="Crypto.JWT.html#claimNbf"><span class="hs-identifier hs-type">claimNbf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-type">NumericDate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span id="claimNbf"><span class="annot"><span class="annottext">claimNbf :: Lens' ClaimsSet (Maybe NumericDate)
</span><a href="Crypto.JWT.html#claimNbf"><span class="hs-identifier hs-var hs-var">claimNbf</span></a></span></span><span> </span><span id="local-6989586621679405951"><span class="annot"><span class="annottext">Maybe NumericDate -&gt; f (Maybe NumericDate)
</span><a href="#local-6989586621679405951"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679405950"><span class="annot"><span class="annottext">h :: ClaimsSet
</span><a href="#local-6989586621679405950"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimNbf :: ClaimsSet -&gt; Maybe NumericDate
</span><a href="Crypto.JWT.html#_claimNbf"><span class="hs-identifier hs-var">_claimNbf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679405949"><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405949"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405948"><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405948"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405950"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimNbf :: Maybe NumericDate
</span><a href="Crypto.JWT.html#_claimNbf"><span class="hs-identifier hs-var">_claimNbf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405948"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe NumericDate -&gt; f (Maybe NumericDate)
</span><a href="#local-6989586621679405951"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405949"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-comment">-- | The issued at claim identifies the time at which the JWT was</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- issued.  This claim can be used to determine the age of the</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- JWT.</span><span>
</span><span id="line-309"></span><span class="annot"><a href="Crypto.JWT.html#claimIat"><span class="hs-identifier hs-type">claimIat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#NumericDate"><span class="hs-identifier hs-type">NumericDate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span id="claimIat"><span class="annot"><span class="annottext">claimIat :: Lens' ClaimsSet (Maybe NumericDate)
</span><a href="Crypto.JWT.html#claimIat"><span class="hs-identifier hs-var hs-var">claimIat</span></a></span></span><span> </span><span id="local-6989586621679405945"><span class="annot"><span class="annottext">Maybe NumericDate -&gt; f (Maybe NumericDate)
</span><a href="#local-6989586621679405945"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679405944"><span class="annot"><span class="annottext">h :: ClaimsSet
</span><a href="#local-6989586621679405944"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimIat :: ClaimsSet -&gt; Maybe NumericDate
</span><a href="Crypto.JWT.html#_claimIat"><span class="hs-identifier hs-var">_claimIat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679405943"><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405943"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-311"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405942"><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405942"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405944"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimIat :: Maybe NumericDate
</span><a href="Crypto.JWT.html#_claimIat"><span class="hs-identifier hs-var">_claimIat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405942"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe NumericDate -&gt; f (Maybe NumericDate)
</span><a href="#local-6989586621679405945"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405943"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="hs-comment">-- | The JWT ID claim provides a unique identifier for the JWT.</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- The identifier value MUST be assigned in a manner that ensures</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- that there is a negligible probability that the same value will</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- be accidentally assigned to a different data object.  The /jti/</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- claim can be used to prevent the JWT from being replayed.  The</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- /jti/ value is a case-sensitive string.</span><span>
</span><span id="line-319"></span><span class="annot"><a href="Crypto.JWT.html#claimJti"><span class="hs-identifier hs-type">claimJti</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span id="claimJti"><span class="annot"><span class="annottext">claimJti :: Lens' ClaimsSet (Maybe Text)
</span><a href="Crypto.JWT.html#claimJti"><span class="hs-identifier hs-var hs-var">claimJti</span></a></span></span><span> </span><span id="local-6989586621679405939"><span class="annot"><span class="annottext">Maybe Text -&gt; f (Maybe Text)
</span><a href="#local-6989586621679405939"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679405938"><span class="annot"><span class="annottext">h :: ClaimsSet
</span><a href="#local-6989586621679405938"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimJti :: ClaimsSet -&gt; Maybe Text
</span><a href="Crypto.JWT.html#_claimJti"><span class="hs-identifier hs-var">_claimJti</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679405937"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679405937"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-321"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405936"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679405936"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405938"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_claimJti :: Maybe Text
</span><a href="Crypto.JWT.html#_claimJti"><span class="hs-identifier hs-var">_claimJti</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679405936"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; f (Maybe Text)
</span><a href="#local-6989586621679405939"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679405937"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- | Claim Names can be defined at will by those using JWTs.</span><span>
</span><span id="line-324"></span><span class="annot"><a href="Crypto.JWT.html#unregisteredClaims"><span class="hs-identifier hs-type">unregisteredClaims</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span id="unregisteredClaims"><span class="annot"><span class="annottext">unregisteredClaims :: Lens' ClaimsSet (Map Text Value)
</span><a href="Crypto.JWT.html#unregisteredClaims"><span class="hs-identifier hs-var hs-var">unregisteredClaims</span></a></span></span><span> </span><span id="local-6989586621679405933"><span class="annot"><span class="annottext">Map Text Value -&gt; f (Map Text Value)
</span><a href="#local-6989586621679405933"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679405932"><span class="annot"><span class="annottext">h :: ClaimsSet
</span><a href="#local-6989586621679405932"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_unregisteredClaims :: ClaimsSet -&gt; Map Text Value
</span><a href="Crypto.JWT.html#_unregisteredClaims"><span class="hs-identifier hs-var">_unregisteredClaims</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679405931"><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621679405931"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-326"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405930"><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621679405930"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405932"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_unregisteredClaims :: Map Text Value
</span><a href="Crypto.JWT.html#_unregisteredClaims"><span class="hs-identifier hs-var">_unregisteredClaims</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621679405930"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text Value -&gt; f (Map Text Value)
</span><a href="#local-6989586621679405933"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621679405931"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">-- | Return an empty claims set.</span><span>
</span><span id="line-330"></span><span class="hs-comment">--</span><span>
</span><span id="line-331"></span><span class="annot"><a href="Crypto.JWT.html#emptyClaimsSet"><span class="hs-identifier hs-type">emptyClaimsSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span>
</span><span id="line-332"></span><span id="emptyClaimsSet"><span class="annot"><span class="annottext">emptyClaimsSet :: ClaimsSet
</span><a href="Crypto.JWT.html#emptyClaimsSet"><span class="hs-identifier hs-var hs-var">emptyClaimsSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StringOrURI
-&gt; Maybe StringOrURI
-&gt; Maybe Audience
-&gt; Maybe NumericDate
-&gt; Maybe NumericDate
-&gt; Maybe NumericDate
-&gt; Maybe Text
-&gt; Map Text Value
-&gt; ClaimsSet
</span><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-var">ClaimsSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621679405929"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621679405929"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621679405929"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621679405929"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621679405929"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621679405929"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621679405929"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679405929"><span class="annot"><span class="annottext">n :: Maybe a
</span><a href="#local-6989586621679405929"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="annot"><a href="Crypto.JWT.html#addClaim"><span class="hs-identifier hs-type">addClaim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span>
</span><span id="line-335"></span><span id="addClaim"><span class="annot"><span class="annottext">addClaim :: Text -&gt; Value -&gt; ClaimsSet -&gt; ClaimsSet
</span><a href="Crypto.JWT.html#addClaim"><span class="hs-identifier hs-var hs-var">addClaim</span></a></span></span><span> </span><span id="local-6989586621679405927"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405927"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679405926"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679405926"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">Lens' ClaimsSet (Map Text Value)
</span><a href="Crypto.JWT.html#unregisteredClaims"><span class="hs-identifier hs-var">unregisteredClaims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405927"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679405926"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><a href="Crypto.JWT.html#registeredClaims"><span class="hs-identifier hs-type">registeredClaims</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-338"></span><span id="registeredClaims"><span class="annot"><span class="annottext">registeredClaims :: Set Text
</span><a href="Crypto.JWT.html#registeredClaims"><span class="hs-identifier hs-var hs-var">registeredClaims</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromDistinctAscList</span></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;aud&quot;</span></span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;exp&quot;</span></span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;iat&quot;</span></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;iss&quot;</span></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;jti&quot;</span></span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;nbf&quot;</span></span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sub&quot;</span></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="annot"><a href="Crypto.JWT.html#filterUnregistered"><span class="hs-identifier hs-type">filterUnregistered</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-349"></span><span id="filterUnregistered"><span class="annot"><span class="annottext">filterUnregistered :: Map Text Value -&gt; Map Text Value
</span><a href="Crypto.JWT.html#filterUnregistered"><span class="hs-identifier hs-var hs-var">filterUnregistered</span></a></span></span><span> </span><span id="local-6989586621679405921"><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621679405921"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
#if MIN_VERSION_containers(0,5,8)
</span><span>  </span><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621679405921"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-operator hs-var">`M.withoutKeys`</span></span><span> </span><span class="annot"><span class="annottext">Set Text
</span><a href="Crypto.JWT.html#registeredClaims"><span class="hs-identifier hs-var">registeredClaims</span></a></span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">M.difference</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">M.fromSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">const</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">registeredClaims</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-356"></span><span class="annot"><a href="Crypto.JWT.html#toKeyMap"><span class="hs-identifier hs-type">toKeyMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KeyMap.KeyMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-357"></span><span id="toKeyMap"><span class="annot"><span class="annottext">toKeyMap :: Map Text Value -&gt; KeyMap Value
</span><a href="Crypto.JWT.html#toKeyMap"><span class="hs-identifier hs-var hs-var">toKeyMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Map Key v -&gt; KeyMap v
</span><span class="hs-identifier hs-var">KeyMap.fromMap</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k1 k2 a. (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">M.mapKeysMonotonic</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Key
</span><span class="hs-identifier hs-var">Key.fromText</span></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="annot"><a href="Crypto.JWT.html#fromKeyMap"><span class="hs-identifier hs-type">fromKeyMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KeyMap.KeyMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-360"></span><span id="fromKeyMap"><span class="annot"><span class="annottext">fromKeyMap :: KeyMap Value -&gt; Map Text Value
</span><a href="Crypto.JWT.html#fromKeyMap"><span class="hs-identifier hs-var hs-var">fromKeyMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k1 k2 a. (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">M.mapKeysMonotonic</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text
</span><span class="hs-identifier hs-var">Key.toText</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v. KeyMap v -&gt; Map Key v
</span><span class="hs-identifier hs-var">KeyMap.toMap</span></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679405910"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-363"></span><span>  </span><span id="local-6989586621679405884"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser ClaimsSet
</span><a href="#local-6989586621679405884"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; (KeyMap Value -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;JWT Claims Set&quot;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405882"><span class="annot"><span class="annottext">KeyMap Value
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe StringOrURI
-&gt; Maybe StringOrURI
-&gt; Maybe Audience
-&gt; Maybe NumericDate
-&gt; Maybe NumericDate
-&gt; Maybe NumericDate
-&gt; Maybe Text
-&gt; Map Text Value
-&gt; ClaimsSet
</span><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-var">ClaimsSet</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyMap Value
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; KeyMap Value -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;iss&quot;</span></span><span>
</span><span id="line-365"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyMap Value
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; KeyMap Value -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;sub&quot;</span></span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyMap Value
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; KeyMap Value -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;aud&quot;</span></span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyMap Value
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; KeyMap Value -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;exp&quot;</span></span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyMap Value
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; KeyMap Value -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;nbf&quot;</span></span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyMap Value
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; KeyMap Value -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;iat&quot;</span></span><span>
</span><span id="line-370"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyMap Value
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; KeyMap Value -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;jti&quot;</span></span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text Value -&gt; Map Text Value
</span><a href="Crypto.JWT.html#filterUnregistered"><span class="hs-identifier hs-var">filterUnregistered</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KeyMap Value -&gt; Map Text Value
</span><a href="Crypto.JWT.html#fromKeyMap"><span class="hs-identifier hs-var">fromKeyMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeyMap Value
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679405874"><span id="local-6989586621679405876"><span id="local-6989586621679405878"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-375"></span><span>  </span><span id="local-6989586621679405842"><span class="annot"><span class="annottext">toJSON :: ClaimsSet -&gt; Value
</span><a href="#local-6989586621679405842"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span id="local-6989586621679405841"><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405841"><span class="hs-identifier hs-var">iss</span></a></span></span><span> </span><span id="local-6989586621679405840"><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405840"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span id="local-6989586621679405839"><span class="annot"><span class="annottext">Maybe Audience
</span><a href="#local-6989586621679405839"><span class="hs-identifier hs-var">aud</span></a></span></span><span> </span><span id="local-6989586621679405838"><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405838"><span class="hs-identifier hs-var">exp'</span></a></span></span><span> </span><span id="local-6989586621679405837"><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405837"><span class="hs-identifier hs-var">nbf</span></a></span></span><span> </span><span id="local-6989586621679405836"><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405836"><span class="hs-identifier hs-var">iat</span></a></span></span><span> </span><span id="local-6989586621679405835"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679405835"><span class="hs-identifier hs-var">jti</span></a></span></span><span> </span><span id="local-6989586621679405834"><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621679405834"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyMap Value -&gt; Value
</span><span class="hs-identifier hs-var">Object</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall v. Map Key v -&gt; KeyMap v
</span><span class="hs-identifier hs-var">KeyMap.fromMap</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k a. [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromDistinctAscList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span>
</span><span id="line-377"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;aud&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Audience
</span><a href="#local-6989586621679405839"><span class="hs-identifier hs-var">aud</span></a></span><span>
</span><span id="line-378"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;exp&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405838"><span class="hs-identifier hs-var">exp'</span></a></span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;iat&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405836"><span class="hs-identifier hs-var">iat</span></a></span><span>
</span><span id="line-380"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;iss&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405841"><span class="hs-identifier hs-var">iss</span></a></span><span>
</span><span id="line-381"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;jti&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679405835"><span class="hs-identifier hs-var">jti</span></a></span><span>
</span><span id="line-382"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;nbf&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe NumericDate
</span><a href="#local-6989586621679405837"><span class="hs-identifier hs-var">nbf</span></a></span><span>
</span><span id="line-383"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;sub&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe StringOrURI
</span><a href="#local-6989586621679405840"><span class="hs-identifier hs-var">sub</span></a></span><span>
</span><span id="line-384"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map Text Value -&gt; KeyMap Value
</span><a href="Crypto.JWT.html#toKeyMap"><span class="hs-identifier hs-var">toKeyMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text Value -&gt; Map Text Value
</span><a href="Crypto.JWT.html#filterUnregistered"><span class="hs-identifier hs-var">filterUnregistered</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621679405834"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-keyword">data</span><span> </span><span id="JWTValidationSettings"><span class="annot"><a href="Crypto.JWT.html#JWTValidationSettings"><span class="hs-identifier hs-var">JWTValidationSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="JWTValidationSettings"><span class="annot"><a href="Crypto.JWT.html#JWTValidationSettings"><span class="hs-identifier hs-var">JWTValidationSettings</span></a></span></span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_jwtValidationSettingsValidationSettings"><span class="annot"><span class="annottext">JWTValidationSettings -&gt; ValidationSettings
</span><a href="Crypto.JWT.html#_jwtValidationSettingsValidationSettings"><span class="hs-identifier hs-var hs-var">_jwtValidationSettingsValidationSettings</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWS.html#ValidationSettings"><span class="hs-identifier hs-type">ValidationSettings</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_jwtValidationSettingsAllowedSkew"><span class="annot"><span class="annottext">JWTValidationSettings -&gt; NominalDiffTime
</span><a href="Crypto.JWT.html#_jwtValidationSettingsAllowedSkew"><span class="hs-identifier hs-var hs-var">_jwtValidationSettingsAllowedSkew</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_jwtValidationSettingsCheckIssuedAt"><span class="annot"><span class="annottext">JWTValidationSettings -&gt; Bool
</span><a href="Crypto.JWT.html#_jwtValidationSettingsCheckIssuedAt"><span class="hs-identifier hs-var hs-var">_jwtValidationSettingsCheckIssuedAt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-comment">-- ^ The allowed skew is interpreted in absolute terms;</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-comment">--   a nonzero value always expands the validity period.</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_jwtValidationSettingsAudiencePredicate"><span class="annot"><span class="annottext">JWTValidationSettings -&gt; StringOrURI -&gt; Bool
</span><a href="Crypto.JWT.html#_jwtValidationSettingsAudiencePredicate"><span class="hs-identifier hs-var hs-var">_jwtValidationSettingsAudiencePredicate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_jwtValidationSettingsIssuerPredicate"><span class="annot"><span class="annottext">JWTValidationSettings -&gt; StringOrURI -&gt; Bool
</span><a href="Crypto.JWT.html#_jwtValidationSettingsIssuerPredicate"><span class="hs-identifier hs-var hs-var">_jwtValidationSettingsIssuerPredicate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-398"></span><span id="jwtValidationSettingsValidationSettings"><span id="jwtValidationSettingsIssuerPredicate"><span id="jwtValidationSettingsCheckIssuedAt"><span id="jwtValidationSettingsAudiencePredicate"><span id="jwtValidationSettingsAllowedSkew"><span id="jWTValidationSettings"><span id="local-6989586621679405771"><span id="local-6989586621679405775"><span id="local-6989586621679405779"><span id="local-6989586621679405783"><span id="local-6989586621679405787"><span id="local-6989586621679405790"><span id="local-6989586621679405797"><span id="local-6989586621679405803"><span id="local-6989586621679405809"><span id="local-6989586621679405815"><span id="local-6989586621679405822"><span id="local-6989586621679406855"><span id="HasJWTValidationSettings"><span class="hs-identifier">makeClassy</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">JWTValidationSettings</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span id="local-6989586621679405722"><span id="local-6989586621679405724"><span id="local-6989586621679406840"><span class="annot"><a href="Crypto.JWT.html#HasJWTValidationSettings"><span class="hs-identifier hs-type">HasJWTValidationSettings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406840"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWS.html#HasValidationSettings"><span class="hs-identifier hs-type">HasValidationSettings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406840"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-401"></span><span>  </span><span id="local-6989586621679405717"><span class="annot"><span class="annottext">validationSettings :: Lens' a ValidationSettings
</span><a href="Crypto.JOSE.JWS.html#validationSettings"><span class="hs-identifier hs-var hs-var hs-var hs-var">validationSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall c. HasJWTValidationSettings c =&gt; Lens' c ValidationSettings
</span><a href="Crypto.JWT.html#jwtValidationSettingsValidationSettings"><span class="hs-identifier hs-var">jwtValidationSettingsValidationSettings</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="hs-comment">-- | Maximum allowed skew when validating the /nbf/, /exp/ and /iat/ claims.</span><span>
</span><span id="line-404"></span><span class="hs-keyword">class</span><span> </span><span id="HasAllowedSkew"><span class="annot"><a href="Crypto.JWT.html#HasAllowedSkew"><span class="hs-identifier hs-var">HasAllowedSkew</span></a></span></span><span> </span><span id="local-6989586621679406838"><span class="annot"><a href="#local-6989586621679406838"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-405"></span><span>  </span><span id="allowedSkew"><span class="annot"><a href="Crypto.JWT.html#allowedSkew"><span class="hs-identifier hs-type">allowedSkew</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="#local-6989586621679406838"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NominalDiffTime</span></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="hs-comment">-- | Predicate for checking values in the /aud/ claim.</span><span>
</span><span id="line-408"></span><span class="hs-keyword">class</span><span> </span><span id="HasAudiencePredicate"><span class="annot"><a href="Crypto.JWT.html#HasAudiencePredicate"><span class="hs-identifier hs-var">HasAudiencePredicate</span></a></span></span><span> </span><span id="local-6989586621679406833"><span class="annot"><a href="#local-6989586621679406833"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-409"></span><span>  </span><span id="audiencePredicate"><span class="annot"><a href="Crypto.JWT.html#audiencePredicate"><span class="hs-identifier hs-type">audiencePredicate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="#local-6989586621679406833"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-comment">-- | Predicate for checking the /iss/ claim.</span><span>
</span><span id="line-412"></span><span class="hs-keyword">class</span><span> </span><span id="HasIssuerPredicate"><span class="annot"><a href="Crypto.JWT.html#HasIssuerPredicate"><span class="hs-identifier hs-var">HasIssuerPredicate</span></a></span></span><span> </span><span id="local-6989586621679406828"><span class="annot"><a href="#local-6989586621679406828"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-413"></span><span>  </span><span id="issuerPredicate"><span class="annot"><a href="Crypto.JWT.html#issuerPredicate"><span class="hs-identifier hs-type">issuerPredicate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="#local-6989586621679406828"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="hs-comment">-- | Whether to check that the /iat/ claim is not in the future.</span><span>
</span><span id="line-416"></span><span class="hs-keyword">class</span><span> </span><span id="HasCheckIssuedAt"><span class="annot"><a href="Crypto.JWT.html#HasCheckIssuedAt"><span class="hs-identifier hs-var">HasCheckIssuedAt</span></a></span></span><span> </span><span id="local-6989586621679406823"><span class="annot"><a href="#local-6989586621679406823"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-417"></span><span>  </span><span id="checkIssuedAt"><span class="annot"><a href="Crypto.JWT.html#checkIssuedAt"><span class="hs-identifier hs-type">checkIssuedAt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><a href="#local-6989586621679406823"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406835"><span class="annot"><a href="Crypto.JWT.html#HasJWTValidationSettings"><span class="hs-identifier hs-type">HasJWTValidationSettings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406835"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAllowedSkew"><span class="hs-identifier hs-type">HasAllowedSkew</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406835"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-420"></span><span>  </span><span id="local-6989586621679405704"><span class="annot"><span class="annottext">allowedSkew :: Lens' a NominalDiffTime
</span><a href="#local-6989586621679405704"><span class="hs-identifier hs-var hs-var hs-var hs-var">allowedSkew</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall c. HasJWTValidationSettings c =&gt; Lens' c NominalDiffTime
</span><a href="Crypto.JWT.html#jwtValidationSettingsAllowedSkew"><span class="hs-identifier hs-var">jwtValidationSettingsAllowedSkew</span></a></span><span>
</span><span id="line-421"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406830"><span class="annot"><a href="Crypto.JWT.html#HasJWTValidationSettings"><span class="hs-identifier hs-type">HasJWTValidationSettings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406830"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAudiencePredicate"><span class="hs-identifier hs-type">HasAudiencePredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406830"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-422"></span><span>  </span><span id="local-6989586621679405696"><span class="annot"><span class="annottext">audiencePredicate :: Lens' a (StringOrURI -&gt; Bool)
</span><a href="#local-6989586621679405696"><span class="hs-identifier hs-var hs-var hs-var hs-var">audiencePredicate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall c.
HasJWTValidationSettings c =&gt;
Lens' c (StringOrURI -&gt; Bool)
</span><a href="Crypto.JWT.html#jwtValidationSettingsAudiencePredicate"><span class="hs-identifier hs-var">jwtValidationSettingsAudiencePredicate</span></a></span><span>
</span><span id="line-423"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406825"><span class="annot"><a href="Crypto.JWT.html#HasJWTValidationSettings"><span class="hs-identifier hs-type">HasJWTValidationSettings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406825"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasIssuerPredicate"><span class="hs-identifier hs-type">HasIssuerPredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406825"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-424"></span><span>  </span><span id="local-6989586621679405688"><span class="annot"><span class="annottext">issuerPredicate :: Lens' a (StringOrURI -&gt; Bool)
</span><a href="#local-6989586621679405688"><span class="hs-identifier hs-var hs-var hs-var hs-var">issuerPredicate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall c.
HasJWTValidationSettings c =&gt;
Lens' c (StringOrURI -&gt; Bool)
</span><a href="Crypto.JWT.html#jwtValidationSettingsIssuerPredicate"><span class="hs-identifier hs-var">jwtValidationSettingsIssuerPredicate</span></a></span><span>
</span><span id="line-425"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406820"><span class="annot"><a href="Crypto.JWT.html#HasJWTValidationSettings"><span class="hs-identifier hs-type">HasJWTValidationSettings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406820"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasCheckIssuedAt"><span class="hs-identifier hs-type">HasCheckIssuedAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406820"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-426"></span><span>  </span><span id="local-6989586621679405680"><span class="annot"><span class="annottext">checkIssuedAt :: Lens' a Bool
</span><a href="#local-6989586621679405680"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkIssuedAt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall c. HasJWTValidationSettings c =&gt; Lens' c Bool
</span><a href="Crypto.JWT.html#jwtValidationSettingsCheckIssuedAt"><span class="hs-identifier hs-var">jwtValidationSettingsCheckIssuedAt</span></a></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="hs-comment">-- | Acquire the default validation settings.</span><span>
</span><span id="line-429"></span><span class="hs-comment">--</span><span>
</span><span id="line-430"></span><span class="hs-comment">-- &lt;https://tools.ietf.org/html/rfc7519#section-4.1.3 RFC 7519 &#167;4.1.3.&gt;</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- states that applications MUST identify itself with a value in the</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- audience claim, therefore a predicate must be supplied.</span><span>
</span><span id="line-433"></span><span class="hs-comment">--</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- The other defaults are:</span><span>
</span><span id="line-435"></span><span class="hs-comment">--</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- - 'defaultValidationSettings' for JWS verification</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- - Zero clock skew tolerance when validating /nbf/, /exp/ and /iat/ claims</span><span>
</span><span id="line-438"></span><span class="hs-comment">-- - /iat/ claim is checked</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- - /issuer/ claim is not checked</span><span>
</span><span id="line-440"></span><span class="hs-comment">--</span><span>
</span><span id="line-441"></span><span class="annot"><a href="Crypto.JWT.html#defaultJWTValidationSettings"><span class="hs-identifier hs-type">defaultJWTValidationSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#StringOrURI"><span class="hs-identifier hs-type">StringOrURI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#JWTValidationSettings"><span class="hs-identifier hs-type">JWTValidationSettings</span></a></span><span>
</span><span id="line-442"></span><span id="defaultJWTValidationSettings"><span class="annot"><span class="annottext">defaultJWTValidationSettings :: (StringOrURI -&gt; Bool) -&gt; JWTValidationSettings
</span><a href="Crypto.JWT.html#defaultJWTValidationSettings"><span class="hs-identifier hs-var hs-var">defaultJWTValidationSettings</span></a></span></span><span> </span><span id="local-6989586621679405679"><span class="annot"><span class="annottext">StringOrURI -&gt; Bool
</span><a href="#local-6989586621679405679"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationSettings
-&gt; NominalDiffTime
-&gt; Bool
-&gt; (StringOrURI -&gt; Bool)
-&gt; (StringOrURI -&gt; Bool)
-&gt; JWTValidationSettings
</span><a href="Crypto.JWT.html#JWTValidationSettings"><span class="hs-identifier hs-var">JWTValidationSettings</span></a></span><span>
</span><span id="line-443"></span><span>  </span><span class="annot"><span class="annottext">ValidationSettings
</span><a href="Crypto.JOSE.JWS.html#defaultValidationSettings"><span class="hs-identifier hs-var">defaultValidationSettings</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">0</span></span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><span class="annottext">StringOrURI -&gt; Bool
</span><a href="#local-6989586621679405679"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="hs-comment">-- | Validate the claims made by a ClaimsSet.</span><span>
</span><span id="line-450"></span><span class="hs-comment">--</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- These checks are performed by 'verifyClaims', which also</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- validates any signatures, so you shouldn't need to use this</span><span>
</span><span id="line-453"></span><span class="hs-comment">-- function directly.</span><span>
</span><span id="line-454"></span><span class="hs-comment">--</span><span>
</span><span id="line-455"></span><span id="local-6989586621679406813"><span id="local-6989586621679406814"><span id="local-6989586621679406816"><span class="annot"><a href="Crypto.JWT.html#validateClaimsSet"><span class="hs-identifier hs-type">validateClaimsSet</span></a></span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-glyph">::</span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTime</span></span><span> </span><span class="annot"><a href="#local-6989586621679406816"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAllowedSkew"><span class="hs-identifier hs-type">HasAllowedSkew</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406814"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAudiencePredicate"><span class="hs-identifier hs-type">HasAudiencePredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406814"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasIssuerPredicate"><span class="hs-identifier hs-type">HasIssuerPredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406814"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasCheckIssuedAt"><span class="hs-identifier hs-type">HasCheckIssuedAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406814"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#AsJWTError"><span class="hs-identifier hs-type">AsJWTError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406813"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679406813"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406816"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406814"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406816"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span></span></span></span><span>
</span><span id="line-465"></span><span id="validateClaimsSet"><span class="annot"><span class="annottext">validateClaimsSet :: forall (m :: * -&gt; *) a e.
(MonadTime m, HasAllowedSkew a, HasAudiencePredicate a,
 HasIssuerPredicate a, HasCheckIssuedAt a, AsJWTError e,
 MonadError e m) =&gt;
a -&gt; ClaimsSet -&gt; m ClaimsSet
</span><a href="Crypto.JWT.html#validateClaimsSet"><span class="hs-identifier hs-var hs-var">validateClaimsSet</span></a></span></span><span> </span><span id="local-6989586621679405641"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405641"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621679405640"><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405640"><span class="hs-identifier hs-var">claims</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>  </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405640"><span class="hs-identifier hs-var">claims</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405640"><span class="hs-identifier hs-var">claims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405641"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a e.
(MonadTime m, HasAllowedSkew a, AsJWTError e, MonadError e m) =&gt;
a -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateExpClaim"><span class="hs-identifier hs-var">validateExpClaim</span></a></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a e.
(MonadTime m, HasCheckIssuedAt a, HasAllowedSkew a, AsJWTError e,
 MonadError e m) =&gt;
a -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateIatClaim"><span class="hs-identifier hs-var">validateIatClaim</span></a></span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a e.
(MonadTime m, HasAllowedSkew a, AsJWTError e, MonadError e m) =&gt;
a -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateNbfClaim"><span class="hs-identifier hs-var">validateNbfClaim</span></a></span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall s e (m :: * -&gt; *).
(HasIssuerPredicate s, AsJWTError e, MonadError e m) =&gt;
s -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateIssClaim"><span class="hs-identifier hs-var">validateIssClaim</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall s e (m :: * -&gt; *).
(HasAudiencePredicate s, AsJWTError e, MonadError e m) =&gt;
s -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateAudClaim"><span class="hs-identifier hs-var">validateAudClaim</span></a></span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span id="local-6989586621679406798"><span id="local-6989586621679406799"><span id="local-6989586621679406800"><span class="annot"><a href="Crypto.JWT.html#validateExpClaim"><span class="hs-identifier hs-type">validateExpClaim</span></a></span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTime</span></span><span> </span><span class="annot"><a href="#local-6989586621679406800"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAllowedSkew"><span class="hs-identifier hs-type">HasAllowedSkew</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406799"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#AsJWTError"><span class="hs-identifier hs-type">AsJWTError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406798"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679406798"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406800"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406799"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406800"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-479"></span><span id="validateExpClaim"><span class="annot"><span class="annottext">validateExpClaim :: forall (m :: * -&gt; *) a e.
(MonadTime m, HasAllowedSkew a, AsJWTError e, MonadError e m) =&gt;
a -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateExpClaim"><span class="hs-identifier hs-var hs-var">validateExpClaim</span></a></span></span><span> </span><span id="local-6989586621679405601"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405601"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-480"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405600"><span class="annot"><span class="annottext">NumericDate
</span><a href="#local-6989586621679405600"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-481"></span><span>    </span><span id="local-6989586621679405599"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405599"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadTime m =&gt; m UTCTime
</span><span class="hs-identifier hs-var">currentTime</span></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405599"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; UTCTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">addUTCTime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall s. HasAllowedSkew s =&gt; Lens' s NominalDiffTime
</span><a href="Crypto.JWT.html#allowedSkew"><span class="hs-identifier hs-var">allowedSkew</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405601"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Iso' NumericDate UTCTime
</span><a href="Crypto.JWT.html#_NumericDate"><span class="hs-identifier hs-var">_NumericDate</span></a></span><span> </span><span class="annot"><span class="annottext">NumericDate
</span><a href="#local-6989586621679405600"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-483"></span><span>      </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) x. MonadError e m =&gt; AReview e () -&gt; m x
</span><span class="hs-identifier hs-var">throwing_</span></span><span> </span><span class="annot"><span class="annottext">forall r. AsJWTError r =&gt; Prism' r ()
</span><a href="Crypto.JWT.html#_JWTExpired"><span class="hs-identifier hs-var">_JWTExpired</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>  </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' ClaimsSet (Maybe NumericDate)
</span><a href="Crypto.JWT.html#claimExp"><span class="hs-identifier hs-var">claimExp</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span id="local-6989586621679406795"><span id="local-6989586621679406796"><span id="local-6989586621679406797"><span class="annot"><a href="Crypto.JWT.html#validateIatClaim"><span class="hs-identifier hs-type">validateIatClaim</span></a></span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTime</span></span><span> </span><span class="annot"><a href="#local-6989586621679406797"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasCheckIssuedAt"><span class="hs-identifier hs-type">HasCheckIssuedAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406796"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAllowedSkew"><span class="hs-identifier hs-type">HasAllowedSkew</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406796"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#AsJWTError"><span class="hs-identifier hs-type">AsJWTError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406795"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679406795"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406797"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406796"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-491"></span><span id="validateIatClaim"><span class="annot"><span class="annottext">validateIatClaim :: forall (m :: * -&gt; *) a e.
(MonadTime m, HasCheckIssuedAt a, HasAllowedSkew a, AsJWTError e,
 MonadError e m) =&gt;
a -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateIatClaim"><span class="hs-identifier hs-var hs-var">validateIatClaim</span></a></span></span><span> </span><span id="local-6989586621679405561"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405561"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-492"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405560"><span class="annot"><span class="annottext">NumericDate
</span><a href="#local-6989586621679405560"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621679405559"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405559"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadTime m =&gt; m UTCTime
</span><span class="hs-identifier hs-var">currentTime</span></span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall s. HasCheckIssuedAt s =&gt; Lens' s Bool
</span><a href="Crypto.JWT.html#checkIssuedAt"><span class="hs-identifier hs-var">checkIssuedAt</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405561"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-495"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Iso' NumericDate UTCTime
</span><a href="Crypto.JWT.html#_NumericDate"><span class="hs-identifier hs-var">_NumericDate</span></a></span><span> </span><span class="annot"><span class="annottext">NumericDate
</span><a href="#local-6989586621679405560"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; UTCTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">addUTCTime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall s. HasAllowedSkew s =&gt; Lens' s NominalDiffTime
</span><a href="Crypto.JWT.html#allowedSkew"><span class="hs-identifier hs-var">allowedSkew</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405561"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405559"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-496"></span><span>        </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) x. MonadError e m =&gt; AReview e () -&gt; m x
</span><span class="hs-identifier hs-var">throwing_</span></span><span> </span><span class="annot"><span class="annottext">forall r. AsJWTError r =&gt; Prism' r ()
</span><a href="Crypto.JWT.html#_JWTIssuedAtFuture"><span class="hs-identifier hs-var">_JWTIssuedAtFuture</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' ClaimsSet (Maybe NumericDate)
</span><a href="Crypto.JWT.html#claimIat"><span class="hs-identifier hs-var">claimIat</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span id="local-6989586621679405554"><span id="local-6989586621679405555"><span id="local-6989586621679405556"><span class="annot"><a href="Crypto.JWT.html#validateNbfClaim"><span class="hs-identifier hs-type">validateNbfClaim</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTime</span></span><span> </span><span class="annot"><a href="#local-6989586621679405556"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAllowedSkew"><span class="hs-identifier hs-type">HasAllowedSkew</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679405555"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#AsJWTError"><span class="hs-identifier hs-type">AsJWTError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679405554"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679405554"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679405556"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679405555"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679405556"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-504"></span><span id="validateNbfClaim"><span class="annot"><span class="annottext">validateNbfClaim :: forall (m :: * -&gt; *) a e.
(MonadTime m, HasAllowedSkew a, AsJWTError e, MonadError e m) =&gt;
a -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateNbfClaim"><span class="hs-identifier hs-var hs-var">validateNbfClaim</span></a></span></span><span> </span><span id="local-6989586621679405524"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405524"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-505"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405523"><span class="annot"><span class="annottext">NumericDate
</span><a href="#local-6989586621679405523"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>    </span><span id="local-6989586621679405522"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405522"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadTime m =&gt; m UTCTime
</span><span class="hs-identifier hs-var">currentTime</span></span><span>
</span><span id="line-507"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405522"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; UTCTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">addUTCTime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall s. HasAllowedSkew s =&gt; Lens' s NominalDiffTime
</span><a href="Crypto.JWT.html#allowedSkew"><span class="hs-identifier hs-var">allowedSkew</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405524"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Iso' NumericDate UTCTime
</span><a href="Crypto.JWT.html#_NumericDate"><span class="hs-identifier hs-var">_NumericDate</span></a></span><span> </span><span class="annot"><span class="annottext">NumericDate
</span><a href="#local-6989586621679405523"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-508"></span><span>      </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) x. MonadError e m =&gt; AReview e () -&gt; m x
</span><span class="hs-identifier hs-var">throwing_</span></span><span> </span><span class="annot"><span class="annottext">forall r. AsJWTError r =&gt; Prism' r ()
</span><a href="Crypto.JWT.html#_JWTNotYetValid"><span class="hs-identifier hs-var">_JWTNotYetValid</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>  </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' ClaimsSet (Maybe NumericDate)
</span><a href="Crypto.JWT.html#claimNbf"><span class="hs-identifier hs-var">claimNbf</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span id="local-6989586621679406789"><span id="local-6989586621679406790"><span id="local-6989586621679406791"><span class="annot"><a href="Crypto.JWT.html#validateAudClaim"><span class="hs-identifier hs-type">validateAudClaim</span></a></span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#HasAudiencePredicate"><span class="hs-identifier hs-type">HasAudiencePredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406791"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#AsJWTError"><span class="hs-identifier hs-type">AsJWTError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406790"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679406790"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406789"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406791"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406789"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-516"></span><span id="validateAudClaim"><span class="annot"><span class="annottext">validateAudClaim :: forall s e (m :: * -&gt; *).
(HasAudiencePredicate s, AsJWTError e, MonadError e m) =&gt;
s -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateAudClaim"><span class="hs-identifier hs-var hs-var">validateAudClaim</span></a></span></span><span> </span><span id="local-6989586621679405495"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679405495"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-517"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405494"><span class="annot"><span class="annottext">[StringOrURI]
</span><a href="#local-6989586621679405494"><span class="hs-identifier hs-var">auds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall s. HasAudiencePredicate s =&gt; Lens' s (StringOrURI -&gt; Bool)
</span><a href="Crypto.JWT.html#audiencePredicate"><span class="hs-identifier hs-var">audiencePredicate</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679405495"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[StringOrURI]
</span><a href="#local-6989586621679405494"><span class="hs-identifier hs-var">auds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-519"></span><span>        </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) x. MonadError e m =&gt; AReview e () -&gt; m x
</span><span class="hs-identifier hs-var">throwing_</span></span><span> </span><span class="annot"><span class="annottext">forall r. AsJWTError r =&gt; Prism' r ()
</span><a href="Crypto.JWT.html#_JWTNotInAudience"><span class="hs-identifier hs-var">_JWTNotInAudience</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>  </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' ClaimsSet (Maybe Audience)
</span><a href="Crypto.JWT.html#claimAud"><span class="hs-identifier hs-var">claimAud</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Iso' Audience [StringOrURI]
</span><a href="Crypto.JWT.html#_Audience"><span class="hs-identifier hs-var">_Audience</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span id="local-6989586621679406792"><span id="local-6989586621679406793"><span id="local-6989586621679406794"><span class="annot"><a href="Crypto.JWT.html#validateIssClaim"><span class="hs-identifier hs-type">validateIssClaim</span></a></span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JWT.html#HasIssuerPredicate"><span class="hs-identifier hs-type">HasIssuerPredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406794"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#AsJWTError"><span class="hs-identifier hs-type">AsJWTError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406793"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679406793"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406792"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406794"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406792"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-527"></span><span id="validateIssClaim"><span class="annot"><span class="annottext">validateIssClaim :: forall s e (m :: * -&gt; *).
(HasIssuerPredicate s, AsJWTError e, MonadError e m) =&gt;
s -&gt; ClaimsSet -&gt; m ()
</span><a href="Crypto.JWT.html#validateIssClaim"><span class="hs-identifier hs-var hs-var">validateIssClaim</span></a></span></span><span> </span><span id="local-6989586621679405472"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679405472"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-528"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679405471"><span class="annot"><span class="annottext">StringOrURI
</span><a href="#local-6989586621679405471"><span class="hs-identifier hs-var">iss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall s. HasIssuerPredicate s =&gt; Lens' s (StringOrURI -&gt; Bool)
</span><a href="Crypto.JWT.html#issuerPredicate"><span class="hs-identifier hs-var">issuerPredicate</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679405472"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">StringOrURI
</span><a href="#local-6989586621679405471"><span class="hs-identifier hs-var">iss</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) x. MonadError e m =&gt; AReview e () -&gt; m x
</span><span class="hs-identifier hs-var">throwing_</span></span><span> </span><span class="annot"><span class="annottext">forall r. AsJWTError r =&gt; Prism' r ()
</span><a href="Crypto.JWT.html#_JWTNotInIssuer"><span class="hs-identifier hs-var">_JWTNotInIssuer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>  </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' ClaimsSet (Maybe StringOrURI)
</span><a href="Crypto.JWT.html#claimIss"><span class="hs-identifier hs-var">claimIss</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="hs-comment">-- | A digitally signed or MACed JWT</span><span>
</span><span id="line-533"></span><span class="hs-comment">--</span><span>
</span><span id="line-534"></span><span class="hs-keyword">type</span><span> </span><span id="SignedJWT"><span class="annot"><a href="Crypto.JWT.html#SignedJWT"><span class="hs-identifier hs-var">SignedJWT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWS.html#CompactJWS"><span class="hs-identifier hs-type">CompactJWS</span></a></span><span> </span><span class="annot"><a href="Crypto.JOSE.JWS.html#JWSHeader"><span class="hs-identifier hs-type">JWSHeader</span></a></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="hs-keyword">newtype</span><span> </span><span id="WrappedUTCTime"><span class="annot"><a href="Crypto.JWT.html#WrappedUTCTime"><span class="hs-identifier hs-var">WrappedUTCTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WrappedUTCTime"><span class="annot"><a href="Crypto.JWT.html#WrappedUTCTime"><span class="hs-identifier hs-var">WrappedUTCTime</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getUTCTime"><span class="annot"><span class="annottext">WrappedUTCTime -&gt; UTCTime
</span><a href="Crypto.JWT.html#getUTCTime"><span class="hs-identifier hs-var hs-var">getUTCTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406756"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679406756"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#WrappedUTCTime"><span class="hs-identifier hs-type">WrappedUTCTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406756"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-540"></span><span>  </span><span id="local-6989586621679405458"><span class="annot"><span class="annottext">currentTime :: ReaderT WrappedUTCTime m UTCTime
</span><a href="#local-6989586621679405458"><span class="hs-identifier hs-var hs-var hs-var hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">WrappedUTCTime -&gt; UTCTime
</span><a href="Crypto.JWT.html#getUTCTime"><span class="hs-identifier hs-var">getUTCTime</span></a></span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="hs-comment">-- | Cryptographically verify a JWS JWT, then validate the</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- Claims Set, returning it if valid.</span><span>
</span><span id="line-545"></span><span class="hs-comment">--</span><span>
</span><span id="line-546"></span><span class="hs-comment">-- This is the only way to get at the claims of a JWS JWT,</span><span>
</span><span id="line-547"></span><span class="hs-comment">-- enforcing that the claims are cryptographically and</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- semantically valid before the application can use them.</span><span>
</span><span id="line-549"></span><span class="hs-comment">--</span><span>
</span><span id="line-550"></span><span class="hs-comment">-- See also 'verifyClaimsAt' which allows you to explicitly specify</span><span>
</span><span id="line-551"></span><span class="hs-comment">-- the time.</span><span>
</span><span id="line-552"></span><span class="hs-comment">--</span><span>
</span><span id="line-553"></span><span id="local-6989586621679406746"><span id="local-6989586621679406748"><span id="local-6989586621679406749"><span id="local-6989586621679406750"><span class="annot"><a href="Crypto.JWT.html#verifyClaims"><span class="hs-identifier hs-type">verifyClaims</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-glyph">::</span><span>
</span><span id="line-555"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTime</span></span><span> </span><span class="annot"><a href="#local-6989586621679406750"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAllowedSkew"><span class="hs-identifier hs-type">HasAllowedSkew</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406749"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAudiencePredicate"><span class="hs-identifier hs-type">HasAudiencePredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406749"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-556"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasIssuerPredicate"><span class="hs-identifier hs-type">HasIssuerPredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406749"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasCheckIssuedAt"><span class="hs-identifier hs-type">HasCheckIssuedAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406749"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWS.html#HasValidationSettings"><span class="hs-identifier hs-type">HasValidationSettings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406749"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Error.html#AsError"><span class="hs-identifier hs-type">AsError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406748"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#AsJWTError"><span class="hs-identifier hs-type">AsJWTError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406748"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679406748"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406750"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-560"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWK.Store.html#VerificationKeyStore"><span class="hs-identifier hs-type">VerificationKeyStore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406750"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.JWS.html#JWSHeader"><span class="hs-identifier hs-type">JWSHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406746"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-561"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406749"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406746"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#SignedJWT"><span class="hs-identifier hs-type">SignedJWT</span></a></span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406750"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span></span></span></span></span><span>
</span><span id="line-566"></span><span id="verifyClaims"><span class="annot"><span class="annottext">verifyClaims :: forall (m :: * -&gt; *) a e k.
(MonadTime m, HasAllowedSkew a, HasAudiencePredicate a,
 HasIssuerPredicate a, HasCheckIssuedAt a, HasValidationSettings a,
 AsError e, AsJWTError e, MonadError e m,
 VerificationKeyStore m (JWSHeader ()) ClaimsSet k) =&gt;
a -&gt; k -&gt; SignedJWT -&gt; m ClaimsSet
</span><a href="Crypto.JWT.html#verifyClaims"><span class="hs-identifier hs-var hs-var">verifyClaims</span></a></span></span><span> </span><span id="local-6989586621679405418"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405418"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621679405417"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679405417"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679405416"><span class="annot"><span class="annottext">SignedJWT
</span><a href="#local-6989586621679405416"><span class="hs-identifier hs-var">jws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-comment">-- It is important, for security reasons, that the signature get</span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-comment">-- verified before the claims.</span><span>
</span><span id="line-569"></span><span>  </span><span class="annot"><span class="annottext">forall a e (m :: * -&gt; *) (h :: * -&gt; *) p payload k s (t :: * -&gt; *).
(HasAlgorithms a, HasValidationPolicy a, AsError e, MonadError e m,
 HasJWSHeader h, HasParams h,
 VerificationKeyStore m (h p) payload k, Cons s s Word8 Word8,
 AsEmpty s, Foldable t, ProtectionIndicator p) =&gt;
(s -&gt; m payload) -&gt; a -&gt; k -&gt; JWS t p h -&gt; m payload
</span><a href="Crypto.JOSE.JWS.html#verifyJWSWithPayload"><span class="hs-identifier hs-var">verifyJWSWithPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; m ClaimsSet
</span><a href="#local-6989586621679405414"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405418"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679405417"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">SignedJWT
</span><a href="#local-6989586621679405416"><span class="hs-identifier hs-var">jws</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a e.
(MonadTime m, HasAllowedSkew a, HasAudiencePredicate a,
 HasIssuerPredicate a, HasCheckIssuedAt a, AsJWTError e,
 MonadError e m) =&gt;
a -&gt; ClaimsSet -&gt; m ClaimsSet
</span><a href="Crypto.JWT.html#validateClaimsSet"><span class="hs-identifier hs-var">validateClaimsSet</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405418"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-571"></span><span>    </span><span id="local-6989586621679405414"><span class="annot"><span class="annottext">f :: ByteString -&gt; m ClaimsSet
</span><a href="#local-6989586621679405414"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">forall r. AsJWTError r =&gt; Prism' r String
</span><a href="Crypto.JWT.html#_JWTClaimsSetDecodeError"><span class="hs-identifier hs-var">_JWTClaimsSetDecodeError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">eitherDecode</span></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="hs-comment">-- | Cryptographically verify a JWS JWT, then validate the</span><span>
</span><span id="line-575"></span><span class="hs-comment">-- Claims Set, returning it if valid.</span><span>
</span><span id="line-576"></span><span class="hs-comment">--</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- This is the same as 'verifyClaims' except that the time is</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- explicitly provided.  If you process many requests per second</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- this will allow you to avoid unnecessary repeat system calls.</span><span>
</span><span id="line-580"></span><span class="hs-comment">--</span><span>
</span><span id="line-581"></span><span id="local-6989586621679406708"><span id="local-6989586621679406709"><span id="local-6989586621679406710"><span id="local-6989586621679406711"><span class="annot"><a href="Crypto.JWT.html#verifyClaimsAt"><span class="hs-identifier hs-type">verifyClaimsAt</span></a></span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-glyph">::</span><span>
</span><span id="line-583"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAllowedSkew"><span class="hs-identifier hs-type">HasAllowedSkew</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406711"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasAudiencePredicate"><span class="hs-identifier hs-type">HasAudiencePredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406711"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-584"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasIssuerPredicate"><span class="hs-identifier hs-type">HasIssuerPredicate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406711"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-585"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#HasCheckIssuedAt"><span class="hs-identifier hs-type">HasCheckIssuedAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406711"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWS.html#HasValidationSettings"><span class="hs-identifier hs-type">HasValidationSettings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406711"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-587"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Error.html#AsError"><span class="hs-identifier hs-type">AsError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406710"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JWT.html#AsJWTError"><span class="hs-identifier hs-type">AsJWTError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406710"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679406710"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406709"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-588"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWK.Store.html#VerificationKeyStore"><span class="hs-identifier hs-type">VerificationKeyStore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Crypto.JWT.html#WrappedUTCTime"><span class="hs-identifier hs-type">WrappedUTCTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406709"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Crypto.JOSE.JWS.html#JWSHeader"><span class="hs-identifier hs-type">JWSHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406708"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406711"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406708"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#SignedJWT"><span class="hs-identifier hs-type">SignedJWT</span></a></span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406709"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span></span></span></span></span><span>
</span><span id="line-595"></span><span id="verifyClaimsAt"><span class="annot"><span class="annottext">verifyClaimsAt :: forall a e (m :: * -&gt; *) k.
(HasAllowedSkew a, HasAudiencePredicate a, HasIssuerPredicate a,
 HasCheckIssuedAt a, HasValidationSettings a, AsError e,
 AsJWTError e, MonadError e m,
 VerificationKeyStore
   (ReaderT WrappedUTCTime m) (JWSHeader ()) ClaimsSet k) =&gt;
a -&gt; k -&gt; UTCTime -&gt; SignedJWT -&gt; m ClaimsSet
</span><a href="Crypto.JWT.html#verifyClaimsAt"><span class="hs-identifier hs-var hs-var">verifyClaimsAt</span></a></span></span><span> </span><span id="local-6989586621679405383"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405383"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679405382"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679405382"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679405381"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405381"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679405380"><span class="annot"><span class="annottext">SignedJWT
</span><a href="#local-6989586621679405380"><span class="hs-identifier hs-var">jwt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a e k.
(MonadTime m, HasAllowedSkew a, HasAudiencePredicate a,
 HasIssuerPredicate a, HasCheckIssuedAt a, HasValidationSettings a,
 AsError e, AsJWTError e, MonadError e m,
 VerificationKeyStore m (JWSHeader ()) ClaimsSet k) =&gt;
a -&gt; k -&gt; SignedJWT -&gt; m ClaimsSet
</span><a href="Crypto.JWT.html#verifyClaims"><span class="hs-identifier hs-var">verifyClaims</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405383"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679405382"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">SignedJWT
</span><a href="#local-6989586621679405380"><span class="hs-identifier hs-var">jwt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; WrappedUTCTime
</span><a href="Crypto.JWT.html#WrappedUTCTime"><span class="hs-identifier hs-var">WrappedUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405381"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span class="hs-comment">-- | Create a JWS JWT</span><span>
</span><span id="line-598"></span><span class="hs-comment">--</span><span>
</span><span id="line-599"></span><span id="local-6989586621679406695"><span id="local-6989586621679406697"><span class="annot"><a href="Crypto.JWT.html#signClaims"><span class="hs-identifier hs-type">signClaims</span></a></span><span>
</span><span id="line-600"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadRandom</span></span><span> </span><span class="annot"><a href="#local-6989586621679406697"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679406695"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406697"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Crypto.JOSE.Error.html#AsError"><span class="hs-identifier hs-type">AsError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406695"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWK.html#JWK"><span class="hs-identifier hs-type">JWK</span></a></span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JOSE.JWS.html#JWSHeader"><span class="hs-identifier hs-type">JWSHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Crypto.JWT.html#ClaimsSet"><span class="hs-identifier hs-type">ClaimsSet</span></a></span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406697"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Crypto.JWT.html#SignedJWT"><span class="hs-identifier hs-type">SignedJWT</span></a></span></span></span><span>
</span><span id="line-605"></span><span id="signClaims"><span class="annot"><span class="annottext">signClaims :: forall (m :: * -&gt; *) e.
(MonadRandom m, MonadError e m, AsError e) =&gt;
JWK -&gt; JWSHeader () -&gt; ClaimsSet -&gt; m SignedJWT
</span><a href="Crypto.JWT.html#signClaims"><span class="hs-identifier hs-var hs-var">signClaims</span></a></span></span><span> </span><span id="local-6989586621679405366"><span class="annot"><span class="annottext">JWK
</span><a href="#local-6989586621679405366"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679405365"><span class="annot"><span class="annottext">JWSHeader ()
</span><a href="#local-6989586621679405365"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679405364"><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405364"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s (a :: * -&gt; *) (m :: * -&gt; *) e (t :: * -&gt; *) p.
(Cons s s Word8 Word8, HasJWSHeader a, HasParams a, MonadRandom m,
 AsError e, MonadError e m, Traversable t, ProtectionIndicator p) =&gt;
s -&gt; t (a p, JWK) -&gt; m (JWS t p a)
</span><a href="Crypto.JOSE.JWS.html#signJWS"><span class="hs-identifier hs-var">signJWS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">ClaimsSet
</span><a href="#local-6989586621679405364"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JWSHeader ()
</span><a href="#local-6989586621679405365"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JWK
</span><a href="#local-6989586621679405366"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-606"></span></pre></body></html>