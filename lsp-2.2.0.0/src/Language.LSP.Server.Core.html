<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns               #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BinaryLiterals             #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia                #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts           #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances          #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies     #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE GADTs                      #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase                 #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings          #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes                 #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE RoleAnnotations            #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables        #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilyDependencies     #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeInType                 #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators              #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances       #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unticked-promoted-constructors #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# OPTIONS_GHC -fprint-explicit-kinds #-}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.LSP.Server.Core</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Colog.Core</span></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LogAction</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>                                                         </span><span class="annot"><span class="hs-identifier">Severity</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>                                                         </span><span class="annot"><span class="hs-identifier">WithSeverity</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>                                                         </span><span class="annot"><span class="hs-operator">(&lt;&amp;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>                      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_Just</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">at</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^?)</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadCatch</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadMask</span></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>                                                         </span><span class="annot"><span class="hs-identifier">MonadThrow</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Fix</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Unlift</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Class</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Identity</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Reader</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>                             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Functor.Product</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.IxMap</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>                              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span>                        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Row</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>                              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.UUID</span></span><span>                              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UUID</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Language.LSP.Diagnostics.html"><span class="hs-identifier">Language.LSP.Diagnostics</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Lens</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Message</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Message</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Types</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Types</span></span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Utils.SMethodMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SMethodMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Utils.SMethodMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SMethodMap</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Language.LSP.Protocol.Utils.Misc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">prettyJSON</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Language.LSP.VFS.html"><span class="hs-identifier">Language.LSP.VFS</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Random</span></span><span>                          </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">next</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-70"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">module</span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Eta reduce&quot;</span></span><span>         </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-71"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">module</span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Redundant do&quot;</span></span><span>       </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-72"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">module</span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Reduce duplication&quot;</span></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><span class="hs-pragma hs-type">String</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">data</span><span> </span><span id="LspCoreLog"><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-var">LspCoreLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-comment">-- TODO: arguably it would be nicer to have the config object itself in there, but</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-comment">-- then we're going to need 'Pretty config' constraints everywhere</span><span>
</span><span id="line-78"></span><span>  </span><span id="NewConfig"><span class="annot"><a href="Language.LSP.Server.Core.html#NewConfig"><span class="hs-identifier hs-var">NewConfig</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ConfigurationParseError"><span class="annot"><a href="Language.LSP.Server.Core.html#ConfigurationParseError"><span class="hs-identifier hs-var">ConfigurationParseError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ConfigurationNotSupported"><span class="annot"><a href="Language.LSP.Server.Core.html#ConfigurationNotSupported"><span class="hs-identifier hs-var">ConfigurationNotSupported</span></a></span></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BadConfigurationResponse"><span class="annot"><a href="Language.LSP.Server.Core.html#BadConfigurationResponse"><span class="hs-identifier hs-var">BadConfigurationResponse</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResponseError</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="WrongConfigSections"><span class="annot"><a href="Language.LSP.Server.Core.html#WrongConfigSections"><span class="hs-identifier hs-var">WrongConfigSections</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span class="hs-special">]</span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679214883"><span id="local-6989586621679214885"><span id="local-6989586621679214901"><span class="annot"><span class="annottext">Int -&gt; LspCoreLog -&gt; ShowS
[LspCoreLog] -&gt; ShowS
LspCoreLog -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [LspCoreLog] -&gt; ShowS
$cshowList :: [LspCoreLog] -&gt; ShowS
show :: LspCoreLog -&gt; String
$cshow :: LspCoreLog -&gt; String
showsPrec :: Int -&gt; LspCoreLog -&gt; ShowS
$cshowsPrec :: Int -&gt; LspCoreLog -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679214879"><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-type">LspCoreLog</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>  </span><span id="local-6989586621679214862"><span class="annot"><span class="annottext">pretty :: forall ann. LspCoreLog -&gt; Doc ann
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#NewConfig"><span class="hs-identifier hs-type">NewConfig</span></a></span><span> </span><span id="local-6989586621679214860"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679214860"><span class="hs-identifier hs-var">config</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: set new config:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall ann. Value -&gt; Doc ann
</span><span class="hs-identifier hs-var">prettyJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679214860"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LspCoreLog
</span><a href="Language.LSP.Server.Core.html#ConfigurationNotSupported"><span class="hs-identifier hs-var">ConfigurationNotSupported</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: not requesting configuration since the client does not support workspace/configuration&quot;</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ConfigurationParseError"><span class="hs-identifier hs-type">ConfigurationParseError</span></a></span><span> </span><span id="local-6989586621679214858"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679214858"><span class="hs-identifier hs-var">settings</span></a></span></span><span> </span><span id="local-6989586621679214857"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679214857"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><span class="annottext">forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: configuration parse error:&quot;</span></span><span>
</span><span id="line-91"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679214857"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-92"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;when parsing&quot;</span></span><span>
</span><span id="line-93"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall ann. Value -&gt; Doc ann
</span><span class="hs-identifier hs-var">prettyJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679214858"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-94"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#BadConfigurationResponse"><span class="hs-identifier hs-type">BadConfigurationResponse</span></a></span><span> </span><span id="local-6989586621679214855"><span class="annot"><span class="annottext">ResponseError
</span><a href="#local-6989586621679214855"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: error when requesting configuration: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ResponseError
</span><a href="#local-6989586621679214855"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#WrongConfigSections"><span class="hs-identifier hs-type">WrongConfigSections</span></a></span><span> </span><span id="local-6989586621679214854"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679214854"><span class="hs-identifier hs-var">sections</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;LSP: expected only one configuration section, got: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. Value -&gt; Doc ann
</span><span class="hs-identifier hs-var">prettyJSON</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">J.toJSON</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679214854"><span class="hs-identifier hs-var">sections</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">newtype</span><span> </span><span id="LspT"><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span></span><span> </span><span id="local-6989586621679215820"><span class="annot"><a href="#local-6989586621679215820"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span id="local-6989586621679215819"><span class="annot"><a href="#local-6989586621679215819"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679215818"><span class="annot"><a href="#local-6989586621679215818"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LspT"><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unLspT"><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
LspT config m a -&gt; ReaderT (LanguageContextEnv config) m a
</span><a href="Language.LSP.Server.Core.html#unLspT"><span class="hs-identifier hs-var hs-var">unLspT</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215820"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679215819"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215818"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679214843"><span id="local-6989586621679214848"><span class="annot"><span class="annottext">forall a b. a -&gt; LspT config m b -&gt; LspT config m a
forall a b. (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
forall config (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; LspT config m b -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; LspT config m b -&gt; LspT config m a
$c&lt;$ :: forall config (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; LspT config m b -&gt; LspT config m a
fmap :: forall a b. (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
$cfmap :: forall config (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214816"><span id="local-6989586621679214820"><span id="local-6989586621679214824"><span id="local-6989586621679214828"><span id="local-6989586621679214833"><span class="annot"><span class="annottext">forall a. a -&gt; LspT config m a
forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m a
forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m b
forall a b.
LspT config m (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
forall a b c.
(a -&gt; b -&gt; c)
-&gt; LspT config m a -&gt; LspT config m b -&gt; LspT config m c
forall {config} {m :: * -&gt; *}.
Applicative m =&gt;
Functor (LspT config m)
forall config (m :: * -&gt; *) a.
Applicative m =&gt;
a -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m b
forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
forall config (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; LspT config m a -&gt; LspT config m b -&gt; LspT config m c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m a
$c&lt;* :: forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m a
*&gt; :: forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m b
$c*&gt; :: forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m b
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; LspT config m a -&gt; LspT config m b -&gt; LspT config m c
$cliftA2 :: forall config (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; LspT config m a -&gt; LspT config m b -&gt; LspT config m c
&lt;*&gt; :: forall a b.
LspT config m (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
$c&lt;*&gt; :: forall config (m :: * -&gt; *) a b.
Applicative m =&gt;
LspT config m (a -&gt; b) -&gt; LspT config m a -&gt; LspT config m b
pure :: forall a. a -&gt; LspT config m a
$cpure :: forall config (m :: * -&gt; *) a.
Applicative m =&gt;
a -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214796"><span id="local-6989586621679214800"><span id="local-6989586621679214805"><span class="annot"><span class="annottext">forall a. a -&gt; LspT config m a
forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m b
forall a b.
LspT config m a -&gt; (a -&gt; LspT config m b) -&gt; LspT config m b
forall {config} {m :: * -&gt; *}.
Monad m =&gt;
Applicative (LspT config m)
forall config (m :: * -&gt; *) a. Monad m =&gt; a -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
Monad m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m b
forall config (m :: * -&gt; *) a b.
Monad m =&gt;
LspT config m a -&gt; (a -&gt; LspT config m b) -&gt; LspT config m b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; LspT config m a
$creturn :: forall config (m :: * -&gt; *) a. Monad m =&gt; a -&gt; LspT config m a
&gt;&gt; :: forall a b. LspT config m a -&gt; LspT config m b -&gt; LspT config m b
$c&gt;&gt; :: forall config (m :: * -&gt; *) a b.
Monad m =&gt;
LspT config m a -&gt; LspT config m b -&gt; LspT config m b
&gt;&gt;= :: forall a b.
LspT config m a -&gt; (a -&gt; LspT config m b) -&gt; LspT config m b
$c&gt;&gt;= :: forall config (m :: * -&gt; *) a b.
Monad m =&gt;
LspT config m a -&gt; (a -&gt; LspT config m b) -&gt; LspT config m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214782"><span class="annot"><span class="annottext">forall e a.
Exception e =&gt;
LspT config m a -&gt; (e -&gt; LspT config m a) -&gt; LspT config m a
forall {config} {m :: * -&gt; *}.
MonadCatch m =&gt;
MonadThrow (LspT config m)
forall config (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
LspT config m a -&gt; (e -&gt; LspT config m a) -&gt; LspT config m a
forall (m :: * -&gt; *).
MonadThrow m
-&gt; (forall e a. Exception e =&gt; m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
catch :: forall e a.
Exception e =&gt;
LspT config m a -&gt; (e -&gt; LspT config m a) -&gt; LspT config m a
$ccatch :: forall config (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
LspT config m a -&gt; (e -&gt; LspT config m a) -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadCatch</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214768"><span class="annot"><span class="annottext">forall a. IO a -&gt; LspT config m a
forall {config} {m :: * -&gt; *}. MonadIO m =&gt; Monad (LspT config m)
forall config (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; LspT config m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
liftIO :: forall a. IO a -&gt; LspT config m a
$cliftIO :: forall config (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214747"><span id="local-6989586621679214751"><span id="local-6989586621679214756"><span class="annot"><span class="annottext">forall b.
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
forall a b c.
LspT config m a
-&gt; (a -&gt; ExitCase b -&gt; LspT config m c)
-&gt; (a -&gt; LspT config m b)
-&gt; LspT config m (b, c)
forall {config} {m :: * -&gt; *}.
MonadMask m =&gt;
MonadCatch (LspT config m)
forall config (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
forall config (m :: * -&gt; *) a b c.
MonadMask m =&gt;
LspT config m a
-&gt; (a -&gt; ExitCase b -&gt; LspT config m c)
-&gt; (a -&gt; LspT config m b)
-&gt; LspT config m (b, c)
forall (m :: * -&gt; *).
MonadCatch m
-&gt; (forall b. ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall b. ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall a b c.
    m a -&gt; (a -&gt; ExitCase b -&gt; m c) -&gt; (a -&gt; m b) -&gt; m (b, c))
-&gt; MonadMask m
generalBracket :: forall a b c.
LspT config m a
-&gt; (a -&gt; ExitCase b -&gt; LspT config m c)
-&gt; (a -&gt; LspT config m b)
-&gt; LspT config m (b, c)
$cgeneralBracket :: forall config (m :: * -&gt; *) a b c.
MonadMask m =&gt;
LspT config m a
-&gt; (a -&gt; ExitCase b -&gt; LspT config m c)
-&gt; (a -&gt; LspT config m b)
-&gt; LspT config m (b, c)
uninterruptibleMask :: forall b.
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
$cuninterruptibleMask :: forall config (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
mask :: forall b.
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
$cmask :: forall config (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. LspT config m a -&gt; LspT config m a) -&gt; LspT config m b)
-&gt; LspT config m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMask</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214734"><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; LspT config m a
forall {config} {m :: * -&gt; *}.
MonadThrow m =&gt;
Monad (LspT config m)
forall config (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; LspT config m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall e a. Exception e =&gt; e -&gt; m a) -&gt; MonadThrow m
throwM :: forall e a. Exception e =&gt; e -&gt; LspT config m a
$cthrowM :: forall config (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214723"><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; LspT config m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; LspT config m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
(forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; t m a) -&gt; MonadTrans t
lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; LspT config m a
$clift :: forall config (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">MonadTrans</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214710"><span class="annot"><span class="annottext">forall b.
((forall a. LspT config m a -&gt; IO a) -&gt; IO b) -&gt; LspT config m b
forall {config} {m :: * -&gt; *}.
MonadUnliftIO m =&gt;
MonadIO (LspT config m)
forall config (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. LspT config m a -&gt; IO a) -&gt; IO b) -&gt; LspT config m b
forall (m :: * -&gt; *).
MonadIO m
-&gt; (forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b)
-&gt; MonadUnliftIO m
withRunInIO :: forall b.
((forall a. LspT config m a -&gt; IO a) -&gt; IO b) -&gt; LspT config m b
$cwithRunInIO :: forall config (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. LspT config m a -&gt; IO a) -&gt; IO b) -&gt; LspT config m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadUnliftIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214698"><span class="annot"><span class="annottext">forall a. (a -&gt; LspT config m a) -&gt; LspT config m a
forall {config} {m :: * -&gt; *}. MonadFix m =&gt; Monad (LspT config m)
forall config (m :: * -&gt; *) a.
MonadFix m =&gt;
(a -&gt; LspT config m a) -&gt; LspT config m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. (a -&gt; m a) -&gt; m a) -&gt; MonadFix m
mfix :: forall a. (a -&gt; LspT config m a) -&gt; LspT config m a
$cmfix :: forall config (m :: * -&gt; *) a.
MonadFix m =&gt;
(a -&gt; LspT config m a) -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFix</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679214675"><span id="local-6989586621679214682"><span id="local-6989586621679214688"><span class="annot"><span class="annottext">NonEmpty (LspT config m a) -&gt; LspT config m a
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
forall b. Integral b =&gt; b -&gt; LspT config m a -&gt; LspT config m a
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
forall config (m :: * -&gt; *) a.
(Applicative m, Semigroup a) =&gt;
NonEmpty (LspT config m a) -&gt; LspT config m a
forall config (m :: * -&gt; *) a.
(Applicative m, Semigroup a) =&gt;
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
forall config (m :: * -&gt; *) a b.
(Applicative m, Semigroup a, Integral b) =&gt;
b -&gt; LspT config m a -&gt; LspT config m a
stimes :: forall b. Integral b =&gt; b -&gt; LspT config m a -&gt; LspT config m a
$cstimes :: forall config (m :: * -&gt; *) a b.
(Applicative m, Semigroup a, Integral b) =&gt;
b -&gt; LspT config m a -&gt; LspT config m a
sconcat :: NonEmpty (LspT config m a) -&gt; LspT config m a
$csconcat :: forall config (m :: * -&gt; *) a.
(Applicative m, Semigroup a) =&gt;
NonEmpty (LspT config m a) -&gt; LspT config m a
&lt;&gt; :: LspT config m a -&gt; LspT config m a -&gt; LspT config m a
$c&lt;&gt; :: forall config (m :: * -&gt; *) a.
(Applicative m, Semigroup a) =&gt;
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Semigroup</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214650"><span id="local-6989586621679214655"><span id="local-6989586621679214661"><span class="annot"><span class="annottext">LspT config m a
[LspT config m a] -&gt; LspT config m a
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
forall a.
Semigroup a -&gt; a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
forall {config} {m :: * -&gt; *} {a}.
(Applicative m, Monoid a) =&gt;
Semigroup (LspT config m a)
forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
LspT config m a
forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
[LspT config m a] -&gt; LspT config m a
forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
mconcat :: [LspT config m a] -&gt; LspT config m a
$cmconcat :: forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
[LspT config m a] -&gt; LspT config m a
mappend :: LspT config m a -&gt; LspT config m a -&gt; LspT config m a
$cmappend :: forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
LspT config m a -&gt; LspT config m a -&gt; LspT config m a
mempty :: LspT config m a
$cmempty :: forall config (m :: * -&gt; *) a.
(Applicative m, Monoid a) =&gt;
LspT config m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monoid</span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215820"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215819"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679215818"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- for deriving the instance of MonadUnliftIO</span><span>
</span><span id="line-103"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">role</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><span class="hs-identifier">representational</span></span><span> </span><span class="annot"><span class="hs-identifier">representational</span></span><span> </span><span class="annot"><span class="hs-identifier">nominal</span></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span id="local-6989586621679215666"><span id="local-6989586621679215667"><span id="local-6989586621679215668"><span class="annot"><a href="Language.LSP.Server.Core.html#runLspT"><span class="hs-identifier hs-type">runLspT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215668"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215668"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215667"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215666"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215667"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215666"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-106"></span><span id="runLspT"><span class="annot"><span class="annottext">runLspT :: forall config (m :: * -&gt; *) a.
LanguageContextEnv config -&gt; LspT config m a -&gt; m a
</span><a href="Language.LSP.Server.Core.html#runLspT"><span class="hs-identifier hs-var hs-var">runLspT</span></a></span></span><span> </span><span id="local-6989586621679214642"><span class="annot"><span class="annottext">LanguageContextEnv config
</span><a href="#local-6989586621679214642"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv config
</span><a href="#local-6989586621679214642"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
LspT config m a -&gt; ReaderT (LanguageContextEnv config) m a
</span><a href="Language.LSP.Server.Core.html#unLspT"><span class="hs-identifier hs-var">unLspT</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#runLspT"><span class="hs-pragma hs-type">runLspT</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">type</span><span> </span><span id="LspM"><span class="annot"><a href="Language.LSP.Server.Core.html#LspM"><span class="hs-identifier hs-var">LspM</span></a></span></span><span> </span><span id="local-6989586621679214638"><span class="annot"><a href="#local-6989586621679214638"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214638"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679215652"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadLsp"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-var">MonadLsp</span></a></span></span><span> </span><span id="local-6989586621679215653"><span class="annot"><a href="#local-6989586621679215653"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span id="local-6989586621679215652"><span class="annot"><a href="#local-6989586621679215652"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679215652"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215653"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>  </span><span id="getLspEnv"><span class="annot"><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-type">getLspEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679215652"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215653"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679215647"><span id="local-6989586621679215648"><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679215648"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215647"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215647"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215648"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">instance</span><span> </span><span id="local-6989586621679214627"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-pragma hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214627"><span class="hs-pragma hs-type">config</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-pragma hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214627"><span class="hs-pragma hs-type">config</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span class="hs-pragma">)</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-pragma hs-type">getLspEnv</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-118"></span><span>  </span><span id="local-6989586621679214625"><span class="annot"><span class="annottext">getLspEnv :: LspT config m (LanguageContextEnv config)
</span><a href="#local-6989586621679214625"><span class="hs-identifier hs-var hs-var hs-var hs-var">getLspEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679215639"><span id="local-6989586621679215640"><span id="local-6989586621679215641"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215641"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215640"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215641"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679215639"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215640"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">instance</span><span> </span><span id="local-6989586621679214614"><span id="local-6989586621679214615"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-pragma hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214615"><span class="hs-pragma hs-type">config</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679214614"><span class="hs-pragma hs-type">r</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-pragma hs-type">LspT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214615"><span class="hs-pragma hs-type">config</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">IO</span></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span></span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-pragma hs-type">getLspEnv</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-123"></span><span>  </span><span id="local-6989586621679214610"><span class="annot"><span class="annottext">getLspEnv :: ReaderT r m (LanguageContextEnv c)
</span><a href="#local-6989586621679214610"><span class="hs-identifier hs-var hs-var hs-var hs-var">getLspEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679215633"><span id="local-6989586621679215634"><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215634"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215633"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215634"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IdentityT</span></span><span> </span><span class="annot"><a href="#local-6989586621679215633"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621679214595"><span class="annot"><span class="annottext">getLspEnv :: IdentityT @(*) m (LanguageContextEnv c)
</span><a href="#local-6989586621679214595"><span class="hs-identifier hs-var hs-var hs-var hs-var">getLspEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">data</span><span> </span><span id="LanguageContextEnv"><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-var">LanguageContextEnv</span></a></span></span><span> </span><span id="local-6989586621679215632"><span class="annot"><a href="#local-6989586621679215632"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>  </span><span id="LanguageContextEnv"><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-var">LanguageContextEnv</span></a></span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="resHandlers"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Handlers IO
</span><a href="Language.LSP.Server.Core.html#resHandlers"><span class="hs-identifier hs-var hs-var">resHandlers</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resConfigSection"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Text
</span><a href="Language.LSP.Server.Core.html#resConfigSection"><span class="hs-identifier hs-var hs-var">resConfigSection</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resParseConfig"><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; config -&gt; Value -&gt; Either Text config
</span><a href="Language.LSP.Server.Core.html#resParseConfig"><span class="hs-identifier hs-var hs-var">resParseConfig</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679215632"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679215632"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resOnConfigChange"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; config -&gt; IO ()
</span><a href="Language.LSP.Server.Core.html#resOnConfigChange"><span class="hs-identifier hs-var hs-var">resOnConfigChange</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679215632"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resSendMessage"><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; FromServerMessage -&gt; IO ()
</span><a href="Language.LSP.Server.Core.html#resSendMessage"><span class="hs-identifier hs-var hs-var">resSendMessage</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FromServerMessage</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-comment">-- We keep the state in a TVar to be thread safe</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resState"><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var hs-var">resState</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-type">LanguageContextState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215632"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resClientCapabilities"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#resClientCapabilities"><span class="hs-identifier hs-var hs-var">resClientCapabilities</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">L.ClientCapabilities</span></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resRootPath"><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#resRootPath"><span class="hs-identifier hs-var hs-var">resRootPath</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- Handlers</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- | A mapping from methods to the static 'Handler's that should be used to</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- handle responses when they come in from the client. To build up a 'Handlers',</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- you should 'mconcat' a list of 'notificationHandler' and 'requestHandler's:</span><span>
</span><span id="line-148"></span><span class="hs-comment">--</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- mconcat [</span><span>
</span><span id="line-151"></span><span class="hs-comment">--   notificationHandler SInitialized $ \notif -&gt; pure ()</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- , requestHandler STextDocumentHover $ \req responder -&gt; pure ()</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- ]</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-155"></span><span class="hs-keyword">data</span><span> </span><span id="Handlers"><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span></span><span> </span><span id="local-6989586621679215621"><span class="annot"><a href="#local-6989586621679215621"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Handlers"><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="reqHandlers"><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Handlers m
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler m 'Request)
</span><a href="Language.LSP.Server.Core.html#reqHandlers"><span class="hs-identifier hs-var hs-var">reqHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SMethodMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215621"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="notHandlers"><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Handlers m
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
</span><a href="Language.LSP.Server.Core.html#notHandlers"><span class="hs-identifier hs-var hs-var">notHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SMethodMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215621"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-160"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679214577"><span id="local-6989586621679214579"><span id="local-6989586621679215613"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215613"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span id="local-6989586621679214573"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
</span><a href="#local-6989586621679214573"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621679214572"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
</span><a href="#local-6989586621679214572"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621679214571"><span class="annot"><span class="annottext">&lt;&gt; :: Handlers config -&gt; Handlers config -&gt; Handlers config
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span id="local-6989586621679214570"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
</span><a href="#local-6989586621679214570"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span id="local-6989586621679214569"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
</span><a href="#local-6989586621679214569"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
</span><a href="#local-6989586621679214573"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler config 'Request)
</span><a href="#local-6989586621679214570"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
</span><a href="#local-6989586621679214572"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler config 'Notification)
</span><a href="#local-6989586621679214569"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679214562"><span id="local-6989586621679214564"><span id="local-6989586621679215606"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215606"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621679214558"><span class="annot"><span class="annottext">mempty :: Handlers config
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="Language.LSP.Server.Core.html#notificationHandler"><span class="hs-identifier hs-type">notificationHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215602"><span class="annot"><a href="#local-6989586621679215602"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215600"><span class="annot"><a href="#local-6989586621679215600"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679215602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215600"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215600"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-166"></span><span id="notificationHandler"><span class="annot"><span class="annottext">notificationHandler :: forall (m :: Method 'ClientToServer 'Notification) (f :: * -&gt; *).
SMethod @'ClientToServer @'Notification m
-&gt; Handler @'ClientToServer @'Notification f m -&gt; Handlers f
</span><a href="Language.LSP.Server.Core.html#notificationHandler"><span class="hs-identifier hs-var hs-var">notificationHandler</span></a></span></span><span> </span><span id="local-6989586621679214555"><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Notification m
</span><a href="#local-6989586621679214555"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679214554"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification f m
</span><a href="#local-6989586621679214554"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {f :: MessageDirection} {t :: MessageKind} (a :: Method f t)
       (v :: Method f t -&gt; *).
SMethod @f @t a -&gt; v a -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Notification m
</span><a href="#local-6989586621679214555"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification f m
</span><a href="#local-6989586621679214554"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><a href="Language.LSP.Server.Core.html#requestHandler"><span class="hs-identifier hs-type">requestHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215589"><span class="annot"><a href="#local-6989586621679215589"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215588"><span class="annot"><a href="#local-6989586621679215588"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679215589"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215588"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215589"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215588"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-169"></span><span id="requestHandler"><span class="annot"><span class="annottext">requestHandler :: forall (m :: Method 'ClientToServer 'Request) (f :: * -&gt; *).
SMethod @'ClientToServer @'Request m
-&gt; Handler @'ClientToServer @'Request f m -&gt; Handlers f
</span><a href="Language.LSP.Server.Core.html#requestHandler"><span class="hs-identifier hs-var hs-var">requestHandler</span></a></span></span><span> </span><span id="local-6989586621679214549"><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Request m
</span><a href="#local-6989586621679214549"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679214548"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request f m
</span><a href="#local-6989586621679214548"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {f :: MessageDirection} {t :: MessageKind} (a :: Method f t)
       (v :: Method f t -&gt; *).
SMethod @f @t a -&gt; v a -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @'Request m
</span><a href="#local-6989586621679214549"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request f m
</span><a href="#local-6989586621679214548"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- | Wrapper to restrict 'Handler's to  ClientToServer' 'Method's</span><span>
</span><span id="line-172"></span><span class="hs-keyword">newtype</span><span> </span><span id="ClientMessageHandler"><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span></span><span> </span><span id="local-6989586621679215591"><span class="annot"><a href="#local-6989586621679215591"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215592"><span class="annot"><a href="#local-6989586621679215592"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MessageKind</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215590"><span class="annot"><a href="#local-6989586621679215590"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679215592"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ClientMessageHandler"><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215591"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215590"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | The type of a handler that handles requests and notifications coming in</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- from the server or client</span><span>
</span><span id="line-176"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Handler"><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679214547"><span class="annot"><a href="#local-6989586621679214547"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span id="local-6989586621679214546"><span> </span><span class="hs-special">(</span><span class="hs-identifier">m</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679214546"><span class="hs-identifier hs-type">from</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214545"><span class="hs-identifier hs-type">t</span></a></span></span><span id="local-6989586621679214546"></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679214544"><span class="annot"><a href="#local-6989586621679214544"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679214544"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214547"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214545"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214543"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-177"></span><span>  </span><span id="Handler"><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span id="local-6989586621679214540"><span id="local-6989586621679214541"><span id="local-6989586621679214542"><span class="annot"><a href="#local-6989586621679214542"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679214541"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679214540"><span class="hs-identifier hs-type">_from</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span></span></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TRequestMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621679214541"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResponseError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MessageResult</span></span><span> </span><span class="annot"><a href="#local-6989586621679214541"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214542"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214542"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>  </span><span id="Handler"><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span id="local-6989586621679214537"><span id="local-6989586621679214538"><span id="local-6989586621679214539"><span class="annot"><a href="#local-6989586621679214539"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679214538"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679214537"><span class="hs-identifier hs-type">_from</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TNotificationMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621679214538"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214539"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-comment">-- | How to convert two isomorphic data structures between each other.</span><span>
</span><span id="line-181"></span><span class="hs-keyword">data</span><span> </span><span id="local-6989586621679215584"><span class="annot"><a href="#local-6989586621679215584"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="%3C~%3E"><span class="annot"><a href="Language.LSP.Server.Core.html#%3C~%3E"><span class="hs-operator hs-var">&lt;~&gt;</span></a></span></span><span> </span><span id="local-6989586621679215583"><span class="annot"><a href="#local-6989586621679215583"><span class="hs-identifier hs-type">n</span></a></span></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Iso"><span class="annot"><a href="Language.LSP.Server.Core.html#Iso"><span class="hs-identifier hs-var">Iso</span></a></span></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="forward"><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). m a -&gt; n a
</span><a href="Language.LSP.Server.Core.html#forward"><span class="hs-identifier hs-var hs-var">forward</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679215581"><span class="annot"><a href="#local-6989586621679215581"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679215584"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215581"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215583"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215581"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="backward"><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). n a -&gt; m a
</span><a href="Language.LSP.Server.Core.html#backward"><span class="hs-identifier hs-var hs-var">backward</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679215577"><span class="annot"><a href="#local-6989586621679215577"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679215583"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215577"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215584"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215577"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span id="local-6989586621679215572"><span id="local-6989586621679215573"><span class="annot"><a href="Language.LSP.Server.Core.html#transmuteHandlers"><span class="hs-identifier hs-type">transmuteHandlers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679215573"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#%3C~%3E"><span class="hs-operator hs-type">&lt;~&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215572"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215573"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215572"><span class="hs-identifier hs-type">n</span></a></span></span></span><span>
</span><span id="line-188"></span><span id="transmuteHandlers"><span class="annot"><span class="annottext">transmuteHandlers :: forall (m :: * -&gt; *) (n :: * -&gt; *).
(&lt;~&gt;) @(*) m n -&gt; Handlers m -&gt; Handlers n
</span><a href="Language.LSP.Server.Core.html#transmuteHandlers"><span class="hs-identifier hs-var hs-var">transmuteHandlers</span></a></span></span><span> </span><span id="local-6989586621679214530"><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n
</span><a href="#local-6989586621679214530"><span class="hs-identifier hs-var">nat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (n :: * -&gt; *).
(forall (a :: Method 'ClientToServer 'Request).
 Handler @'ClientToServer @'Request m a
 -&gt; Handler @'ClientToServer @'Request n a)
-&gt; (forall (a :: Method 'ClientToServer 'Notification).
    Handler @'ClientToServer @'Notification m a
    -&gt; Handler @'ClientToServer @'Notification n a)
-&gt; Handlers m
-&gt; Handlers n
</span><a href="Language.LSP.Server.Core.html#mapHandlers"><span class="hs-identifier hs-var">mapHandlers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679214528"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request m a
</span><a href="#local-6989586621679214528"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679214527"><span class="annot"><span class="annottext">TRequestMessage @'ClientToServer a
</span><a href="#local-6989586621679214527"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679214526"><span class="annot"><span class="annottext">Either ResponseError (MessageResult @'ClientToServer @'Request a)
-&gt; n ()
</span><a href="#local-6989586621679214526"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). m a -&gt; n a
</span><a href="Language.LSP.Server.Core.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n
</span><a href="#local-6989586621679214530"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request m a
</span><a href="#local-6989586621679214528"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">TRequestMessage @'ClientToServer a
</span><a href="#local-6989586621679214527"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). n a -&gt; m a
</span><a href="Language.LSP.Server.Core.html#backward"><span class="hs-identifier hs-var">backward</span></a></span><span> </span><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n
</span><a href="#local-6989586621679214530"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either ResponseError (MessageResult @'ClientToServer @'Request a)
-&gt; n ()
</span><a href="#local-6989586621679214526"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679214525"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification m a
</span><a href="#local-6989586621679214525"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679214524"><span class="annot"><span class="annottext">TNotificationMessage @'ClientToServer a
</span><a href="#local-6989586621679214524"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) (n :: k -&gt; *).
(&lt;~&gt;) @k m n -&gt; forall (a :: k). m a -&gt; n a
</span><a href="Language.LSP.Server.Core.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">(&lt;~&gt;) @(*) m n
</span><a href="#local-6989586621679214530"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification m a
</span><a href="#local-6989586621679214525"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage @'ClientToServer a
</span><a href="#local-6989586621679214524"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span id="local-6989586621679215567"><span id="local-6989586621679215569"><span class="annot"><a href="Language.LSP.Server.Core.html#mapHandlers"><span class="hs-identifier hs-type">mapHandlers</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215568"><span class="annot"><a href="#local-6989586621679215568"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215569"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215568"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215567"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215568"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215566"><span class="annot"><a href="#local-6989586621679215566"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215569"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215566"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215567"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215566"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215569"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215567"><span class="hs-identifier hs-type">n</span></a></span></span></span><span>
</span><span id="line-194"></span><span id="mapHandlers"><span class="annot"><span class="annottext">mapHandlers :: forall (m :: * -&gt; *) (n :: * -&gt; *).
(forall (a :: Method 'ClientToServer 'Request).
 Handler @'ClientToServer @'Request m a
 -&gt; Handler @'ClientToServer @'Request n a)
-&gt; (forall (a :: Method 'ClientToServer 'Notification).
    Handler @'ClientToServer @'Notification m a
    -&gt; Handler @'ClientToServer @'Notification n a)
-&gt; Handlers m
-&gt; Handlers n
</span><a href="Language.LSP.Server.Core.html#mapHandlers"><span class="hs-identifier hs-var hs-var">mapHandlers</span></a></span></span><span> </span><span id="local-6989586621679214523"><span class="annot"><span class="annottext">forall (a :: Method 'ClientToServer 'Request).
Handler @'ClientToServer @'Request m a
-&gt; Handler @'ClientToServer @'Request n a
</span><a href="#local-6989586621679214523"><span class="hs-identifier hs-var">mapReq</span></a></span></span><span> </span><span id="local-6989586621679214522"><span class="annot"><span class="annottext">forall (a :: Method 'ClientToServer 'Notification).
Handler @'ClientToServer @'Notification m a
-&gt; Handler @'ClientToServer @'Notification n a
</span><a href="#local-6989586621679214522"><span class="hs-identifier hs-var">mapNot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span id="local-6989586621679214521"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
</span><a href="#local-6989586621679214521"><span class="hs-identifier hs-var">reqs</span></a></span></span><span> </span><span id="local-6989586621679214520"><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler m 'Notification)
</span><a href="#local-6989586621679214520"><span class="hs-identifier hs-var">nots</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
-&gt; Handlers m
</span><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-var">Handlers</span></a></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler n 'Request)
</span><a href="#local-6989586621679214519"><span class="hs-identifier hs-var">reqs'</span></a></span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler n 'Notification)
</span><a href="#local-6989586621679214518"><span class="hs-identifier hs-var">nots'</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679214519"><span class="annot"><span class="annottext">reqs' :: SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler n 'Request)
</span><a href="#local-6989586621679214519"><span class="hs-identifier hs-var hs-var">reqs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {f :: MessageDirection} {t :: MessageKind}
       (u :: Method f t -&gt; *) (v :: Method f t -&gt; *).
(forall (a :: Method f t). u a -&gt; v a)
-&gt; SMethodMap @f @t u -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span id="local-6989586621679214516"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request m a
</span><a href="#local-6989586621679214516"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (a :: Method 'ClientToServer 'Request).
Handler @'ClientToServer @'Request m a
-&gt; Handler @'ClientToServer @'Request n a
</span><a href="#local-6989586621679214523"><span class="hs-identifier hs-var">mapReq</span></a></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Request m a
</span><a href="#local-6989586621679214516"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer @'Request (ClientMessageHandler m 'Request)
</span><a href="#local-6989586621679214521"><span class="hs-identifier hs-var">reqs</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621679214518"><span class="annot"><span class="annottext">nots' :: SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler n 'Notification)
</span><a href="#local-6989586621679214518"><span class="hs-identifier hs-var hs-var">nots'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {f :: MessageDirection} {t :: MessageKind}
       (u :: Method f t -&gt; *) (v :: Method f t -&gt; *).
(forall (a :: Method f t). u a -&gt; v a)
-&gt; SMethodMap @f @t u -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span id="local-6989586621679214515"><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification m a
</span><a href="#local-6989586621679214515"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (a :: Method 'ClientToServer 'Notification).
Handler @'ClientToServer @'Notification m a
-&gt; Handler @'ClientToServer @'Notification n a
</span><a href="#local-6989586621679214522"><span class="hs-identifier hs-var">mapNot</span></a></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @'Notification m a
</span><a href="#local-6989586621679214515"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SMethodMap
  @'ClientToServer
  @'Notification
  (ClientMessageHandler m 'Notification)
</span><a href="#local-6989586621679214520"><span class="hs-identifier hs-var">nots</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- | state used by the LSP dispatcher to manage the message loop</span><span>
</span><span id="line-200"></span><span class="hs-keyword">data</span><span> </span><span id="LanguageContextState"><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-var">LanguageContextState</span></a></span></span><span> </span><span id="local-6989586621679215551"><span class="annot"><a href="#local-6989586621679215551"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>  </span><span id="LanguageContextState"><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-var">LanguageContextState</span></a></span></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="resVFS"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var hs-var">resVFS</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#VFSData"><span class="hs-identifier hs-type">VFSData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resDiagnostics"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar DiagnosticStore
</span><a href="Language.LSP.Server.Core.html#resDiagnostics"><span class="hs-identifier hs-var hs-var">resDiagnostics</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Language.LSP.Diagnostics.html#DiagnosticStore"><span class="hs-identifier hs-type">DiagnosticStore</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resConfig"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar config
</span><a href="Language.LSP.Server.Core.html#resConfig"><span class="hs-identifier hs-var hs-var">resConfig</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679215551"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resWorkspaceFolders"><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar [WorkspaceFolder]
</span><a href="Language.LSP.Server.Core.html#resWorkspaceFolders"><span class="hs-identifier hs-var hs-var">resWorkspaceFolders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">WorkspaceFolder</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resProgressData"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; ProgressData
</span><a href="Language.LSP.Server.Core.html#resProgressData"><span class="hs-identifier hs-var hs-var">resProgressData</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressData"><span class="hs-identifier hs-type">ProgressData</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resPendingResponses"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar ResponseMap
</span><a href="Language.LSP.Server.Core.html#resPendingResponses"><span class="hs-identifier hs-var hs-var">resPendingResponses</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ResponseMap"><span class="hs-identifier hs-type">ResponseMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resRegistrationsNot"><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Notification)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsNot"><span class="hs-identifier hs-var hs-var">resRegistrationsNot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationMap"><span class="hs-identifier hs-type">RegistrationMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resRegistrationsReq"><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Request)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsReq"><span class="hs-identifier hs-var hs-var">resRegistrationsReq</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationMap"><span class="hs-identifier hs-type">RegistrationMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resLspId"><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar Int32
</span><a href="Language.LSP.Server.Core.html#resLspId"><span class="hs-identifier hs-var hs-var">resLspId</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-keyword">type</span><span> </span><span id="ResponseMap"><span class="annot"><a href="Language.LSP.Server.Core.html#ResponseMap"><span class="hs-identifier hs-var">ResponseMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IxMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LspId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-type">ServerResponseCallback</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-keyword">type</span><span> </span><span id="RegistrationMap"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationMap"><span class="hs-identifier hs-var">RegistrationMap</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679214504"><span class="annot"><a href="#local-6989586621679214504"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MessageKind</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethodMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-type">RegistrationId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-type">ClientMessageHandler</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679214504"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-keyword">data</span><span> </span><span id="RegistrationToken"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-var">RegistrationToken</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215263"><span id="local-6989586621679215262"><span class="annot"><a href="#local-6989586621679215262"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679215263"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RegistrationToken"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-var">RegistrationToken</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679215262"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-type">RegistrationId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215262"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span class="hs-keyword">newtype</span><span> </span><span id="RegistrationId"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-var">RegistrationId</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215530"><span id="local-6989586621679215529"><span class="annot"><a href="#local-6989586621679215529"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679215530"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RegistrationId"><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-var">RegistrationId</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679214495"><span id="local-6989586621679214500"><span class="annot"><span class="annottext">RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall (t :: MessageKind) (m :: Method 'ClientToServer t).
RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
/= :: RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
$c/= :: forall (t :: MessageKind) (m :: Method 'ClientToServer t).
RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
== :: RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
$c== :: forall (t :: MessageKind) (m :: Method 'ClientToServer t).
RegistrationId @t m -&gt; RegistrationId @t m -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-keyword">data</span><span> </span><span id="ProgressData"><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressData"><span class="hs-identifier hs-var">ProgressData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ProgressData"><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressData"><span class="hs-identifier hs-var">ProgressData</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="progressNextId"><span class="annot"><span class="annottext">ProgressData -&gt; TVar Int32
</span><a href="Language.LSP.Server.Core.html#progressNextId"><span class="hs-identifier hs-var hs-var">progressNextId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span id="progressCancel"><span class="annot"><span class="annottext">ProgressData -&gt; TVar (Map ProgressToken (IO ()))
</span><a href="Language.LSP.Server.Core.html#progressCancel"><span class="hs-identifier hs-var hs-var">progressCancel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProgressToken</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-keyword">data</span><span> </span><span id="VFSData"><span class="annot"><a href="Language.LSP.Server.Core.html#VFSData"><span class="hs-identifier hs-var">VFSData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>  </span><span id="VFSData"><span class="annot"><a href="Language.LSP.Server.Core.html#VFSData"><span class="hs-identifier hs-var">VFSData</span></a></span></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="vfsData"><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var hs-var">vfsData</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Language.LSP.VFS.html#VFS"><span class="hs-identifier hs-type">VFS</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="reverseMap"><span class="annot"><span class="annottext">VFSData -&gt; Map String String
</span><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var hs-var">reverseMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-pragma hs-type">modifyState</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-231"></span><span id="local-6989586621679215524"><span id="local-6989586621679215525"><span id="local-6989586621679215526"><span class="annot"><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-type">modifyState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215526"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215525"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-type">LanguageContextState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215526"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679215524"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679215524"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215524"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215525"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-232"></span><span id="modifyState"><span class="annot"><span class="annottext">modifyState :: forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var hs-var">modifyState</span></a></span></span><span> </span><span id="local-6989586621679214473"><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679214473"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span id="local-6989586621679214472"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679214472"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621679214471"><span class="annot"><span class="annottext">TVar a
</span><a href="#local-6989586621679214471"><span class="hs-identifier hs-var">tvarDat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679214473"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var">resState</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar a
</span><a href="#local-6989586621679214471"><span class="hs-identifier hs-var">tvarDat</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679214472"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-pragma hs-type">stateState</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-237"></span><span id="local-6989586621679215511"><span id="local-6989586621679215512"><span id="local-6989586621679215513"><span id="local-6989586621679215514"><span class="annot"><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-type">stateState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215514"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215513"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-type">LanguageContextState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215514"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679215512"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679215512"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679215511"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679215512"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215513"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215511"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-238"></span><span id="stateState"><span class="annot"><span class="annottext">stateState :: forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var hs-var">stateState</span></a></span></span><span> </span><span id="local-6989586621679214455"><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar s
</span><a href="#local-6989586621679214455"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span id="local-6989586621679214454"><span class="annot"><span class="annottext">s -&gt; (a, s)
</span><a href="#local-6989586621679214454"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621679214453"><span class="annot"><span class="annottext">TVar s
</span><a href="#local-6989586621679214453"><span class="hs-identifier hs-var">tvarDat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar s
</span><a href="#local-6989586621679214455"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var">resState</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. TVar s -&gt; (s -&gt; (a, s)) -&gt; STM a
</span><span class="hs-identifier hs-var">stateTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar s
</span><a href="#local-6989586621679214453"><span class="hs-identifier hs-var">tvarDat</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; (a, s)
</span><a href="#local-6989586621679214454"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-pragma hs-type">getsState</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-243"></span><span id="local-6989586621679215502"><span id="local-6989586621679215503"><span id="local-6989586621679215504"><span class="annot"><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-type">getsState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215504"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215503"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextState"><span class="hs-identifier hs-type">LanguageContextState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215504"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679215502"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215503"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215502"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-244"></span><span id="getsState"><span class="annot"><span class="annottext">getsState :: forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var hs-var">getsState</span></a></span></span><span> </span><span id="local-6989586621679214440"><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679214440"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621679214439"><span class="annot"><span class="annottext">TVar a
</span><a href="#local-6989586621679214439"><span class="hs-identifier hs-var">tvarDat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LanguageContextState config -&gt; TVar a
</span><a href="#local-6989586621679214440"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var">resState</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-246"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar a
</span><a href="#local-6989586621679214439"><span class="hs-identifier hs-var">tvarDat</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="hs-comment">-- | Language Server Protocol options that the server may configure.</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- If you set handlers for some requests, you may need to set some of these options.</span><span>
</span><span id="line-252"></span><span class="hs-keyword">data</span><span> </span><span id="Options"><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-var">Options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>  </span><span id="Options"><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-var">Options</span></a></span></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="optTextDocumentSync"><span class="annot"><span class="annottext">Options -&gt; Maybe TextDocumentSyncOptions
</span><a href="Language.LSP.Server.Core.html#optTextDocumentSync"><span class="hs-identifier hs-var hs-var">optTextDocumentSync</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.TextDocumentSyncOptions</span></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">-- |  The characters that trigger completion automatically.</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="optCompletionTriggerCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#optCompletionTriggerCharacters"><span class="hs-identifier hs-var hs-var">optCompletionTriggerCharacters</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">-- | The list of all possible characters that commit a completion. This field can be used</span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-comment">-- if clients don't support individual commit characters per completion item. See</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-comment">-- `_commitCharactersSupport`.</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="optCompletionAllCommitCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#optCompletionAllCommitCharacters"><span class="hs-identifier hs-var hs-var">optCompletionAllCommitCharacters</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-comment">-- | The characters that trigger signature help automatically.</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="optSignatureHelpTriggerCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#optSignatureHelpTriggerCharacters"><span class="hs-identifier hs-var hs-var">optSignatureHelpTriggerCharacters</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-comment">-- | List of characters that re-trigger signature help.</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-comment">-- These trigger characters are only active when signature help is already showing. All trigger characters</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-comment">-- are also counted as re-trigger characters.</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="optSignatureHelpRetriggerCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#optSignatureHelpRetriggerCharacters"><span class="hs-identifier hs-var hs-var">optSignatureHelpRetriggerCharacters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-comment">-- | CodeActionKinds that this server may return.</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">-- The list of kinds may be generic, such as `CodeActionKind.Refactor`, or the server</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-comment">-- may list out every specific kind they provide.</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="optCodeActionKinds"><span class="annot"><span class="annottext">Options -&gt; Maybe [CodeActionKind]
</span><a href="Language.LSP.Server.Core.html#optCodeActionKinds"><span class="hs-identifier hs-var hs-var">optCodeActionKinds</span></a></span></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">CodeActionKind</span></span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-comment">-- | The list of characters that triggers on type formatting.</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-comment">-- If you set `documentOnTypeFormattingHandler`, you **must** set this.</span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-comment">-- The first character is mandatory, so a 'NonEmpty' should be passed.</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="optDocumentOnTypeFormattingTriggerCharacters"><span class="annot"><span class="annottext">Options -&gt; Maybe (NonEmpty Char)
</span><a href="Language.LSP.Server.Core.html#optDocumentOnTypeFormattingTriggerCharacters"><span class="hs-identifier hs-var hs-var">optDocumentOnTypeFormattingTriggerCharacters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-comment">-- | The commands to be executed on the server.</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-comment">-- If you set `executeCommandHandler`, you **must** set this.</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="optExecuteCommandCommands"><span class="annot"><span class="annottext">Options -&gt; Maybe [Text]
</span><a href="Language.LSP.Server.Core.html#optExecuteCommandCommands"><span class="hs-identifier hs-var hs-var">optExecuteCommandCommands</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-comment">-- | Information about the server that can be advertised to the client.</span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="optServerInfo"><span class="annot"><span class="annottext">Options
-&gt; Maybe
     (Rec
        ((.+)
           @(*) ((.==) @(*) &quot;name&quot; Text) ((.==) @(*) &quot;version&quot; (Maybe Text))))
</span><a href="Language.LSP.Server.Core.html#optServerInfo"><span class="hs-identifier hs-var hs-var">optServerInfo</span></a></span></span><span>                       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;name&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.==</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.+</span></span><span> </span><span class="annot"><span class="hs-string">&quot;version&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.==</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-type">Options</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621679214425"><span class="annot"><span class="annottext">def :: Options
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TextDocumentSyncOptions
-&gt; Maybe String
-&gt; Maybe String
-&gt; Maybe String
-&gt; Maybe String
-&gt; Maybe [CodeActionKind]
-&gt; Maybe (NonEmpty Char)
-&gt; Maybe [Text]
-&gt; Maybe
     (Rec
        ((.+)
           @(*) ((.==) @(*) &quot;name&quot; Text) ((.==) @(*) &quot;version&quot; (Maybe Text))))
-&gt; Options
</span><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-var">Options</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-284"></span><span>                </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="annot"><a href="Language.LSP.Server.Core.html#defaultOptions"><span class="hs-identifier hs-type">defaultOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-type">Options</span></a></span><span>
</span><span id="line-287"></span><span id="defaultOptions"><span class="annot"><span class="annottext">defaultOptions :: Options
</span><a href="Language.LSP.Server.Core.html#defaultOptions"><span class="hs-identifier hs-var hs-var">defaultOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-comment">-- | A package indicating the percentage of progress complete and a</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- an optional message to go with it during a 'withProgress'</span><span>
</span><span id="line-291"></span><span class="hs-comment">--</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- @since 0.10.0.0</span><span>
</span><span id="line-293"></span><span class="hs-keyword">data</span><span> </span><span id="ProgressAmount"><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressAmount"><span class="hs-identifier hs-var">ProgressAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ProgressAmount"><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressAmount"><span class="hs-identifier hs-var">ProgressAmount</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UInt</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | Thrown if the user cancels a 'Cancellable' 'withProgress'/'withIndefiniteProgress'/ session</span><span>
</span><span id="line-296"></span><span class="hs-comment">--</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- @since 0.11.0.0</span><span>
</span><span id="line-298"></span><span class="hs-keyword">data</span><span> </span><span id="ProgressCancelledException"><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressCancelledException"><span class="hs-identifier hs-var">ProgressCancelledException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ProgressCancelledException"><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressCancelledException"><span class="hs-identifier hs-var">ProgressCancelledException</span></a></span></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679214415"><span id="local-6989586621679214417"><span id="local-6989586621679214419"><span class="annot"><span class="annottext">Int -&gt; ProgressCancelledException -&gt; ShowS
[ProgressCancelledException] -&gt; ShowS
ProgressCancelledException -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ProgressCancelledException] -&gt; ShowS
$cshowList :: [ProgressCancelledException] -&gt; ShowS
show :: ProgressCancelledException -&gt; String
$cshow :: ProgressCancelledException -&gt; String
showsPrec :: Int -&gt; ProgressCancelledException -&gt; ShowS
$cshowsPrec :: Int -&gt; ProgressCancelledException -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-300"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679214405"><span id="local-6989586621679214407"><span id="local-6989586621679214409"><span class="annot"><span class="hs-identifier hs-type">E.Exception</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressCancelledException"><span class="hs-identifier hs-type">ProgressCancelledException</span></a></span></span></span></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">-- | Whether or not the user should be able to cancel a 'withProgress'/'withIndefiniteProgress'</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- session</span><span>
</span><span id="line-304"></span><span class="hs-comment">--</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- @since 0.11.0.0</span><span>
</span><span id="line-306"></span><span class="hs-keyword">data</span><span> </span><span id="ProgressCancellable"><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressCancellable"><span class="hs-identifier hs-var">ProgressCancellable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Cancellable"><span class="annot"><a href="Language.LSP.Server.Core.html#Cancellable"><span class="hs-identifier hs-var">Cancellable</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="NotCancellable"><span class="annot"><a href="Language.LSP.Server.Core.html#NotCancellable"><span class="hs-identifier hs-var">NotCancellable</span></a></span></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="hs-comment">-- See Note [LSP configuration] for discussion of the configuration-related fields</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- | Contains all the callbacks to use for initialized the language server.</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- it is parameterized over a config type variable representing the type for the</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- specific configuration data the language server needs to use.</span><span>
</span><span id="line-312"></span><span class="hs-keyword">data</span><span> </span><span id="ServerDefinition"><span class="annot"><a href="Language.LSP.Server.Core.html#ServerDefinition"><span class="hs-identifier hs-var">ServerDefinition</span></a></span></span><span> </span><span id="local-6989586621679215488"><span class="annot"><a href="#local-6989586621679215488"><span class="hs-identifier hs-type">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679214401"><span class="annot"><a href="#local-6989586621679214401"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679214400"><span class="annot"><a href="#local-6989586621679214400"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-313"></span><span>  </span><span id="ServerDefinition"><span class="annot"><a href="Language.LSP.Server.Core.html#ServerDefinition"><span class="hs-identifier hs-var">ServerDefinition</span></a></span></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="defaultConfig"><span class="annot"><span class="annottext">forall config. ServerDefinition config -&gt; config
</span><a href="Language.LSP.Server.Core.html#defaultConfig"><span class="hs-identifier hs-var hs-var">defaultConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679215488"><span class="hs-identifier hs-type">config</span></a></span><span>
</span><span id="line-315"></span><span>      </span><span class="hs-comment">-- ^ The default value we initialize the config variable to.</span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="configSection"><span class="annot"><span class="annottext">forall config. ServerDefinition config -&gt; Text
</span><a href="Language.LSP.Server.Core.html#configSection"><span class="hs-identifier hs-var hs-var">configSection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-317"></span><span>      </span><span class="hs-comment">-- ^ The &quot;config section&quot; that this server uses. This is used to identify the settings</span><span>
</span><span id="line-318"></span><span>      </span><span class="hs-comment">-- that are relevant to the server.</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="parseConfig"><span class="annot"><span class="annottext">forall config.
ServerDefinition config -&gt; config -&gt; Value -&gt; Either Text config
</span><a href="Language.LSP.Server.Core.html#parseConfig"><span class="hs-identifier hs-var hs-var">parseConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679215488"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679215488"><span class="hs-identifier hs-type">config</span></a></span><span>
</span><span id="line-320"></span><span>      </span><span class="hs-comment">-- ^ @parseConfig oldConfig newConfigObject@ is called whenever we</span><span>
</span><span id="line-321"></span><span>      </span><span class="hs-comment">-- get updated configuration from the client.</span><span>
</span><span id="line-322"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-323"></span><span>      </span><span class="hs-comment">-- @parseConfig@ is called on the object corresponding to the server's</span><span>
</span><span id="line-324"></span><span>      </span><span class="hs-comment">-- config section, it should not itself try to look for the config section.</span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-comment">-- Note that the 'J.Value' may represent only a partial object in the case where we</span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-comment">-- are handling a @workspace/didChangeConfiguration@ request where the client sends</span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-comment">-- only the changed settings. This is also the main circumstance where the old configuration</span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-comment">-- argument is useful. It is generally fine for servers to ignore this case and just</span><span>
</span><span id="line-330"></span><span>      </span><span class="hs-comment">-- assume that the 'J.Value' represents a full new config and ignore the old configuration.</span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-comment">-- This will only be problematic in the case of clients which behave as above and *also*</span><span>
</span><span id="line-332"></span><span>      </span><span class="hs-comment">-- don't support @workspace/configuration@, which is discouraged.</span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="onConfigChange"><span class="annot"><span class="annottext">()
</span><a href="Language.LSP.Server.Core.html#onConfigChange"><span class="hs-identifier hs-var hs-var">onConfigChange</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679215488"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214401"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-comment">-- ^ This callback is called any time the configuration is updated, with</span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-comment">-- the new config. Servers that want to react to config changes should provide</span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-comment">-- a callback here, it is not sufficient to just add e.g. a @workspace/didChangeConfiguration@</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-comment">-- handler.</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="doInitialize"><span class="annot"><span class="annottext">()
</span><a href="Language.LSP.Server.Core.html#doInitialize"><span class="hs-identifier hs-var hs-var">doInitialize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215488"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TMessage</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method_Initialize</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResponseError</span></span><span> </span><span class="annot"><a href="#local-6989586621679214400"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>      </span><span class="hs-comment">-- ^ Called *after* receiving the @initialize@ request and *before*</span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-comment">-- returning the response. This callback will be invoked to offer the</span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-comment">-- language server implementation the chance to create any processes or</span><span>
</span><span id="line-343"></span><span>      </span><span class="hs-comment">-- start new threads that may be necessary for the server lifecycle. It can</span><span>
</span><span id="line-344"></span><span>      </span><span class="hs-comment">-- also return an error in the initialization if necessary.</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="staticHandlers"><span class="annot"><span class="annottext">()
</span><a href="Language.LSP.Server.Core.html#staticHandlers"><span class="hs-identifier hs-var hs-var">staticHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientCapabilities</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handlers"><span class="hs-identifier hs-type">Handlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214401"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-346"></span><span>      </span><span class="hs-comment">-- ^ Handlers for any methods you want to statically support.</span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-comment">-- The handlers here cannot be unregistered during the server's lifetime</span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-comment">-- and will be registered statically in the initialize request.</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-comment">-- The handlers provided can depend on the client capabilities, which</span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-comment">-- are static across the lifetime of the server.</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="interpretHandler"><span class="annot"><span class="annottext">()
</span><a href="Language.LSP.Server.Core.html#interpretHandler"><span class="hs-identifier hs-var hs-var">interpretHandler</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679214400"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679214401"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#%3C~%3E"><span class="hs-operator hs-type">&lt;~&gt;</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>      </span><span class="hs-comment">-- ^ How to run the handlers in your own monad of choice, @m@.</span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-comment">-- It is passed the result of 'doInitialize', so typically you will want</span><span>
</span><span id="line-354"></span><span>      </span><span class="hs-comment">-- to thread along the 'LanguageContextEnv' as well as any other state you</span><span>
</span><span id="line-355"></span><span>      </span><span class="hs-comment">-- need to run your monad. @m@ should most likely be built on top of</span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-comment">-- 'LspT'.</span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-comment">-- @</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-comment">--  ServerDefinition { ...</span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-comment">--  , doInitialize = \env _req -&gt; pure $ Right env</span><span>
</span><span id="line-361"></span><span>      </span><span class="hs-comment">--  , interpretHandler = \env -&gt; Iso</span><span>
</span><span id="line-362"></span><span>      </span><span class="hs-comment">--     (runLspT env) -- how to convert from IO ~&gt; m</span><span>
</span><span id="line-363"></span><span>      </span><span class="hs-comment">--     liftIO        -- how to convert from m ~&gt; IO</span><span>
</span><span id="line-364"></span><span>      </span><span class="hs-comment">--  }</span><span>
</span><span id="line-365"></span><span>      </span><span class="hs-comment">-- @</span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="options"><span class="annot"><span class="annottext">forall config. ServerDefinition config -&gt; Options
</span><a href="Language.LSP.Server.Core.html#options"><span class="hs-identifier hs-var hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Options"><span class="hs-identifier hs-type">Options</span></a></span><span>
</span><span id="line-367"></span><span>      </span><span class="hs-comment">-- ^ Configurable options for the server's capabilities.</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="hs-comment">-- | A function that a 'Handler' is passed that can be used to respond to a</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- request with either an error, or the response params.</span><span>
</span><span id="line-372"></span><span class="hs-keyword">newtype</span><span> </span><span id="ServerResponseCallback"><span class="annot"><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-var">ServerResponseCallback</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215419"><span class="annot"><a href="#local-6989586621679215419"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerToClient</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ServerResponseCallback"><span class="annot"><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-var">ServerResponseCallback</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResponseError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MessageResult</span></span><span> </span><span class="annot"><a href="#local-6989586621679215419"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-comment">-- | Return value signals if response handler was inserted successfully</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- Might fail if the id was already in the map</span><span>
</span><span id="line-377"></span><span id="local-6989586621679215479"><span id="local-6989586621679215480"><span id="local-6989586621679215481"><span class="annot"><a href="Language.LSP.Server.Core.html#addResponseHandler"><span class="hs-identifier hs-type">addResponseHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215481"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215480"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LspId</span></span><span> </span><span class="annot"><a href="#local-6989586621679215479"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Product</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMethod</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-type">ServerResponseCallback</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679215479"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215480"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-378"></span><span id="addResponseHandler"><span class="annot"><span class="annottext">addResponseHandler :: forall config (f :: * -&gt; *) (m :: Method 'ServerToClient 'Request).
MonadLsp config f =&gt;
LspId @'ServerToClient m
-&gt; Product
     @(Method 'ServerToClient 'Request)
     (SMethod @'ServerToClient @'Request)
     ServerResponseCallback
     m
-&gt; f Bool
</span><a href="Language.LSP.Server.Core.html#addResponseHandler"><span class="hs-identifier hs-var hs-var">addResponseHandler</span></a></span></span><span> </span><span id="local-6989586621679214383"><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679214383"><span class="hs-identifier hs-var">lid</span></a></span></span><span> </span><span id="local-6989586621679214382"><span class="annot"><span class="annottext">Product
  @(Method 'ServerToClient 'Request)
  (SMethod @'ServerToClient @'Request)
  ServerResponseCallback
  m
</span><a href="#local-6989586621679214382"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar ResponseMap
</span><a href="Language.LSP.Server.Core.html#resPendingResponses"><span class="hs-identifier hs-var">resPendingResponses</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679214381"><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679214381"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall {a} (k :: a -&gt; *) (m :: a) (f :: a -&gt; *).
IxOrd @a k =&gt;
k m -&gt; f m -&gt; IxMap @a k f -&gt; Maybe (IxMap @a k f)
</span><span class="hs-identifier hs-var">insertIxMap</span></span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679214383"><span class="hs-identifier hs-var">lid</span></a></span><span> </span><span class="annot"><span class="annottext">Product
  @(Method 'ServerToClient 'Request)
  (SMethod @'ServerToClient @'Request)
  ServerResponseCallback
  m
</span><a href="#local-6989586621679214382"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679214381"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-381"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679214379"><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679214379"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679214379"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>      </span><span class="annot"><span class="annottext">Maybe ResponseMap
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResponseMap
</span><a href="#local-6989586621679214381"><span class="hs-identifier hs-var">pending</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><a href="Language.LSP.Server.Core.html#sendNotification"><span class="hs-identifier hs-type">sendNotification</span></a></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215463"><span class="annot"><a href="#local-6989586621679215463"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerToClient</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215464"><span class="annot"><a href="#local-6989586621679215464"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679215465"><span class="annot"><a href="#local-6989586621679215465"><span class="hs-identifier hs-type">config</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215465"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215464"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SServerMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679215463"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MessageParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679215463"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215464"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span id="sendNotification"><span class="annot"><span class="annottext">sendNotification :: forall (m :: Method 'ServerToClient 'Notification) (f :: * -&gt; *)
       config.
MonadLsp config f =&gt;
SServerMethod @'Notification m
-&gt; MessageParams @'ServerToClient @'Notification m -&gt; f ()
</span><a href="Language.LSP.Server.Core.html#sendNotification"><span class="hs-identifier hs-var hs-var">sendNotification</span></a></span></span><span> </span><span id="local-6989586621679214374"><span class="annot"><span class="annottext">SServerMethod @'Notification m
</span><a href="#local-6989586621679214374"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679214373"><span class="annot"><span class="annottext">MessageParams @'ServerToClient @'Notification m
</span><a href="#local-6989586621679214373"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214372"><span class="annot"><span class="annottext">msg :: TNotificationMessage @'ServerToClient m
</span><a href="#local-6989586621679214372"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: MessageDirection) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; TNotificationMessage @f m
</span><span class="hs-identifier hs-var">TNotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Notification m
</span><a href="#local-6989586621679214374"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MessageParams @'ServerToClient @'Notification m
</span><a href="#local-6989586621679214373"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall {t :: MessageKind} (m :: Method 'ServerToClient t).
SServerMethod @t m -&gt; ServerNotOrReq @t m
</span><span class="hs-identifier hs-var">splitServerMethod</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Notification m
</span><a href="#local-6989586621679214374"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="annottext">ServerNotOrReq @'Notification m
</span><span class="hs-identifier hs-var">IsServerNot</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Notification).
((TMessage @'ServerToClient @'Notification m :: *)
 ~ (TNotificationMessage @'ServerToClient m :: *)) =&gt;
TNotificationMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage @'ServerToClient m
</span><a href="#local-6989586621679214372"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="annot"><span class="annottext">ServerNotOrReq @'Notification m
</span><span class="hs-identifier hs-var">IsServerEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: MessageKind) (m :: Method 'ServerToClient t)
       (a :: Method 'ClientToServer 'Request -&gt; *).
SMethod @'ServerToClient @t m
-&gt; TMessage @'ServerToClient @t m -&gt; FromServerMessage' a
</span><span class="hs-identifier hs-var">FromServerMess</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Notification m
</span><a href="#local-6989586621679214374"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (s :: Symbol) (f :: MessageDirection).
TNotificationMessage @f ('Method_CustomMethod @f @'Notification s)
-&gt; TCustomMessage s f 'Notification
</span><span class="hs-identifier hs-var">NotMess</span></span><span> </span><span class="annot"><span class="annottext">TNotificationMessage @'ServerToClient m
</span><a href="#local-6989586621679214372"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="annot"><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-type">sendRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215434"><span class="annot"><a href="#local-6989586621679215434"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerToClient</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215435"><span class="annot"><a href="#local-6989586621679215435"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679215436"><span class="annot"><a href="#local-6989586621679215436"><span class="hs-identifier hs-type">config</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215436"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215435"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-396"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SServerMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679215434"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-397"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MessageParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679215434"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-398"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResponseError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MessageResult</span></span><span> </span><span class="annot"><a href="#local-6989586621679215434"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215435"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215435"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LspId</span></span><span> </span><span class="annot"><a href="#local-6989586621679215434"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span id="sendRequest"><span class="annot"><span class="annottext">sendRequest :: forall (m :: Method 'ServerToClient 'Request) (f :: * -&gt; *) config.
MonadLsp config f =&gt;
SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; (Either
      ResponseError (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient m)
</span><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-var hs-var">sendRequest</span></a></span></span><span> </span><span id="local-6989586621679214329"><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679214329"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679214328"><span class="annot"><span class="annottext">MessageParams @'ServerToClient @'Request m
</span><a href="#local-6989586621679214328"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679214327"><span class="annot"><span class="annottext">Either ResponseError (MessageResult @'ServerToClient @'Request m)
-&gt; f ()
</span><a href="#local-6989586621679214327"><span class="hs-identifier hs-var">resHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>  </span><span id="local-6989586621679214326"><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679214326"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: MessageDirection) (m :: Method f 'Request).
Int32 -&gt; LspId @f m
</span><span class="hs-identifier hs-var">IdInt</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *). MonadLsp config m =&gt; m Int32
</span><a href="Language.LSP.Server.Core.html#freshLspId"><span class="hs-identifier hs-var">freshLspId</span></a></span><span>
</span><span id="line-402"></span><span>  </span><span id="local-6989586621679214323"><span class="annot"><span class="annottext">f () -&gt; IO ()
</span><a href="#local-6989586621679214323"><span class="hs-identifier hs-var">rio</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; m (m a -&gt; IO a)
</span><span class="hs-identifier hs-var">askRunInIO</span></span><span>
</span><span id="line-403"></span><span>  </span><span id="local-6989586621679214321"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679214321"><span class="hs-identifier hs-var">success</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (f :: * -&gt; *) (m :: Method 'ServerToClient 'Request).
MonadLsp config f =&gt;
LspId @'ServerToClient m
-&gt; Product
     @(Method 'ServerToClient 'Request)
     (SMethod @'ServerToClient @'Request)
     ServerResponseCallback
     m
-&gt; f Bool
</span><a href="Language.LSP.Server.Core.html#addResponseHandler"><span class="hs-identifier hs-var">addResponseHandler</span></a></span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679214326"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
f a -&gt; g a -&gt; Product @k f g a
</span><span class="hs-identifier hs-var">Pair</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679214329"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Request).
(Either ResponseError (MessageResult @'ServerToClient @'Request m)
 -&gt; IO ())
-&gt; ServerResponseCallback m
</span><a href="Language.LSP.Server.Core.html#ServerResponseCallback"><span class="hs-identifier hs-var">ServerResponseCallback</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f () -&gt; IO ()
</span><a href="#local-6989586621679214323"><span class="hs-identifier hs-var">rio</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either ResponseError (MessageResult @'ServerToClient @'Request m)
-&gt; f ()
</span><a href="#local-6989586621679214327"><span class="hs-identifier hs-var">resHandler</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679214321"><span class="hs-identifier hs-var">success</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LSP: could not send FromServer request as id is reused&quot;</span></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214317"><span class="annot"><span class="annottext">msg :: TRequestMessage @'ServerToClient m
</span><a href="#local-6989586621679214317"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: MessageDirection) (m :: Method f 'Request).
Text
-&gt; LspId @f m
-&gt; SMethod @f @'Request m
-&gt; MessageParams @f @'Request m
-&gt; TRequestMessage @f m
</span><span class="hs-identifier hs-var">TRequestMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679214326"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679214329"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MessageParams @'ServerToClient @'Request m
</span><a href="#local-6989586621679214328"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall {t :: MessageKind} (m :: Method 'ServerToClient t).
SServerMethod @t m -&gt; ServerNotOrReq @t m
</span><span class="hs-identifier hs-var">splitServerMethod</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679214329"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="annottext">ServerNotOrReq @'Request m
</span><span class="hs-identifier hs-var">IsServerReq</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Request).
((TMessage @'ServerToClient @'Request m :: *)
 ~ (TRequestMessage @'ServerToClient m :: *)) =&gt;
TRequestMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">fromServerReq</span></span><span> </span><span class="annot"><span class="annottext">TRequestMessage @'ServerToClient m
</span><a href="#local-6989586621679214317"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><span class="annottext">ServerNotOrReq @'Request m
</span><span class="hs-identifier hs-var">IsServerEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: MessageKind) (m :: Method 'ServerToClient t)
       (a :: Method 'ClientToServer 'Request -&gt; *).
SMethod @'ServerToClient @t m
-&gt; TMessage @'ServerToClient @t m -&gt; FromServerMessage' a
</span><span class="hs-identifier hs-var">FromServerMess</span></span><span> </span><span class="annot"><span class="annottext">SServerMethod @'Request m
</span><a href="#local-6989586621679214329"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (s :: Symbol) (f :: MessageDirection).
TRequestMessage @f ('Method_CustomMethod @f @'Request s)
-&gt; TCustomMessage s f 'Request
</span><span class="hs-identifier hs-var">ReqMess</span></span><span> </span><span class="annot"><span class="annottext">TRequestMessage @'ServerToClient m
</span><a href="#local-6989586621679214317"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">LspId @'ServerToClient m
</span><a href="#local-6989586621679214326"><span class="hs-identifier hs-var">reqId</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-comment">-- | Return the 'VirtualFile' associated with a given 'NormalizedUri', if there is one.</span><span>
</span><span id="line-415"></span><span id="local-6989586621679215408"><span id="local-6989586621679215409"><span class="annot"><a href="Language.LSP.Server.Core.html#getVirtualFile"><span class="hs-identifier hs-type">getVirtualFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215409"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215408"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NormalizedUri</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215408"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.LSP.VFS.html#VirtualFile"><span class="hs-identifier hs-type">VirtualFile</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-416"></span><span id="getVirtualFile"><span class="annot"><span class="annottext">getVirtualFile :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
NormalizedUri -&gt; m (Maybe VirtualFile)
</span><a href="Language.LSP.Server.Core.html#getVirtualFile"><span class="hs-identifier hs-var hs-var">getVirtualFile</span></a></span></span><span> </span><span id="local-6989586621679214279"><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679214279"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-417"></span><span>  </span><span id="local-6989586621679214278"><span class="annot"><span class="annottext">VFS
</span><a href="#local-6989586621679214278"><span class="hs-identifier hs-var">dat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var">vfsData</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VFS
</span><a href="#local-6989586621679214278"><span class="hs-identifier hs-var">dat</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasVfsMap s a =&gt; Lens' s a
</span><a href="Language.LSP.VFS.html#vfsMap"><span class="hs-identifier hs-var">vfsMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679214279"><span class="hs-identifier hs-var">uri</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getVirtualFile"><span class="hs-pragma hs-type">getVirtualFile</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span id="local-6989586621679215389"><span id="local-6989586621679215390"><span class="annot"><a href="Language.LSP.Server.Core.html#getVirtualFiles"><span class="hs-identifier hs-type">getVirtualFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215390"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215389"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215389"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Language.LSP.VFS.html#VFS"><span class="hs-identifier hs-type">VFS</span></a></span></span></span><span>
</span><span id="line-423"></span><span id="getVirtualFiles"><span class="annot"><span class="annottext">getVirtualFiles :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m VFS
</span><a href="Language.LSP.Server.Core.html#getVirtualFiles"><span class="hs-identifier hs-var hs-var">getVirtualFiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var">vfsData</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getVirtualFiles"><span class="hs-pragma hs-type">getVirtualFiles</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="hs-comment">-- | Take an atomic snapshot of the current state of the virtual file system.</span><span>
</span><span id="line-428"></span><span id="local-6989586621679215386"><span class="annot"><a href="Language.LSP.Server.Core.html#snapshotVirtualFiles"><span class="hs-identifier hs-type">snapshotVirtualFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LanguageContextEnv"><span class="hs-identifier hs-type">LanguageContextEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215386"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="Language.LSP.VFS.html#VFS"><span class="hs-identifier hs-type">VFS</span></a></span></span><span>
</span><span id="line-429"></span><span id="snapshotVirtualFiles"><span class="annot"><span class="annottext">snapshotVirtualFiles :: forall c. LanguageContextEnv c -&gt; STM VFS
</span><a href="Language.LSP.Server.Core.html#snapshotVirtualFiles"><span class="hs-identifier hs-var hs-var">snapshotVirtualFiles</span></a></span></span><span> </span><span id="local-6989586621679214264"><span class="annot"><span class="annottext">LanguageContextEnv c
</span><a href="#local-6989586621679214264"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var">vfsData</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; LanguageContextState config
</span><a href="Language.LSP.Server.Core.html#resState"><span class="hs-identifier hs-var">resState</span></a></span><span> </span><span class="annot"><span class="annottext">LanguageContextEnv c
</span><a href="#local-6989586621679214264"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#snapshotVirtualFiles"><span class="hs-pragma hs-type">snapshotVirtualFiles</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="hs-comment">-- | Dump the current text for a given VFS file to a temporary file,</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- and return the path to the file.</span><span>
</span><span id="line-436"></span><span id="local-6989586621679215382"><span id="local-6989586621679215383"><span class="annot"><a href="Language.LSP.Server.Core.html#persistVirtualFile"><span class="hs-identifier hs-type">persistVirtualFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215383"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215382"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679215382"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><a href="Language.LSP.VFS.html#VfsLog"><span class="hs-identifier hs-type">VfsLog</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NormalizedUri</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215382"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-437"></span><span id="persistVirtualFile"><span class="annot"><span class="annottext">persistVirtualFile :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
LogAction m (WithSeverity VfsLog)
-&gt; NormalizedUri -&gt; m (Maybe String)
</span><a href="Language.LSP.Server.Core.html#persistVirtualFile"><span class="hs-identifier hs-var hs-var">persistVirtualFile</span></a></span></span><span> </span><span id="local-6989586621679214246"><span class="annot"><span class="annottext">LogAction m (WithSeverity VfsLog)
</span><a href="#local-6989586621679214246"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621679214245"><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679214245"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679214244"><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679214244"><span class="hs-identifier hs-var">vfs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
LogAction m (WithSeverity VfsLog)
-&gt; VFS -&gt; NormalizedUri -&gt; Maybe (String, m ())
</span><a href="Language.LSP.VFS.html#persistFileVFS"><span class="hs-identifier hs-var">persistFileVFS</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity VfsLog)
</span><a href="#local-6989586621679214246"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VFSData -&gt; VFS
</span><a href="Language.LSP.Server.Core.html#vfsData"><span class="hs-identifier hs-var">vfsData</span></a></span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679214244"><span class="hs-identifier hs-var">vfs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679214245"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-440"></span><span>      </span><span class="annot"><span class="annottext">Maybe (String, m ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679214244"><span class="hs-identifier hs-var">vfs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679214242"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679214242"><span class="hs-identifier hs-var">fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214241"><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679214241"><span class="hs-identifier hs-var">write</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679214240"><span class="annot"><span class="annottext">revMap :: Map String String
</span><a href="#local-6989586621679214240"><span class="hs-identifier hs-var hs-var">revMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Uri -&gt; Maybe String
</span><span class="hs-identifier hs-var">uriToFilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NormalizedUri -&gt; Uri
</span><span class="hs-identifier hs-var">fromNormalizedUri</span></span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679214245"><span class="hs-identifier hs-var">uri</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-443"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679214237"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679214237"><span class="hs-identifier hs-var">uri_fp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679214242"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679214237"><span class="hs-identifier hs-var">uri_fp</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; Map String String
</span><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var">reverseMap</span></a></span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679214244"><span class="hs-identifier hs-var">vfs</span></a></span><span>
</span><span id="line-444"></span><span>              </span><span class="hs-comment">-- TODO: Does the VFS make sense for URIs which are not files?</span><span>
</span><span id="line-445"></span><span>              </span><span class="hs-comment">-- The reverse map should perhaps be (FilePath -&gt; URI)</span><span>
</span><span id="line-446"></span><span>              </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; Map String String
</span><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var">reverseMap</span></a></span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679214244"><span class="hs-identifier hs-var">vfs</span></a></span><span>
</span><span id="line-447"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621679214235"><span class="annot"><span class="annottext">vfs' :: VFSData
</span><a href="#local-6989586621679214235"><span class="hs-identifier hs-var hs-var">vfs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679214244"><span class="hs-identifier hs-var">vfs</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">reverseMap :: Map String String
</span><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var">reverseMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621679214240"><span class="hs-identifier hs-var">revMap</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-448"></span><span>            </span><span id="local-6989586621679214234"><span class="annot"><span class="annottext">act :: m (Maybe String)
</span><a href="#local-6989586621679214234"><span class="hs-identifier hs-var hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-449"></span><span>              </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679214241"><span class="hs-identifier hs-var">write</span></a></span><span>
</span><span id="line-450"></span><span>              </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679214242"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Maybe String)
</span><a href="#local-6989586621679214234"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679214235"><span class="hs-identifier hs-var">vfs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span class="hs-comment">-- | Given a text document identifier, annotate it with the latest version.</span><span>
</span><span id="line-454"></span><span id="local-6989586621679215369"><span id="local-6989586621679215370"><span class="annot"><a href="Language.LSP.Server.Core.html#getVersionedTextDoc"><span class="hs-identifier hs-type">getVersionedTextDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215370"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215369"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TextDocumentIdentifier</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215369"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VersionedTextDocumentIdentifier</span></span></span></span><span>
</span><span id="line-455"></span><span id="getVersionedTextDoc"><span class="annot"><span class="annottext">getVersionedTextDoc :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
TextDocumentIdentifier -&gt; m VersionedTextDocumentIdentifier
</span><a href="Language.LSP.Server.Core.html#getVersionedTextDoc"><span class="hs-identifier hs-var hs-var">getVersionedTextDoc</span></a></span></span><span> </span><span id="local-6989586621679214220"><span class="annot"><span class="annottext">TextDocumentIdentifier
</span><a href="#local-6989586621679214220"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214219"><span class="annot"><span class="annottext">uri :: Uri
</span><a href="#local-6989586621679214219"><span class="hs-identifier hs-var hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TextDocumentIdentifier
</span><a href="#local-6989586621679214220"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasUri s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.uri</span></span><span>
</span><span id="line-457"></span><span>  </span><span id="local-6989586621679214217"><span class="annot"><span class="annottext">Maybe VirtualFile
</span><a href="#local-6989586621679214217"><span class="hs-identifier hs-var">mvf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
NormalizedUri -&gt; m (Maybe VirtualFile)
</span><a href="Language.LSP.Server.Core.html#getVirtualFile"><span class="hs-identifier hs-var">getVirtualFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uri -&gt; NormalizedUri
</span><span class="hs-identifier hs-var">toNormalizedUri</span></span><span> </span><span class="annot"><span class="annottext">Uri
</span><a href="#local-6989586621679214219"><span class="hs-identifier hs-var">uri</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214215"><span class="annot"><span class="annottext">ver :: Int32
</span><a href="#local-6989586621679214215"><span class="hs-identifier hs-var hs-var">ver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe VirtualFile
</span><a href="#local-6989586621679214217"><span class="hs-identifier hs-var">mvf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-459"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.VFS.html#VirtualFile"><span class="hs-identifier hs-type">VirtualFile</span></a></span><span> </span><span id="local-6989586621679214213"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679214213"><span class="hs-identifier hs-var">lspver</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Rope
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679214213"><span class="hs-identifier hs-var">lspver</span></a></span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><span class="annottext">Maybe VirtualFile
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-461"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uri -&gt; Int32 -&gt; VersionedTextDocumentIdentifier
</span><span class="hs-identifier hs-var">VersionedTextDocumentIdentifier</span></span><span> </span><span class="annot"><span class="annottext">Uri
</span><a href="#local-6989586621679214219"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679214215"><span class="hs-identifier hs-var">ver</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getVersionedTextDoc"><span class="hs-pragma hs-type">getVersionedTextDoc</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="hs-comment">-- TODO: should this function return a URI?</span><span>
</span><span id="line-466"></span><span class="hs-comment">-- | If the contents of a VFS has been dumped to a temporary file, map</span><span>
</span><span id="line-467"></span><span class="hs-comment">-- the temporary file name back to the original one.</span><span>
</span><span id="line-468"></span><span id="local-6989586621679215359"><span id="local-6989586621679215360"><span class="annot"><a href="Language.LSP.Server.Core.html#reverseFileMap"><span class="hs-identifier hs-type">reverseFileMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215360"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215359"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215359"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-469"></span><span id="reverseFileMap"><span class="annot"><span class="annottext">reverseFileMap :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m ShowS
</span><a href="Language.LSP.Server.Core.html#reverseFileMap"><span class="hs-identifier hs-var hs-var">reverseFileMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>  </span><span id="local-6989586621679214201"><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679214201"><span class="hs-identifier hs-var">vfs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar VFSData
</span><a href="Language.LSP.Server.Core.html#resVFS"><span class="hs-identifier hs-var">resVFS</span></a></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214200"><span class="annot"><span class="annottext">f :: ShowS
</span><a href="#local-6989586621679214200"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679214199"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679214199"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679214199"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679214199"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VFSData -&gt; Map String String
</span><a href="Language.LSP.Server.Core.html#reverseMap"><span class="hs-identifier hs-var">reverseMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VFSData
</span><a href="#local-6989586621679214201"><span class="hs-identifier hs-var">vfs</span></a></span><span>
</span><span id="line-472"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="#local-6989586621679214200"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#reverseFileMap"><span class="hs-pragma hs-type">reverseFileMap</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span id="local-6989586621679215447"><span id="local-6989586621679215448"><span class="annot"><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-type">sendToClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215448"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromServerMessage</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-479"></span><span id="sendToClient"><span class="annot"><span class="annottext">sendToClient :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var hs-var">sendToClient</span></a></span></span><span> </span><span id="local-6989586621679214186"><span class="annot"><span class="annottext">FromServerMessage
</span><a href="#local-6989586621679214186"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-480"></span><span>  </span><span id="local-6989586621679214185"><span class="annot"><span class="annottext">FromServerMessage -&gt; IO ()
</span><a href="#local-6989586621679214185"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; FromServerMessage -&gt; IO ()
</span><a href="Language.LSP.Server.Core.html#resSendMessage"><span class="hs-identifier hs-var">resSendMessage</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-481"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FromServerMessage -&gt; IO ()
</span><a href="#local-6989586621679214185"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FromServerMessage
</span><a href="#local-6989586621679214186"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-pragma hs-type">sendToClient</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span id="local-6989586621679215426"><span id="local-6989586621679215427"><span class="annot"><a href="Language.LSP.Server.Core.html#freshLspId"><span class="hs-identifier hs-type">freshLspId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215427"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215426"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215426"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span></span></span><span>
</span><span id="line-488"></span><span id="freshLspId"><span class="annot"><span class="annottext">freshLspId :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m Int32
</span><a href="Language.LSP.Server.Core.html#freshLspId"><span class="hs-identifier hs-var hs-var">freshLspId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar Int32
</span><a href="Language.LSP.Server.Core.html#resLspId"><span class="hs-identifier hs-var">resLspId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679214180"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679214180"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679214179"><span class="annot"><span class="annottext">next :: Int32
</span><a href="#local-6989586621679214179"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679214180"><span class="hs-identifier hs-var">cur</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679214180"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679214179"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#freshLspId"><span class="hs-pragma hs-type">freshLspId</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="hs-comment">-- | The current configuration from the client as set via the @initialize@ and</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- @workspace/didChangeConfiguration@ requests, as well as by calls to</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- 'setConfig'.</span><span>
</span><span id="line-499"></span><span id="local-6989586621679215347"><span id="local-6989586621679215348"><span class="annot"><a href="Language.LSP.Server.Core.html#getConfig"><span class="hs-identifier hs-type">getConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215348"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215347"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215347"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215348"><span class="hs-identifier hs-type">config</span></a></span></span></span><span>
</span><span id="line-500"></span><span id="getConfig"><span class="annot"><span class="annottext">getConfig :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m config
</span><a href="Language.LSP.Server.Core.html#getConfig"><span class="hs-identifier hs-var hs-var">getConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar config
</span><a href="Language.LSP.Server.Core.html#resConfig"><span class="hs-identifier hs-var">resConfig</span></a></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getConfig"><span class="hs-pragma hs-type">getConfig</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span id="local-6989586621679215343"><span id="local-6989586621679215344"><span class="annot"><a href="Language.LSP.Server.Core.html#setConfig"><span class="hs-identifier hs-type">setConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215344"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215343"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215344"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215343"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-505"></span><span id="setConfig"><span class="annot"><span class="annottext">setConfig :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; config -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#setConfig"><span class="hs-identifier hs-var hs-var">setConfig</span></a></span></span><span> </span><span id="local-6989586621679214171"><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679214171"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar config
</span><a href="Language.LSP.Server.Core.html#resConfig"><span class="hs-identifier hs-var">resConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679214171"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#setConfig"><span class="hs-pragma hs-type">setConfig</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span id="local-6989586621679215337"><span id="local-6989586621679215338"><span class="annot"><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-identifier hs-type">getClientCapabilities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215338"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215337"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215337"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ClientCapabilities</span></span></span></span><span>
</span><span id="line-510"></span><span id="getClientCapabilities"><span class="annot"><span class="annottext">getClientCapabilities :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-identifier hs-var hs-var">getClientCapabilities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#resClientCapabilities"><span class="hs-identifier hs-var">resClientCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-pragma hs-type">getClientCapabilities</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span id="local-6989586621679215333"><span id="local-6989586621679215334"><span class="annot"><a href="Language.LSP.Server.Core.html#getRootPath"><span class="hs-identifier hs-type">getRootPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215334"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215333"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215333"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-515"></span><span id="getRootPath"><span class="annot"><span class="annottext">getRootPath :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m (Maybe String)
</span><a href="Language.LSP.Server.Core.html#getRootPath"><span class="hs-identifier hs-var hs-var">getRootPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Maybe String
</span><a href="Language.LSP.Server.Core.html#resRootPath"><span class="hs-identifier hs-var">resRootPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getRootPath"><span class="hs-pragma hs-type">getRootPath</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="hs-comment">-- | The current workspace folders, if the client supports workspace folders.</span><span>
</span><span id="line-520"></span><span id="local-6989586621679215329"><span id="local-6989586621679215330"><span class="annot"><a href="Language.LSP.Server.Core.html#getWorkspaceFolders"><span class="hs-identifier hs-type">getWorkspaceFolders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215330"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215329"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215329"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">WorkspaceFolder</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-521"></span><span id="getWorkspaceFolders"><span class="annot"><span class="annottext">getWorkspaceFolders :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (Maybe [WorkspaceFolder])
</span><a href="Language.LSP.Server.Core.html#getWorkspaceFolders"><span class="hs-identifier hs-var hs-var">getWorkspaceFolders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-522"></span><span>  </span><span id="local-6989586621679214129"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214129"><span class="hs-identifier hs-var">clientCaps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-identifier hs-var">getClientCapabilities</span></a></span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214128"><span class="annot"><span class="annottext">clientSupportsWfs :: Bool
</span><a href="#local-6989586621679214128"><span class="hs-identifier hs-var hs-var">clientSupportsWfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214129"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasWorkspace s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.workspace</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasWorkspaceFolders s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.workspaceFolders</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679214128"><span class="hs-identifier hs-var">clientSupportsWfs</span></a></span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#getsState"><span class="hs-identifier hs-var">getsState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar [WorkspaceFolder]
</span><a href="Language.LSP.Server.Core.html#resWorkspaceFolders"><span class="hs-identifier hs-var">resWorkspaceFolders</span></a></span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getWorkspaceFolders"><span class="hs-pragma hs-type">getWorkspaceFolders</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="hs-comment">-- | Sends a @client/registerCapability@ request and dynamically registers</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- a 'Method' with a 'Handler'. Returns 'Nothing' if the client does not</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- support dynamic registration for the specified method, otherwise a</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- 'RegistrationToken' which can be used to unregister it later.</span><span>
</span><span id="line-534"></span><span class="annot"><a href="Language.LSP.Server.Core.html#registerCapability"><span class="hs-identifier hs-type">registerCapability</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679215312"><span class="annot"><a href="#local-6989586621679215312"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679215314"><span class="annot"><a href="#local-6989586621679215314"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679215311"><span class="annot"><a href="#local-6989586621679215311"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientToServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679215314"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679215313"><span class="annot"><a href="#local-6989586621679215313"><span class="hs-identifier hs-type">config</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-535"></span><span>                      </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215313"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215312"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-536"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SClientMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621679215311"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-537"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RegistrationOptions</span></span><span> </span><span class="annot"><a href="#local-6989586621679215311"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-538"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215312"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215311"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-539"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215312"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-type">RegistrationToken</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215311"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span id="registerCapability"><span class="annot"><span class="annottext">registerCapability :: forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t) config.
MonadLsp config f =&gt;
SClientMethod @t m
-&gt; RegistrationOptions @'ClientToServer @t m
-&gt; Handler @'ClientToServer @t f m
-&gt; f (Maybe (RegistrationToken @t m))
</span><a href="Language.LSP.Server.Core.html#registerCapability"><span class="hs-identifier hs-var hs-var">registerCapability</span></a></span></span><span> </span><span id="local-6989586621679214093"><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621679214092"><span class="annot"><span class="annottext">RegistrationOptions @'ClientToServer @t m
</span><a href="#local-6989586621679214092"><span class="hs-identifier hs-var">regOpts</span></a></span></span><span> </span><span id="local-6989586621679214091"><span class="annot"><span class="annottext">Handler @'ClientToServer @t f m
</span><a href="#local-6989586621679214091"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-541"></span><span>  </span><span id="local-6989586621679214090"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214090"><span class="hs-identifier hs-var">clientCaps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#resClientCapabilities"><span class="hs-identifier hs-var">resClientCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-542"></span><span>  </span><span id="local-6989586621679214089"><span class="annot"><span class="annottext">Handlers IO
</span><a href="#local-6989586621679214089"><span class="hs-identifier hs-var">handlers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Handlers IO
</span><a href="Language.LSP.Server.Core.html#resHandlers"><span class="hs-identifier hs-var">resHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m (LanguageContextEnv config)
</span><a href="Language.LSP.Server.Core.html#getLspEnv"><span class="hs-identifier hs-var">getLspEnv</span></a></span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214088"><span class="annot"><span class="annottext">alreadyStaticallyRegistered :: Bool
</span><a href="#local-6989586621679214088"><span class="hs-identifier hs-var hs-var">alreadyStaticallyRegistered</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall {t :: MessageKind} (m :: Method 'ClientToServer t).
SClientMethod @t m -&gt; ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">splitClientMethod</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-544"></span><span>        </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientNot</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {f1 :: MessageDirection} {t1 :: MessageKind}
       {f2 :: MessageDirection} {t2 :: MessageKind} (a :: Method f1 t1)
       (v :: Method f2 t2 -&gt; *).
SMethod @f1 @t1 a -&gt; SMethodMap @f2 @t2 v -&gt; Bool
</span><span class="hs-identifier hs-var">SMethodMap.member</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Handlers m
-&gt; SMethodMap
     @'ClientToServer
     @'Notification
     (ClientMessageHandler m 'Notification)
</span><a href="Language.LSP.Server.Core.html#notHandlers"><span class="hs-identifier hs-var">notHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">Handlers IO
</span><a href="#local-6989586621679214089"><span class="hs-identifier hs-var">handlers</span></a></span><span>
</span><span id="line-545"></span><span>        </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientReq</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {f1 :: MessageDirection} {t1 :: MessageKind}
       {f2 :: MessageDirection} {t2 :: MessageKind} (a :: Method f1 t1)
       (v :: Method f2 t2 -&gt; *).
SMethod @f1 @t1 a -&gt; SMethodMap @f2 @t2 v -&gt; Bool
</span><span class="hs-identifier hs-var">SMethodMap.member</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Handlers m
-&gt; SMethodMap
     @'ClientToServer @'Request (ClientMessageHandler m 'Request)
</span><a href="Language.LSP.Server.Core.html#reqHandlers"><span class="hs-identifier hs-var">reqHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">Handlers IO
</span><a href="#local-6989586621679214089"><span class="hs-identifier hs-var">handlers</span></a></span><span>
</span><span id="line-546"></span><span>        </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot register capability for custom methods&quot;</span></span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><span class="annottext">ClientCapabilities -&gt; Bool -&gt; f (Maybe (RegistrationToken @t m))
</span><a href="#local-6989586621679214070"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214090"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679214088"><span class="hs-identifier hs-var">alreadyStaticallyRegistered</span></a></span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-comment">-- If the server has already registered statically, don't dynamically register</span><span>
</span><span id="line-550"></span><span>    </span><span class="hs-comment">-- as per the spec</span><span>
</span><span id="line-551"></span><span>    </span><span id="local-6989586621679214070"><span class="annot"><span class="annottext">go :: ClientCapabilities -&gt; Bool -&gt; f (Maybe (RegistrationToken @t m))
</span><a href="#local-6989586621679214070"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679214069"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214069"><span class="hs-identifier hs-var">_clientCaps</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-552"></span><span>    </span><span class="annot"><a href="#local-6989586621679214070"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679214068"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214068"><span class="hs-identifier hs-var">clientCaps</span></a></span></span><span>  </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-553"></span><span>      </span><span class="hs-comment">-- First, check to see if the client supports dynamic registration on this method</span><span>
</span><span id="line-554"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ClientCapabilities -&gt; Bool
</span><a href="#local-6989586621679214067"><span class="hs-identifier hs-var">dynamicSupported</span></a></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214068"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-555"></span><span>          </span><span id="local-6989586621679214066"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679214066"><span class="hs-identifier hs-var">uuid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UUID -&gt; Text
</span><span class="hs-identifier hs-var">UUID.toText</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; (StdGen -&gt; (a, StdGen)) -&gt; m a
</span><span class="hs-identifier hs-var">getStdRandom</span></span><span> </span><span class="annot"><span class="annottext">forall a g. (Random a, RandomGen g) =&gt; g -&gt; (a, g)
</span><span class="hs-identifier hs-var">random</span></span><span>
</span><span id="line-556"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214062"><span class="annot"><span class="annottext">registration :: TRegistration @t m
</span><a href="#local-6989586621679214062"><span class="hs-identifier hs-var hs-var">registration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: MessageKind) (m :: Method 'ClientToServer t).
Text
-&gt; SClientMethod @t m
-&gt; Maybe (RegistrationOptions @'ClientToServer @t m)
-&gt; TRegistration @t m
</span><span class="hs-identifier hs-var">L.TRegistration</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679214066"><span class="hs-identifier hs-var">uuid</span></a></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">RegistrationOptions @'ClientToServer @t m
</span><a href="#local-6989586621679214092"><span class="hs-identifier hs-var">regOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>              </span><span id="local-6989586621679214060"><span class="annot"><span class="annottext">params :: RegistrationParams
</span><a href="#local-6989586621679214060"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Registration] -&gt; RegistrationParams
</span><span class="hs-identifier hs-var">L.RegistrationParams</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall {t :: MessageKind} (m :: Method 'ClientToServer t).
TRegistration @t m -&gt; Registration
</span><span class="hs-identifier hs-var">toUntypedRegistration</span></span><span> </span><span class="annot"><span class="annottext">TRegistration @t m
</span><a href="#local-6989586621679214062"><span class="hs-identifier hs-var">registration</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-558"></span><span>              </span><span id="local-6989586621679214057"><span class="annot"><span class="annottext">regId :: RegistrationId @t m
</span><a href="#local-6989586621679214057"><span class="hs-identifier hs-var hs-var">regId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: MessageKind) (m :: Method 'ClientToServer t).
Text -&gt; RegistrationId @t m
</span><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-var">RegistrationId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679214066"><span class="hs-identifier hs-var">uuid</span></a></span><span>
</span><span id="line-559"></span><span>          </span><span id="local-6989586621679214056"><span class="annot"><span class="annottext">UnliftIO f
</span><a href="#local-6989586621679214056"><span class="hs-identifier hs-var">rio</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadUnliftIO m =&gt; m (UnliftIO m)
</span><span class="hs-identifier hs-var">askUnliftIO</span></span><span>
</span><span id="line-560"></span><span>          </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall {t :: MessageKind} (m :: Method 'ClientToServer t).
SClientMethod @t m -&gt; ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">splitClientMethod</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-561"></span><span>            </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientNot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Notification)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsNot"><span class="hs-identifier hs-var">resRegistrationsNot</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679214049"><span class="annot"><span class="annottext">RegistrationMap 'Notification
</span><a href="#local-6989586621679214049"><span class="hs-identifier hs-var">oldRegs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-562"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214048"><span class="annot"><span class="annottext">pair :: Product
  @(Method 'ClientToServer t)
  (RegistrationId @t)
  (ClientMessageHandler IO t)
  m
</span><a href="#local-6989586621679214048"><span class="hs-identifier hs-var hs-var">pair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {k} (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
f a -&gt; g a -&gt; Product @k f g a
</span><span class="hs-identifier hs-var">Pair</span></span><span> </span><span class="annot"><span class="annottext">RegistrationId @t m
</span><a href="#local-6989586621679214057"><span class="hs-identifier hs-var">regId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). UnliftIO m -&gt; forall a. m a -&gt; IO a
</span><span class="hs-identifier hs-var">unliftIO</span></span><span> </span><span class="annot"><span class="annottext">UnliftIO f
</span><a href="#local-6989586621679214056"><span class="hs-identifier hs-var">rio</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @t f m
</span><a href="#local-6989586621679214091"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall {f :: MessageDirection} {t :: MessageKind} (a :: Method f t)
       (v :: Method f t -&gt; *).
SMethod @f @t a -&gt; v a -&gt; SMethodMap @f @t v -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.insert</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">Product
  @(Method 'ClientToServer t)
  (RegistrationId @t)
  (ClientMessageHandler IO t)
  m
</span><a href="#local-6989586621679214048"><span class="hs-identifier hs-var">pair</span></a></span><span> </span><span class="annot"><span class="annottext">RegistrationMap 'Notification
</span><a href="#local-6989586621679214049"><span class="hs-identifier hs-var">oldRegs</span></a></span><span>
</span><span id="line-564"></span><span>            </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientReq</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Request)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsReq"><span class="hs-identifier hs-var">resRegistrationsReq</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679214038"><span class="annot"><span class="annottext">RegistrationMap 'Request
</span><a href="#local-6989586621679214038"><span class="hs-identifier hs-var">oldRegs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-565"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679214037"><span class="annot"><span class="annottext">pair :: Product
  @(Method 'ClientToServer t)
  (RegistrationId @t)
  (ClientMessageHandler IO t)
  m
</span><a href="#local-6989586621679214037"><span class="hs-identifier hs-var hs-var">pair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {k} (f :: k -&gt; *) (g :: k -&gt; *) (a :: k).
f a -&gt; g a -&gt; Product @k f g a
</span><span class="hs-identifier hs-var">Pair</span></span><span> </span><span class="annot"><span class="annottext">RegistrationId @t m
</span><a href="#local-6989586621679214057"><span class="hs-identifier hs-var">regId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (t :: MessageKind)
       (m :: Method 'ClientToServer t).
Handler @'ClientToServer @t f m -&gt; ClientMessageHandler f t m
</span><a href="Language.LSP.Server.Core.html#ClientMessageHandler"><span class="hs-identifier hs-var">ClientMessageHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679214036"><span class="annot"><span class="annottext">TRequestMessage @'ClientToServer m
</span><a href="#local-6989586621679214036"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679214035"><span class="annot"><span class="annottext">Either ResponseError (MessageResult @'ClientToServer @'Request m)
-&gt; IO ()
</span><a href="#local-6989586621679214035"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). UnliftIO m -&gt; forall a. m a -&gt; IO a
</span><span class="hs-identifier hs-var">unliftIO</span></span><span> </span><span class="annot"><span class="annottext">UnliftIO f
</span><a href="#local-6989586621679214056"><span class="hs-identifier hs-var">rio</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler @'ClientToServer @t f m
</span><a href="#local-6989586621679214091"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TRequestMessage @'ClientToServer m
</span><a href="#local-6989586621679214036"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either ResponseError (MessageResult @'ClientToServer @'Request m)
-&gt; IO ()
</span><a href="#local-6989586621679214035"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall {f :: MessageDirection} {t :: MessageKind} (a :: Method f t)
       (v :: Method f t -&gt; *).
SMethod @f @t a -&gt; v a -&gt; SMethodMap @f @t v -&gt; SMethodMap @f @t v
</span><span class="hs-identifier hs-var">SMethodMap.insert</span></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">Product
  @(Method 'ClientToServer t)
  (RegistrationId @t)
  (ClientMessageHandler IO t)
  m
</span><a href="#local-6989586621679214037"><span class="hs-identifier hs-var">pair</span></a></span><span> </span><span class="annot"><span class="annottext">RegistrationMap 'Request
</span><a href="#local-6989586621679214038"><span class="hs-identifier hs-var">oldRegs</span></a></span><span>
</span><span id="line-567"></span><span>            </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot register capability for custom methods&quot;</span></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>          </span><span class="hs-comment">-- TODO: handle the scenario where this returns an error</span><span>
</span><span id="line-570"></span><span>          </span><span class="annot"><span class="annottext">LspId @'ServerToClient 'Method_ClientRegisterCapability
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Request) (f :: * -&gt; *) config.
MonadLsp config f =&gt;
SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; (Either
      ResponseError (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient m)
</span><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-var">sendRequest</span></a></span><span> </span><span class="annot"><span class="annottext">SMethod @'ServerToClient @'Request 'Method_ClientRegisterCapability
</span><span class="hs-identifier hs-var">SMethod_ClientRegisterCapability</span></span><span> </span><span class="annot"><span class="annottext">RegistrationParams
</span><a href="#local-6989586621679214060"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679214030"><span class="annot"><span class="annottext">Either
  ResponseError
  (MessageResult
     @'ServerToClient @'Request 'Method_ClientRegisterCapability)
</span><a href="#local-6989586621679214030"><span class="hs-identifier hs-var">_res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: MessageKind) (m :: Method 'ClientToServer t).
SMethod @'ClientToServer @t m
-&gt; RegistrationId @t m -&gt; RegistrationToken @t m
</span><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-var">RegistrationToken</span></a></span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">RegistrationId @t m
</span><a href="#local-6989586621679214057"><span class="hs-identifier hs-var">regId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-comment">-- Also I'm thinking we should move this function to somewhere in messages.hs so</span><span>
</span><span id="line-576"></span><span>    </span><span class="hs-comment">-- we don't forget to update it when adding new methods...</span><span>
</span><span id="line-577"></span><span>    </span><span id="local-6989586621679215261"><span class="annot"><a href="#local-6989586621679214029"><span class="hs-identifier hs-type">capDyn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.HasDynamicRegistration</span></span><span> </span><span class="annot"><a href="#local-6989586621679215261"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679215261"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-578"></span><span>    </span><span id="local-6989586621679214029"><span class="annot"><span class="annottext">capDyn :: forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var hs-var">capDyn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679214025"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679214025"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679214025"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasDynamicRegistration s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.dynamicRegistration</span></span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-comment">-- | Checks if client capabilities declares that the method supports dynamic registration</span><span>
</span><span id="line-582"></span><span>    </span><span id="local-6989586621679214067"><span class="annot"><span class="annottext">dynamicSupported :: ClientCapabilities -&gt; Bool
</span><a href="#local-6989586621679214067"><span class="hs-identifier hs-var hs-var">dynamicSupported</span></a></span></span><span> </span><span id="local-6989586621679214023"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><a href="#local-6989586621679214093"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-583"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_WorkspaceDidChangeConfiguration</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasWorkspace s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.workspace</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasDidChangeConfiguration s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.didChangeConfiguration</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-584"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_WorkspaceDidChangeWatchedFiles</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasWorkspace s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.workspace</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasDidChangeWatchedFiles s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.didChangeWatchedFiles</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-585"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_WorkspaceSymbol</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasWorkspace s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.workspace</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasSymbol s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.symbol</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-586"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_WorkspaceExecuteCommand</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasWorkspace s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.workspace</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasExecuteCommand s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.executeCommand</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-587"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentDidOpen</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasSynchronization s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.synchronization</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-588"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentDidChange</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasSynchronization s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.synchronization</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-589"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentDidClose</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasSynchronization s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.synchronization</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-590"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentCompletion</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasCompletion s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.completion</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-591"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentHover</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasHover s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.hover</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-592"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentSignatureHelp</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasSignatureHelp s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.signatureHelp</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-593"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentDeclaration</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasDeclaration s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.declaration</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-594"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentDefinition</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasDefinition s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.definition</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-595"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentTypeDefinition</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTypeDefinition s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.typeDefinition</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-596"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentImplementation</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasImplementation s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.implementation</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-597"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentReferences</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasReferences s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.references</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-598"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentDocumentHighlight</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasDocumentHighlight s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.documentHighlight</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-599"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentDocumentSymbol</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasDocumentSymbol s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.documentSymbol</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-600"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentCodeAction</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasCodeAction s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.codeAction</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-601"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentCodeLens</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasCodeLens s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.codeLens</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-602"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentDocumentLink</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasDocumentLink s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.documentLink</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-603"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentDocumentColor</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasColorProvider s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.colorProvider</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-604"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentColorPresentation</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasColorProvider s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.colorProvider</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-605"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentFormatting</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasFormatting s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.formatting</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-606"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentRangeFormatting</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasRangeFormatting s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.rangeFormatting</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-607"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentOnTypeFormatting</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasOnTypeFormatting s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.onTypeFormatting</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-608"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentRename</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasRename s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.rename</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-609"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentFoldingRange</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasFoldingRange s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.foldingRange</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-610"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentSelectionRange</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasSelectionRange s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.selectionRange</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-611"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier hs-var">SMethod_TextDocumentPrepareCallHierarchy</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasDynamicRegistration a (Maybe Bool) =&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679214029"><span class="hs-identifier hs-var">capDyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679214023"><span class="hs-identifier hs-var">clientCaps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasTextDocument s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.textDocument</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasCallHierarchy s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.callHierarchy</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-612"></span><span>      </span><span class="hs-comment">--SMethod_TextDocumentSemanticTokens       -&gt; capDyn $ clientCaps ^? L.textDocument . _Just . L.semanticTokens . _Just</span><span>
</span><span id="line-613"></span><span>      </span><span class="annot"><span class="annottext">SClientMethod @t m
</span><span class="hs-identifier">_</span></span><span>                                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span class="hs-comment">-- | Sends a @client/unregisterCapability@ request and removes the handler</span><span>
</span><span id="line-616"></span><span class="hs-comment">-- for that associated registration.</span><span>
</span><span id="line-617"></span><span id="local-6989586621679215116"><span id="local-6989586621679215117"><span id="local-6989586621679215118"><span class="annot"><a href="Language.LSP.Server.Core.html#unregisterCapability"><span class="hs-identifier hs-type">unregisterCapability</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215118"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215117"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-type">RegistrationToken</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215116"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215117"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-618"></span><span id="unregisterCapability"><span class="annot"><span class="annottext">unregisterCapability :: forall {t :: MessageKind} config (f :: * -&gt; *)
       (m :: Method 'ClientToServer t).
MonadLsp config f =&gt;
RegistrationToken @t m -&gt; f ()
</span><a href="Language.LSP.Server.Core.html#unregisterCapability"><span class="hs-identifier hs-var hs-var">unregisterCapability</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationToken"><span class="hs-identifier hs-type">RegistrationToken</span></a></span><span> </span><span id="local-6989586621679213496"><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679213496"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#RegistrationId"><span class="hs-identifier hs-type">RegistrationId</span></a></span><span> </span><span id="local-6989586621679213495"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213495"><span class="hs-identifier hs-var">uuid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-619"></span><span>  </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall {t :: MessageKind} (m :: Method 'ClientToServer t).
SClientMethod @t m -&gt; ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">splitClientMethod</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679213496"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientReq</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Request)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsReq"><span class="hs-identifier hs-var">resRegistrationsReq</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {f1 :: MessageDirection} {t1 :: MessageKind}
       {f2 :: MessageDirection} {t2 :: MessageKind} (a :: Method f1 t1)
       (v :: Method f2 t2 -&gt; *).
SMethod @f1 @t1 a -&gt; SMethodMap @f2 @t2 v -&gt; SMethodMap @f2 @t2 v
</span><span class="hs-identifier hs-var">SMethodMap.delete</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679213496"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-621"></span><span>    </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientNot</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextState config -&gt; TVar (RegistrationMap 'Notification)
</span><a href="Language.LSP.Server.Core.html#resRegistrationsNot"><span class="hs-identifier hs-var">resRegistrationsNot</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {f1 :: MessageDirection} {t1 :: MessageKind}
       {f2 :: MessageDirection} {t2 :: MessageKind} (a :: Method f1 t1)
       (v :: Method f2 t2 -&gt; *).
SMethod @f1 @t1 a -&gt; SMethodMap @f2 @t2 v -&gt; SMethodMap @f2 @t2 v
</span><span class="hs-identifier hs-var">SMethodMap.delete</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679213496"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-622"></span><span>    </span><span class="annot"><span class="annottext">ClientNotOrReq @t m
</span><span class="hs-identifier hs-var">IsClientEither</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot unregister capability for custom methods&quot;</span></span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679213479"><span class="annot"><span class="annottext">unregistration :: TUnregistration @t m
</span><a href="#local-6989586621679213479"><span class="hs-identifier hs-var hs-var">unregistration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: MessageKind) (m :: Method 'ClientToServer t).
Text -&gt; SMethod @'ClientToServer @t m -&gt; TUnregistration @t m
</span><span class="hs-identifier hs-var">L.TUnregistration</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213495"><span class="hs-identifier hs-var">uuid</span></a></span><span> </span><span class="annot"><span class="annottext">SMethod @'ClientToServer @t m
</span><a href="#local-6989586621679213496"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-625"></span><span>      </span><span id="local-6989586621679213477"><span class="annot"><span class="annottext">params :: UnregistrationParams
</span><a href="#local-6989586621679213477"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Unregistration] -&gt; UnregistrationParams
</span><span class="hs-identifier hs-var">L.UnregistrationParams</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall {t :: MessageKind} (m :: Method 'ClientToServer t).
TUnregistration @t m -&gt; Unregistration
</span><span class="hs-identifier hs-var">toUntypedUnregistration</span></span><span> </span><span class="annot"><span class="annottext">TUnregistration @t m
</span><a href="#local-6989586621679213479"><span class="hs-identifier hs-var">unregistration</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-626"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Request) (f :: * -&gt; *) config.
MonadLsp config f =&gt;
SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; (Either
      ResponseError (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient m)
</span><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-var">sendRequest</span></a></span><span> </span><span class="annot"><span class="annottext">SMethod
  @'ServerToClient @'Request 'Method_ClientUnregisterCapability
</span><span class="hs-identifier hs-var">SMethod_ClientUnregisterCapability</span></span><span> </span><span class="annot"><span class="annottext">UnregistrationParams
</span><a href="#local-6989586621679213477"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679213472"><span class="annot"><span class="annottext">Either
  ResponseError
  (MessageResult
     @'ServerToClient @'Request 'Method_ClientUnregisterCapability)
</span><a href="#local-6989586621679213472"><span class="hs-identifier hs-var">_res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-629"></span><span class="hs-comment">-- PROGRESS</span><span>
</span><span id="line-630"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span id="local-6989586621679215090"><span id="local-6989586621679215091"><span id="local-6989586621679215092"><span class="annot"><a href="Language.LSP.Server.Core.html#storeProgress"><span class="hs-identifier hs-type">storeProgress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215092"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215091"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProgressToken</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="annot"><a href="#local-6989586621679215090"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215091"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-633"></span><span id="storeProgress"><span class="annot"><span class="annottext">storeProgress :: forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
ProgressToken -&gt; Async a -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#storeProgress"><span class="hs-identifier hs-var hs-var">storeProgress</span></a></span></span><span> </span><span id="local-6989586621679213465"><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213465"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679213464"><span class="annot"><span class="annottext">Async a
</span><a href="#local-6989586621679213464"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProgressData -&gt; TVar (Map ProgressToken (IO ()))
</span><a href="Language.LSP.Server.Core.html#progressCancel"><span class="hs-identifier hs-var">progressCancel</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; ProgressData
</span><a href="Language.LSP.Server.Core.html#resProgressData"><span class="hs-identifier hs-var">resProgressData</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213465"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; Async a -&gt; e -&gt; IO ()
</span><span class="hs-identifier hs-var">cancelWith</span></span><span> </span><span class="annot"><span class="annottext">Async a
</span><a href="#local-6989586621679213464"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ProgressCancelledException
</span><a href="Language.LSP.Server.Core.html#ProgressCancelledException"><span class="hs-identifier hs-var">ProgressCancelledException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#storeProgress"><span class="hs-pragma hs-type">storeProgress</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span id="local-6989586621679215082"><span id="local-6989586621679215083"><span class="annot"><a href="Language.LSP.Server.Core.html#deleteProgress"><span class="hs-identifier hs-type">deleteProgress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215083"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215082"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProgressToken</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215082"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-638"></span><span id="deleteProgress"><span class="annot"><span class="annottext">deleteProgress :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
ProgressToken -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#deleteProgress"><span class="hs-identifier hs-var hs-var">deleteProgress</span></a></span></span><span> </span><span id="local-6989586621679213458"><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213458"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar a) -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#modifyState"><span class="hs-identifier hs-var">modifyState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProgressData -&gt; TVar (Map ProgressToken (IO ()))
</span><a href="Language.LSP.Server.Core.html#progressCancel"><span class="hs-identifier hs-var">progressCancel</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; ProgressData
</span><a href="Language.LSP.Server.Core.html#resProgressData"><span class="hs-identifier hs-var">resProgressData</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213458"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#deleteProgress"><span class="hs-pragma hs-type">deleteProgress</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="hs-comment">-- Get a new id for the progress session and make a new one</span><span>
</span><span id="line-643"></span><span id="local-6989586621679215076"><span id="local-6989586621679215077"><span class="annot"><a href="Language.LSP.Server.Core.html#getNewProgressId"><span class="hs-identifier hs-type">getNewProgressId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215077"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215076"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215076"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProgressToken</span></span></span></span><span>
</span><span id="line-644"></span><span id="getNewProgressId"><span class="annot"><span class="annottext">getNewProgressId :: forall config (m :: * -&gt; *). MonadLsp config m =&gt; m ProgressToken
</span><a href="Language.LSP.Server.Core.html#getNewProgressId"><span class="hs-identifier hs-var hs-var">getNewProgressId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-645"></span><span>  </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProgressData -&gt; TVar Int32
</span><a href="Language.LSP.Server.Core.html#progressNextId"><span class="hs-identifier hs-var">progressNextId</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; ProgressData
</span><a href="Language.LSP.Server.Core.html#resProgressData"><span class="hs-identifier hs-var">resProgressData</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679213451"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679213451"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679213450"><span class="annot"><span class="annottext">next :: Int32
</span><a href="#local-6989586621679213450"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679213451"><span class="hs-identifier hs-var">cur</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">1</span></span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int32 |? Text) -&gt; ProgressToken
</span><span class="hs-identifier hs-var">L.ProgressToken</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; a |? b
</span><span class="hs-identifier hs-var">L.InL</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679213451"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679213450"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#getNewProgressId"><span class="hs-pragma hs-type">getNewProgressId</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span id="local-6989586621679215066"><span id="local-6989586621679215069"><span id="local-6989586621679215070"><span class="annot"><a href="Language.LSP.Server.Core.html#withProgressBase"><span class="hs-identifier hs-type">withProgressBase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215070"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215069"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressCancellable"><span class="hs-identifier hs-type">ProgressCancellable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressAmount"><span class="hs-identifier hs-type">ProgressAmount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215069"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215069"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215066"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215069"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215066"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-652"></span><span id="withProgressBase"><span class="annot"><span class="annottext">withProgressBase :: forall c (m :: * -&gt; *) a.
MonadLsp c m =&gt;
Bool
-&gt; Text
-&gt; ProgressCancellable
-&gt; ((ProgressAmount -&gt; m ()) -&gt; m a)
-&gt; m a
</span><a href="Language.LSP.Server.Core.html#withProgressBase"><span class="hs-identifier hs-var hs-var">withProgressBase</span></a></span></span><span> </span><span id="local-6989586621679213415"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679213415"><span class="hs-identifier hs-var">indefinite</span></a></span></span><span> </span><span id="local-6989586621679213414"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213414"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621679213413"><span class="annot"><span class="annottext">ProgressCancellable
</span><a href="#local-6989586621679213413"><span class="hs-identifier hs-var">cancellable</span></a></span></span><span> </span><span id="local-6989586621679213412"><span class="annot"><span class="annottext">(ProgressAmount -&gt; m ()) -&gt; m a
</span><a href="#local-6989586621679213412"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>  </span><span id="local-6989586621679213411"><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213411"><span class="hs-identifier hs-var">progId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *). MonadLsp config m =&gt; m ProgressToken
</span><a href="Language.LSP.Server.Core.html#getNewProgressId"><span class="hs-identifier hs-var">getNewProgressId</span></a></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679213410"><span class="annot"><span class="annottext">initialPercentage :: Maybe UInt
</span><a href="#local-6989586621679213410"><span class="hs-identifier hs-var hs-var">initialPercentage</span></a></span></span><span>
</span><span id="line-657"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679213415"><span class="hs-identifier hs-var">indefinite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-658"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UInt
</span><span class="hs-number">0</span></span><span>
</span><span id="line-659"></span><span>      </span><span id="local-6989586621679213409"><span class="annot"><span class="annottext">cancellable' :: Bool
</span><a href="#local-6989586621679213409"><span class="hs-identifier hs-var hs-var">cancellable'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProgressCancellable
</span><a href="#local-6989586621679213413"><span class="hs-identifier hs-var">cancellable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-660"></span><span>                      </span><span class="annot"><span class="annottext">ProgressCancellable
</span><a href="Language.LSP.Server.Core.html#Cancellable"><span class="hs-identifier hs-var">Cancellable</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-661"></span><span>                      </span><span class="annot"><span class="annottext">ProgressCancellable
</span><a href="Language.LSP.Server.Core.html#NotCancellable"><span class="hs-identifier hs-var">NotCancellable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span>  </span><span class="hs-comment">-- Create progress token</span><span>
</span><span id="line-664"></span><span>  </span><span class="hs-comment">-- FIXME  : This needs to wait until the request returns before</span><span>
</span><span id="line-665"></span><span>  </span><span class="hs-comment">-- continuing!!!</span><span>
</span><span id="line-666"></span><span>  </span><span class="annot"><span class="annottext">LspId @'ServerToClient 'Method_WindowWorkDoneProgressCreate
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Request) (f :: * -&gt; *) config.
MonadLsp config f =&gt;
SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; (Either
      ResponseError (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient m)
</span><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-var">sendRequest</span></a></span><span> </span><span class="annot"><span class="annottext">SMethod
  @'ServerToClient @'Request 'Method_WindowWorkDoneProgressCreate
</span><span class="hs-identifier hs-var">SMethod_WindowWorkDoneProgressCreate</span></span><span>
</span><span id="line-667"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProgressToken -&gt; WorkDoneProgressCreateParams
</span><span class="hs-identifier hs-var">WorkDoneProgressCreateParams</span></span><span> </span><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213411"><span class="hs-identifier hs-var">progId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679213406"><span class="annot"><span class="annottext">Either
  ResponseError
  (MessageResult
     @'ServerToClient @'Request 'Method_WindowWorkDoneProgressCreate)
</span><a href="#local-6989586621679213406"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  ResponseError
  (MessageResult
     @'ServerToClient @'Request 'Method_WindowWorkDoneProgressCreate)
</span><a href="#local-6989586621679213406"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-669"></span><span>            </span><span class="hs-comment">-- An error occurred when the client was setting it up</span><span>
</span><span id="line-670"></span><span>            </span><span class="hs-comment">-- No need to do anything then, as per the spec</span><span>
</span><span id="line-671"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679213405"><span class="annot"><span class="annottext">ResponseError
</span><a href="#local-6989586621679213405"><span class="hs-identifier hs-var">_err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">MessageResult
  @'ServerToClient @'Request 'Method_WindowWorkDoneProgressCreate
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-comment">-- Send the begin and done notifications via 'bracket_' so that they are always fired</span><span>
</span><span id="line-675"></span><span>  </span><span id="local-6989586621679213404"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679213404"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b
</span><span class="hs-identifier hs-var">withRunInIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679213402"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621679213402"><span class="hs-identifier hs-var">runInBase</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-676"></span><span>    </span><span class="annot"><span class="annottext">forall a b c. IO a -&gt; IO b -&gt; IO c -&gt; IO c
</span><span class="hs-identifier hs-var">E.bracket_</span></span><span>
</span><span id="line-677"></span><span>      </span><span class="hs-comment">-- Send begin notification</span><span>
</span><span id="line-678"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621679213402"><span class="hs-identifier hs-var">runInBase</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Notification) (f :: * -&gt; *)
       config.
MonadLsp config f =&gt;
SServerMethod @'Notification m
-&gt; MessageParams @'ServerToClient @'Notification m -&gt; f ()
</span><a href="Language.LSP.Server.Core.html#sendNotification"><span class="hs-identifier hs-var">sendNotification</span></a></span><span> </span><span class="annot"><span class="annottext">forall {f :: MessageDirection}.
SMethod @f @'Notification ('Method_Progress @f)
</span><span class="hs-identifier hs-var">SMethod_Progress</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-679"></span><span>        </span><span class="annot"><span class="annottext">ProgressToken -&gt; Value -&gt; ProgressParams
</span><span class="hs-identifier hs-var">ProgressParams</span></span><span> </span><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213411"><span class="hs-identifier hs-var">progId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">J.toJSON</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-680"></span><span>          </span><span class="annot"><span class="annottext">AString &quot;begin&quot;
-&gt; Text
-&gt; Maybe Bool
-&gt; Maybe Text
-&gt; Maybe UInt
-&gt; WorkDoneProgressBegin
</span><span class="hs-identifier hs-var">WorkDoneProgressBegin</span></span><span> </span><span class="annot"><span class="annottext">forall (s :: Symbol). KnownSymbol s =&gt; AString s
</span><span class="hs-identifier hs-var">L.AString</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213414"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679213409"><span class="hs-identifier hs-var">cancellable'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe UInt
</span><a href="#local-6989586621679213410"><span class="hs-identifier hs-var">initialPercentage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span>      </span><span class="hs-comment">-- Send end notification</span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621679213402"><span class="hs-identifier hs-var">runInBase</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Notification) (f :: * -&gt; *)
       config.
MonadLsp config f =&gt;
SServerMethod @'Notification m
-&gt; MessageParams @'ServerToClient @'Notification m -&gt; f ()
</span><a href="Language.LSP.Server.Core.html#sendNotification"><span class="hs-identifier hs-var">sendNotification</span></a></span><span> </span><span class="annot"><span class="annottext">forall {f :: MessageDirection}.
SMethod @f @'Notification ('Method_Progress @f)
</span><span class="hs-identifier hs-var">SMethod_Progress</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-684"></span><span>        </span><span class="annot"><span class="annottext">ProgressToken -&gt; Value -&gt; ProgressParams
</span><span class="hs-identifier hs-var">ProgressParams</span></span><span> </span><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213411"><span class="hs-identifier hs-var">progId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">J.toJSON</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AString &quot;end&quot; -&gt; Maybe Text -&gt; WorkDoneProgressEnd
</span><span class="hs-identifier hs-var">WorkDoneProgressEnd</span></span><span> </span><span class="annot"><span class="annottext">forall (s :: Symbol). KnownSymbol s =&gt; AString s
</span><span class="hs-identifier hs-var">L.AString</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span>      </span><span class="hs-comment">-- Run f asynchronously</span><span>
</span><span id="line-687"></span><span>      </span><span id="local-6989586621679213395"><span class="annot"><span class="annottext">Async a
</span><a href="#local-6989586621679213395"><span class="hs-identifier hs-var">aid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO (Async a)
</span><span class="hs-identifier hs-var">async</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621679213402"><span class="hs-identifier hs-var">runInBase</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ProgressAmount -&gt; m ()) -&gt; m a
</span><a href="#local-6989586621679213412"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {config} {f :: * -&gt; *}.
MonadLsp config f =&gt;
ProgressToken -&gt; ProgressAmount -&gt; f ()
</span><a href="#local-6989586621679213393"><span class="hs-identifier hs-var">updater</span></a></span><span> </span><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213411"><span class="hs-identifier hs-var">progId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>      </span><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621679213402"><span class="hs-identifier hs-var">runInBase</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
MonadLsp config m =&gt;
ProgressToken -&gt; Async a -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#storeProgress"><span class="hs-identifier hs-var">storeProgress</span></a></span><span> </span><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213411"><span class="hs-identifier hs-var">progId</span></a></span><span> </span><span class="annot"><span class="annottext">Async a
</span><a href="#local-6989586621679213395"><span class="hs-identifier hs-var">aid</span></a></span><span>
</span><span id="line-689"></span><span>      </span><span class="annot"><span class="annottext">forall a. Async a -&gt; IO a
</span><span class="hs-identifier hs-var">wait</span></span><span> </span><span class="annot"><span class="annottext">Async a
</span><a href="#local-6989586621679213395"><span class="hs-identifier hs-var">aid</span></a></span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-comment">-- Delete the progress cancellation from the map</span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-comment">-- If we don't do this then it's easy to leak things as the map contains any IO action.</span><span>
</span><span id="line-693"></span><span>  </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
ProgressToken -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#deleteProgress"><span class="hs-identifier hs-var">deleteProgress</span></a></span><span> </span><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213411"><span class="hs-identifier hs-var">progId</span></a></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679213404"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679213393"><span class="annot"><span class="annottext">updater :: ProgressToken -&gt; ProgressAmount -&gt; f ()
</span><a href="#local-6989586621679213393"><span class="hs-identifier hs-var hs-var">updater</span></a></span></span><span> </span><span id="local-6989586621679213386"><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213386"><span class="hs-identifier hs-var">progId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressAmount"><span class="hs-identifier hs-type">ProgressAmount</span></a></span><span> </span><span id="local-6989586621679213385"><span class="annot"><span class="annottext">Maybe UInt
</span><a href="#local-6989586621679213385"><span class="hs-identifier hs-var">percentage</span></a></span></span><span> </span><span id="local-6989586621679213384"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679213384"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-697"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Notification) (f :: * -&gt; *)
       config.
MonadLsp config f =&gt;
SServerMethod @'Notification m
-&gt; MessageParams @'ServerToClient @'Notification m -&gt; f ()
</span><a href="Language.LSP.Server.Core.html#sendNotification"><span class="hs-identifier hs-var">sendNotification</span></a></span><span> </span><span class="annot"><span class="annottext">forall {f :: MessageDirection}.
SMethod @f @'Notification ('Method_Progress @f)
</span><span class="hs-identifier hs-var">SMethod_Progress</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ProgressToken -&gt; Value -&gt; ProgressParams
</span><span class="hs-identifier hs-var">ProgressParams</span></span><span> </span><span class="annot"><span class="annottext">ProgressToken
</span><a href="#local-6989586621679213386"><span class="hs-identifier hs-var">progId</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">J.toJSON</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-698"></span><span>              </span><span class="annot"><span class="annottext">AString &quot;report&quot;
-&gt; Maybe Bool -&gt; Maybe Text -&gt; Maybe UInt -&gt; WorkDoneProgressReport
</span><span class="hs-identifier hs-var">WorkDoneProgressReport</span></span><span> </span><span class="annot"><span class="annottext">forall (s :: Symbol). KnownSymbol s =&gt; AString s
</span><span class="hs-identifier hs-var">L.AString</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679213384"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UInt
</span><a href="#local-6989586621679213385"><span class="hs-identifier hs-var">percentage</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="annot"><a href="Language.LSP.Server.Core.html#clientSupportsProgress"><span class="hs-identifier hs-type">clientSupportsProgress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ClientCapabilities</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-701"></span><span id="clientSupportsProgress"><span class="annot"><span class="annottext">clientSupportsProgress :: ClientCapabilities -&gt; Bool
</span><a href="Language.LSP.Server.Core.html#clientSupportsProgress"><span class="hs-identifier hs-var hs-var">clientSupportsProgress</span></a></span></span><span> </span><span id="local-6989586621679213381"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679213381"><span class="hs-identifier hs-var">caps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679213381"><span class="hs-identifier hs-var">caps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasWindow s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.window</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasWorkDoneProgress s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.workDoneProgress</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#clientSupportsProgress"><span class="hs-pragma hs-type">clientSupportsProgress</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span class="hs-comment">-- | Wrapper for reporting progress to the client during a long running</span><span>
</span><span id="line-706"></span><span class="hs-comment">-- task.</span><span>
</span><span id="line-707"></span><span class="hs-comment">-- 'withProgress' @title cancellable f@ starts a new progress reporting</span><span>
</span><span id="line-708"></span><span class="hs-comment">-- session, and finishes it once f is completed.</span><span>
</span><span id="line-709"></span><span class="hs-comment">-- f is provided with an update function that allows it to report on</span><span>
</span><span id="line-710"></span><span class="hs-comment">-- the progress during the session.</span><span>
</span><span id="line-711"></span><span class="hs-comment">-- If @cancellable@ is 'Cancellable', @f@ will be thrown a</span><span>
</span><span id="line-712"></span><span class="hs-comment">-- 'ProgressCancelledException' if the user cancels the action in</span><span>
</span><span id="line-713"></span><span class="hs-comment">-- progress.</span><span>
</span><span id="line-714"></span><span id="local-6989586621679215038"><span id="local-6989586621679215039"><span id="local-6989586621679215040"><span class="annot"><a href="Language.LSP.Server.Core.html#withProgress"><span class="hs-identifier hs-type">withProgress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215040"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215039"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressCancellable"><span class="hs-identifier hs-type">ProgressCancellable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressAmount"><span class="hs-identifier hs-type">ProgressAmount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215039"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215039"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215038"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215039"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215038"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-715"></span><span id="withProgress"><span class="annot"><span class="annottext">withProgress :: forall c (m :: * -&gt; *) a.
MonadLsp c m =&gt;
Text
-&gt; ProgressCancellable -&gt; ((ProgressAmount -&gt; m ()) -&gt; m a) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#withProgress"><span class="hs-identifier hs-var hs-var">withProgress</span></a></span></span><span> </span><span id="local-6989586621679213369"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213369"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621679213368"><span class="annot"><span class="annottext">ProgressCancellable
</span><a href="#local-6989586621679213368"><span class="hs-identifier hs-var">cancellable</span></a></span></span><span> </span><span id="local-6989586621679213367"><span class="annot"><span class="annottext">(ProgressAmount -&gt; m ()) -&gt; m a
</span><a href="#local-6989586621679213367"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-716"></span><span>  </span><span id="local-6989586621679213366"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679213366"><span class="hs-identifier hs-var">clientCaps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-identifier hs-var">getClientCapabilities</span></a></span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ClientCapabilities -&gt; Bool
</span><a href="Language.LSP.Server.Core.html#clientSupportsProgress"><span class="hs-identifier hs-var">clientSupportsProgress</span></a></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679213366"><span class="hs-identifier hs-var">clientCaps</span></a></span><span>
</span><span id="line-718"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall c (m :: * -&gt; *) a.
MonadLsp c m =&gt;
Bool
-&gt; Text
-&gt; ProgressCancellable
-&gt; ((ProgressAmount -&gt; m ()) -&gt; m a)
-&gt; m a
</span><a href="Language.LSP.Server.Core.html#withProgressBase"><span class="hs-identifier hs-var">withProgressBase</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213369"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">ProgressCancellable
</span><a href="#local-6989586621679213368"><span class="hs-identifier hs-var">cancellable</span></a></span><span> </span><span class="annot"><span class="annottext">(ProgressAmount -&gt; m ()) -&gt; m a
</span><a href="#local-6989586621679213367"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-719"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(ProgressAmount -&gt; m ()) -&gt; m a
</span><a href="#local-6989586621679213367"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span class="hs-comment">-- | Same as 'withProgress', but for processes that do not report the</span><span>
</span><span id="line-722"></span><span class="hs-comment">-- precentage complete.</span><span>
</span><span id="line-723"></span><span class="hs-comment">--</span><span>
</span><span id="line-724"></span><span class="hs-comment">-- @since 0.10.0.0</span><span>
</span><span id="line-725"></span><span id="local-6989586621679215032"><span id="local-6989586621679215033"><span id="local-6989586621679215034"><span class="annot"><a href="Language.LSP.Server.Core.html#withIndefiniteProgress"><span class="hs-identifier hs-type">withIndefiniteProgress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215034"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215033"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#ProgressCancellable"><span class="hs-identifier hs-type">ProgressCancellable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215033"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215032"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215033"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215032"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-726"></span><span id="withIndefiniteProgress"><span class="annot"><span class="annottext">withIndefiniteProgress :: forall c (m :: * -&gt; *) a.
MonadLsp c m =&gt;
Text -&gt; ProgressCancellable -&gt; m a -&gt; m a
</span><a href="Language.LSP.Server.Core.html#withIndefiniteProgress"><span class="hs-identifier hs-var hs-var">withIndefiniteProgress</span></a></span></span><span> </span><span id="local-6989586621679213357"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213357"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621679213356"><span class="annot"><span class="annottext">ProgressCancellable
</span><a href="#local-6989586621679213356"><span class="hs-identifier hs-var">cancellable</span></a></span></span><span> </span><span id="local-6989586621679213355"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679213355"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-727"></span><span>  </span><span id="local-6989586621679213354"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679213354"><span class="hs-identifier hs-var">clientCaps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
m ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#getClientCapabilities"><span class="hs-identifier hs-var">getClientCapabilities</span></a></span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ClientCapabilities -&gt; Bool
</span><a href="Language.LSP.Server.Core.html#clientSupportsProgress"><span class="hs-identifier hs-var">clientSupportsProgress</span></a></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679213354"><span class="hs-identifier hs-var">clientCaps</span></a></span><span>
</span><span id="line-729"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall c (m :: * -&gt; *) a.
MonadLsp c m =&gt;
Bool
-&gt; Text
-&gt; ProgressCancellable
-&gt; ((ProgressAmount -&gt; m ()) -&gt; m a)
-&gt; m a
</span><a href="Language.LSP.Server.Core.html#withProgressBase"><span class="hs-identifier hs-var">withProgressBase</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213357"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">ProgressCancellable
</span><a href="#local-6989586621679213356"><span class="hs-identifier hs-var">cancellable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679213355"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679213355"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span class="hs-comment">-- | Aggregate all diagnostics pertaining to a particular version of a document,</span><span>
</span><span id="line-735"></span><span class="hs-comment">-- by source, and sends a @textDocument/publishDiagnostics@ notification with</span><span>
</span><span id="line-736"></span><span class="hs-comment">-- the total (limited by the first parameter) whenever it is updated.</span><span>
</span><span id="line-737"></span><span id="local-6989586621679215027"><span id="local-6989586621679215028"><span class="annot"><a href="Language.LSP.Server.Core.html#publishDiagnostics"><span class="hs-identifier hs-type">publishDiagnostics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215028"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215027"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NormalizedUri</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.Int32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LSP.Diagnostics.html#DiagnosticsBySource"><span class="hs-identifier hs-type">DiagnosticsBySource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215027"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-738"></span><span id="publishDiagnostics"><span class="annot"><span class="annottext">publishDiagnostics :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
Int -&gt; NormalizedUri -&gt; Maybe Int32 -&gt; DiagnosticsBySource -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#publishDiagnostics"><span class="hs-identifier hs-var hs-var">publishDiagnostics</span></a></span></span><span> </span><span id="local-6989586621679213341"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679213341"><span class="hs-identifier hs-var">maxDiagnosticCount</span></a></span></span><span> </span><span id="local-6989586621679213340"><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679213340"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span id="local-6989586621679213339"><span class="annot"><span class="annottext">Maybe Int32
</span><a href="#local-6989586621679213339"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621679213338"><span class="annot"><span class="annottext">DiagnosticsBySource
</span><a href="#local-6989586621679213338"><span class="hs-identifier hs-var">diags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar DiagnosticStore
</span><a href="Language.LSP.Server.Core.html#resDiagnostics"><span class="hs-identifier hs-var">resDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679213337"><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679213337"><span class="hs-identifier hs-var">oldDiags</span></a></span></span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-739"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679213336"><span class="annot"><span class="annottext">newDiags :: DiagnosticStore
</span><a href="#local-6989586621679213336"><span class="hs-identifier hs-var hs-var">newDiags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
-&gt; NormalizedUri
-&gt; Maybe Int32
-&gt; DiagnosticsBySource
-&gt; DiagnosticStore
</span><a href="Language.LSP.Diagnostics.html#updateDiagnostics"><span class="hs-identifier hs-var">updateDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679213337"><span class="hs-identifier hs-var">oldDiags</span></a></span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679213340"><span class="hs-identifier hs-var">uri</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int32
</span><a href="#local-6989586621679213339"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticsBySource
</span><a href="#local-6989586621679213338"><span class="hs-identifier hs-var">diags</span></a></span><span>
</span><span id="line-740"></span><span>      </span><span id="local-6989586621679213334"><span class="annot"><span class="annottext">mdp :: Maybe PublishDiagnosticsParams
</span><a href="#local-6989586621679213334"><span class="hs-identifier hs-var hs-var">mdp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; DiagnosticStore
-&gt; NormalizedUri
-&gt; Maybe PublishDiagnosticsParams
</span><a href="Language.LSP.Diagnostics.html#getDiagnosticParamsFor"><span class="hs-identifier hs-var">getDiagnosticParamsFor</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679213341"><span class="hs-identifier hs-var">maxDiagnosticCount</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679213336"><span class="hs-identifier hs-var">newDiags</span></a></span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679213340"><span class="hs-identifier hs-var">uri</span></a></span><span>
</span><span id="line-741"></span><span>      </span><span id="local-6989586621679213332"><span class="annot"><span class="annottext">act :: m ()
</span><a href="#local-6989586621679213332"><span class="hs-identifier hs-var hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PublishDiagnosticsParams
</span><a href="#local-6989586621679213334"><span class="hs-identifier hs-var">mdp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-742"></span><span>        </span><span class="annot"><span class="annottext">Maybe PublishDiagnosticsParams
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679213331"><span class="annot"><span class="annottext">PublishDiagnosticsParams
</span><a href="#local-6989586621679213331"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-744"></span><span>          </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Notification).
((TMessage @'ServerToClient @'Notification m :: *)
 ~ (TNotificationMessage @'ServerToClient m :: *)) =&gt;
TNotificationMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">L.fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: MessageDirection) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; TNotificationMessage @f m
</span><span class="hs-identifier hs-var">L.TNotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SMethod
  @'ServerToClient
  @'Notification
  'Method_TextDocumentPublishDiagnostics
</span><span class="hs-identifier hs-var">L.SMethod_TextDocumentPublishDiagnostics</span></span><span> </span><span class="annot"><span class="annottext">PublishDiagnosticsParams
</span><a href="#local-6989586621679213331"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-745"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679213332"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679213336"><span class="hs-identifier hs-var">newDiags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="hs-comment">-- | Remove all diagnostics from a particular source, and send the updates to</span><span>
</span><span id="line-750"></span><span class="hs-comment">-- the client.</span><span>
</span><span id="line-751"></span><span id="local-6989586621679215020"><span id="local-6989586621679215021"><span class="annot"><a href="Language.LSP.Server.Core.html#flushDiagnosticsBySource"><span class="hs-identifier hs-type">flushDiagnosticsBySource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215021"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215020"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- ^ Max number of diagnostics to send</span><span>
</span><span id="line-752"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679215020"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-753"></span><span id="flushDiagnosticsBySource"><span class="annot"><span class="annottext">flushDiagnosticsBySource :: forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
Int -&gt; Maybe Text -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#flushDiagnosticsBySource"><span class="hs-identifier hs-var hs-var">flushDiagnosticsBySource</span></a></span></span><span> </span><span id="local-6989586621679213314"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679213314"><span class="hs-identifier hs-var">maxDiagnosticCount</span></a></span></span><span> </span><span id="local-6989586621679213313"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679213313"><span class="hs-identifier hs-var">msource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar DiagnosticStore
</span><a href="Language.LSP.Server.Core.html#resDiagnostics"><span class="hs-identifier hs-var">resDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679213312"><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679213312"><span class="hs-identifier hs-var">oldDiags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679213311"><span class="annot"><span class="annottext">newDiags :: DiagnosticStore
</span><a href="#local-6989586621679213311"><span class="hs-identifier hs-var hs-var">newDiags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagnosticStore -&gt; Maybe Text -&gt; DiagnosticStore
</span><a href="Language.LSP.Diagnostics.html#flushBySource"><span class="hs-identifier hs-var">flushBySource</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679213312"><span class="hs-identifier hs-var">oldDiags</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679213313"><span class="hs-identifier hs-var">msource</span></a></span><span>
</span><span id="line-755"></span><span>      </span><span class="hs-comment">-- Send the updated diagnostics to the client</span><span>
</span><span id="line-756"></span><span>      </span><span id="local-6989586621679213309"><span class="annot"><span class="annottext">act :: m ()
</span><a href="#local-6989586621679213309"><span class="hs-identifier hs-var hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">HM.keys</span></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679213311"><span class="hs-identifier hs-var">newDiags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679213306"><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679213306"><span class="hs-identifier hs-var">uri</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679213305"><span class="annot"><span class="annottext">mdp :: Maybe PublishDiagnosticsParams
</span><a href="#local-6989586621679213305"><span class="hs-identifier hs-var hs-var">mdp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; DiagnosticStore
-&gt; NormalizedUri
-&gt; Maybe PublishDiagnosticsParams
</span><a href="Language.LSP.Diagnostics.html#getDiagnosticParamsFor"><span class="hs-identifier hs-var">getDiagnosticParamsFor</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679213314"><span class="hs-identifier hs-var">maxDiagnosticCount</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679213311"><span class="hs-identifier hs-var">newDiags</span></a></span><span> </span><span class="annot"><span class="annottext">NormalizedUri
</span><a href="#local-6989586621679213306"><span class="hs-identifier hs-var">uri</span></a></span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PublishDiagnosticsParams
</span><a href="#local-6989586621679213305"><span class="hs-identifier hs-var">mdp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-759"></span><span>          </span><span class="annot"><span class="annottext">Maybe PublishDiagnosticsParams
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679213304"><span class="annot"><span class="annottext">PublishDiagnosticsParams
</span><a href="#local-6989586621679213304"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-761"></span><span>            </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Notification).
((TMessage @'ServerToClient @'Notification m :: *)
 ~ (TNotificationMessage @'ServerToClient m :: *)) =&gt;
TNotificationMessage @'ServerToClient m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">L.fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: MessageDirection) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; TNotificationMessage @f m
</span><span class="hs-identifier hs-var">L.TNotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SMethod
  @'ServerToClient
  @'Notification
  'Method_TextDocumentPublishDiagnostics
</span><span class="hs-identifier hs-var">L.SMethod_TextDocumentPublishDiagnostics</span></span><span> </span><span class="annot"><span class="annottext">PublishDiagnosticsParams
</span><a href="#local-6989586621679213304"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-762"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679213309"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DiagnosticStore
</span><a href="#local-6989586621679213311"><span class="hs-identifier hs-var">newDiags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="hs-comment">-- ---------------------------------------------------------------------</span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span class="hs-comment">-- | The changes in a workspace edit should be applied from the end of the file</span><span>
</span><span id="line-767"></span><span class="hs-comment">-- toward the start. Sort them into this order.</span><span>
</span><span id="line-768"></span><span class="annot"><a href="Language.LSP.Server.Core.html#reverseSortEdit"><span class="hs-identifier hs-type">reverseSortEdit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.WorkspaceEdit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.WorkspaceEdit</span></span><span>
</span><span id="line-769"></span><span id="reverseSortEdit"><span class="annot"><span class="annottext">reverseSortEdit :: WorkspaceEdit -&gt; WorkspaceEdit
</span><a href="Language.LSP.Server.Core.html#reverseSortEdit"><span class="hs-identifier hs-var hs-var">reverseSortEdit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.WorkspaceEdit</span></span><span> </span><span id="local-6989586621679213301"><span class="annot"><span class="annottext">Maybe (Map Uri [TextEdit])
</span><a href="#local-6989586621679213301"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621679213300"><span class="annot"><span class="annottext">Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
</span><a href="#local-6989586621679213300"><span class="hs-identifier hs-var">dcs</span></a></span></span><span> </span><span id="local-6989586621679213299"><span class="annot"><span class="annottext">Maybe (Map ChangeAnnotationIdentifier ChangeAnnotation)
</span><a href="#local-6989586621679213299"><span class="hs-identifier hs-var">anns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Map Uri [TextEdit])
-&gt; Maybe
     [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
-&gt; Maybe (Map ChangeAnnotationIdentifier ChangeAnnotation)
-&gt; WorkspaceEdit
</span><span class="hs-identifier hs-var">L.WorkspaceEdit</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Map Uri [TextEdit])
</span><a href="#local-6989586621679213298"><span class="hs-identifier hs-var">cs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
</span><a href="#local-6989586621679213297"><span class="hs-identifier hs-var">dcs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Map ChangeAnnotationIdentifier ChangeAnnotation)
</span><a href="#local-6989586621679213299"><span class="hs-identifier hs-var">anns</span></a></span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-771"></span><span>    </span><span class="annot"><a href="#local-6989586621679213298"><span class="hs-identifier hs-type">cs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Uri</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TextEdit</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>    </span><span id="local-6989586621679213298"><span class="annot"><span class="annottext">cs' :: Maybe (Map Uri [TextEdit])
</span><a href="#local-6989586621679213298"><span class="hs-identifier hs-var hs-var">cs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TextEdit] -&gt; [TextEdit]
</span><a href="#local-6989586621679213296"><span class="hs-identifier hs-var">sortTextEdits</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Map Uri [TextEdit])
</span><a href="#local-6989586621679213301"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span>    </span><span class="annot"><a href="#local-6989586621679213297"><span class="hs-identifier hs-type">dcs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.DocumentChange</span></span><span class="hs-special">]</span><span>
</span><span id="line-775"></span><span>    </span><span id="local-6989586621679213297"><span class="annot"><span class="annottext">dcs' :: Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
</span><a href="#local-6989586621679213297"><span class="hs-identifier hs-var hs-var">dcs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile)))
-&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))
</span><a href="#local-6989586621679213294"><span class="hs-identifier hs-var">sortOnlyTextDocumentEdits</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  [TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))]
</span><a href="#local-6989586621679213300"><span class="hs-identifier hs-var">dcs</span></a></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>    </span><span class="annot"><a href="#local-6989586621679213296"><span class="hs-identifier hs-type">sortTextEdits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.TextEdit</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.TextEdit</span></span><span class="hs-special">]</span><span>
</span><span id="line-778"></span><span>    </span><span id="local-6989586621679213296"><span class="annot"><span class="annottext">sortTextEdits :: [TextEdit] -&gt; [TextEdit]
</span><a href="#local-6989586621679213296"><span class="hs-identifier hs-var hs-var">sortTextEdits</span></a></span></span><span> </span><span id="local-6989586621679213293"><span class="annot"><span class="annottext">[TextEdit]
</span><a href="#local-6989586621679213293"><span class="hs-identifier hs-var">edits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Down a
</span><span class="hs-identifier hs-var">Down</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasRange s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.range</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TextEdit]
</span><a href="#local-6989586621679213293"><span class="hs-identifier hs-var">edits</span></a></span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span>    </span><span class="annot"><a href="#local-6989586621679213294"><span class="hs-identifier hs-type">sortOnlyTextDocumentEdits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.DocumentChange</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.DocumentChange</span></span><span>
</span><span id="line-781"></span><span>    </span><span id="local-6989586621679213294"><span class="annot"><span class="annottext">sortOnlyTextDocumentEdits :: (TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile)))
-&gt; TextDocumentEdit |? (CreateFile |? (RenameFile |? DeleteFile))
</span><a href="#local-6989586621679213294"><span class="hs-identifier hs-var hs-var">sortOnlyTextDocumentEdits</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.InL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.TextDocumentEdit</span></span><span> </span><span id="local-6989586621679213289"><span class="annot"><span class="annottext">OptionalVersionedTextDocumentIdentifier
</span><a href="#local-6989586621679213289"><span class="hs-identifier hs-var">td</span></a></span></span><span> </span><span id="local-6989586621679213288"><span class="annot"><span class="annottext">[TextEdit |? AnnotatedTextEdit]
</span><a href="#local-6989586621679213288"><span class="hs-identifier hs-var">edits</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; a |? b
</span><span class="hs-identifier hs-var">L.InL</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OptionalVersionedTextDocumentIdentifier
-&gt; [TextEdit |? AnnotatedTextEdit] -&gt; TextDocumentEdit
</span><span class="hs-identifier hs-var">L.TextDocumentEdit</span></span><span> </span><span class="annot"><span class="annottext">OptionalVersionedTextDocumentIdentifier
</span><a href="#local-6989586621679213289"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">[TextEdit |? AnnotatedTextEdit]
</span><a href="#local-6989586621679213287"><span class="hs-identifier hs-var">edits'</span></a></span><span>
</span><span id="line-782"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-783"></span><span>        </span><span id="local-6989586621679213287"><span class="annot"><span class="annottext">edits' :: [TextEdit |? AnnotatedTextEdit]
</span><a href="#local-6989586621679213287"><span class="hs-identifier hs-var hs-var">edits'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Down a
</span><span class="hs-identifier hs-var">Down</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TextEdit |? AnnotatedTextEdit) -&gt; Range
</span><a href="#local-6989586621679213286"><span class="hs-identifier hs-var">editRange</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TextEdit |? AnnotatedTextEdit]
</span><a href="#local-6989586621679213288"><span class="hs-identifier hs-var">edits</span></a></span><span>
</span><span id="line-784"></span><span>    </span><span class="annot"><a href="#local-6989586621679213294"><span class="hs-identifier hs-var">sortOnlyTextDocumentEdits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.InR</span></span><span> </span><span id="local-6989586621679213284"><span class="annot"><span class="annottext">CreateFile |? (RenameFile |? DeleteFile)
</span><a href="#local-6989586621679213284"><span class="hs-identifier hs-var">others</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; a |? b
</span><span class="hs-identifier hs-var">L.InR</span></span><span> </span><span class="annot"><span class="annottext">CreateFile |? (RenameFile |? DeleteFile)
</span><a href="#local-6989586621679213284"><span class="hs-identifier hs-var">others</span></a></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span>    </span><span class="annot"><a href="#local-6989586621679213286"><span class="hs-identifier hs-type">editRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.TextEdit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">L.|?</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.AnnotatedTextEdit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.Range</span></span><span>
</span><span id="line-787"></span><span>    </span><span id="local-6989586621679213286"><span class="annot"><span class="annottext">editRange :: (TextEdit |? AnnotatedTextEdit) -&gt; Range
</span><a href="#local-6989586621679213286"><span class="hs-identifier hs-var hs-var">editRange</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.InR</span></span><span> </span><span id="local-6989586621679213283"><span class="annot"><span class="annottext">AnnotatedTextEdit
</span><a href="#local-6989586621679213283"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedTextEdit
</span><a href="#local-6989586621679213283"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasRange s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.range</span></span><span>
</span><span id="line-788"></span><span>    </span><span class="annot"><a href="#local-6989586621679213286"><span class="hs-identifier hs-var">editRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L.InL</span></span><span> </span><span id="local-6989586621679213282"><span class="annot"><span class="annottext">TextEdit
</span><a href="#local-6989586621679213282"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TextEdit
</span><a href="#local-6989586621679213282"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasRange s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.range</span></span><span>
</span><span id="line-789"></span><span>
</span><span id="line-790"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-791"></span><span class="hs-comment">-- CONFIG</span><span>
</span><span id="line-792"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span class="hs-comment">-- | Given a new config object, try to update our config with it.</span><span>
</span><span id="line-795"></span><span id="local-6989586621679214996"><span id="local-6989586621679214997"><span class="annot"><a href="Language.LSP.Server.Core.html#tryChangeConfig"><span class="hs-identifier hs-type">tryChangeConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679214997"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspM"><span class="hs-identifier hs-type">LspM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214996"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679214997"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-type">LspCoreLog</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">J.Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214997"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-796"></span><span id="tryChangeConfig"><span class="annot"><span class="annottext">tryChangeConfig :: forall (m :: * -&gt; *) config.
((m :: (* -&gt; *)) ~ (LspM config :: (* -&gt; *))) =&gt;
LogAction m (WithSeverity LspCoreLog) -&gt; Value -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#tryChangeConfig"><span class="hs-identifier hs-var hs-var">tryChangeConfig</span></a></span></span><span> </span><span id="local-6989586621679213263"><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679213263"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621679213262"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679213262"><span class="hs-identifier hs-var">newConfigObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-797"></span><span>  </span><span id="local-6989586621679213261"><span class="annot"><span class="annottext">config -&gt; Value -&gt; Either Text config
</span><a href="#local-6989586621679213261"><span class="hs-identifier hs-var">parseCfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">forall config.
LanguageContextEnv config -&gt; config -&gt; Value -&gt; Either Text config
</span><a href="Language.LSP.Server.Core.html#resParseConfig"><span class="hs-identifier hs-var">resParseConfig</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span id="local-6989586621679213259"><span class="annot"><span class="annottext">Either Text config
</span><a href="#local-6989586621679213259"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) s a.
MonadLsp config m =&gt;
(LanguageContextState config -&gt; TVar s) -&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="Language.LSP.Server.Core.html#stateState"><span class="hs-identifier hs-var">stateState</span></a></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextState config -&gt; TVar config
</span><a href="Language.LSP.Server.Core.html#resConfig"><span class="hs-identifier hs-var">resConfig</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679213258"><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679213258"><span class="hs-identifier hs-var">oldConfig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">config -&gt; Value -&gt; Either Text config
</span><a href="#local-6989586621679213261"><span class="hs-identifier hs-var">parseCfg</span></a></span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679213258"><span class="hs-identifier hs-var">oldConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679213262"><span class="hs-identifier hs-var">newConfigObject</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-799"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679213257"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213257"><span class="hs-identifier hs-var">err</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213257"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679213258"><span class="hs-identifier hs-var">oldConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679213256"><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679213256"><span class="hs-identifier hs-var">newConfig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679213256"><span class="hs-identifier hs-var">newConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679213256"><span class="hs-identifier hs-var">newConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Text config
</span><a href="#local-6989586621679213259"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-802"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679213255"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213255"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-803"></span><span>      </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679213263"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Text -&gt; LspCoreLog
</span><a href="Language.LSP.Server.Core.html#ConfigurationParseError"><span class="hs-identifier hs-var">ConfigurationParseError</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679213262"><span class="hs-identifier hs-var">newConfigObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213255"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Warning</span></span><span>
</span><span id="line-804"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679213252"><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679213252"><span class="hs-identifier hs-var">newConfig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-805"></span><span>      </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679213263"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; LspCoreLog
</span><a href="Language.LSP.Server.Core.html#NewConfig"><span class="hs-identifier hs-var">NewConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679213262"><span class="hs-identifier hs-var">newConfigObject</span></a></span><span> </span><span class="annot"><span class="annottext">forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-806"></span><span>      </span><span id="local-6989586621679213250"><span class="annot"><span class="annottext">config -&gt; IO ()
</span><a href="#local-6989586621679213250"><span class="hs-identifier hs-var">cb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; config -&gt; IO ()
</span><a href="Language.LSP.Server.Core.html#resOnConfigChange"><span class="hs-identifier hs-var">resOnConfigChange</span></a></span><span>
</span><span id="line-807"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">config -&gt; IO ()
</span><a href="#local-6989586621679213250"><span class="hs-identifier hs-var">cb</span></a></span><span> </span><span class="annot"><span class="annottext">config
</span><a href="#local-6989586621679213252"><span class="hs-identifier hs-var">newConfig</span></a></span><span>
</span><span id="line-808"></span><span>
</span><span id="line-809"></span><span class="hs-comment">-- | Send a `worksapce/configuration` request to update the server's config.</span><span>
</span><span id="line-810"></span><span class="hs-comment">--</span><span>
</span><span id="line-811"></span><span class="hs-comment">-- This is called automatically in response to `workspace/didChangeConfiguration` notifications</span><span>
</span><span id="line-812"></span><span class="hs-comment">-- from the client, so should not normally be called manually.</span><span>
</span><span id="line-813"></span><span id="local-6989586621679214982"><span id="local-6989586621679214983"><span class="annot"><a href="Language.LSP.Server.Core.html#requestConfigUpdate"><span class="hs-identifier hs-type">requestConfigUpdate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679214983"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspM"><span class="hs-identifier hs-type">LspM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214982"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679214983"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html#LspCoreLog"><span class="hs-identifier hs-type">LspCoreLog</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214983"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-814"></span><span id="requestConfigUpdate"><span class="annot"><span class="annottext">requestConfigUpdate :: forall (m :: * -&gt; *) config.
((m :: (* -&gt; *)) ~ (LspM config :: (* -&gt; *))) =&gt;
LogAction m (WithSeverity LspCoreLog) -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#requestConfigUpdate"><span class="hs-identifier hs-var hs-var">requestConfigUpdate</span></a></span></span><span> </span><span id="local-6989586621679213223"><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679213223"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-815"></span><span>  </span><span id="local-6989586621679213222"><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679213222"><span class="hs-identifier hs-var">caps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; ClientCapabilities
</span><a href="Language.LSP.Server.Core.html#resClientCapabilities"><span class="hs-identifier hs-var">resClientCapabilities</span></a></span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679213221"><span class="annot"><span class="annottext">supportsConfiguration :: Bool
</span><a href="#local-6989586621679213221"><span class="hs-identifier hs-var hs-var">supportsConfiguration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientCapabilities
</span><a href="#local-6989586621679213222"><span class="hs-identifier hs-var">caps</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasWorkspace s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.workspace</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. HasConfiguration s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">L.configuration</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679213221"><span class="hs-identifier hs-var">supportsConfiguration</span></a></span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-819"></span><span>    </span><span id="local-6989586621679213219"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213219"><span class="hs-identifier hs-var">section</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall config (m :: * -&gt; *) a.
ReaderT (LanguageContextEnv config) m a -&gt; LspT config m a
</span><a href="Language.LSP.Server.Core.html#LspT"><span class="hs-identifier hs-var">LspT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">forall config. LanguageContextEnv config -&gt; Text
</span><a href="Language.LSP.Server.Core.html#resConfigSection"><span class="hs-identifier hs-var">resConfigSection</span></a></span><span>
</span><span id="line-820"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: Method 'ServerToClient 'Request) (f :: * -&gt; *) config.
MonadLsp config f =&gt;
SServerMethod @'Request m
-&gt; MessageParams @'ServerToClient @'Request m
-&gt; (Either
      ResponseError (MessageResult @'ServerToClient @'Request m)
    -&gt; f ())
-&gt; f (LspId @'ServerToClient m)
</span><a href="Language.LSP.Server.Core.html#sendRequest"><span class="hs-identifier hs-var">sendRequest</span></a></span><span> </span><span class="annot"><span class="annottext">SMethod @'ServerToClient @'Request 'Method_WorkspaceConfiguration
</span><span class="hs-identifier hs-var">SMethod_WorkspaceConfiguration</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ConfigurationItem] -&gt; ConfigurationParams
</span><span class="hs-identifier hs-var">ConfigurationParams</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe Text -&gt; Maybe Text -&gt; ConfigurationItem
</span><span class="hs-identifier hs-var">ConfigurationItem</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679213219"><span class="hs-identifier hs-var">section</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-821"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679213215"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679213215"><span class="hs-identifier hs-var">newConfigObject</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) config.
((m :: (* -&gt; *)) ~ (LspM config :: (* -&gt; *))) =&gt;
LogAction m (WithSeverity LspCoreLog) -&gt; Value -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#tryChangeConfig"><span class="hs-identifier hs-var">tryChangeConfig</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679213223"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679213215"><span class="hs-identifier hs-var">newConfigObject</span></a></span><span>
</span><span id="line-822"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679213214"><span class="annot"><span class="annottext">MessageResult
  @'ServerToClient @'Request 'Method_WorkspaceConfiguration
</span><a href="#local-6989586621679213214"><span class="hs-identifier hs-var">sections</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679213223"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; LspCoreLog
</span><a href="Language.LSP.Server.Core.html#WrongConfigSections"><span class="hs-identifier hs-var">WrongConfigSections</span></a></span><span> </span><span class="annot"><span class="annottext">MessageResult
  @'ServerToClient @'Request 'Method_WorkspaceConfiguration
</span><a href="#local-6989586621679213214"><span class="hs-identifier hs-var">sections</span></a></span><span> </span><span class="annot"><span class="annottext">forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span>
</span><span id="line-823"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679213212"><span class="annot"><span class="annottext">ResponseError
</span><a href="#local-6989586621679213212"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679213223"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ResponseError -&gt; LspCoreLog
</span><a href="Language.LSP.Server.Core.html#BadConfigurationResponse"><span class="hs-identifier hs-var">BadConfigurationResponse</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseError
</span><a href="#local-6989586621679213212"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-keyword">else</span><span>
</span><span id="line-825"></span><span>    </span><span class="annot"><span class="annottext">LogAction m (WithSeverity LspCoreLog)
</span><a href="#local-6989586621679213223"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) msg. LogAction m msg -&gt; msg -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&amp;</span></span><span> </span><span class="annot"><span class="annottext">LspCoreLog
</span><a href="Language.LSP.Server.Core.html#ConfigurationNotSupported"><span class="hs-identifier hs-var">ConfigurationNotSupported</span></a></span><span> </span><span class="annot"><span class="annottext">forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-operator hs-var">`WithSeverity`</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span class="hs-comment">{- Note [LSP configuration]
LSP configuration is a huge mess.
- The configuration model of the client is not specified
- Many of the configuration messages are not specified in what they should return

In particular, configuration appears in three places:
1. The `initializationOptions` field of the `initialize` request.
  - The contents of this are unspecified. &quot;User provided initialization options&quot;.
2. The `settings` field of the `workspace/didChangeConfiguration` notification.
  - The contents of this are unspecified. &quot;The actual changed settings&quot;.
3. The `section` field of the response to the `workspace/configuration` request.
  - This at least says it should be the settings corresponding to the sections
    specified in the request.

It's very hard to know what to do here. In particular, the first two cases seem
like they could include arbitrary configuration from the client that might not
relate to you. How you locate &quot;your&quot; settings is unclear.

We are on firmer ground with case 3. Then at least it seems that we can pick
a configuration section, just always ask for that, and require clients to use
that for our settings. Furthermore, this is the method that is encouraged by the
specification designers: https://github.com/microsoft/language-server-protocol/issues/567#issuecomment-420589320.

For this reason we mostly try and rely on `workspace/configuration`. That means
three things:
- We require servers to give a specific configuration section for us to use
  when requesting configuration.
- We can try and make sense of `initializationOptions`, but regardless we should
  send a `workspace/configuration` request afterwards (in the handler for the
  `initialized` notification, which is the earliest we can send messages:
  https://github.com/microsoft/language-server-protocol/issues/567#issuecomment-953772465)
- We can try and make sense of `didChangeConfiguration`, but regardless we should
  send a `workspace/configuration` request afterwards

We do try to make sense of the first two cases also, especially because clients do
not have to support `workspace/configuration`! In practice,
many clients seem to follow the sensible approach laid out here:
https://github.com/microsoft/language-server-protocol/issues/972#issuecomment-626668243

To make this work, we try to be tolerant by using the following strategy.
When we receive a configuration object from any of the sources above, we first
check to see if it has a field corresponding to our configuration section. If it
does, then we assume that it our config and try to parse it. If it does not, we
try to parse the entire config object. This hopefully lets us handle a variety
of sensible cases where the client sends us mostly our config, either wrapped
in our section or not.
-}</span><span>
</span><span id="line-874"></span></pre></body></html>