<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | This module uses template Haskell. Following is a simplified explanation of usage for those unfamiliar with calling Template Haskell functions.</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- The function @embedFile@ in this modules embeds a file into the executable</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- that you can use it at runtime. A file is represented as a @ByteString@.</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- However, as you can see below, the type signature indicates a value of type</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- @Q Exp@ will be returned. In order to convert this into a @ByteString@, you</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- must use Template Haskell syntax, e.g.:</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- &gt; $(embedFile &quot;myfile.txt&quot;)</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- This expression will have type @ByteString@. Be certain to enable the</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- TemplateHaskell language extension, usually by adding the following to the</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- top of your module:</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- &gt; {-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-19"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.FileEmbed</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Embed at compile time</span></span><span>
</span><span id="line-21"></span><span>      </span><span class="annot"><a href="Data.FileEmbed.html#embedFile"><span class="hs-identifier">embedFile</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#embedFileIfExists"><span class="hs-identifier">embedFileIfExists</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#embedOneFileOf"><span class="hs-identifier">embedOneFileOf</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#embedDir"><span class="hs-identifier">embedDir</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#embedDirListing"><span class="hs-identifier">embedDirListing</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#getDir"><span class="hs-identifier">getDir</span></a></span><span>
</span><span id="line-27"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Embed as a IsString</span></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#embedStringFile"><span class="hs-identifier">embedStringFile</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#embedOneStringFileOf"><span class="hs-identifier">embedOneStringFileOf</span></a></span><span>
</span><span id="line-30"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Inject into an executable</span></span><span>
</span><span id="line-31"></span><span>      </span><span class="annot"><span class="hs-comment">-- $inject</span></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,5,0)
</span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#dummySpace"><span class="hs-identifier">dummySpace</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#dummySpaceWith"><span class="hs-identifier">dummySpaceWith</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#inject"><span class="hs-identifier">inject</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#injectFile"><span class="hs-identifier">injectFile</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#injectWith"><span class="hs-identifier">injectWith</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#injectFileWith"><span class="hs-identifier">injectFileWith</span></a></span><span>
</span><span id="line-40"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Relative path manipulation</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#makeRelativeToProject"><span class="hs-identifier">makeRelativeToProject</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#makeRelativeToLocationPredicate"><span class="hs-identifier">makeRelativeToLocationPredicate</span></a></span><span>
</span><span id="line-43"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Internal</span></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#stringToBs"><span class="hs-identifier">stringToBs</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#bsToExp"><span class="hs-identifier">bsToExp</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.FileEmbed.html#strToExp"><span class="hs-identifier">strToExp</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Exp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AppE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ListE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">LitE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TupE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SigE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">VarE</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Lit</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Q</span></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runIO</span></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">qLocation</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">loc_filename</span></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,7,0)
</span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Quasi</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">qAddDependentFile</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,16,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">mkBytes</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">bytesPrimL</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Internal</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">doesDirectoryExist</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">doesFileExist</span></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>                         </span><span class="annot"><span class="hs-identifier">getDirectoryContents</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">canonicalizePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throw</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tryJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ErrorCall</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">filterM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">guard</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B8</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&amp;&amp;&amp;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;$&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePackAddressLen</span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isDoesNotExistError</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeDirectory</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeExtension</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sortBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- | Embed a single file in your source code.</span><span>
</span><span id="line-81"></span><span class="hs-comment">--</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- &gt; import qualified Data.ByteString</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- &gt; myFile :: Data.ByteString.ByteString</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- &gt; myFile = $(embedFile &quot;dirName/fileName&quot;)</span><span>
</span><span id="line-86"></span><span class="annot"><a href="Data.FileEmbed.html#embedFile"><span class="hs-identifier hs-type">embedFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-87"></span><span id="embedFile"><span class="annot"><span class="annottext">embedFile :: [Char] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#embedFile"><span class="hs-identifier hs-var hs-var">embedFile</span></a></span></span><span> </span><span id="local-6989586621679047089"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047089"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,7,0)
</span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; [Char] -&gt; m ()
</span><span class="hs-identifier hs-var">qAddDependentFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047089"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IO a -&gt; Q a
</span><span class="hs-identifier hs-var">runIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ByteString
</span><span class="hs-identifier hs-var">B.readFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047089"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Q Exp
</span><a href="Data.FileEmbed.html#bsToExp"><span class="hs-identifier hs-var">bsToExp</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | Maybe embed a single file in your source code depending on whether or not file exists.</span><span>
</span><span id="line-94"></span><span class="hs-comment">--</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- Warning: When a build is compiled with the file missing, a recompile when the file exists might not trigger an embed of the file.</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- You might try to fix this by doing a clean build.</span><span>
</span><span id="line-97"></span><span class="hs-comment">--</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- &gt; import qualified Data.ByteString</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- &gt; maybeMyFile :: Maybe Data.ByteString.ByteString</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- &gt; maybeMyFile = $(embedFileIfExists &quot;dirName/fileName&quot;)</span><span>
</span><span id="line-102"></span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- @since 0.0.14.0</span><span>
</span><span id="line-104"></span><span class="annot"><a href="Data.FileEmbed.html#embedFileIfExists"><span class="hs-identifier hs-type">embedFileIfExists</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-105"></span><span id="embedFileIfExists"><span class="annot"><span class="annottext">embedFileIfExists :: [Char] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#embedFileIfExists"><span class="hs-identifier hs-var hs-var">embedFileIfExists</span></a></span></span><span> </span><span id="local-6989586621679047087"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047087"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621679047086"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679047086"><span class="hs-identifier hs-var">mbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; Q a
</span><span class="hs-identifier hs-var">runIO</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe ByteString)
</span><a href="#local-6989586621679047085"><span class="hs-identifier hs-var">maybeFile</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679047086"><span class="hs-identifier hs-var">mbs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679047084"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047084"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,7,0)
</span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; [Char] -&gt; m ()
</span><span class="hs-identifier hs-var">qAddDependentFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047087"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-cpp">
#endif
</span><span>      </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">bsToExp</span><span> </span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><a href="#local-6989586621679047085"><span class="hs-identifier hs-type">maybeFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679047085"><span class="annot"><span class="annottext">maybeFile :: IO (Maybe ByteString)
</span><a href="#local-6989586621679047085"><span class="hs-identifier hs-var hs-var">maybeFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><span class="annottext">forall e b a.
Exception e =&gt;
(e -&gt; Maybe b) -&gt; IO a -&gt; IO (Either b a)
</span><span class="hs-identifier hs-var">tryJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IOError -&gt; Bool
</span><span class="hs-identifier hs-var">isDoesNotExistError</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; IO ByteString
</span><span class="hs-identifier hs-var">B.readFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047087"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">-- | Embed a single existing file in your source code</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- out of list a list of paths supplied.</span><span>
</span><span id="line-122"></span><span class="hs-comment">--</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- &gt; import qualified Data.ByteString</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- &gt; myFile :: Data.ByteString.ByteString</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- &gt; myFile = $(embedOneFileOf [ &quot;dirName/fileName&quot;, &quot;src/dirName/fileName&quot; ])</span><span>
</span><span id="line-127"></span><span class="annot"><a href="Data.FileEmbed.html#embedOneFileOf"><span class="hs-identifier hs-type">embedOneFileOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-128"></span><span id="embedOneFileOf"><span class="annot"><span class="annottext">embedOneFileOf :: [[Char]] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#embedOneFileOf"><span class="hs-identifier hs-var hs-var">embedOneFileOf</span></a></span></span><span> </span><span id="local-6989586621679047080"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047080"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IO a -&gt; Q a
</span><span class="hs-identifier hs-var">runIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO ([Char], ByteString)
</span><a href="#local-6989586621679047079"><span class="hs-identifier hs-var">readExistingFile</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047080"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621679047078"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047078"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679047077"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047077"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,7,0)
</span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; [Char] -&gt; m ()
</span><span class="hs-identifier hs-var">qAddDependentFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047078"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Q Exp
</span><a href="Data.FileEmbed.html#bsToExp"><span class="hs-identifier hs-var">bsToExp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047077"><span class="hs-identifier hs-var">content</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="#local-6989586621679047079"><span class="hs-identifier hs-type">readExistingFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679047079"><span class="annot"><span class="annottext">readExistingFile :: [[Char]] -&gt; IO ([Char], ByteString)
</span><a href="#local-6989586621679047079"><span class="hs-identifier hs-var hs-var">readExistingFile</span></a></span></span><span> </span><span id="local-6989586621679047076"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047076"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>      </span><span id="local-6989586621679047075"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047075"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047076"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047075"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679047074"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047074"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[[Char]]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ByteString
</span><span class="hs-identifier hs-var">B.readFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047074"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679047073"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047073"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047074"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047073"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="annottext">[[Char]]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ErrorCall
</span><span class="hs-identifier hs-var">ErrorCall</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot find file to embed as resource&quot;</span></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">-- | Embed a directory recursively in your source code.</span><span>
</span><span id="line-143"></span><span class="hs-comment">--</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- &gt; import qualified Data.ByteString</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- &gt; myDir :: [(FilePath, Data.ByteString.ByteString)]</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- &gt; myDir = $(embedDir &quot;dirName&quot;)</span><span>
</span><span id="line-148"></span><span class="annot"><a href="Data.FileEmbed.html#embedDir"><span class="hs-identifier hs-type">embedDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-149"></span><span id="embedDir"><span class="annot"><span class="annottext">embedDir :: [Char] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#embedDir"><span class="hs-identifier hs-var hs-var">embedDir</span></a></span></span><span> </span><span id="local-6989586621679047071"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047071"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679047070"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679047070"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621679047069"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679047069"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IO a -&gt; Q a
</span><span class="hs-identifier hs-var">runIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO [([Char], ByteString)]
</span><a href="Data.FileEmbed.html#fileList"><span class="hs-identifier hs-var">fileList</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047071"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ([Char], ByteString) -&gt; Q Exp
</span><a href="Data.FileEmbed.html#pairToExp"><span class="hs-identifier hs-var">pairToExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047071"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Type -&gt; Exp
</span><span class="hs-identifier hs-var">SigE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679047069"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679047070"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Embed a directory listing recursively in your source code.</span><span>
</span><span id="line-155"></span><span class="hs-comment">--</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- &gt; myFiles :: [FilePath]</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- &gt; myFiles = $(embedDirListing &quot;dirName&quot;)</span><span>
</span><span id="line-158"></span><span class="hs-comment">--</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- @since 0.0.11</span><span>
</span><span id="line-160"></span><span class="annot"><a href="Data.FileEmbed.html#embedDirListing"><span class="hs-identifier hs-type">embedDirListing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-161"></span><span id="embedDirListing"><span class="annot"><span class="annottext">embedDirListing :: [Char] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#embedDirListing"><span class="hs-identifier hs-var hs-var">embedDirListing</span></a></span></span><span> </span><span id="local-6989586621679047065"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047065"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679047064"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679047064"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">FilePath</span><span class="hs-special">]</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679047063"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679047063"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IO a -&gt; Q a
</span><span class="hs-identifier hs-var">runIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO [([Char], ByteString)]
</span><a href="Data.FileEmbed.html#fileList"><span class="hs-identifier hs-var">fileList</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047065"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#strToExp"><span class="hs-identifier hs-var">strToExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Type -&gt; Exp
</span><span class="hs-identifier hs-var">SigE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679047063"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679047064"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | Get a directory tree in the IO monad.</span><span>
</span><span id="line-167"></span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- This is the workhorse of 'embedDir'</span><span>
</span><span id="line-169"></span><span class="annot"><a href="Data.FileEmbed.html#getDir"><span class="hs-identifier hs-type">getDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span id="getDir"><span class="annot"><span class="annottext">getDir :: [Char] -&gt; IO [([Char], ByteString)]
</span><a href="Data.FileEmbed.html#getDir"><span class="hs-identifier hs-var hs-var">getDir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO [([Char], ByteString)]
</span><a href="Data.FileEmbed.html#fileList"><span class="hs-identifier hs-var">fileList</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><a href="Data.FileEmbed.html#pairToExp"><span class="hs-identifier hs-type">pairToExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-173"></span><span id="pairToExp"><span class="annot"><span class="annottext">pairToExp :: [Char] -&gt; ([Char], ByteString) -&gt; Q Exp
</span><a href="Data.FileEmbed.html#pairToExp"><span class="hs-identifier hs-var hs-var">pairToExp</span></a></span></span><span> </span><span id="local-6989586621679047062"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047062"><span class="hs-identifier hs-var">_root</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679047061"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047061"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679047060"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047060"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,7,0)
</span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; [Char] -&gt; m ()
</span><span class="hs-identifier hs-var">qAddDependentFile</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047062"><span class="hs-identifier hs-var">_root</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047061"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span id="local-6989586621679047059"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679047059"><span class="hs-identifier hs-var">exp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Q Exp
</span><a href="Data.FileEmbed.html#bsToExp"><span class="hs-identifier hs-var">bsToExp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047060"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">TupE</span></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,16,0)
</span><span>      </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span class="hs-cpp">
#endif
</span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047061"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679047059"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><a href="Data.FileEmbed.html#bsToExp"><span class="hs-identifier hs-type">bsToExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2, 5, 0)
</span><span id="bsToExp"><span class="annot"><span class="annottext">bsToExp :: ByteString -&gt; Q Exp
</span><a href="Data.FileEmbed.html#bsToExp"><span class="hs-identifier hs-var hs-var">bsToExp</span></a></span></span><span> </span><span id="local-6989586621679047056"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047056"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">unsafePerformIO</span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">unsafePackAddressLen</span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Lit
</span><span class="hs-identifier hs-var">IntegerL</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B8.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047056"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2, 16, 0)
</span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bytes -&gt; Lit
</span><span class="hs-identifier hs-var">bytesPrimL</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-192"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.PS</span></span><span> </span><span id="local-6989586621679047052"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679047052"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span id="local-6989586621679047051"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679047051"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621679047050"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679047050"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047056"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-193"></span><span>                </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Word -&gt; Word -&gt; Bytes
</span><span class="hs-identifier hs-var">mkBytes</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679047052"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679047051"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679047050"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#elif MIN_VERSION_template_haskell(2, 8, 0)
</span><span>      </span><span class="hs-special">`</span><span class="hs-identifier">AppE</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">LitE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StringPrimL</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">B.unpack</span><span> </span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>      </span><span class="hs-special">`</span><span class="hs-identifier">AppE</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">LitE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StringPrimL</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">B8.unpack</span><span> </span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#else
</span><span class="hs-identifier">bsToExp</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-identifier">helper</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">stringToBs</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">chars</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">B8.unpack</span><span> </span><span class="hs-identifier">bs</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">AppE</span><span> </span><span class="hs-identifier">helper</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">LitE</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">StringL</span><span> </span><span class="hs-identifier">chars</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-206"></span><span class="annot"><a href="Data.FileEmbed.html#stringToBs"><span class="hs-identifier hs-type">stringToBs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-207"></span><span id="stringToBs"><span class="annot"><span class="annottext">stringToBs :: [Char] -&gt; ByteString
</span><a href="Data.FileEmbed.html#stringToBs"><span class="hs-identifier hs-var hs-var">stringToBs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.pack</span></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- | Embed a single file in your source code.</span><span>
</span><span id="line-210"></span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- &gt; import Data.String</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- &gt; myFile :: IsString a =&gt; a</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- &gt; myFile = $(embedStringFile &quot;dirName/fileName&quot;)</span><span>
</span><span id="line-215"></span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- Since 0.0.9</span><span>
</span><span id="line-217"></span><span class="annot"><a href="Data.FileEmbed.html#embedStringFile"><span class="hs-identifier hs-type">embedStringFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-218"></span><span id="embedStringFile"><span class="annot"><span class="annottext">embedStringFile :: [Char] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#embedStringFile"><span class="hs-identifier hs-var hs-var">embedStringFile</span></a></span></span><span> </span><span id="local-6989586621679047048"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047048"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,7,0)
</span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; [Char] -&gt; m ()
</span><span class="hs-identifier hs-var">qAddDependentFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047048"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IO a -&gt; Q a
</span><span class="hs-identifier hs-var">runIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO [Char]
</span><span class="hs-identifier hs-var">P.readFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047048"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#strToExp"><span class="hs-identifier hs-var">strToExp</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- | Embed a single existing string file in your source code</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- out of list a list of paths supplied.</span><span>
</span><span id="line-226"></span><span class="hs-comment">--</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- Since 0.0.9</span><span>
</span><span id="line-228"></span><span class="annot"><a href="Data.FileEmbed.html#embedOneStringFileOf"><span class="hs-identifier hs-type">embedOneStringFileOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-229"></span><span id="embedOneStringFileOf"><span class="annot"><span class="annottext">embedOneStringFileOf :: [[Char]] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#embedOneStringFileOf"><span class="hs-identifier hs-var hs-var">embedOneStringFileOf</span></a></span></span><span> </span><span id="local-6989586621679047046"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047046"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IO a -&gt; Q a
</span><span class="hs-identifier hs-var">runIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO ([Char], [Char])
</span><a href="#local-6989586621679047045"><span class="hs-identifier hs-var">readExistingFile</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047046"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621679047044"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047044"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679047043"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047043"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,7,0)
</span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; [Char] -&gt; m ()
</span><span class="hs-identifier hs-var">qAddDependentFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047044"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#strToExp"><span class="hs-identifier hs-var">strToExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047043"><span class="hs-identifier hs-var">content</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="#local-6989586621679047045"><span class="hs-identifier hs-type">readExistingFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621679047045"><span class="annot"><span class="annottext">readExistingFile :: [[Char]] -&gt; IO ([Char], [Char])
</span><a href="#local-6989586621679047045"><span class="hs-identifier hs-var hs-var">readExistingFile</span></a></span></span><span> </span><span id="local-6989586621679047042"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047042"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-238"></span><span>      </span><span id="local-6989586621679047041"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047041"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047042"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047041"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679047040"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047040"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[[Char]]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO [Char]
</span><span class="hs-identifier hs-var">P.readFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047040"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679047039"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047039"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047040"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047039"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">[[Char]]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ErrorCall
</span><span class="hs-identifier hs-var">ErrorCall</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot find file to embed as resource&quot;</span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><a href="Data.FileEmbed.html#strToExp"><span class="hs-identifier hs-type">strToExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2, 5, 0)
</span><span id="strToExp"><span class="annot"><span class="annottext">strToExp :: [Char] -&gt; Q Exp
</span><a href="Data.FileEmbed.html#strToExp"><span class="hs-identifier hs-var hs-var">strToExp</span></a></span></span><span> </span><span id="local-6989586621679047038"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047038"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">fromString</span><span>
</span><span id="line-247"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047038"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">strToExp</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-identifier">helper</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">fromString</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">AppE</span><span> </span><span class="hs-identifier">helper</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">LitE</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">StringL</span><span> </span><span class="hs-identifier">s</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-254"></span><span class="annot"><a href="Data.FileEmbed.html#notHidden"><span class="hs-identifier hs-type">notHidden</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-255"></span><span id="notHidden"><span class="annot"><span class="annottext">notHidden :: [Char] -&gt; Bool
</span><a href="Data.FileEmbed.html#notHidden"><span class="hs-identifier hs-var hs-var">notHidden</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Data.FileEmbed.html#notHidden"><span class="hs-identifier hs-var">notHidden</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="annot"><a href="Data.FileEmbed.html#fileList"><span class="hs-identifier hs-type">fileList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-259"></span><span id="fileList"><span class="annot"><span class="annottext">fileList :: [Char] -&gt; IO [([Char], ByteString)]
</span><a href="Data.FileEmbed.html#fileList"><span class="hs-identifier hs-var hs-var">fileList</span></a></span></span><span> </span><span id="local-6989586621679047036"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047036"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; IO [([Char], ByteString)]
</span><a href="Data.FileEmbed.html#fileList%27"><span class="hs-identifier hs-var">fileList'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047036"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><a href="Data.FileEmbed.html#fileList%27"><span class="hs-identifier hs-type">fileList'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span id="fileList%27"><span class="annot"><span class="annottext">fileList' :: [Char] -&gt; [Char] -&gt; IO [([Char], ByteString)]
</span><a href="Data.FileEmbed.html#fileList%27"><span class="hs-identifier hs-var hs-var">fileList'</span></a></span></span><span> </span><span id="local-6989586621679047034"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047034"><span class="hs-identifier hs-var">realTop</span></a></span></span><span> </span><span id="local-6989586621679047033"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047033"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621679047032"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047032"><span class="hs-identifier hs-var">allContents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Data.FileEmbed.html#notHidden"><span class="hs-identifier hs-var">notHidden</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO [[Char]]
</span><span class="hs-identifier hs-var">getDirectoryContents</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047034"><span class="hs-identifier hs-var">realTop</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047033"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679047030"><span class="annot"><span class="annottext">all' :: [([Char], [Char])]
</span><a href="#local-6989586621679047030"><span class="hs-identifier hs-var hs-var">all'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047033"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><span class="hs-operator hs-var">&amp;&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679047029"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047029"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047034"><span class="hs-identifier hs-var">realTop</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047033"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047029"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679047032"><span class="hs-identifier hs-var">allContents</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621679047028"><span class="annot"><span class="annottext">[([Char], ByteString)]
</span><a href="#local-6989586621679047028"><span class="hs-identifier hs-var">files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Char], [Char])]
</span><a href="#local-6989586621679047030"><span class="hs-identifier hs-var">all'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span>
</span><span id="line-266"></span><span>             </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a, m b) -&gt; m (a, b)
</span><a href="Data.FileEmbed.html#liftPair2"><span class="hs-identifier hs-var">liftPair2</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ByteString
</span><span class="hs-identifier hs-var">B.readFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679047026"><span class="annot"><span class="annottext">[[([Char], ByteString)]]
</span><a href="#local-6989586621679047026"><span class="hs-identifier hs-var">dirs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesDirectoryExist</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Char], [Char])]
</span><a href="#local-6989586621679047030"><span class="hs-identifier hs-var">all'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span>
</span><span id="line-268"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; IO [([Char], ByteString)]
</span><a href="Data.FileEmbed.html#fileList%27"><span class="hs-identifier hs-var">fileList'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047034"><span class="hs-identifier hs-var">realTop</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[([Char], ByteString)]
</span><a href="#local-6989586621679047028"><span class="hs-identifier hs-var">files</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[([Char], ByteString)]]
</span><a href="#local-6989586621679047026"><span class="hs-identifier hs-var">dirs</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span id="local-6989586621679047303"><span id="local-6989586621679047304"><span id="local-6989586621679047305"><span class="annot"><a href="Data.FileEmbed.html#liftPair2"><span class="hs-identifier hs-type">liftPair2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679047305"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679047304"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679047305"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679047303"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679047305"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679047304"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679047303"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-272"></span><span id="liftPair2"><span class="annot"><span class="annottext">liftPair2 :: forall (m :: * -&gt; *) a b. Monad m =&gt; (a, m b) -&gt; m (a, b)
</span><a href="Data.FileEmbed.html#liftPair2"><span class="hs-identifier hs-var hs-var">liftPair2</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679047021"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679047021"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679047020"><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679047020"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679047020"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679047019"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679047019"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679047021"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679047019"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="annot"><a href="Data.FileEmbed.html#magic"><span class="hs-identifier hs-type">magic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-275"></span><span id="magic"><span class="annot"><span class="annottext">magic :: ByteString -&gt; ByteString
</span><a href="Data.FileEmbed.html#magic"><span class="hs-identifier hs-var hs-var">magic</span></a></span></span><span> </span><span id="local-6989586621679047017"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047017"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;fe&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047017"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><a href="Data.FileEmbed.html#sizeLen"><span class="hs-identifier hs-type">sizeLen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-278"></span><span id="sizeLen"><span class="annot"><span class="annottext">sizeLen :: Int
</span><a href="Data.FileEmbed.html#sizeLen"><span class="hs-identifier hs-var hs-var">sizeLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><a href="Data.FileEmbed.html#getInner"><span class="hs-identifier hs-type">getInner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-281"></span><span id="getInner"><span class="annot"><span class="annottext">getInner :: ByteString -&gt; ByteString
</span><a href="Data.FileEmbed.html#getInner"><span class="hs-identifier hs-var hs-var">getInner</span></a></span></span><span> </span><span id="local-6989586621679047013"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047013"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679047012"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047012"><span class="hs-identifier hs-var">sizeBS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679047011"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047011"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">B.splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.FileEmbed.html#sizeLen"><span class="hs-identifier hs-var">sizeLen</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047013"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-283"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Read a =&gt; ReadS a
</span><span class="hs-identifier hs-var">reads</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047012"><span class="hs-identifier hs-var">sizeBS</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-284"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679047007"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679047007"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Int, [Char])]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679047007"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679047011"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Data.FileEmbed (getInner): Your dummy space has been corrupted.&quot;</span></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><a href="Data.FileEmbed.html#padSize"><span class="hs-identifier hs-type">padSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-288"></span><span id="padSize"><span class="annot"><span class="annottext">padSize :: Int -&gt; [Char]
</span><a href="Data.FileEmbed.html#padSize"><span class="hs-identifier hs-var hs-var">padSize</span></a></span></span><span> </span><span id="local-6989586621679047003"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679047003"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679047000"><span class="annot"><span class="annottext">s :: [Char]
</span><a href="#local-6989586621679047000"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679047003"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-290"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="Data.FileEmbed.html#sizeLen"><span class="hs-identifier hs-var">sizeLen</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047000"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679047000"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-cpp">

#if MIN_VERSION_template_haskell(2,5,0)
</span><span class="hs-comment">-- | Allocate the given number of bytes in the generate executable. That space</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- can be filled up with the 'inject' and 'injectFile' functions.</span><span>
</span><span id="line-295"></span><span class="annot"><a href="Data.FileEmbed.html#dummySpace"><span class="hs-identifier hs-type">dummySpace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-296"></span><span id="dummySpace"><span class="annot"><span class="annottext">dummySpace :: Int -&gt; Q Exp
</span><a href="Data.FileEmbed.html#dummySpace"><span class="hs-identifier hs-var hs-var">dummySpace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int -&gt; Q Exp
</span><a href="Data.FileEmbed.html#dummySpaceWith"><span class="hs-identifier hs-var">dummySpaceWith</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;MS&quot;</span></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="hs-comment">-- | Like 'dummySpace', but takes a postfix for the magic string.  In</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- order for this to work, the same postfix must be used by 'inject' /</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- 'injectFile'.  This allows an executable to have multiple</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- 'ByteString's injected into it, without encountering collisions.</span><span>
</span><span id="line-302"></span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- Since 0.0.8</span><span>
</span><span id="line-304"></span><span class="annot"><a href="Data.FileEmbed.html#dummySpaceWith"><span class="hs-identifier hs-type">dummySpaceWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-305"></span><span id="dummySpaceWith"><span class="annot"><span class="annottext">dummySpaceWith :: ByteString -&gt; Int -&gt; Q Exp
</span><a href="Data.FileEmbed.html#dummySpaceWith"><span class="hs-identifier hs-var hs-var">dummySpaceWith</span></a></span></span><span> </span><span id="local-6989586621679046996"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046996"><span class="hs-identifier hs-var">postfix</span></a></span></span><span> </span><span id="local-6989586621679046995"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046995"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679046994"><span class="annot"><span class="annottext">size :: [Char]
</span><a href="#local-6989586621679046994"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
</span><a href="Data.FileEmbed.html#padSize"><span class="hs-identifier hs-var">padSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046995"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-307"></span><span>        </span><span id="local-6989586621679046993"><span class="annot"><span class="annottext">magic' :: ByteString
</span><a href="#local-6989586621679046993"><span class="hs-identifier hs-var hs-var">magic'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Data.FileEmbed.html#magic"><span class="hs-identifier hs-var">magic</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046996"><span class="hs-identifier hs-var">postfix</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span id="local-6989586621679046992"><span class="annot"><span class="annottext">start :: [Char]
</span><a href="#local-6989586621679046992"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046993"><span class="hs-identifier hs-var">magic'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046994"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-309"></span><span>        </span><span id="local-6989586621679046991"><span class="annot"><span class="annottext">magicLen :: Int
</span><a href="#local-6989586621679046991"><span class="hs-identifier hs-var hs-var">magicLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B8.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046993"><span class="hs-identifier hs-var">magic'</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span id="local-6989586621679046988"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621679046988"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046991"><span class="hs-identifier hs-var">magicLen</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.FileEmbed.html#sizeLen"><span class="hs-identifier hs-var">sizeLen</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046995"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span id="local-6989586621679046982"><span class="annot"><span class="annottext">chars :: Exp
</span><a href="#local-6989586621679046982"><span class="hs-identifier hs-var hs-var">chars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; Lit
</span><span class="hs-identifier hs-var">StringPrimL</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,6,0)
</span><span>            </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span class="hs-cpp">
#endif
</span><span>            </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046992"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046995"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">getInner</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.drop</span><span> </span><span class="hs-identifier">magicLen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafePerformIO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafePackAddressLen</span><span> </span><span class="hs-identifier">len</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">chars</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- | Inject some raw data inside a @ByteString@ containing empty, dummy space</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- (allocated with @dummySpace@). Typically, the original @ByteString@ is an</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- executable read from the filesystem.</span><span>
</span><span id="line-322"></span><span class="annot"><a href="Data.FileEmbed.html#inject"><span class="hs-identifier hs-type">inject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ bs to inject</span><span>
</span><span id="line-323"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ original BS containing dummy</span><span>
</span><span id="line-324"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ new BS, or Nothing if there is insufficient dummy space</span><span>
</span><span id="line-325"></span><span id="inject"><span class="annot"><span class="annottext">inject :: ByteString -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Data.FileEmbed.html#inject"><span class="hs-identifier hs-var hs-var">inject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Data.FileEmbed.html#injectWith"><span class="hs-identifier hs-var">injectWith</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;MS&quot;</span></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">-- | Like 'inject', but takes a postfix for the magic string.</span><span>
</span><span id="line-328"></span><span class="hs-comment">--</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- Since 0.0.8</span><span>
</span><span id="line-330"></span><span class="annot"><a href="Data.FileEmbed.html#injectWith"><span class="hs-identifier hs-type">injectWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ postfix of magic string</span><span>
</span><span id="line-331"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ bs to inject</span><span>
</span><span id="line-332"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ original BS containing dummy</span><span>
</span><span id="line-333"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ new BS, or Nothing if there is insufficient dummy space</span><span>
</span><span id="line-334"></span><span id="injectWith"><span class="annot"><span class="annottext">injectWith :: ByteString -&gt; ByteString -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Data.FileEmbed.html#injectWith"><span class="hs-identifier hs-var hs-var">injectWith</span></a></span></span><span> </span><span id="local-6989586621679046978"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046978"><span class="hs-identifier hs-var">postfix</span></a></span></span><span> </span><span id="local-6989586621679046977"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046977"><span class="hs-identifier hs-var">toInj</span></a></span></span><span> </span><span id="local-6989586621679046976"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046976"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046975"><span class="hs-identifier hs-var">toInjL</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046973"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">B.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046972"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046971"><span class="hs-identifier hs-var">magic'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.pack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
</span><a href="Data.FileEmbed.html#padSize"><span class="hs-identifier hs-var">padSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046975"><span class="hs-identifier hs-var">toInjL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046977"><span class="hs-identifier hs-var">toInj</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.pack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046973"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046975"><span class="hs-identifier hs-var">toInjL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046970"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621679046971"><span class="annot"><span class="annottext">magic' :: ByteString
</span><a href="#local-6989586621679046971"><span class="hs-identifier hs-var hs-var">magic'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Data.FileEmbed.html#magic"><span class="hs-identifier hs-var">magic</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046978"><span class="hs-identifier hs-var">postfix</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span id="local-6989586621679046975"><span class="annot"><span class="annottext">toInjL :: Int
</span><a href="#local-6989586621679046975"><span class="hs-identifier hs-var hs-var">toInjL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046977"><span class="hs-identifier hs-var">toInj</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679046972"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046972"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679046969"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046969"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">B.breakSubstring</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046971"><span class="hs-identifier hs-var">magic'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046976"><span class="hs-identifier hs-var">orig</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679046967"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046967"><span class="hs-identifier hs-var">sizeBS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679046966"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046966"><span class="hs-identifier hs-var">rest'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; (ByteString, ByteString)
</span><span class="hs-identifier hs-var">B.splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.FileEmbed.html#sizeLen"><span class="hs-identifier hs-var">sizeLen</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B.drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">B8.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046971"><span class="hs-identifier hs-var">magic'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046969"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621679046973"><span class="annot"><span class="annottext">size :: Int
</span><a href="#local-6989586621679046973"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Read a =&gt; ReadS a
</span><span class="hs-identifier hs-var">reads</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046967"><span class="hs-identifier hs-var">sizeBS</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679046957"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046957"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Int, [Char])]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046957"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-345"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Data.FileEmbed (inject): Your dummy space has been corrupted. Size is: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046967"><span class="hs-identifier hs-var">sizeBS</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621679046970"><span class="annot"><span class="annottext">after :: ByteString
</span><a href="#local-6989586621679046970"><span class="hs-identifier hs-var hs-var">after</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679046973"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046966"><span class="hs-identifier hs-var">rest'</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">-- | Same as 'inject', but instead of performing the injecting in memory, read</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- the contents from the filesystem and write back to a different file on the</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- filesystem.</span><span>
</span><span id="line-351"></span><span class="annot"><a href="Data.FileEmbed.html#injectFile"><span class="hs-identifier hs-type">injectFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ bs to inject</span><span>
</span><span id="line-352"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- ^ template file</span><span>
</span><span id="line-353"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- ^ output file</span><span>
</span><span id="line-354"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span id="injectFile"><span class="annot"><span class="annottext">injectFile :: ByteString -&gt; [Char] -&gt; [Char] -&gt; IO ()
</span><a href="Data.FileEmbed.html#injectFile"><span class="hs-identifier hs-var hs-var">injectFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; [Char] -&gt; [Char] -&gt; IO ()
</span><a href="Data.FileEmbed.html#injectFileWith"><span class="hs-identifier hs-var">injectFileWith</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;MS&quot;</span></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-comment">-- | Like 'injectFile', but takes a postfix for the magic string.</span><span>
</span><span id="line-358"></span><span class="hs-comment">--</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- Since 0.0.8</span><span>
</span><span id="line-360"></span><span class="annot"><a href="Data.FileEmbed.html#injectFileWith"><span class="hs-identifier hs-type">injectFileWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ postfix of magic string</span><span>
</span><span id="line-361"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-comment">-- ^ bs to inject</span><span>
</span><span id="line-362"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- ^ template file</span><span>
</span><span id="line-363"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- ^ output file</span><span>
</span><span id="line-364"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span id="injectFileWith"><span class="annot"><span class="annottext">injectFileWith :: ByteString -&gt; ByteString -&gt; [Char] -&gt; [Char] -&gt; IO ()
</span><a href="Data.FileEmbed.html#injectFileWith"><span class="hs-identifier hs-var hs-var">injectFileWith</span></a></span></span><span> </span><span id="local-6989586621679046956"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046956"><span class="hs-identifier hs-var">postfix</span></a></span></span><span> </span><span id="local-6989586621679046955"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046955"><span class="hs-identifier hs-var">inj</span></a></span></span><span> </span><span id="local-6989586621679046954"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046954"><span class="hs-identifier hs-var">srcFP</span></a></span></span><span> </span><span id="local-6989586621679046953"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046953"><span class="hs-identifier hs-var">dstFP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>    </span><span id="local-6989586621679046952"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046952"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ByteString
</span><span class="hs-identifier hs-var">B.readFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046954"><span class="hs-identifier hs-var">srcFP</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString -&gt; Maybe ByteString
</span><a href="Data.FileEmbed.html#injectWith"><span class="hs-identifier hs-var">injectWith</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046956"><span class="hs-identifier hs-var">postfix</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046955"><span class="hs-identifier hs-var">inj</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046952"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-368"></span><span>        </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Insufficient dummy space&quot;</span></span><span>
</span><span id="line-369"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679046951"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046951"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">B.writeFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046953"><span class="hs-identifier hs-var">dstFP</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679046951"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">{- $inject

The inject system allows arbitrary content to be embedded inside a Haskell
executable, post compilation. Typically, file-embed allows you to read some
contents from the file system at compile time and embed them inside your
executable. Consider a case, instead, where you would want to embed these
contents after compilation. Two real-world examples are:

* You would like to embed a hash of the executable itself, for sanity checking in a network protocol. (Obviously the hash will change after you embed the hash.)

* You want to create a self-contained web server that has a set of content, but will need to update the content on machines that do not have access to GHC.

The typical workflow use:

* Use 'dummySpace' or 'dummySpaceWith' to create some empty space in your executable

* Use 'injectFile' or 'injectFileWith' from a separate utility to modify that executable to have the updated content.

The reason for the @With@-variant of the functions is for cases where you wish
to inject multiple different kinds of content, and therefore need control over
the magic key. If you know for certain that there will only be one dummy space
available, you can use the non-@With@ variants.

-}</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-comment">-- | Take a relative file path and attach it to the root of the current</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- project.</span><span>
</span><span id="line-398"></span><span class="hs-comment">--</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- The idea here is that, when building with Stack, the build will always be</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- executed with a current working directory of the root of the project (where</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- your .cabal file is located). However, if you load up multiple projects with</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- @stack ghci@, the working directory may be something else entirely.</span><span>
</span><span id="line-403"></span><span class="hs-comment">--</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- This function looks at the source location of the Haskell file calling it,</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- finds the first parent directory with a .cabal file, and uses that as the</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- root directory for fixing the relative path.</span><span>
</span><span id="line-407"></span><span class="hs-comment">--</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- @$(makeRelativeToProject &quot;data/foo.txt&quot; &gt;&gt;= embedFile)@</span><span>
</span><span id="line-409"></span><span class="hs-comment">--</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- @since 0.0.10</span><span>
</span><span id="line-411"></span><span class="annot"><a href="Data.FileEmbed.html#makeRelativeToProject"><span class="hs-identifier hs-type">makeRelativeToProject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-412"></span><span id="makeRelativeToProject"><span class="annot"><span class="annottext">makeRelativeToProject :: [Char] -&gt; Q [Char]
</span><a href="Data.FileEmbed.html#makeRelativeToProject"><span class="hs-identifier hs-var hs-var">makeRelativeToProject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Bool) -&gt; [Char] -&gt; Q [Char]
</span><a href="Data.FileEmbed.html#makeRelativeToLocationPredicate"><span class="hs-identifier hs-var">makeRelativeToLocationPredicate</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.cabal&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><span class="hs-identifier hs-var">takeExtension</span></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-comment">-- | Take a predicate to infer the project root and a relative file path, the given file path is then attached to the inferred project root</span><span>
</span><span id="line-415"></span><span class="hs-comment">--</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- This function looks at the source location of the Haskell file calling it,</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- finds the first parent directory with a file matching the given predicate, and uses that as the</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- root directory for fixing the relative path.</span><span>
</span><span id="line-419"></span><span class="hs-comment">--</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- @$(makeRelativeToLocationPredicate ((==) &quot;.cabal&quot; . takeExtension) &quot;data/foo.txt&quot; &gt;&gt;= embedFile)@</span><span>
</span><span id="line-421"></span><span class="hs-comment">--</span><span>
</span><span id="line-422"></span><span class="hs-comment">-- @since 0.0.15.0</span><span>
</span><span id="line-423"></span><span class="annot"><a href="Data.FileEmbed.html#makeRelativeToLocationPredicate"><span class="hs-identifier hs-type">makeRelativeToLocationPredicate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-424"></span><span id="makeRelativeToLocationPredicate"><span class="annot"><span class="annottext">makeRelativeToLocationPredicate :: ([Char] -&gt; Bool) -&gt; [Char] -&gt; Q [Char]
</span><a href="Data.FileEmbed.html#makeRelativeToLocationPredicate"><span class="hs-identifier hs-var hs-var">makeRelativeToLocationPredicate</span></a></span></span><span> </span><span id="local-6989586621679046949"><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="#local-6989586621679046949"><span class="hs-identifier hs-var">isTargetFile</span></a></span></span><span> </span><span id="local-6989586621679046948"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046948"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621679046947"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621679046947"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; m Loc
</span><span class="hs-identifier hs-var">qLocation</span></span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><span class="annottext">forall a. IO a -&gt; Q a
</span><span class="hs-identifier hs-var">runIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>        </span><span id="local-6989586621679046946"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046946"><span class="hs-identifier hs-var">srcFP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO [Char]
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; [Char]
</span><span class="hs-identifier hs-var">loc_filename</span></span><span> </span><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621679046947"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span id="local-6989586621679046945"><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621679046945"><span class="hs-identifier hs-var">mdir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO (Maybe [Char])
</span><a href="#local-6989586621679046944"><span class="hs-identifier hs-var">findProjectDir</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046946"><span class="hs-identifier hs-var">srcFP</span></a></span><span>
</span><span id="line-429"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621679046945"><span class="hs-identifier hs-var">mdir</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-430"></span><span>            </span><span class="annot"><span class="annottext">Maybe [Char]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Could not find .cabal file for path: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046946"><span class="hs-identifier hs-var">srcFP</span></a></span><span>
</span><span id="line-431"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679046943"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046943"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046943"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046948"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621679046944"><span class="annot"><span class="annottext">findProjectDir :: [Char] -&gt; IO (Maybe [Char])
</span><a href="#local-6989586621679046944"><span class="hs-identifier hs-var hs-var">findProjectDir</span></a></span></span><span> </span><span id="local-6989586621679046936"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046936"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679046935"><span class="annot"><span class="annottext">dir :: [Char]
</span><a href="#local-6989586621679046935"><span class="hs-identifier hs-var hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046936"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-435"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046935"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046936"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-436"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-437"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>                </span><span id="local-6989586621679046934"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679046934"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO [[Char]]
</span><span class="hs-identifier hs-var">getDirectoryContents</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046935"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-439"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="#local-6989586621679046949"><span class="hs-identifier hs-var">isTargetFile</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679046934"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-440"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046935"><span class="hs-identifier hs-var">dir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO (Maybe [Char])
</span><a href="#local-6989586621679046944"><span class="hs-identifier hs-var">findProjectDir</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679046935"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-442"></span></pre></body></html>