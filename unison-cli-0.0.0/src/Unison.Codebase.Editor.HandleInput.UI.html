<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Codebase.Editor.HandleInput.UI</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.UI.html#openUI"><span class="hs-identifier">openUI</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lens</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch.Type</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Branch</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Reference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2.Referent</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Project</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Project</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Project</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.ProjectBranch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ProjectBranch</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.ProjectBranch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html"><span class="hs-identifier">Unison.Cli.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier">Cli</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html"><span class="hs-identifier">Unison.Cli.Monad</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cli</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.MonadUtils.html"><span class="hs-identifier">Unison.Cli.MonadUtils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cli</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.ProjectUtils.html"><span class="hs-identifier">Unison.Cli.ProjectUtils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Project</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SqliteCodebase.Conversions</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Conversions</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorType</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ConstructorType</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Project</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProjectAndBranch</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Project.Util</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">projectBranchPath</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.CodebaseServer</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Server</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Web.Browser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">openBrowser</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.UI.html#openUI"><span class="hs-identifier hs-type">openUI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Path'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span id="openUI"><span class="annot"><span class="annottext">openUI :: Path' -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#openUI"><span class="hs-identifier hs-var hs-var">openUI</span></a></span></span><span> </span><span id="local-6989586621680944178"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621680944178"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680944176"><span class="annot"><span class="annottext">Maybe BaseUrl
$sel:serverBaseUrl:Env :: Env -&gt; Maybe BaseUrl
serverBaseUrl :: Maybe BaseUrl
</span><a href="Unison.Cli.Monad.html#%24sel%3AserverBaseUrl%3AEnv"><span class="hs-identifier hs-var hs-var">serverBaseUrl</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-42"></span><span>  </span><span id="local-6989586621680944174"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944174"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680944172"><span class="annot"><span class="annottext">absPath :: Absolute
</span><a href="#local-6989586621680944172"><span class="hs-identifier hs-var hs-var">absPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l r o. Resolve l r o =&gt; l -&gt; r -&gt; o
</span><span class="hs-identifier hs-var">Path.resolve</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944174"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621680944178"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">whenJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe BaseUrl
</span><a href="#local-6989586621680944176"><span class="hs-identifier hs-var">serverBaseUrl</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680944169"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680944169"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="annottext">Absolute
-&gt; Cli (Maybe (ProjectAndBranch Project ProjectBranch, Path))
</span><a href="Unison.Cli.ProjectUtils.html#getProjectBranchForPath"><span class="hs-identifier hs-var">Project.getProjectBranchForPath</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944172"><span class="hs-identifier hs-var">absPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-46"></span><span>      </span><span class="annot"><span class="annottext">Maybe (ProjectAndBranch Project ProjectBranch, Path)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; Path' -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#openUIForLooseCode"><span class="hs-identifier hs-var">openUIForLooseCode</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680944169"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621680944178"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-47"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680944166"><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680944166"><span class="hs-identifier hs-var">projectBranch</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680944165"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944165"><span class="hs-identifier hs-var">pathWithinBranch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; ProjectAndBranch Project ProjectBranch -&gt; Path -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#openUIForProject"><span class="hs-identifier hs-var">openUIForProject</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680944169"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680944166"><span class="hs-identifier hs-var">projectBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944165"><span class="hs-identifier hs-var">pathWithinBranch</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.UI.html#openUIForProject"><span class="hs-identifier hs-type">openUIForProject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server.BaseUrl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Project</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.ProjectBranch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span id="openUIForProject"><span class="annot"><span class="annottext">openUIForProject :: BaseUrl -&gt; ProjectAndBranch Project ProjectBranch -&gt; Path -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#openUIForProject"><span class="hs-identifier hs-var hs-var">openUIForProject</span></a></span></span><span> </span><span id="local-6989586621680944163"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680944163"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span id="local-6989586621680944162"><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680944162"><span class="hs-identifier hs-var">projectAndBranch</span></a></span></span><span> </span><span id="local-6989586621680944161"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944161"><span class="hs-identifier hs-var">pathFromProjectRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-51"></span><span>  </span><span id="local-6989586621680944160"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944160"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span id="local-6989586621680944159"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944159"><span class="hs-identifier hs-var">perspective</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="annottext">Absolute
-&gt; Cli (Maybe (ProjectAndBranch Project ProjectBranch, Path))
</span><a href="Unison.Cli.ProjectUtils.html#getProjectBranchForPath"><span class="hs-identifier hs-var">Project.getProjectBranchForPath</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944160"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-54"></span><span>      </span><span class="annot"><span class="annottext">Maybe (ProjectAndBranch Project ProjectBranch, Path)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-55"></span><span>        </span><span class="hs-comment">-- The current path is outside the project the argument was in. Use the project root</span><span>
</span><span id="line-56"></span><span>        </span><span class="hs-comment">-- as the perspective.</span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.empty</span></span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680944156"><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680944156"><span class="hs-identifier hs-var">_projectBranch</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680944155"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944155"><span class="hs-identifier hs-var">pathWithinBranch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944155"><span class="hs-identifier hs-var">pathWithinBranch</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span id="local-6989586621680944154"><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621680944154"><span class="hs-identifier hs-var">mayDefinitionRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Cli (Maybe DefinitionReference)
</span><a href="#local-6989586621680944153"><span class="hs-identifier hs-var">getDefinitionRef</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944159"><span class="hs-identifier hs-var">perspective</span></a></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680944152"><span class="annot"><span class="annottext">projectBranchNames :: ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621680944152"><span class="hs-identifier hs-var hs-var">projectBranchNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">Project -&gt; ProjectName
</span><span class="hs-identifier hs-var">Project.name</span></span><span> </span><span class="annot"><span class="annottext">ProjectBranch -&gt; ProjectBranchName
</span><span class="hs-identifier hs-var">ProjectBranch.name</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680944162"><span class="hs-identifier hs-var">projectAndBranch</span></a></span><span>
</span><span id="line-61"></span><span>  </span><span id="local-6989586621680944148"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680944148"><span class="hs-identifier hs-var">_success</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">openBrowser</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Service -&gt; BaseUrl -&gt; Text
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
-&gt; Path -&gt; Maybe DefinitionReference -&gt; Service
</span><span class="hs-identifier hs-var">Server.ProjectBranchUI</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectName ProjectBranchName
</span><a href="#local-6989586621680944152"><span class="hs-identifier hs-var">projectBranchNames</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944159"><span class="hs-identifier hs-var">perspective</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621680944154"><span class="hs-identifier hs-var">mayDefinitionRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680944163"><span class="hs-identifier hs-var">url</span></a></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="#local-6989586621680944142"><span class="hs-identifier hs-type">pathToBranchFromCodebaseRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621680944142"><span class="annot"><span class="annottext">pathToBranchFromCodebaseRoot :: Absolute
</span><a href="#local-6989586621680944142"><span class="hs-identifier hs-var hs-var">pathToBranchFromCodebaseRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectId ProjectBranchId -&gt; Absolute
</span><span class="hs-identifier hs-var">projectBranchPath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">Project -&gt; ProjectId
</span><span class="hs-identifier hs-var">Project.projectId</span></span><span> </span><span class="annot"><span class="annottext">ProjectBranch -&gt; ProjectBranchId
</span><span class="hs-identifier hs-var">ProjectBranch.branchId</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680944162"><span class="hs-identifier hs-var">projectAndBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-comment">-- If the provided ui path matches a definition, find it.</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="#local-6989586621680944153"><span class="hs-identifier hs-type">getDefinitionRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Server.DefinitionReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>    </span><span id="local-6989586621680944153"><span class="annot"><span class="annottext">getDefinitionRef :: Path -&gt; Cli (Maybe DefinitionReference)
</span><a href="#local-6989586621680944153"><span class="hs-identifier hs-var hs-var">getDefinitionRef</span></a></span></span><span> </span><span id="local-6989586621680944139"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944139"><span class="hs-identifier hs-var">perspective</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-69"></span><span>      </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680944137"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
</span><a href="Unison.Cli.Monad.html#%24sel%3Acodebase%3AEnv"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-70"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680944134"><span class="annot"><span class="annottext">absPathToDefinition :: Path
</span><a href="#local-6989586621680944134"><span class="hs-identifier hs-var hs-var">absPathToDefinition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall l r o. Resolve l r o =&gt; l -&gt; r -&gt; o
</span><span class="hs-identifier hs-var">Path.resolve</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944142"><span class="hs-identifier hs-var">pathToBranchFromCodebaseRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Relative
</span><span class="hs-identifier hs-var">Path.Relative</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944161"><span class="hs-identifier hs-var">pathFromProjectRoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680944131"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944131"><span class="hs-identifier hs-var">pathToDefinitionNamespace</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680944130"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680944130"><span class="hs-identifier hs-var">_nameSeg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. Snoc s s a a =&gt; s -&gt; Maybe (s, a)
</span><span class="hs-identifier hs-var">Lens.unsnoc</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944134"><span class="hs-identifier hs-var">absPathToDefinition</span></a></span><span>
</span><span id="line-72"></span><span>      </span><span id="local-6989586621680944127"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680944127"><span class="hs-identifier hs-var">namespaceBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
-&gt; Maybe (Branch Transaction) -&gt; Transaction (Branch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowBranchAtPath</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944131"><span class="hs-identifier hs-var">pathToDefinitionNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>      </span><span id="local-6989586621680944124"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944124"><span class="hs-identifier hs-var">fqn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span>        </span><span id="local-6989586621680944123"><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621680944123"><span class="hs-identifier hs-var">pathFromPerspective</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Maybe [a]
</span><span class="hs-identifier hs-var">List.stripPrefix</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; [NameSegment]
</span><span class="hs-identifier hs-var">Path.toList</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944139"><span class="hs-identifier hs-var">perspective</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; [NameSegment]
</span><span class="hs-identifier hs-var">Path.toList</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680944161"><span class="hs-identifier hs-var">pathFromProjectRoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><span class="annottext">Path -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Path.toName</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment] -&gt; Path
</span><span class="hs-identifier hs-var">Path.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621680944123"><span class="hs-identifier hs-var">pathFromPerspective</span></a></span><span>
</span><span id="line-76"></span><span>      </span><span id="local-6989586621680944118"><span class="annot"><span class="annottext">DefinitionReference
</span><a href="#local-6989586621680944118"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (n :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Branch n -&gt; Name -&gt; Cli (Maybe DefinitionReference)
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#getTermOrTypeRef"><span class="hs-identifier hs-var">getTermOrTypeRef</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680944137"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680944127"><span class="hs-identifier hs-var">namespaceBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944124"><span class="hs-identifier hs-var">fqn</span></a></span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">DefinitionReference
</span><a href="#local-6989586621680944118"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span id="local-6989586621680944273"><span id="local-6989586621680944274"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.UI.html#getTermOrTypeRef"><span class="hs-identifier hs-type">getTermOrTypeRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621680944274"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2Branch.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621680944273"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server.DefinitionReference</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-80"></span><span id="getTermOrTypeRef"><span class="annot"><span class="annottext">getTermOrTypeRef :: forall (m :: * -&gt; *) (n :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Branch n -&gt; Name -&gt; Cli (Maybe DefinitionReference)
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#getTermOrTypeRef"><span class="hs-identifier hs-var hs-var">getTermOrTypeRef</span></a></span></span><span> </span><span id="local-6989586621680944100"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621680944100"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621680944099"><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621680944099"><span class="hs-identifier hs-var">namespaceBranch</span></a></span></span><span> </span><span id="local-6989586621680944098"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944098"><span class="hs-identifier hs-var">fqn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680944097"><span class="annot"><span class="annottext">nameSeg :: NameSegment
</span><a href="#local-6989586621680944097"><span class="hs-identifier hs-var hs-var">nameSeg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSegment
</span><span class="hs-identifier hs-var">Name.lastSegment</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944098"><span class="hs-identifier hs-var">fqn</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680944095"><span class="annot"><span class="annottext">terms :: MaybeT Cli DefinitionReference
</span><a href="#local-6989586621680944095"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-83"></span><span>        </span><span id="local-6989586621680944094"><span class="annot"><span class="annottext">Map Referent (n MdValues)
</span><a href="#local-6989586621680944094"><span class="hs-identifier hs-var">matchingTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680944097"><span class="hs-identifier hs-var">nameSeg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Referent (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.terms</span></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621680944099"><span class="hs-identifier hs-var">namespaceBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>        </span><span id="local-6989586621680944091"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680944091"><span class="hs-identifier hs-var">oneTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map Referent (n MdValues)
</span><a href="#local-6989586621680944094"><span class="hs-identifier hs-var">matchingTerms</span></a></span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Name -&gt; Referent -&gt; Transaction DefinitionReference
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#toTermReference"><span class="hs-identifier hs-var">toTermReference</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621680944100"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944098"><span class="hs-identifier hs-var">fqn</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680944091"><span class="hs-identifier hs-var">oneTerm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680944087"><span class="annot"><span class="annottext">types :: MaybeT Cli DefinitionReference
</span><a href="#local-6989586621680944087"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-87"></span><span>        </span><span id="local-6989586621680944086"><span class="annot"><span class="annottext">Map Reference (n MdValues)
</span><a href="#local-6989586621680944086"><span class="hs-identifier hs-var">matchingTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680944097"><span class="hs-identifier hs-var">nameSeg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Branch m -&gt; Map NameSegment (Map Reference (m MdValues))
</span><span class="hs-identifier hs-var">V2Branch.types</span></span><span> </span><span class="annot"><span class="annottext">Branch n
</span><a href="#local-6989586621680944099"><span class="hs-identifier hs-var">namespaceBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>        </span><span id="local-6989586621680944084"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680944084"><span class="hs-identifier hs-var">oneType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (n MdValues)
</span><a href="#local-6989586621680944086"><span class="hs-identifier hs-var">matchingTypes</span></a></span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Reference -&gt; DefinitionReference
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#toTypeReference"><span class="hs-identifier hs-var">toTypeReference</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944098"><span class="hs-identifier hs-var">fqn</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680944084"><span class="hs-identifier hs-var">oneType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><span class="annottext">MaybeT Cli DefinitionReference
</span><a href="#local-6989586621680944095"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">MaybeT Cli DefinitionReference
</span><a href="#local-6989586621680944087"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.UI.html#openUIForLooseCode"><span class="hs-identifier hs-type">openUIForLooseCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server.BaseUrl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Path'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span id="openUIForLooseCode"><span class="annot"><span class="annottext">openUIForLooseCode :: BaseUrl -&gt; Path' -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#openUIForLooseCode"><span class="hs-identifier hs-var hs-var">openUIForLooseCode</span></a></span></span><span> </span><span id="local-6989586621680944081"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680944081"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span id="local-6989586621680944080"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621680944080"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680944079"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621680944079"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621680944078"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944078"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680944077"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944077"><span class="hs-identifier hs-var">perspective</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680944076"><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621680944076"><span class="hs-identifier hs-var">definitionRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Absolute
-&gt; Path'
-&gt; Codebase m Symbol Ann
-&gt; Cli (Absolute, Maybe DefinitionReference)
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#getUIUrlParts"><span class="hs-identifier hs-var">getUIUrlParts</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944078"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621680944080"><span class="hs-identifier hs-var">path'</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680944079"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span id="local-6989586621680944074"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680944074"><span class="hs-identifier hs-var">_success</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">openBrowser</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Service -&gt; BaseUrl -&gt; Text
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Maybe DefinitionReference -&gt; Service
</span><span class="hs-identifier hs-var">Server.LooseCodeUI</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944077"><span class="hs-identifier hs-var">perspective</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621680944076"><span class="hs-identifier hs-var">definitionRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680944081"><span class="hs-identifier hs-var">url</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span id="local-6989586621680944253"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.UI.html#getUIUrlParts"><span class="hs-identifier hs-type">getUIUrlParts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Path'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621680944253"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Server.DefinitionReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-101"></span><span id="getUIUrlParts"><span class="annot"><span class="annottext">getUIUrlParts :: forall (m :: * -&gt; *).
Absolute
-&gt; Path'
-&gt; Codebase m Symbol Ann
-&gt; Cli (Absolute, Maybe DefinitionReference)
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#getUIUrlParts"><span class="hs-identifier hs-var hs-var">getUIUrlParts</span></a></span></span><span> </span><span id="local-6989586621680944062"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944062"><span class="hs-identifier hs-var">startPath</span></a></span></span><span> </span><span id="local-6989586621680944061"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621680944061"><span class="hs-identifier hs-var">definitionPath'</span></a></span></span><span> </span><span id="local-6989586621680944060"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621680944060"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680944059"><span class="annot"><span class="annottext">absPath :: Absolute
</span><a href="#local-6989586621680944059"><span class="hs-identifier hs-var hs-var">absPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l r o. Resolve l r o =&gt; l -&gt; r -&gt; o
</span><span class="hs-identifier hs-var">Path.resolve</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944062"><span class="hs-identifier hs-var">startPath</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621680944061"><span class="hs-identifier hs-var">definitionPath'</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680944058"><span class="annot"><span class="annottext">perspective :: Absolute
</span><a href="#local-6989586621680944058"><span class="hs-identifier hs-var hs-var">perspective</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Bool
</span><span class="hs-identifier hs-var">Path.isAbsolute</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621680944061"><span class="hs-identifier hs-var">definitionPath'</span></a></span><span>
</span><span id="line-105"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span>
</span><span id="line-106"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944062"><span class="hs-identifier hs-var">startPath</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall s a. Snoc s s a a =&gt; s -&gt; Maybe (s, a)
</span><span class="hs-identifier hs-var">Lens.unsnoc</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944059"><span class="hs-identifier hs-var">absPath</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680944055"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944055"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680944054"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680944054"><span class="hs-identifier hs-var">_nameSeg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>      </span><span id="local-6989586621680944053"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680944053"><span class="hs-identifier hs-var">namespaceBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span>
</span><span id="line-111"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
-&gt; Maybe (Branch Transaction) -&gt; Transaction (Branch Transaction)
</span><span class="hs-identifier hs-var">Codebase.getShallowBranchAtPath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944055"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>      </span><span id="local-6989586621680944052"><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621680944052"><span class="hs-identifier hs-var">mayDefRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>        </span><span id="local-6989586621680944051"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944051"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">hoistMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Path.toName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Path
</span><span class="hs-identifier hs-var">Path.fromPath'</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621680944061"><span class="hs-identifier hs-var">definitionPath'</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (n :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Branch n -&gt; Name -&gt; Cli (Maybe DefinitionReference)
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#getTermOrTypeRef"><span class="hs-identifier hs-var">getTermOrTypeRef</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621680944060"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680944053"><span class="hs-identifier hs-var">namespaceBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944051"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><a href="#local-6989586621680944052"><span class="hs-identifier hs-var">mayDefRef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="annottext">Maybe DefinitionReference
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944059"><span class="hs-identifier hs-var">absPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680944049"><span class="annot"><span class="annottext">DefinitionReference
</span><a href="#local-6989586621680944049"><span class="hs-identifier hs-var">defRef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944058"><span class="hs-identifier hs-var">perspective</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">DefinitionReference
</span><a href="#local-6989586621680944049"><span class="hs-identifier hs-var">defRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Absolute, NameSegment)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680944059"><span class="hs-identifier hs-var">absPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.UI.html#toTypeReference"><span class="hs-identifier hs-type">toTypeReference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2.Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server.DefinitionReference</span></span><span>
</span><span id="line-122"></span><span id="toTypeReference"><span class="annot"><span class="annottext">toTypeReference :: Name -&gt; Reference -&gt; DefinitionReference
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#toTypeReference"><span class="hs-identifier hs-var hs-var">toTypeReference</span></a></span></span><span> </span><span id="local-6989586621680944048"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944048"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680944047"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680944047"><span class="hs-identifier hs-var">reference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><span class="annottext">HashQualified Name -&gt; DefinitionReference
</span><span class="hs-identifier hs-var">Server.TypeReference</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="annottext">forall n. n -&gt; Reference -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.fromNamedReference</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944048"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Reference
</span><span class="hs-identifier hs-var">Conversions.reference2to1</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680944047"><span class="hs-identifier hs-var">reference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span id="local-6989586621680944258"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.UI.html#toTermReference"><span class="hs-identifier hs-type">toTermReference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621680944258"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2.Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sqlite.Transaction</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server.DefinitionReference</span></span></span><span>
</span><span id="line-127"></span><span id="toTermReference"><span class="annot"><span class="annottext">toTermReference :: forall (m :: * -&gt; *).
Codebase m Symbol Ann
-&gt; Name -&gt; Referent -&gt; Transaction DefinitionReference
</span><a href="Unison.Codebase.Editor.HandleInput.UI.html#toTermReference"><span class="hs-identifier hs-var hs-var">toTermReference</span></a></span></span><span> </span><span id="local-6989586621680944035"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621680944035"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621680944034"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944034"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680944033"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680944033"><span class="hs-identifier hs-var">referent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680944033"><span class="hs-identifier hs-var">referent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">V2.Referent.Ref</span></span><span> </span><span id="local-6989586621680944031"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680944031"><span class="hs-identifier hs-var">reference</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">HashQualified Name -&gt; DefinitionReference
</span><span class="hs-identifier hs-var">Server.TermReference</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-132"></span><span>          </span><span class="annot"><span class="annottext">forall n. n -&gt; Reference -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.fromNamedReference</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944034"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Reference
</span><span class="hs-identifier hs-var">Conversions.reference2to1</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680944031"><span class="hs-identifier hs-var">reference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">V2.Referent.Con</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>      </span><span id="local-6989586621680944028"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680944028"><span class="hs-identifier hs-var">v1Referent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Applicative m =&gt;
(Reference -&gt; m ConstructorType) -&gt; Referent -&gt; m Referent
</span><span class="hs-identifier hs-var">Conversions.referent2to1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Reference -&gt; Transaction ConstructorType
</span><span class="hs-identifier hs-var">Codebase.getDeclType</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621680944035"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680944033"><span class="hs-identifier hs-var">referent</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680944025"><span class="annot"><span class="annottext">hq :: HashQualified Name
</span><a href="#local-6989586621680944025"><span class="hs-identifier hs-var hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n. n -&gt; Referent -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.fromNamedReferent</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680944034"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680944028"><span class="hs-identifier hs-var">v1Referent</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680944028"><span class="hs-identifier hs-var">v1Referent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span class="annot"><span class="annottext">ConstructorReference
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier hs-var">ConstructorType.Data</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>          </span><span class="annot"><span class="annottext">HashQualified Name -&gt; DefinitionReference
</span><span class="hs-identifier hs-var">Server.DataConstructorReference</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680944025"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span class="annot"><span class="annottext">ConstructorReference
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier hs-var">ConstructorType.Effect</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>          </span><span class="annot"><span class="annottext">HashQualified Name -&gt; DefinitionReference
</span><span class="hs-identifier hs-var">Server.AbilityConstructorReference</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680944025"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Impossible! *twirls mustache*&quot;</span></span><span>
</span><span id="line-143"></span></pre></body></html>