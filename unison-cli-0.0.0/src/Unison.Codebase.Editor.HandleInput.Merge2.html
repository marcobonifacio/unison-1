<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Codebase.Editor.HandleInput.Merge2</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#handleMerge"><span class="hs-identifier">handleMerge</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><span class="hs-comment">-- * API exported for @pull@</span></span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#MergeInfo"><span class="hs-identifier">MergeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#AliceMergeInfo"><span class="hs-identifier">AliceMergeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#BobMergeInfo"><span class="hs-identifier">BobMergeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#LcaMergeInfo"><span class="hs-identifier">LcaMergeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#doMerge"><span class="hs-identifier">doMerge</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#doMergeLocalBranch"><span class="hs-identifier">doMergeLocalBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapped</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_1</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Writer</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Writer</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifoldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bifoldMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bitraversable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bitraverse</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Foldable</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:|)</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List.NonEmpty</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semialign</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">align</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NESet</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set.NonEmpty</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.These</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">These</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.ANSI</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Builder</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Builder</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Builder</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Branch</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CausalBranch</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2.Branch</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Causal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2.Causal</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.HashTags</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CausalHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unCausalHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.DbId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProjectId</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Operations</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Operations</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Project</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Project</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.ProjectBranch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProjectBranch</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Queries</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Queries</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin.Decls</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Builtin.Decls</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.MergeTypes.html"><span class="hs-identifier">Unison.Cli.MergeTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSource"><span class="hs-identifier">MergeSource</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSourceAndTarget"><span class="hs-identifier">MergeSourceAndTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSourceOrTarget"><span class="hs-identifier">MergeSourceOrTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html"><span class="hs-identifier">Unison.Cli.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier">Cli</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html"><span class="hs-identifier">Unison.Cli.Monad</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cli</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.MonadUtils.html"><span class="hs-identifier">Unison.Cli.MonadUtils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cli</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.ProjectUtils.html"><span class="hs-identifier">Unison.Cli.ProjectUtils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ProjectUtils</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Branch0</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Branch.html"><span class="hs-identifier">Unison.Codebase.Editor.HandleInput.Branch</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HandleInput.Branch</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Update2.html"><span class="hs-identifier">Unison.Codebase.Editor.HandleInput.Update2</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Update2.html#getNamespaceDependentsOf2"><span class="hs-identifier">getNamespaceDependentsOf2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Update2.html#makeParsingEnv"><span class="hs-identifier">makeParsingEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Update2.html#prettyParseTypecheck2"><span class="hs-identifier">prettyParseTypecheck2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Update2.html#typecheckedUnisonFileToBranchAdds"><span class="hs-identifier">typecheckedUnisonFileToBranchAdds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html"><span class="hs-identifier">Unison.Codebase.Editor.Output</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Output</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.RemoteRepo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ReadShareLooseCode</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Path</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SqliteCodebase.Branch.Cache</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newBranchCache</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SqliteCodebase.Conversions</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Conversions</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SqliteCodebase.Operations</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Operations</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ConstructorReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">GConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decl</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Debug</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Debug</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Hash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Hash</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Hash</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hash</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified'</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ'</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.CombineDiffs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CombinedDiffOp</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">combineDiffs</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.Database</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MergeDatabase</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makeMergeDatabase</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">referent2to1</span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.DeclCoherencyCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IncoherentDeclReason</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">checkDeclCoherency</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lenientCheckDeclCoherency</span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.DeclNameLookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DeclNameLookup</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">expectConstructorNames</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.Diff</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Merge</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.DiffOp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DiffOp</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.EitherWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EitherWay</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.EitherWayI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EitherWayI</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.EitherWayI</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EitherWayI</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.Libdeps</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Merge</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.PartitionCombinedDiffs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partitionCombinedDiffs</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.Synhashed</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Synhashed</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.Synhashed</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Synhashed</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.ThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.ThreeWay</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ThreeWay</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.TwoOrThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TwoOrThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.TwoWay</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TwoWay</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.TwoWayI</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TwoWayI</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.Unconflicts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Unconflicts</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.Unconflicts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Unconflicts</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Merge.Updated</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Updated</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment.Internal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment.Internal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PrettyPrintEnv</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PrettyPrintEnvDecl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Project</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProjectAndBranch</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProjectBranchName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProjectBranchNameKind</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProjectName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Semver</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">classifyProjectBranchName</span></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent'</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent'</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sqlite</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.DeclPrinter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AccessorName</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.DeclPrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DeclPrinter</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.TermPrinter</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TermPrinter</span></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Typechecker</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Typechecker</span></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Defns</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">alignDefnsWith</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defnsAreEmpty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipDefnsWith</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipDefnsWith3</span></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Monoid</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Monoid</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">flattenNametree</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">traverseNametreeWithName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unflattenNametree</span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ColorText</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Relation</span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Relation</span></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Star2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Star2</span></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Star2</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Star2</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.SyntaxText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SyntaxText'</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Witch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeFrom</span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zip</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWith</span></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#handleMerge"><span class="hs-identifier hs-type">handleMerge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectName</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span id="handleMerge"><span class="annot"><span class="annottext">handleMerge :: ProjectAndBranch (Maybe ProjectName) ProjectBranchName -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#handleMerge"><span class="hs-identifier hs-var hs-var">handleMerge</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span id="local-6989586621680965058"><span class="annot"><span class="annottext">Maybe ProjectName
</span><a href="#local-6989586621680965058"><span class="hs-identifier hs-var">maybeBobProjectName</span></a></span></span><span> </span><span id="local-6989586621680965057"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680965057"><span class="hs-identifier hs-var">bobBranchName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-comment">-- Assert that Alice (us) is on a project branch, and grab the causal hash.</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680965056"><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680965056"><span class="hs-identifier hs-var">aliceProjectAndBranch</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680965055"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621680965055"><span class="hs-identifier hs-var">_path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli (ProjectAndBranch Project ProjectBranch, Path)
</span><a href="Unison.Cli.ProjectUtils.html#expectCurrentProjectBranch"><span class="hs-identifier hs-var">ProjectUtils.expectCurrentProjectBranch</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-comment">-- Resolve Bob's maybe-project-name + branch-name to the info the merge algorithm needs: the project name, branch</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-comment">-- name, and causal hash.</span><span>
</span><span id="line-149"></span><span>  </span><span id="local-6989586621680965053"><span class="annot"><span class="annottext">Project
</span><a href="#local-6989586621680965053"><span class="hs-identifier hs-var">bobProject</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ProjectName
</span><a href="#local-6989586621680965058"><span class="hs-identifier hs-var">maybeBobProjectName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="annottext">Maybe ProjectName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680965056"><span class="hs-identifier hs-var">aliceProjectAndBranch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">project</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680965052"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621680965052"><span class="hs-identifier hs-var">bobProjectName</span></a></span></span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621680965052"><span class="hs-identifier hs-var">bobProjectName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680965056"><span class="hs-identifier hs-var">aliceProjectAndBranch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">project</span><span class="hs-operator">.</span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680965056"><span class="hs-identifier hs-var">aliceProjectAndBranch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">project</span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>            </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectName -&gt; Transaction (Maybe Project)
</span><span class="hs-identifier hs-var">Queries.loadProjectByName</span></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621680965052"><span class="hs-identifier hs-var">bobProjectName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>              </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><span class="hs-identifier hs-var">onNothingM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Output -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectName -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#LocalProjectDoesntExist"><span class="hs-identifier hs-var">Output.LocalProjectDoesntExist</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621680965052"><span class="hs-identifier hs-var">bobProjectName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621680965045"><span class="annot"><span class="annottext">ProjectBranch
</span><a href="#local-6989586621680965045"><span class="hs-identifier hs-var">bobProjectBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Project -&gt; ProjectBranchName -&gt; Cli ProjectBranch
</span><a href="Unison.Cli.ProjectUtils.html#expectProjectBranchByName"><span class="hs-identifier hs-var">ProjectUtils.expectProjectBranchByName</span></a></span><span> </span><span class="annot"><span class="annottext">Project
</span><a href="#local-6989586621680965053"><span class="hs-identifier hs-var">bobProject</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680965057"><span class="hs-identifier hs-var">bobBranchName</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965043"><span class="annot"><span class="annottext">bobProjectAndBranch :: ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680965043"><span class="hs-identifier hs-var hs-var">bobProjectAndBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; ProjectAndBranch a b
</span><span class="hs-identifier hs-var">ProjectAndBranch</span></span><span> </span><span class="annot"><span class="annottext">Project
</span><a href="#local-6989586621680965053"><span class="hs-identifier hs-var">bobProject</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranch
</span><a href="#local-6989586621680965045"><span class="hs-identifier hs-var">bobProjectBranch</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="annottext">TwoWay (ProjectAndBranch Project ProjectBranch) -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#doMergeLocalBranch"><span class="hs-identifier hs-var">doMergeLocalBranch</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:alice:TwoWay :: ProjectAndBranch Project ProjectBranch
</span><span class="hs-identifier hs-var">alice</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680965056"><span class="hs-identifier hs-var">aliceProjectAndBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">$sel:bob:TwoWay :: ProjectAndBranch Project ProjectBranch
</span><span class="hs-identifier hs-var">bob</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
</span><a href="#local-6989586621680965043"><span class="hs-identifier hs-var">bobProjectAndBranch</span></a></span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-keyword">data</span><span> </span><span id="MergeInfo"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#MergeInfo"><span class="hs-identifier hs-var">MergeInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MergeInfo"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#MergeInfo"><span class="hs-identifier hs-var">MergeInfo</span></a></span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Aalice%3AMergeInfo"><span class="annot"><span class="annottext">MergeInfo -&gt; AliceMergeInfo
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Aalice%3AMergeInfo"><span class="hs-identifier hs-var hs-var">alice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#AliceMergeInfo"><span class="hs-identifier hs-type">AliceMergeInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-168"></span><span>    </span><span id="%24sel%3Abob%3AMergeInfo"><span class="annot"><span class="annottext">MergeInfo -&gt; BobMergeInfo
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Abob%3AMergeInfo"><span class="hs-identifier hs-var hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#BobMergeInfo"><span class="hs-identifier hs-type">BobMergeInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-169"></span><span>    </span><span id="%24sel%3Alca%3AMergeInfo"><span class="annot"><span class="annottext">MergeInfo -&gt; LcaMergeInfo
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Alca%3AMergeInfo"><span class="hs-identifier hs-var hs-var">lca</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#LcaMergeInfo"><span class="hs-identifier hs-type">LcaMergeInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- | How should we describe this merge in the reflog?</span><span>
</span><span id="line-171"></span><span>    </span><span id="%24sel%3Adescription%3AMergeInfo"><span class="annot"><span class="annottext">MergeInfo -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Adescription%3AMergeInfo"><span class="hs-identifier hs-var hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-keyword">data</span><span> </span><span id="AliceMergeInfo"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#AliceMergeInfo"><span class="hs-identifier hs-var">AliceMergeInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AliceMergeInfo"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#AliceMergeInfo"><span class="hs-identifier hs-var">AliceMergeInfo</span></a></span></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcausalHash%3AAliceMergeInfo"><span class="annot"><span class="annottext">AliceMergeInfo -&gt; CausalHash
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AcausalHash%3AAliceMergeInfo"><span class="hs-identifier hs-var hs-var">causalHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>    </span><span id="%24sel%3AprojectAndBranch%3AAliceMergeInfo"><span class="annot"><span class="annottext">AliceMergeInfo -&gt; ProjectAndBranch Project ProjectBranch
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AprojectAndBranch%3AAliceMergeInfo"><span class="hs-identifier hs-var hs-var">projectAndBranch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Project</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranch</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-keyword">data</span><span> </span><span id="BobMergeInfo"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#BobMergeInfo"><span class="hs-identifier hs-var">BobMergeInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BobMergeInfo"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#BobMergeInfo"><span class="hs-identifier hs-var">BobMergeInfo</span></a></span></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcausalHash%3ABobMergeInfo"><span class="annot"><span class="annottext">BobMergeInfo -&gt; CausalHash
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AcausalHash%3ABobMergeInfo"><span class="hs-identifier hs-var hs-var">causalHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span class="hs-special">,</span><span>
</span><span id="line-181"></span><span>    </span><span id="%24sel%3Asource%3ABobMergeInfo"><span class="annot"><span class="annottext">BobMergeInfo -&gt; MergeSource
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Asource%3ABobMergeInfo"><span class="hs-identifier hs-var hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSource"><span class="hs-identifier hs-type">MergeSource</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-keyword">newtype</span><span> </span><span id="LcaMergeInfo"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#LcaMergeInfo"><span class="hs-identifier hs-var">LcaMergeInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LcaMergeInfo"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#LcaMergeInfo"><span class="hs-identifier hs-var">LcaMergeInfo</span></a></span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcausalHash%3ALcaMergeInfo"><span class="annot"><span class="annottext">LcaMergeInfo -&gt; Maybe CausalHash
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AcausalHash%3ALcaMergeInfo"><span class="hs-identifier hs-var hs-var">causalHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#doMerge"><span class="hs-identifier hs-type">doMerge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#MergeInfo"><span class="hs-identifier hs-type">MergeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span id="doMerge"><span class="annot"><span class="annottext">doMerge :: MergeInfo -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#doMerge"><span class="hs-identifier hs-var hs-var">doMerge</span></a></span></span><span> </span><span id="local-6989586621680965026"><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965025"><span class="annot"><span class="annottext">debugFunctions :: DebugFunctions
</span><a href="#local-6989586621680965025"><span class="hs-identifier hs-var hs-var">debugFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DebugFlag -&gt; Bool
</span><span class="hs-identifier hs-var">Debug.shouldDebug</span></span><span> </span><span class="annot"><span class="annottext">DebugFlag
</span><span class="hs-identifier hs-var">Debug.Merge</span></span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DebugFunctions
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugFunctions"><span class="hs-identifier hs-var">realDebugFunctions</span></a></span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DebugFunctions
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#fakeDebugFunctions"><span class="hs-identifier hs-var">fakeDebugFunctions</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965020"><span class="annot"><span class="annottext">alicePath :: Absolute
</span><a href="#local-6989586621680965020"><span class="hs-identifier hs-var hs-var">alicePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectId ProjectBranchId -&gt; Absolute
</span><span class="hs-identifier hs-var">ProjectUtils.projectBranchPath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
-&gt; ProjectAndBranch ProjectId ProjectBranchId
</span><a href="Unison.Cli.ProjectUtils.html#justTheIds"><span class="hs-identifier hs-var">ProjectUtils.justTheIds</span></a></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">projectAndBranch</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965017"><span class="annot"><span class="annottext">aliceBranchNames :: MergeTarget
</span><a href="#local-6989586621680965017"><span class="hs-identifier hs-var hs-var">aliceBranchNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch -&gt; MergeTarget
</span><a href="Unison.Cli.ProjectUtils.html#justTheNames"><span class="hs-identifier hs-var">ProjectUtils.justTheNames</span></a></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">projectAndBranch</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965015"><span class="annot"><span class="annottext">mergeSource :: MergeSourceOrTarget
</span><a href="#local-6989586621680965015"><span class="hs-identifier hs-var hs-var">mergeSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MergeSource -&gt; MergeSourceOrTarget
</span><a href="Unison.Cli.MergeTypes.html#MergeSourceOrTarget%27Source"><span class="hs-identifier hs-var">MergeSourceOrTarget'Source</span></a></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">source</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965013"><span class="annot"><span class="annottext">mergeTarget :: MergeSourceOrTarget
</span><a href="#local-6989586621680965013"><span class="hs-identifier hs-var hs-var">mergeTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MergeTarget -&gt; MergeSourceOrTarget
</span><a href="Unison.Cli.MergeTypes.html#MergeSourceOrTarget%27Target"><span class="hs-identifier hs-var">MergeSourceOrTarget'Target</span></a></span><span> </span><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680965017"><span class="hs-identifier hs-var">aliceBranchNames</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965011"><span class="annot"><span class="annottext">mergeSourceAndTarget :: MergeSourceAndTarget
</span><a href="#local-6989586621680965011"><span class="hs-identifier hs-var hs-var">mergeSourceAndTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSourceAndTarget"><span class="hs-identifier hs-type">MergeSourceAndTarget</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:alice:MergeSourceAndTarget :: MergeTarget
</span><a href="Unison.Cli.MergeTypes.html#%24sel%3Aalice%3AMergeSourceAndTarget"><span class="hs-identifier hs-var">alice</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680965017"><span class="hs-identifier hs-var">aliceBranchNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:bob:MergeSourceAndTarget :: MergeSource
</span><a href="Unison.Cli.MergeTypes.html#%24sel%3Abob%3AMergeSourceAndTarget"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">source</span><span class="hs-special">}</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680965006"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
</span><a href="Unison.Cli.Monad.html#%24sel%3Acodebase%3AEnv"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><span class="annottext">forall a. ((forall void. a -&gt; Cli void) -&gt; Cli a) -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#label"><span class="hs-identifier hs-var">Cli.label</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680965003"><span class="annot"><span class="annottext">forall void. () -&gt; Cli void
</span><a href="#local-6989586621680965003"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">-- If alice == bob, or LCA == bob (so alice is ahead of bob), then we are done.</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeSourceAndTarget -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeAlreadyUpToDate2"><span class="hs-identifier hs-var">Output.MergeAlreadyUpToDate2</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceAndTarget
</span><a href="#local-6989586621680965011"><span class="hs-identifier hs-var">mergeSourceAndTarget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">forall void. () -&gt; Cli void
</span><a href="#local-6989586621680965003"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- Otherwise, if LCA == alice (so alice is behind bob), then we could fast forward to bob, so we're done.</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>      </span><span id="local-6989586621680964998"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621680964998"><span class="hs-identifier hs-var">bobBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; CausalHash -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Codebase.expectBranchForHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680965006"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; (Branch IO -&gt; Branch IO) -&gt; Cli Bool
</span><a href="Unison.Cli.MonadUtils.html#updateAt"><span class="hs-identifier hs-var">Cli.updateAt</span></a></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">description</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680965020"><span class="hs-identifier hs-var">alicePath</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680964994"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621680964994"><span class="hs-identifier hs-var">_aliceBranch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621680964998"><span class="hs-identifier hs-var">bobBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeSourceAndTarget -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeSuccessFastForward"><span class="hs-identifier hs-var">Output.MergeSuccessFastForward</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceAndTarget
</span><a href="#local-6989586621680965011"><span class="hs-identifier hs-var">mergeSourceAndTarget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><span class="annottext">forall void. () -&gt; Cli void
</span><a href="#local-6989586621680965003"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-comment">-- Create a bunch of cached database lookup functions</span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621680964992"><span class="annot"><span class="annottext">MergeDatabase
</span><a href="#local-6989586621680964992"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase IO Symbol Ann -&gt; m MergeDatabase
</span><span class="hs-identifier hs-var">makeMergeDatabase</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680965006"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-comment">-- Load Alice/Bob/LCA causals</span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621680964991"><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964991"><span class="hs-identifier hs-var">causals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><span class="annottext">CausalHash -&gt; Transaction (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Operations.expectCausalBranchByCausalHash</span></span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">TwoOrThreeWay</span></span><span>
</span><span id="line-224"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:alice:TwoOrThreeWay :: CausalHash
</span><span class="hs-identifier hs-var">alice</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">,</span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><span class="annottext">$sel:bob:TwoOrThreeWay :: CausalHash
</span><span class="hs-identifier hs-var">bob</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">,</span><span>
</span><span id="line-226"></span><span>            </span><span class="annot"><span class="annottext">$sel:lca:TwoOrThreeWay :: Maybe CausalHash
</span><span class="hs-identifier hs-var">lca</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span>
</span><span id="line-227"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DebugFunctions
</span><a href="#local-6989586621680965025"><span class="hs-identifier hs-var">debugFunctions</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">debugCausals</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964991"><span class="hs-identifier hs-var">causals</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- Load Alice/Bob/LCA branches</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621680964984"><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964984"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>        </span><span id="local-6989586621680964983"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964983"><span class="hs-identifier hs-var">alice</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964991"><span class="hs-identifier hs-var">causals</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-235"></span><span>        </span><span id="local-6989586621680964982"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964982"><span class="hs-identifier hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964991"><span class="hs-identifier hs-var">causals</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-236"></span><span>        </span><span id="local-6989586621680964981"><span class="annot"><span class="annottext">Maybe (Branch Transaction)
</span><a href="#local-6989586621680964981"><span class="hs-identifier hs-var">lca</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964991"><span class="hs-identifier hs-var">causals</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964979"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964979"><span class="hs-identifier hs-var">causal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964979"><span class="hs-identifier hs-var">causal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-237"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoOrThreeWay</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Maybe (Branch Transaction)
lca :: Maybe (Branch Transaction)
$sel:lca:TwoOrThreeWay :: Maybe (Branch Transaction)
</span><a href="#local-6989586621680964981"><span class="hs-identifier hs-var hs-var">lca</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
alice :: Branch Transaction
$sel:alice:TwoOrThreeWay :: Branch Transaction
</span><a href="#local-6989586621680964983"><span class="hs-identifier hs-var hs-var">alice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
bob :: Branch Transaction
$sel:bob:TwoOrThreeWay :: Branch Transaction
</span><a href="#local-6989586621680964982"><span class="hs-identifier hs-var hs-var">bob</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-comment">-- Assert that neither Alice nor Bob have defns in lib</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680965013"><span class="hs-identifier hs-var">mergeTarget</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964984"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680965015"><span class="hs-identifier hs-var">mergeSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964984"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964977"><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680964977"><span class="hs-identifier hs-var">who</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964976"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964976"><span class="hs-identifier hs-var">branch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>      </span><span id="local-6989586621680964975"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964975"><span class="hs-identifier hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier hs-var">NameSegment.libSegment</span></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964976"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">children</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-243"></span><span>          </span><span class="annot"><span class="annottext">Maybe (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch m
</span><span class="hs-identifier hs-var">V2.Branch.empty</span></span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680964971"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964971"><span class="hs-identifier hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964971"><span class="hs-identifier hs-var">libdeps</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964975"><span class="hs-identifier hs-var">libdeps</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964975"><span class="hs-identifier hs-var">libdeps</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>        </span><span class="annot"><span class="annottext">forall a. Output -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeSourceOrTarget -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeDefnsInLib"><span class="hs-identifier hs-var">Output.MergeDefnsInLib</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680964977"><span class="hs-identifier hs-var">who</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-comment">-- Load Alice/Bob/LCA definitions and decl name lookups</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680964967"><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964967"><span class="hs-identifier hs-var">defns3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964966"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964966"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964965"><span class="annot"><span class="annottext">Map Name [Maybe Name]
</span><a href="#local-6989586621680964965"><span class="hs-identifier hs-var">lcaDeclToConstructors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964964"><span class="annot"><span class="annottext">emptyNametree :: Nametree (Defns (Map k a) (Map k a))
</span><a href="#local-6989586621680964964"><span class="hs-identifier hs-var hs-var">emptyNametree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:Nametree :: Defns (Map k a) (Map k a)
</span><span class="hs-identifier hs-var">value</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall terms types. terms -&gt; types -&gt; Defns terms types
</span><span class="hs-identifier hs-var">Defns</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:children:Nametree :: Map NameSegment (Nametree (Defns (Map k a) (Map k a)))
</span><span class="hs-identifier hs-var">children</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">}</span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964958"><span class="annot"><span class="annottext">loadDefns :: Branch Transaction
-&gt; Cli
     (Nametree
        (Defns (Map NameSegment Referent) (Map NameSegment TypeReference)))
</span><a href="#local-6989586621680964958"><span class="hs-identifier hs-var hs-var">loadDefns</span></a></span></span><span> </span><span id="local-6989586621680964957"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964957"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-252"></span><span>            </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
(Referent -&gt; m Referent)
-&gt; Branch m
-&gt; m (Either
        ConflictedName
        (Nametree
           (Defns
              (Map NameSegment Referent) (Map NameSegment TypeReference))))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#loadNamespaceDefinitions"><span class="hs-identifier hs-var">loadNamespaceDefinitions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeDatabase -&gt; Referent -&gt; Transaction Referent
</span><span class="hs-identifier hs-var">referent2to1</span></span><span> </span><span class="annot"><span class="annottext">MergeDatabase
</span><a href="#local-6989586621680964992"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964957"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; m (Either a b) -&gt; m b
</span><span class="hs-identifier hs-var">onLeftM</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964954"><span class="annot"><span class="annottext">ConflictedName
</span><a href="#local-6989586621680964954"><span class="hs-identifier hs-var">conflictedName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-253"></span><span>              </span><span class="annot"><span class="annottext">forall a. Output -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConflictedName
</span><a href="#local-6989586621680964954"><span class="hs-identifier hs-var">conflictedName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-254"></span><span>                </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName%27Term"><span class="hs-identifier hs-type">ConflictedName'Term</span></a></span><span> </span><span id="local-6989586621680964952"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964952"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680964951"><span class="annot"><span class="annottext">NESet Referent
</span><a href="#local-6989586621680964951"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NESet Referent -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeConflictedTermName"><span class="hs-identifier hs-var">Output.MergeConflictedTermName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964952"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">NESet Referent
</span><a href="#local-6989586621680964951"><span class="hs-identifier hs-var">refs</span></a></span><span>
</span><span id="line-255"></span><span>                </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName%27Type"><span class="hs-identifier hs-type">ConflictedName'Type</span></a></span><span> </span><span id="local-6989586621680964948"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964948"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680964947"><span class="annot"><span class="annottext">NESet TypeReference
</span><a href="#local-6989586621680964947"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NESet TypeReference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeConflictedTypeName"><span class="hs-identifier hs-var">Output.MergeConflictedTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964948"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">NESet TypeReference
</span><a href="#local-6989586621680964947"><span class="hs-identifier hs-var">refs</span></a></span><span>
</span><span id="line-256"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964945"><span class="annot"><span class="annottext">load :: Maybe (MergeSourceOrTarget, Branch Transaction)
-&gt; Cli
     (Nametree
        (Defns (Map NameSegment Referent) (Map NameSegment TypeReference)),
      DeclNameLookup)
</span><a href="#local-6989586621680964945"><span class="hs-identifier hs-var hs-var">load</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-257"></span><span>            </span><span class="annot"><span class="annottext">Maybe (MergeSourceOrTarget, Branch Transaction)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} {a} {k} {a}. Nametree (Defns (Map k a) (Map k a))
</span><a href="#local-6989586621680964964"><span class="hs-identifier hs-var">emptyNametree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Name Name -&gt; Map Name [Name] -&gt; DeclNameLookup
</span><span class="hs-identifier hs-var">DeclNameLookup</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680964943"><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680964943"><span class="hs-identifier hs-var">who</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964942"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964942"><span class="hs-identifier hs-var">branch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>              </span><span id="local-6989586621680964941"><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964941"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
-&gt; Cli
     (Nametree
        (Defns (Map NameSegment Referent) (Map NameSegment TypeReference)))
</span><a href="#local-6989586621680964958"><span class="hs-identifier hs-var">loadDefns</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964942"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-260"></span><span>              </span><span id="local-6989586621680964940"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964940"><span class="hs-identifier hs-var">declNameLookup</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-261"></span><span>                </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
(TermReferenceId -&gt; m Int)
-&gt; Nametree
     (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
-&gt; m (Either IncoherentDeclReason DeclNameLookup)
</span><span class="hs-identifier hs-var">checkDeclCoherency</span></span><span> </span><span class="annot"><span class="annottext">MergeDatabase
</span><a href="#local-6989586621680964992"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">loadDeclNumConstructors</span><span> </span><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964941"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; m (Either a b) -&gt; m b
</span><span class="hs-identifier hs-var">onLeftM</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964939"><span class="annot"><span class="annottext">IncoherentDeclReason
</span><a href="#local-6989586621680964939"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-262"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Output -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IncoherentDeclReason
</span><a href="#local-6989586621680964939"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-263"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">IncoherentDeclReason'ConstructorAlias</span></span><span> </span><span id="local-6989586621680964937"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964937"><span class="hs-identifier hs-var">typeName</span></a></span></span><span> </span><span id="local-6989586621680964936"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964936"><span class="hs-identifier hs-var">conName1</span></a></span></span><span> </span><span id="local-6989586621680964935"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964935"><span class="hs-identifier hs-var">conName2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>                      </span><span class="annot"><span class="annottext">MergeSourceOrTarget -&gt; Name -&gt; Name -&gt; Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeConstructorAlias"><span class="hs-identifier hs-var">Output.MergeConstructorAlias</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680964943"><span class="hs-identifier hs-var">who</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964937"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964936"><span class="hs-identifier hs-var">conName1</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964935"><span class="hs-identifier hs-var">conName2</span></a></span><span>
</span><span id="line-265"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">IncoherentDeclReason'MissingConstructorName</span></span><span> </span><span id="local-6989586621680964932"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964932"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget -&gt; Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeMissingConstructorName"><span class="hs-identifier hs-var">Output.MergeMissingConstructorName</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680964943"><span class="hs-identifier hs-var">who</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964932"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-266"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">IncoherentDeclReason'NestedDeclAlias</span></span><span> </span><span id="local-6989586621680964929"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964929"><span class="hs-identifier hs-var">shorterName</span></a></span></span><span> </span><span id="local-6989586621680964928"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964928"><span class="hs-identifier hs-var">longerName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-267"></span><span>                      </span><span class="annot"><span class="annottext">MergeSourceOrTarget -&gt; Name -&gt; Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeNestedDeclAlias"><span class="hs-identifier hs-var">Output.MergeNestedDeclAlias</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680964943"><span class="hs-identifier hs-var">who</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964929"><span class="hs-identifier hs-var">shorterName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964928"><span class="hs-identifier hs-var">longerName</span></a></span><span>
</span><span id="line-268"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">IncoherentDeclReason'StrayConstructor</span></span><span> </span><span id="local-6989586621680964925"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964925"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget -&gt; Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeStrayConstructor"><span class="hs-identifier hs-var">Output.MergeStrayConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680964943"><span class="hs-identifier hs-var">who</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964925"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-269"></span><span>              </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964941"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964940"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680964923"><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964923"><span class="hs-identifier hs-var">aliceDefns0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964922"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964922"><span class="hs-identifier hs-var">aliceDeclNameLookup</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (MergeSourceOrTarget, Branch Transaction)
-&gt; Cli
     (Nametree
        (Defns (Map NameSegment Referent) (Map NameSegment TypeReference)),
      DeclNameLookup)
</span><a href="#local-6989586621680964945"><span class="hs-identifier hs-var">load</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680965013"><span class="hs-identifier hs-var">mergeTarget</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964984"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680964921"><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964921"><span class="hs-identifier hs-var">bobDefns0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964920"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964920"><span class="hs-identifier hs-var">bobDeclNameLookup</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (MergeSourceOrTarget, Branch Transaction)
-&gt; Cli
     (Nametree
        (Defns (Map NameSegment Referent) (Map NameSegment TypeReference)),
      DeclNameLookup)
</span><a href="#local-6989586621680964945"><span class="hs-identifier hs-var">load</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680965015"><span class="hs-identifier hs-var">mergeSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964984"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>      </span><span id="local-6989586621680964919"><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964919"><span class="hs-identifier hs-var">lcaDefns0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall {k} {a} {k} {a}. Nametree (Defns (Map k a) (Map k a))
</span><a href="#local-6989586621680964964"><span class="hs-identifier hs-var">emptyNametree</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
-&gt; Cli
     (Nametree
        (Defns (Map NameSegment Referent) (Map NameSegment TypeReference)))
</span><a href="#local-6989586621680964958"><span class="hs-identifier hs-var">loadDefns</span></a></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964984"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span>
</span><span id="line-274"></span><span>      </span><span id="local-6989586621680964917"><span class="annot"><span class="annottext">Map Name [Maybe Name]
</span><a href="#local-6989586621680964917"><span class="hs-identifier hs-var">lcaDeclToConstructors</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
(TermReferenceId -&gt; m Int)
-&gt; Nametree
     (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
-&gt; m (Map Name [Maybe Name])
</span><span class="hs-identifier hs-var">lenientCheckDeclCoherency</span></span><span> </span><span class="annot"><span class="annottext">MergeDatabase
</span><a href="#local-6989586621680964992"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">loadDeclNumConstructors</span><span> </span><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964919"><span class="hs-identifier hs-var">lcaDefns0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964888"><span class="annot"><span class="annottext">flatten :: Nametree s -&gt; Defns (BiMultimap b Name) (BiMultimap b Name)
</span><a href="#local-6989586621680964888"><span class="hs-identifier hs-var hs-var">flatten</span></a></span></span><span> </span><span id="local-6989586621680964887"><span class="annot"><span class="annottext">Nametree s
</span><a href="#local-6989586621680964887"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall terms types. terms -&gt; types -&gt; Defns terms types
</span><span class="hs-identifier hs-var">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b.
Ord b =&gt;
(a -&gt; Map NameSegment b) -&gt; Nametree a -&gt; BiMultimap b Name
</span><span class="hs-identifier hs-var">flattenNametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;terms&quot; a =&gt; a
</span><span class="">#terms</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nametree s
</span><a href="#local-6989586621680964887"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b.
Ord b =&gt;
(a -&gt; Map NameSegment b) -&gt; Nametree a -&gt; BiMultimap b Name
</span><span class="hs-identifier hs-var">flattenNametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;types&quot; a =&gt; a
</span><span class="">#types</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nametree s
</span><a href="#local-6989586621680964887"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964885"><span class="annot"><span class="annottext">defns3 :: ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964885"><span class="hs-identifier hs-var hs-var">defns3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {b} {b} {s}.
(Ord b, Ord b, HasField' &quot;types&quot; s (Map NameSegment b),
 HasField' &quot;terms&quot; s (Map NameSegment b)) =&gt;
Nametree s -&gt; Defns (BiMultimap b Name) (BiMultimap b Name)
</span><a href="#local-6989586621680964888"><span class="hs-identifier hs-var">flatten</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ThreeWay</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:alice:ThreeWay :: Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><span class="hs-identifier hs-var">alice</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964923"><span class="hs-identifier hs-var">aliceDefns0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:bob:ThreeWay :: Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><span class="hs-identifier hs-var">bob</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964921"><span class="hs-identifier hs-var">bobDefns0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:lca:ThreeWay :: Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><span class="hs-identifier hs-var">lca</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964919"><span class="hs-identifier hs-var">lcaDefns0</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-278"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964879"><span class="annot"><span class="annottext">declNameLookups :: TwoWay DeclNameLookup
</span><a href="#local-6989586621680964879"><span class="hs-identifier hs-var hs-var">declNameLookups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:alice:TwoWay :: DeclNameLookup
</span><span class="hs-identifier hs-var">alice</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964922"><span class="hs-identifier hs-var">aliceDeclNameLookup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:bob:TwoWay :: DeclNameLookup
</span><span class="hs-identifier hs-var">bob</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964920"><span class="hs-identifier hs-var">bobDeclNameLookup</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964885"><span class="hs-identifier hs-var">defns3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964879"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Name [Maybe Name]
</span><a href="#local-6989586621680964917"><span class="hs-identifier hs-var">lcaDeclToConstructors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964878"><span class="annot"><span class="annottext">defns :: TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964878"><span class="hs-identifier hs-var hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ThreeWay a -&gt; TwoWay a
</span><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964967"><span class="hs-identifier hs-var">defns3</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DebugFunctions
</span><a href="#local-6989586621680965025"><span class="hs-identifier hs-var">debugFunctions</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">debugDefns</span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964967"><span class="hs-identifier hs-var">defns3</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964966"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name [Maybe Name]
</span><a href="#local-6989586621680964965"><span class="hs-identifier hs-var">lcaDeclToConstructors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-comment">-- Diff LCA-&gt;Alice and LCA-&gt;Bob</span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621680964876"><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
</span><a href="#local-6989586621680964876"><span class="hs-identifier hs-var">diffs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeDatabase
-&gt; TwoWay DeclNameLookup
-&gt; Map Name [Maybe Name]
-&gt; ThreeWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; Transaction
     (TwoWay
        (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference))
</span><span class="hs-identifier hs-var">Merge.nameBasedNamespaceDiff</span></span><span> </span><span class="annot"><span class="annottext">MergeDatabase
</span><a href="#local-6989586621680964992"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964966"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name [Maybe Name]
</span><a href="#local-6989586621680964965"><span class="hs-identifier hs-var">lcaDeclToConstructors</span></a></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964967"><span class="hs-identifier hs-var">defns3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DebugFunctions
</span><a href="#local-6989586621680965025"><span class="hs-identifier hs-var">debugFunctions</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">debugDiffs</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
</span><a href="#local-6989586621680964876"><span class="hs-identifier hs-var">diffs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-comment">-- Bail early if it looks like we can't proceed with the merge, because Alice or Bob has one or more conflicted alias</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a -&gt; TwoWay a
</span><span class="hs-identifier hs-var">TwoWay</span></span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680965013"><span class="hs-identifier hs-var">mergeTarget</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680965015"><span class="hs-identifier hs-var">mergeSource</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
</span><a href="#local-6989586621680964876"><span class="hs-identifier hs-var">diffs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964874"><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680964874"><span class="hs-identifier hs-var">who</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964873"><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference
</span><a href="#local-6989586621680964873"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">whenJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall term typ.
(Ord term, Ord typ) =&gt;
Defns (BiMultimap term Name) (BiMultimap typ Name)
-&gt; DefnsF3 (Map Name) DiffOp Synhashed term typ
-&gt; Maybe (Name, Name)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#findConflictedAlias"><span class="hs-identifier hs-var">findConflictedAlias</span></a></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964967"><span class="hs-identifier hs-var">defns3</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span> </span><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference
</span><a href="#local-6989586621680964873"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964870"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964870"><span class="hs-identifier hs-var">name1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964869"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964869"><span class="hs-identifier hs-var">name2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="annottext">forall a. Output -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeSourceOrTarget -&gt; Name -&gt; Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeConflictedAliases"><span class="hs-identifier hs-var">Output.MergeConflictedAliases</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceOrTarget
</span><a href="#local-6989586621680964874"><span class="hs-identifier hs-var">who</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964870"><span class="hs-identifier hs-var">name1</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964869"><span class="hs-identifier hs-var">name2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-comment">-- Combine the LCA-&gt;Alice and LCA-&gt;Bob diffs together</span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964867"><span class="annot"><span class="annottext">diff :: DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
</span><a href="#local-6989586621680964867"><span class="hs-identifier hs-var hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
-&gt; DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
</span><span class="hs-identifier hs-var">combineDiffs</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
</span><a href="#local-6989586621680964876"><span class="hs-identifier hs-var">diffs</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DebugFunctions
</span><a href="#local-6989586621680965025"><span class="hs-identifier hs-var">debugFunctions</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">debugCombinedDiff</span><span> </span><span class="annot"><span class="annottext">DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
</span><a href="#local-6989586621680964867"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-comment">-- Partition the combined diff into the conflicted things and the unconflicted things</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680964866"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964866"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964865"><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964865"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay DeclNameLookup
-&gt; DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
-&gt; Either
     Name
     (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId),
      DefnsF Unconflicts Referent TypeReference)
</span><span class="hs-identifier hs-var">partitionCombinedDiffs</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964878"><span class="hs-identifier hs-var">defns</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964966"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
</span><a href="#local-6989586621680964867"><span class="hs-identifier hs-var">diff</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m b) -&gt; Either a b -&gt; m b
</span><span class="hs-identifier hs-var">onLeft</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964863"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964863"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">forall a. Output -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeConflictInvolvingBuiltin"><span class="hs-identifier hs-var">Output.MergeConflictInvolvingBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964863"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DebugFunctions
</span><a href="#local-6989586621680965025"><span class="hs-identifier hs-var">debugFunctions</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">debugPartitionedDiff</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964866"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964865"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-comment">-- Identify the unconflicted dependents we need to pull into the Unison file (either first for typechecking, if there</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-comment">-- aren't conflicts, or else for manual conflict resolution without a typechecking step, if there are)</span><span>
</span><span id="line-310"></span><span>    </span><span id="local-6989586621680964861"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964861"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
-&gt; DefnsF Unconflicts Referent TypeReference
-&gt; Transaction
     (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#identifyDependents"><span class="hs-identifier hs-var">identifyDependents</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964878"><span class="hs-identifier hs-var">defns</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964866"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964865"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DebugFunctions
</span><a href="#local-6989586621680965025"><span class="hs-identifier hs-var">debugFunctions</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">debugDependents</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964861"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680964859"><span class="hs-identifier hs-type">stageOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span>
</span><span id="line-315"></span><span>        </span><span id="local-6989586621680964859"><span class="annot"><span class="annottext">stageOne :: DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964859"><span class="hs-identifier hs-var hs-var">stageOne</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>          </span><span class="annot"><span class="annottext">forall termid typeid term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (DefnsF (Map Name) termid typeid)
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (DefnsF (Map Name) termid typeid)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makeStageOne"><span class="hs-identifier hs-var">makeStageOne</span></a></span><span>
</span><span id="line-317"></span><span>            </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964966"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span>
</span><span id="line-318"></span><span>            </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964866"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-319"></span><span>            </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964865"><span class="hs-identifier hs-var">unconflicts</span></a></span><span>
</span><span id="line-320"></span><span>            </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964861"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-321"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964967"><span class="hs-identifier hs-var">defns3</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DebugFunctions
</span><a href="#local-6989586621680965025"><span class="hs-identifier hs-var">debugFunctions</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">debugStageOne</span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964859"><span class="hs-identifier hs-var">stageOne</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-comment">-- Load and merge Alice's and Bob's libdeps</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621680964855"><span class="annot"><span class="annottext">Branch0 Transaction
</span><a href="#local-6989586621680964855"><span class="hs-identifier hs-var">mergedLibdeps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-328"></span><span>        </span><span id="local-6989586621680964854"><span class="annot"><span class="annottext">ThreeWay (Map NameSegment (CausalBranch Transaction))
</span><a href="#local-6989586621680964854"><span class="hs-identifier hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
-&gt; Transaction
     (ThreeWay (Map NameSegment (CausalBranch Transaction)))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#loadLibdeps"><span class="hs-identifier hs-var">loadLibdeps</span></a></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964984"><span class="hs-identifier hs-var">branches</span></a></span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">MergeDatabase
-&gt; Map NameSegment (CausalBranch Transaction)
-&gt; Transaction (Branch0 Transaction)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#libdepsToBranch0"><span class="hs-identifier hs-var">libdepsToBranch0</span></a></span><span> </span><span class="annot"><span class="annottext">MergeDatabase
</span><a href="#local-6989586621680964992"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v.
(Ord k, Eq v) =&gt;
(Set k -&gt; k -&gt; (k, k)) -&gt; ThreeWay (Map k v) -&gt; Map k v
</span><span class="hs-identifier hs-var">Merge.mergeLibdeps</span></span><span> </span><span class="annot"><span class="annottext">Set NameSegment -&gt; NameSegment -&gt; (NameSegment, NameSegment)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#getTwoFreshNames"><span class="hs-identifier hs-var">getTwoFreshNames</span></a></span><span> </span><span class="annot"><span class="annottext">ThreeWay (Map NameSegment (CausalBranch Transaction))
</span><a href="#local-6989586621680964854"><span class="hs-identifier hs-var">libdeps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-comment">-- Make PPE for Alice that contains all of Alice's names, but suffixified against her names + Bob's names</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680964849"><span class="hs-identifier hs-type">mkPpes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span>
</span><span id="line-333"></span><span>        </span><span id="local-6989586621680964849"><span class="annot"><span class="annottext">mkPpes :: TwoWay Names -&gt; Names -&gt; TwoWay PrettyPrintEnvDecl
</span><a href="#local-6989586621680964849"><span class="hs-identifier hs-var hs-var">mkPpes</span></a></span></span><span> </span><span id="local-6989586621680964848"><span class="annot"><span class="annottext">TwoWay Names
</span><a href="#local-6989586621680964848"><span class="hs-identifier hs-var">defnsNames</span></a></span></span><span> </span><span id="local-6989586621680964847"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621680964847"><span class="hs-identifier hs-var">libdepsNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>          </span><span class="annot"><span class="annottext">TwoWay Names
</span><a href="#local-6989586621680964848"><span class="hs-identifier hs-var">defnsNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964845"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621680964845"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Namer -&gt; Suffixifier -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.makePPED</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Namer
</span><span class="hs-identifier hs-var">PPE.namer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621680964845"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621680964847"><span class="hs-identifier hs-var">libdepsNames</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Suffixifier
</span><a href="#local-6989586621680964842"><span class="hs-identifier hs-var">suffixifier</span></a></span><span>
</span><span id="line-335"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-336"></span><span>            </span><span id="local-6989586621680964842"><span class="annot"><span class="annottext">suffixifier :: Suffixifier
</span><a href="#local-6989586621680964842"><span class="hs-identifier hs-var hs-var">suffixifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Suffixifier
</span><span class="hs-identifier hs-var">PPE.suffixifyByName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="annot"><span class="annottext">TwoWay Names
</span><a href="#local-6989586621680964848"><span class="hs-identifier hs-var">defnsNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621680964847"><span class="hs-identifier hs-var">libdepsNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964839"><span class="annot"><span class="annottext">ppes :: TwoWay PrettyPrintEnvDecl
</span><a href="#local-6989586621680964839"><span class="hs-identifier hs-var hs-var">ppes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay Names -&gt; Names -&gt; TwoWay PrettyPrintEnvDecl
</span><a href="#local-6989586621680964849"><span class="hs-identifier hs-var">mkPpes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; Names
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#defnsToNames"><span class="hs-identifier hs-var">defnsToNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964878"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 Transaction
</span><a href="#local-6989586621680964855"><span class="hs-identifier hs-var">mergedLibdeps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621680964836"><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann),
   DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621680964836"><span class="hs-identifier hs-var">hydratedThings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-340"></span><span>      </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964866"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964861"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964835"><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId
</span><a href="#local-6989586621680964835"><span class="hs-identifier hs-var">conflicts1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964834"><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId
</span><a href="#local-6989586621680964834"><span class="hs-identifier hs-var">dependents1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964833"><span class="annot"><span class="annottext">hydrate :: DefnsF (Map Name) TermReferenceId TermReferenceId
-&gt; Transaction
     (DefnsF
        (Map Name)
        (Term Symbol Ann, Type Symbol Ann)
        (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621680964833"><span class="hs-identifier hs-var hs-var">hydrate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) name term typ.
(Monad m, Ord name) =&gt;
(Hash -&gt; m [term])
-&gt; (Hash -&gt; m [typ])
-&gt; DefnsF (Map name) TermReferenceId TermReferenceId
-&gt; m (DefnsF (Map name) term (TermReferenceId, typ))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#hydrateDefns"><span class="hs-identifier hs-var">hydrateDefns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
HasCallStack =&gt;
Codebase m v a -&gt; Hash -&gt; Transaction [(Term v a, Type v a)]
</span><span class="hs-identifier hs-var">Codebase.unsafeGetTermComponent</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680965006"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Hash -&gt; Transaction [Decl Symbol Ann]
</span><span class="hs-identifier hs-var">Operations.expectDeclComponent</span></span><span>
</span><span id="line-343"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId
-&gt; Transaction
     (DefnsF
        (Map Name)
        (Term Symbol Ann, Type Symbol Ann)
        (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621680964833"><span class="hs-identifier hs-var">hydrate</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId
</span><a href="#local-6989586621680964835"><span class="hs-identifier hs-var">conflicts1</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId
-&gt; Transaction
     (DefnsF
        (Map Name)
        (Term Symbol Ann, Type Symbol Ann)
        (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621680964833"><span class="hs-identifier hs-var">hydrate</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId
</span><a href="#local-6989586621680964834"><span class="hs-identifier hs-var">dependents1</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680964829"><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964829"><span class="hs-identifier hs-var">renderedConflicts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964828"><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964828"><span class="hs-identifier hs-var">renderedDependents</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-346"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964809"><span class="annot"><span class="annottext">honk :: DeclNameLookup
-&gt; PrettyPrintEnvDecl
-&gt; r
-&gt; Defns
     (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText))
</span><a href="#local-6989586621680964809"><span class="hs-identifier hs-var hs-var">honk</span></a></span></span><span> </span><span id="local-6989586621680964808"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964808"><span class="hs-identifier hs-var">declNameLookup</span></a></span></span><span> </span><span id="local-6989586621680964807"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680964807"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621680964806"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680964806"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-347"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680964805"><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
</span><a href="#local-6989586621680964805"><span class="hs-identifier hs-var">types</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964804"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680964804"><span class="hs-identifier hs-var">accessorNames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>                      </span><span class="annot"><span class="annottext">forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">Writer.runWriter</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-349"></span><span>                        </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680964806"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) k a b.
Applicative t =&gt;
(k -&gt; a -&gt; t b) -&gt; Map k a -&gt; t (Map k b)
</span><span class="hs-identifier hs-var">Map.traverseWithKey</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964801"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964801"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680964800"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964800"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964799"><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621680964799"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-350"></span><span>                          </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnvDecl
-&gt; Name
-&gt; TermReferenceId
-&gt; Decl v a
-&gt; WriterT (Set Name) Identity (Pretty ColorText)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#renderTypeBinding"><span class="hs-identifier hs-var">renderTypeBinding</span></a></span><span>
</span><span id="line-351"></span><span>                            </span><span class="hs-comment">-- Sort of a hack; since the decl printer looks in the PPE for names of constructors,</span><span>
</span><span id="line-352"></span><span>                            </span><span class="hs-comment">-- we just delete all term names out and add back the constructors...</span><span>
</span><span id="line-353"></span><span>                            </span><span class="hs-comment">-- probably no need to wipe out the suffixified side but we do it anyway</span><span>
</span><span id="line-354"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeclNameLookup
-&gt; Name
-&gt; TermReferenceId
-&gt; PrettyPrintEnvDecl
-&gt; PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#setPpedToConstructorNames"><span class="hs-identifier hs-var">setPpedToConstructorNames</span></a></span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964808"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964801"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964800"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680964807"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>                            </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964801"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-356"></span><span>                            </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964800"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-357"></span><span>                            </span><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621680964799"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-358"></span><span>                    </span><span id="local-6989586621680964796"><span class="annot"><span class="annottext">terms :: Map Name (Pretty ColorText)
</span><a href="#local-6989586621680964796"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-359"></span><span>                      </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680964806"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall k a b. (k -&gt; a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapMaybeWithKey</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964794"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964794"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680964793"><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621680964793"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964792"><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621680964792"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-360"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964794"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680964804"><span class="hs-identifier hs-var">accessorNames</span></a></span><span>
</span><span id="line-361"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-362"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a v.
(Monoid a, Var v) =&gt;
PrettyPrintEnv -&gt; Name -&gt; Term v a -&gt; Type v a -&gt; Pretty ColorText
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#renderTermBinding"><span class="hs-identifier hs-var">renderTermBinding</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680964807"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">suffixifiedPPE</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964794"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621680964793"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621680964792"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
$sel:terms:Defns :: Map Name (Pretty ColorText)
terms :: Map Name (Pretty ColorText)
</span><span class="hs-identifier hs-var hs-var">terms</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
$sel:types:Defns :: Map Name (Pretty ColorText)
types :: Map Name (Pretty ColorText)
</span><span class="hs-identifier hs-var hs-var">types</span></span><span class="hs-special">}</span><span>
</span><span id="line-364"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Unzip f =&gt; f (a, b) -&gt; (f a, f b)
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-365"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964787"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964787"><span class="hs-identifier hs-var">declNameLookup</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680964786"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (Term Symbol Ann, Type Symbol Ann)
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621680964786"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964785"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (Term Symbol Ann, Type Symbol Ann)
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621680964785"><span class="hs-identifier hs-var">dependents</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680964784"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680964784"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964783"><span class="annot"><span class="annottext">honk1 :: DefnsF
  (Map Name)
  (Term Symbol Ann, Type Symbol Ann)
  (TermReferenceId, Decl Symbol Ann)
-&gt; Defns
     (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText))
</span><a href="#local-6989586621680964783"><span class="hs-identifier hs-var hs-var">honk1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {r} {v} {a} {v} {a}.
(HasField &quot;types&quot; r (Map Name (TermReferenceId, Decl v a)),
 HasField &quot;terms&quot; r (Map Name (Term v a, Type v a)), Monoid a,
 Var v, Var v) =&gt;
DeclNameLookup
-&gt; PrettyPrintEnvDecl
-&gt; r
-&gt; Defns
     (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText))
</span><a href="#local-6989586621680964809"><span class="hs-identifier hs-var">honk</span></a></span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964787"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680964784"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-367"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (Term Symbol Ann, Type Symbol Ann)
  (TermReferenceId, Decl Symbol Ann)
-&gt; Defns
     (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText))
</span><a href="#local-6989586621680964783"><span class="hs-identifier hs-var">honk1</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (Term Symbol Ann, Type Symbol Ann)
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621680964786"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (Term Symbol Ann, Type Symbol Ann)
  (TermReferenceId, Decl Symbol Ann)
-&gt; Defns
     (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText))
</span><a href="#local-6989586621680964783"><span class="hs-identifier hs-var">honk1</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (Term Symbol Ann, Type Symbol Ann)
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621680964785"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>                  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964966"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span>
</span><span id="line-370"></span><span>                  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann),
   DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621680964836"><span class="hs-identifier hs-var">hydratedThings</span></a></span><span>
</span><span id="line-371"></span><span>                  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay PrettyPrintEnvDecl
</span><a href="#local-6989586621680964839"><span class="hs-identifier hs-var">ppes</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964782"><span class="annot"><span class="annottext">prettyUnisonFile :: Pretty ColorText
</span><a href="#local-6989586621680964782"><span class="hs-identifier hs-var hs-var">prettyUnisonFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-374"></span><span>          </span><span class="annot"><span class="annottext">TwoWay Text
-&gt; TwoWay
     (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
-&gt; TwoWay
     (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
-&gt; Pretty ColorText
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makePrettyUnisonFile"><span class="hs-identifier hs-var">makePrettyUnisonFile</span></a></span><span>
</span><span id="line-375"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span>
</span><span id="line-376"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:alice:TwoWay :: Text
</span><span class="hs-identifier hs-var">alice</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680965017"><span class="hs-identifier hs-var">aliceBranchNames</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-377"></span><span>                </span><span class="annot"><span class="annottext">$sel:bob:TwoWay :: Text
</span><span class="hs-identifier hs-var">bob</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-378"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">source</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-379"></span><span>                    </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSource%27LocalProjectBranch"><span class="hs-identifier hs-type">MergeSource'LocalProjectBranch</span></a></span><span> </span><span id="local-6989586621680964778"><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680964778"><span class="hs-identifier hs-var">bobBranchNames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680964778"><span class="hs-identifier hs-var">bobBranchNames</span></a></span><span>
</span><span id="line-380"></span><span>                    </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSource%27RemoteProjectBranch"><span class="hs-identifier hs-type">MergeSource'RemoteProjectBranch</span></a></span><span> </span><span id="local-6989586621680964776"><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680964776"><span class="hs-identifier hs-var">bobBranchNames</span></a></span></span><span>
</span><span id="line-381"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680965017"><span class="hs-identifier hs-var">aliceBranchNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680964776"><span class="hs-identifier hs-var">bobBranchNames</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;remote &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680964776"><span class="hs-identifier hs-var">bobBranchNames</span></a></span><span>
</span><span id="line-382"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">MergeTarget
</span><a href="#local-6989586621680964776"><span class="hs-identifier hs-var">bobBranchNames</span></a></span><span>
</span><span id="line-383"></span><span>                    </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSource%27RemoteLooseCode"><span class="hs-identifier hs-type">MergeSource'RemoteLooseCode</span></a></span><span> </span><span id="local-6989586621680964774"><span class="annot"><span class="annottext">ReadShareLooseCode
</span><a href="#local-6989586621680964774"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-384"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Path.toName</span></span><span> </span><span class="annot"><span class="annottext">ReadShareLooseCode
</span><a href="#local-6989586621680964774"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">path</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-385"></span><span>                        </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;root&gt;&quot;</span></span><span>
</span><span id="line-386"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680964772"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964772"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964772"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-387"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-388"></span><span>            </span><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964829"><span class="hs-identifier hs-var">renderedConflicts</span></a></span><span>
</span><span id="line-389"></span><span>            </span><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964828"><span class="hs-identifier hs-var">renderedDependents</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964770"><span class="annot"><span class="annottext">stageOneBranch :: Branch0 IO
</span><a href="#local-6989586621680964770"><span class="hs-identifier hs-var hs-var">stageOneBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v a.
Codebase IO v a
-&gt; DefnsF (Map Name) Referent TypeReference
-&gt; Branch0 Transaction
-&gt; Branch0 IO
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#defnsAndLibdepsToBranch0"><span class="hs-identifier hs-var">defnsAndLibdepsToBranch0</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680965006"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964859"><span class="hs-identifier hs-var">stageOne</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 Transaction
</span><a href="#local-6989586621680964855"><span class="hs-identifier hs-var">mergedLibdeps</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>    </span><span id="local-6989586621680964768"><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680964768"><span class="hs-identifier hs-var">maybeTypecheckedUnisonFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-394"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964767"><span class="annot"><span class="annottext">thisMergeHasConflicts :: Bool
</span><a href="#local-6989586621680964767"><span class="hs-identifier hs-var hs-var">thisMergeHasConflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-395"></span><span>            </span><span class="hs-comment">-- Eh, they'd either both be null, or neither, but just check both maps anyway</span><span>
</span><span id="line-396"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Foldable f, Foldable g) =&gt;
Defns (f a) (g b) -&gt; Bool
</span><span class="hs-identifier hs-var">defnsAreEmpty</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964866"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Foldable f, Foldable g) =&gt;
Defns (f a) (g b) -&gt; Bool
</span><span class="hs-identifier hs-var">defnsAreEmpty</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964866"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680964767"><span class="hs-identifier hs-var">thisMergeHasConflicts</span></a></span><span>
</span><span id="line-398"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-399"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-400"></span><span>              </span><span id="local-6989586621680964766"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680964766"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-401"></span><span>              </span><span id="local-6989586621680964764"><span class="annot"><span class="annottext">ParsingEnv Transaction
</span><a href="#local-6989586621680964764"><span class="hs-identifier hs-var">parsingEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Names -&gt; Cli (ParsingEnv Transaction)
</span><a href="Unison.Codebase.Editor.HandleInput.Update2.html#makeParsingEnv"><span class="hs-identifier hs-var">makeParsingEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680964766"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621680964770"><span class="hs-identifier hs-var">stageOneBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>              </span><span class="annot"><span class="annottext">Pretty ColorText
-&gt; ParsingEnv Transaction
-&gt; Cli
     (Either (Pretty ColorText) (TypecheckedUnisonFile Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.Update2.html#prettyParseTypecheck2"><span class="hs-identifier hs-var">prettyParseTypecheck2</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964782"><span class="hs-identifier hs-var">prettyUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">ParsingEnv Transaction
</span><a href="#local-6989586621680964764"><span class="hs-identifier hs-var">parsingEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Either a b -&gt; Maybe b
</span><span class="hs-identifier hs-var">eitherToMaybe</span></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964762"><span class="annot"><span class="annottext">parents :: TwoOrThreeWay (CausalHash, IO (Branch IO))
</span><a href="#local-6989586621680964762"><span class="hs-identifier hs-var hs-var">parents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-405"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680964761"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964761"><span class="hs-identifier hs-var">causal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964761"><span class="hs-identifier hs-var">causal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; CausalHash -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Codebase.expectBranchForHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680965006"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964761"><span class="hs-identifier hs-var">causal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964991"><span class="hs-identifier hs-var">causals</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621680964768"><span class="hs-identifier hs-var">maybeTypecheckedUnisonFile</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-408"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680964760"><span class="annot"><span class="annottext">Text -&gt; Text -&gt; IO ()
$sel:writeSource:Env :: Env -&gt; Text -&gt; Text -&gt; IO ()
writeSource :: Text -&gt; Text -&gt; IO ()
</span><a href="Unison.Cli.Monad.html#%24sel%3AwriteSource%3AEnv"><span class="hs-identifier hs-var hs-var">writeSource</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-410"></span><span>        </span><span id="local-6989586621680964758"><span class="annot"><span class="annottext">ProjectBranchId
</span><a href="#local-6989586621680964758"><span class="hs-identifier hs-var">_temporaryBranchId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-411"></span><span>          </span><span class="annot"><span class="annottext">Branch IO
-&gt; Maybe ProjectBranchId
-&gt; Project
-&gt; Transaction ProjectBranchName
-&gt; Text
-&gt; Cli ProjectBranchId
</span><a href="Unison.Codebase.Editor.HandleInput.Branch.html#doCreateBranch%27"><span class="hs-identifier hs-var">HandleInput.Branch.doCreateBranch'</span></a></span><span>
</span><span id="line-412"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Applicative m =&gt;
Branch0 m
-&gt; (CausalHash, m (Branch m))
-&gt; (CausalHash, m (Branch m))
-&gt; Branch m
</span><span class="hs-identifier hs-var">Branch.mergeNode</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621680964770"><span class="hs-identifier hs-var">stageOneBranch</span></a></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalHash, IO (Branch IO))
</span><a href="#local-6989586621680964762"><span class="hs-identifier hs-var">parents</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalHash, IO (Branch IO))
</span><a href="#local-6989586621680964762"><span class="hs-identifier hs-var">parents</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>            </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-414"></span><span>            </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">projectAndBranch</span><span class="hs-operator">.</span><span class="hs-identifier">project</span><span>
</span><span id="line-415"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectId -&gt; MergeSourceAndTarget -&gt; Transaction ProjectBranchName
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#findTemporaryBranchName"><span class="hs-identifier hs-var">findTemporaryBranchName</span></a></span><span> </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">projectAndBranch</span><span class="hs-operator">.</span><span class="hs-identifier">project</span><span class="hs-operator">.</span><span class="hs-identifier">projectId</span><span> </span><span class="annot"><span class="annottext">MergeSourceAndTarget
</span><a href="#local-6989586621680965011"><span class="hs-identifier hs-var">mergeSourceAndTarget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>            </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">description</span><span>
</span><span id="line-417"></span><span>        </span><span id="local-6989586621680964754"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680964754"><span class="hs-identifier hs-var">scratchFilePath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-418"></span><span>          </span><span class="annot"><span class="annottext">Cli (Maybe (FilePath, Bool))
</span><a href="Unison.Cli.MonadUtils.html#getLatestFile"><span class="hs-identifier hs-var">Cli.getLatestFile</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-419"></span><span>            </span><span class="annot"><span class="annottext">Maybe (FilePath, Bool)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;scratch.u&quot;</span></span><span>
</span><span id="line-420"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680964752"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680964752"><span class="hs-identifier hs-var">file</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680964752"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-421"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; IO ()
</span><a href="#local-6989586621680964760"><span class="hs-identifier hs-var">writeSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680964754"><span class="hs-identifier hs-var">scratchFilePath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; FilePath
</span><span class="hs-identifier hs-var">Pretty.toPlain</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964782"><span class="hs-identifier hs-var">prettyUnisonFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>        </span><span class="annot"><span class="annottext">Output -&gt; Cli ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; MergeSourceAndTarget -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeFailure"><span class="hs-identifier hs-var">Output.MergeFailure</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680964754"><span class="hs-identifier hs-var">scratchFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceAndTarget
</span><a href="#local-6989586621680965011"><span class="hs-identifier hs-var">mergeSourceAndTarget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680964748"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621680964748"><span class="hs-identifier hs-var">tuf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>        </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a.
(Var v, Show a) =&gt;
Codebase m v a -&gt; TypecheckedUnisonFile v a -&gt; Transaction ()
</span><span class="hs-identifier hs-var">Codebase.addDefsToCodebase</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680965006"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621680964748"><span class="hs-identifier hs-var">tuf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964746"><span class="annot"><span class="annottext">stageTwoBranch :: Branch0 IO
</span><a href="#local-6989586621680964746"><span class="hs-identifier hs-var hs-var">stageTwoBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (m :: * -&gt; *).
(Monad m, Foldable f) =&gt;
f (Path, Branch0 m -&gt; Branch0 m) -&gt; Branch0 m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.batchUpdates</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
TypecheckedUnisonFile Symbol Ann
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="Unison.Codebase.Editor.HandleInput.Update2.html#typecheckedUnisonFileToBranchAdds"><span class="hs-identifier hs-var">typecheckedUnisonFileToBranchAdds</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621680964748"><span class="hs-identifier hs-var">tuf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621680964770"><span class="hs-identifier hs-var">stageOneBranch</span></a></span><span>
</span><span id="line-426"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-427"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; (Branch IO -&gt; Branch IO) -&gt; Cli Bool
</span><a href="Unison.Cli.MonadUtils.html#updateAt"><span class="hs-identifier hs-var">Cli.updateAt</span></a></span><span>
</span><span id="line-428"></span><span>            </span><span class="annot"><span class="annottext">MergeInfo
</span><a href="#local-6989586621680965026"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">description</span><span>
</span><span id="line-429"></span><span>            </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680965020"><span class="hs-identifier hs-var">alicePath</span></a></span><span>
</span><span id="line-430"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680964744"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621680964744"><span class="hs-identifier hs-var">_aliceBranch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Applicative m =&gt;
Branch0 m
-&gt; (CausalHash, m (Branch m))
-&gt; (CausalHash, m (Branch m))
-&gt; Branch m
</span><span class="hs-identifier hs-var">Branch.mergeNode</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621680964746"><span class="hs-identifier hs-var">stageTwoBranch</span></a></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalHash, IO (Branch IO))
</span><a href="#local-6989586621680964762"><span class="hs-identifier hs-var">parents</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalHash, IO (Branch IO))
</span><a href="#local-6989586621680964762"><span class="hs-identifier hs-var">parents</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>        </span><span class="annot"><span class="annottext">Output -&gt; Cli ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MergeSourceAndTarget -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeSuccess"><span class="hs-identifier hs-var">Output.MergeSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceAndTarget
</span><a href="#local-6989586621680965011"><span class="hs-identifier hs-var">mergeSourceAndTarget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#doMergeLocalBranch"><span class="hs-identifier hs-type">doMergeLocalBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Project</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranch</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span id="doMergeLocalBranch"><span class="annot"><span class="annottext">doMergeLocalBranch :: TwoWay (ProjectAndBranch Project ProjectBranch) -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#doMergeLocalBranch"><span class="hs-identifier hs-var hs-var">doMergeLocalBranch</span></a></span></span><span> </span><span id="local-6989586621680964742"><span class="annot"><span class="annottext">TwoWay (ProjectAndBranch Project ProjectBranch)
</span><a href="#local-6989586621680964742"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680964741"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964741"><span class="hs-identifier hs-var">aliceCausalHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964740"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964740"><span class="hs-identifier hs-var">bobCausalHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964739"><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621680964739"><span class="hs-identifier hs-var">lcaCausalHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><span class="annottext">forall a. Transaction a -&gt; Cli a
</span><a href="Unison.Cli.Monad.html#runTransaction"><span class="hs-identifier hs-var">Cli.runTransaction</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-437"></span><span>      </span><span id="local-6989586621680964738"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964738"><span class="hs-identifier hs-var">aliceCausalHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectId ProjectBranchId
-&gt; Transaction CausalHash
</span><a href="Unison.Cli.ProjectUtils.html#getProjectBranchCausalHash"><span class="hs-identifier hs-var">ProjectUtils.getProjectBranchCausalHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
-&gt; ProjectAndBranch ProjectId ProjectBranchId
</span><a href="Unison.Cli.ProjectUtils.html#justTheIds"><span class="hs-identifier hs-var">ProjectUtils.justTheIds</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (ProjectAndBranch Project ProjectBranch)
</span><a href="#local-6989586621680964742"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>      </span><span id="local-6989586621680964736"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964736"><span class="hs-identifier hs-var">bobCausalHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProjectAndBranch ProjectId ProjectBranchId
-&gt; Transaction CausalHash
</span><a href="Unison.Cli.ProjectUtils.html#getProjectBranchCausalHash"><span class="hs-identifier hs-var">ProjectUtils.getProjectBranchCausalHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch
-&gt; ProjectAndBranch ProjectId ProjectBranchId
</span><a href="Unison.Cli.ProjectUtils.html#justTheIds"><span class="hs-identifier hs-var">ProjectUtils.justTheIds</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (ProjectAndBranch Project ProjectBranch)
</span><a href="#local-6989586621680964742"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>      </span><span class="hs-comment">-- Using Alice and Bob's causal hashes, find the LCA (if it exists)</span><span>
</span><span id="line-440"></span><span>      </span><span id="local-6989586621680964735"><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621680964735"><span class="hs-identifier hs-var">lcaCausalHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; CausalHash -&gt; Transaction (Maybe CausalHash)
</span><span class="hs-identifier hs-var">Operations.lca</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964738"><span class="hs-identifier hs-var">aliceCausalHash</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964736"><span class="hs-identifier hs-var">bobCausalHash</span></a></span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964738"><span class="hs-identifier hs-var">aliceCausalHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964736"><span class="hs-identifier hs-var">bobCausalHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621680964735"><span class="hs-identifier hs-var">lcaCausalHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-comment">-- Do the merge!</span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><span class="annottext">MergeInfo -&gt; Cli ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#doMerge"><span class="hs-identifier hs-var">doMerge</span></a></span><span>
</span><span id="line-445"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#MergeInfo"><span class="hs-identifier hs-type">MergeInfo</span></a></span><span>
</span><span id="line-446"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:alice:MergeInfo :: AliceMergeInfo
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Aalice%3AMergeInfo"><span class="hs-identifier hs-var">alice</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-447"></span><span>          </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#AliceMergeInfo"><span class="hs-identifier hs-type">AliceMergeInfo</span></a></span><span>
</span><span id="line-448"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:causalHash:AliceMergeInfo :: CausalHash
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AcausalHash%3AAliceMergeInfo"><span class="hs-identifier hs-var">causalHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964741"><span class="hs-identifier hs-var">aliceCausalHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-449"></span><span>              </span><span class="annot"><span class="annottext">$sel:projectAndBranch:AliceMergeInfo :: ProjectAndBranch Project ProjectBranch
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AprojectAndBranch%3AAliceMergeInfo"><span class="hs-identifier hs-var">projectAndBranch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay (ProjectAndBranch Project ProjectBranch)
</span><a href="#local-6989586621680964742"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-450"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-451"></span><span>        </span><span class="annot"><span class="annottext">$sel:bob:MergeInfo :: BobMergeInfo
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Abob%3AMergeInfo"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-452"></span><span>          </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#BobMergeInfo"><span class="hs-identifier hs-type">BobMergeInfo</span></a></span><span>
</span><span id="line-453"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:causalHash:BobMergeInfo :: CausalHash
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AcausalHash%3ABobMergeInfo"><span class="hs-identifier hs-var">causalHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680964740"><span class="hs-identifier hs-var">bobCausalHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-454"></span><span>              </span><span class="annot"><span class="annottext">$sel:source:BobMergeInfo :: MergeSource
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Asource%3ABobMergeInfo"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MergeTarget -&gt; MergeSource
</span><a href="Unison.Cli.MergeTypes.html#MergeSource%27LocalProjectBranch"><span class="hs-identifier hs-var">MergeSource'LocalProjectBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch -&gt; MergeTarget
</span><a href="Unison.Cli.ProjectUtils.html#justTheNames"><span class="hs-identifier hs-var">ProjectUtils.justTheNames</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (ProjectAndBranch Project ProjectBranch)
</span><a href="#local-6989586621680964742"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-456"></span><span>        </span><span class="annot"><span class="annottext">$sel:lca:MergeInfo :: LcaMergeInfo
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Alca%3AMergeInfo"><span class="hs-identifier hs-var">lca</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>          </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#LcaMergeInfo"><span class="hs-identifier hs-type">LcaMergeInfo</span></a></span><span>
</span><span id="line-458"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:causalHash:LcaMergeInfo :: Maybe CausalHash
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AcausalHash%3ALcaMergeInfo"><span class="hs-identifier hs-var">causalHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CausalHash
</span><a href="#local-6989586621680964739"><span class="hs-identifier hs-var">lcaCausalHash</span></a></span><span>
</span><span id="line-459"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><span class="annottext">$sel:description:MergeInfo :: Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3Adescription%3AMergeInfo"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;merge &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProjectAndBranch Project ProjectBranch -&gt; MergeTarget
</span><a href="Unison.Cli.ProjectUtils.html#justTheNames"><span class="hs-identifier hs-var">ProjectUtils.justTheNames</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (ProjectAndBranch Project ProjectBranch)
</span><a href="#local-6989586621680964742"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- Loading basic info out of the database</span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#loadLibdeps"><span class="hs-identifier hs-type">loadLibdeps</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoOrThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2.Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-468"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span id="loadLibdeps"><span class="annot"><span class="annottext">loadLibdeps :: TwoOrThreeWay (Branch Transaction)
-&gt; Transaction
     (ThreeWay (Map NameSegment (CausalBranch Transaction)))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#loadLibdeps"><span class="hs-identifier hs-var hs-var">loadLibdeps</span></a></span></span><span> </span><span id="local-6989586621680964733"><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964733"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>  </span><span id="local-6989586621680964732"><span class="annot"><span class="annottext">Map NameSegment (CausalBranch Transaction)
</span><a href="#local-6989586621680964732"><span class="hs-identifier hs-var">lca</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964733"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-472"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Branch Transaction)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-473"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680964731"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964731"><span class="hs-identifier hs-var">lcaBranch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
-&gt; Transaction (Map NameSegment (CausalBranch Transaction))
</span><a href="#local-6989586621680964730"><span class="hs-identifier hs-var">load</span></a></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964731"><span class="hs-identifier hs-var">lcaBranch</span></a></span><span>
</span><span id="line-474"></span><span>  </span><span id="local-6989586621680964729"><span class="annot"><span class="annottext">Map NameSegment (CausalBranch Transaction)
</span><a href="#local-6989586621680964729"><span class="hs-identifier hs-var">alice</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
-&gt; Transaction (Map NameSegment (CausalBranch Transaction))
</span><a href="#local-6989586621680964730"><span class="hs-identifier hs-var">load</span></a></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964733"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-475"></span><span>  </span><span id="local-6989586621680964728"><span class="annot"><span class="annottext">Map NameSegment (CausalBranch Transaction)
</span><a href="#local-6989586621680964728"><span class="hs-identifier hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
-&gt; Transaction (Map NameSegment (CausalBranch Transaction))
</span><a href="#local-6989586621680964730"><span class="hs-identifier hs-var">load</span></a></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (Branch Transaction)
</span><a href="#local-6989586621680964733"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ThreeWay</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Map NameSegment (CausalBranch Transaction)
lca :: Map NameSegment (CausalBranch Transaction)
$sel:lca:ThreeWay :: Map NameSegment (CausalBranch Transaction)
</span><a href="#local-6989586621680964732"><span class="hs-identifier hs-var hs-var">lca</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (CausalBranch Transaction)
alice :: Map NameSegment (CausalBranch Transaction)
$sel:alice:ThreeWay :: Map NameSegment (CausalBranch Transaction)
</span><a href="#local-6989586621680964729"><span class="hs-identifier hs-var hs-var">alice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (CausalBranch Transaction)
bob :: Map NameSegment (CausalBranch Transaction)
$sel:bob:ThreeWay :: Map NameSegment (CausalBranch Transaction)
</span><a href="#local-6989586621680964728"><span class="hs-identifier hs-var hs-var">bob</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-478"></span><span>    </span><span class="annot"><a href="#local-6989586621680964730"><span class="hs-identifier hs-type">load</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2.Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>    </span><span id="local-6989586621680964730"><span class="annot"><span class="annottext">load :: Branch Transaction
-&gt; Transaction (Map NameSegment (CausalBranch Transaction))
</span><a href="#local-6989586621680964730"><span class="hs-identifier hs-var hs-var">load</span></a></span></span><span> </span><span id="local-6989586621680964727"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964727"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-480"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier hs-var">NameSegment.libSegment</span></span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964727"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">children</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><span class="annottext">Maybe (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680964726"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964726"><span class="hs-identifier hs-var">libdepsCausal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-483"></span><span>          </span><span id="local-6989586621680964725"><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964725"><span class="hs-identifier hs-var">libdepsBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964726"><span class="hs-identifier hs-var">libdepsCausal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-484"></span><span>          </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964725"><span class="hs-identifier hs-var">libdepsBranch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">children</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- Creating Unison files</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span id="local-6989586621680966389"><span id="local-6989586621680966390"><span id="local-6989586621680966391"><span id="local-6989586621680966392"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#hydrateDefns"><span class="hs-identifier hs-type">hydrateDefns</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680966392"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680966391"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966392"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680966390"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966392"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680966389"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-493"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966391"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-494"></span><span>  </span><span class="annot"><a href="#local-6989586621680966392"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966391"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680966390"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680966389"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-495"></span><span id="hydrateDefns"><span class="annot"><span class="annottext">hydrateDefns :: forall (m :: * -&gt; *) name term typ.
(Monad m, Ord name) =&gt;
(Hash -&gt; m [term])
-&gt; (Hash -&gt; m [typ])
-&gt; DefnsF (Map name) TermReferenceId TermReferenceId
-&gt; m (DefnsF (Map name) term (TermReferenceId, typ))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#hydrateDefns"><span class="hs-identifier hs-var hs-var">hydrateDefns</span></a></span></span><span> </span><span id="local-6989586621680964714"><span class="annot"><span class="annottext">Hash -&gt; m [term]
</span><a href="#local-6989586621680964714"><span class="hs-identifier hs-var">getTermComponent</span></a></span></span><span> </span><span id="local-6989586621680964713"><span class="annot"><span class="annottext">Hash -&gt; m [typ]
</span><a href="#local-6989586621680964713"><span class="hs-identifier hs-var">getTypeComponent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-496"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; * -&gt; *) (f :: * -&gt; *) a c b d.
(Bitraversable t, Applicative f) =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; t a b -&gt; f (t c d)
</span><span class="hs-identifier hs-var">bitraverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) name term.
(Monad m, Ord name) =&gt;
(Hash -&gt; m [term]) -&gt; Map name TermReferenceId -&gt; m (Map name term)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#hydrateTerms"><span class="hs-identifier hs-var">hydrateTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; m [term]
</span><a href="#local-6989586621680964714"><span class="hs-identifier hs-var">getTermComponent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) name typ.
(Monad m, Ord name) =&gt;
(Hash -&gt; m [typ])
-&gt; Map name TermReferenceId -&gt; m (Map name (TermReferenceId, typ))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#hydrateTypes"><span class="hs-identifier hs-var">hydrateTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; m [typ]
</span><a href="#local-6989586621680964713"><span class="hs-identifier hs-var">getTypeComponent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span id="local-6989586621680966324"><span id="local-6989586621680966325"><span id="local-6989586621680966326"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#hydrateTerms"><span class="hs-identifier hs-type">hydrateTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680966326"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680966325"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966326"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680966324"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966325"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966326"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966325"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966324"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-499"></span><span id="hydrateTerms"><span class="annot"><span class="annottext">hydrateTerms :: forall (m :: * -&gt; *) name term.
(Monad m, Ord name) =&gt;
(Hash -&gt; m [term]) -&gt; Map name TermReferenceId -&gt; m (Map name term)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#hydrateTerms"><span class="hs-identifier hs-var hs-var">hydrateTerms</span></a></span></span><span> </span><span id="local-6989586621680964706"><span class="annot"><span class="annottext">Hash -&gt; m [term]
</span><a href="#local-6989586621680964706"><span class="hs-identifier hs-var">getTermComponent</span></a></span></span><span> </span><span id="local-6989586621680964705"><span class="annot"><span class="annottext">Map name TermReferenceId
</span><a href="#local-6989586621680964705"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><span class="annottext">forall a b name (m :: * -&gt; *).
(Monad m, Ord name) =&gt;
(Hash -&gt; m [a])
-&gt; Map name TermReferenceId
-&gt; (name -&gt; TermReferenceId -&gt; a -&gt; b)
-&gt; m (Map name b)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#componenty"><span class="hs-identifier hs-var">componenty</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; m [term]
</span><a href="#local-6989586621680964706"><span class="hs-identifier hs-var">getTermComponent</span></a></span><span> </span><span class="annot"><span class="annottext">Map name TermReferenceId
</span><a href="#local-6989586621680964705"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span id="local-6989586621680966321"><span id="local-6989586621680966322"><span id="local-6989586621680966323"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#hydrateTypes"><span class="hs-identifier hs-type">hydrateTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680966323"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680966322"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966323"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680966321"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-505"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966322"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-506"></span><span>  </span><span class="annot"><a href="#local-6989586621680966323"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966322"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680966321"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-507"></span><span id="hydrateTypes"><span class="annot"><span class="annottext">hydrateTypes :: forall (m :: * -&gt; *) name typ.
(Monad m, Ord name) =&gt;
(Hash -&gt; m [typ])
-&gt; Map name TermReferenceId -&gt; m (Map name (TermReferenceId, typ))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#hydrateTypes"><span class="hs-identifier hs-var hs-var">hydrateTypes</span></a></span></span><span> </span><span id="local-6989586621680964698"><span class="annot"><span class="annottext">Hash -&gt; m [typ]
</span><a href="#local-6989586621680964698"><span class="hs-identifier hs-var">getTypeComponent</span></a></span></span><span> </span><span id="local-6989586621680964697"><span class="annot"><span class="annottext">Map name TermReferenceId
</span><a href="#local-6989586621680964697"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-508"></span><span>  </span><span class="annot"><span class="annottext">forall a b name (m :: * -&gt; *).
(Monad m, Ord name) =&gt;
(Hash -&gt; m [a])
-&gt; Map name TermReferenceId
-&gt; (name -&gt; TermReferenceId -&gt; a -&gt; b)
-&gt; m (Map name b)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#componenty"><span class="hs-identifier hs-var">componenty</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; m [typ]
</span><a href="#local-6989586621680964698"><span class="hs-identifier hs-var">getTypeComponent</span></a></span><span> </span><span class="annot"><span class="annottext">Map name TermReferenceId
</span><a href="#local-6989586621680964697"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#componenty"><span class="hs-identifier hs-type">componenty</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-511"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680966315"><span class="annot"><a href="#local-6989586621680966315"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680966314"><span class="annot"><a href="#local-6989586621680966314"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621680966316"><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621680966317"><span class="annot"><a href="#local-6989586621680966317"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680966317"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-513"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680966315"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-514"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966315"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966314"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-516"></span><span>  </span><span class="annot"><a href="#local-6989586621680966317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966314"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span id="componenty"><span class="annot"><span class="annottext">componenty :: forall a b name (m :: * -&gt; *).
(Monad m, Ord name) =&gt;
(Hash -&gt; m [a])
-&gt; Map name TermReferenceId
-&gt; (name -&gt; TermReferenceId -&gt; a -&gt; b)
-&gt; m (Map name b)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#componenty"><span class="hs-identifier hs-var hs-var">componenty</span></a></span></span><span> </span><span id="local-6989586621680964678"><span class="annot"><span class="annottext">Hash -&gt; m [a]
</span><a href="#local-6989586621680964678"><span class="hs-identifier hs-var">getComponent</span></a></span></span><span> </span><span id="local-6989586621680964677"><span class="annot"><span class="annottext">Map name TermReferenceId
</span><a href="#local-6989586621680964677"><span class="hs-identifier hs-var">things</span></a></span></span><span> </span><span id="local-6989586621680964676"><span class="annot"><span class="annottext">name -&gt; TermReferenceId -&gt; a -&gt; b
</span><a href="#local-6989586621680964676"><span class="hs-identifier hs-var">modify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-518"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">Foldable.foldlM</span></span><span> </span><span class="annot"><span class="annottext">Map name b -&gt; Hash -&gt; m (Map name b)
</span><a href="#local-6989586621680964674"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId -&gt; Hash
</span><span class="hs-identifier hs-var">Reference.idToHash</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map name TermReferenceId
</span><a href="#local-6989586621680964677"><span class="hs-identifier hs-var">things</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-520"></span><span>    </span><span class="annot"><a href="#local-6989586621680964674"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966314"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966314"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>    </span><span id="local-6989586621680964674"><span class="annot"><span class="annottext">f :: Map name b -&gt; Hash -&gt; m (Map name b)
</span><a href="#local-6989586621680964674"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680964669"><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680964669"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680964668"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621680964668"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-522"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map name b -&gt; (TermReferenceId, a) -&gt; Map name b
</span><a href="#local-6989586621680964666"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680964669"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Hash -&gt; [a] -&gt; [(TermReferenceId, a)]
</span><span class="hs-identifier hs-var">Reference.componentFor</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621680964668"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; m [a]
</span><a href="#local-6989586621680964678"><span class="hs-identifier hs-var">getComponent</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621680964668"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span>    </span><span class="annot"><a href="#local-6989586621680964666"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966314"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680966315"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966314"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-525"></span><span>    </span><span id="local-6989586621680964666"><span class="annot"><span class="annottext">g :: Map name b -&gt; (TermReferenceId, a) -&gt; Map name b
</span><a href="#local-6989586621680964666"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680964664"><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680964664"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680964663"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964663"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964662"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680964662"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><span class="hs-identifier hs-var">Set.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermReferenceId -&gt; a -&gt; Map name b -&gt; name -&gt; Map name b
</span><a href="#local-6989586621680964660"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964663"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680964662"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680964664"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; a -&gt; BiMultimap a b -&gt; Set b
</span><span class="hs-identifier hs-var">BiMultimap.lookupDom</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964663"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap TermReferenceId name
</span><a href="#local-6989586621680964658"><span class="hs-identifier hs-var">things2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span>    </span><span class="annot"><a href="#local-6989586621680964660"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966315"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966314"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966314"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-529"></span><span>    </span><span id="local-6989586621680964660"><span class="annot"><span class="annottext">h :: TermReferenceId -&gt; a -&gt; Map name b -&gt; name -&gt; Map name b
</span><a href="#local-6989586621680964660"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680964657"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964657"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621680964656"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680964656"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span id="local-6989586621680964655"><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680964655"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680964654"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680964654"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-530"></span><span>      </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680964654"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">name -&gt; TermReferenceId -&gt; a -&gt; b
</span><a href="#local-6989586621680964676"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621680964654"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964657"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680964656"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map name b
</span><a href="#local-6989586621680964655"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span>    </span><span class="annot"><a href="#local-6989586621680964658"><span class="hs-identifier hs-type">things2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="annot"><a href="#local-6989586621680966316"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-533"></span><span>    </span><span id="local-6989586621680964658"><span class="annot"><span class="annottext">things2 :: BiMultimap TermReferenceId name
</span><a href="#local-6989586621680964658"><span class="hs-identifier hs-var hs-var">things2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-534"></span><span>      </span><span class="annot"><span class="annottext">forall a b. (Ord a, Ord b) =&gt; Map b a -&gt; BiMultimap a b
</span><span class="hs-identifier hs-var">BiMultimap.fromRange</span></span><span> </span><span class="annot"><span class="annottext">Map name TermReferenceId
</span><a href="#local-6989586621680964677"><span class="hs-identifier hs-var">things</span></a></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span id="local-6989586621680966360"><span id="local-6989586621680966361"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#renderTermBinding"><span class="hs-identifier hs-type">renderTermBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621680966361"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680966360"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621680966360"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966361"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621680966360"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966361"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span></span></span><span>
</span><span id="line-537"></span><span id="renderTermBinding"><span class="annot"><span class="annottext">renderTermBinding :: forall a v.
(Monoid a, Var v) =&gt;
PrettyPrintEnv -&gt; Name -&gt; Term v a -&gt; Type v a -&gt; Pretty ColorText
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#renderTermBinding"><span class="hs-identifier hs-var hs-var">renderTermBinding</span></a></span></span><span> </span><span id="local-6989586621680964637"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621680964637"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.NameOnly</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680964635"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680964635"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680964634"><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621680964634"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span id="local-6989586621680964633"><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621680964633"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><span class="annottext">forall r. Pretty (SyntaxText' r) -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">Pretty.syntaxToColor</span></span><span> </span><span class="annot"><span class="annottext">Pretty (SyntaxText' TypeReference)
</span><a href="#local-6989586621680964631"><span class="hs-identifier hs-var">rendered</span></a></span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-540"></span><span>    </span><span class="annot"><a href="#local-6989586621680964631"><span class="hs-identifier hs-type">rendered</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SyntaxText'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>    </span><span id="local-6989586621680964631"><span class="annot"><span class="annottext">rendered :: Pretty (SyntaxText' TypeReference)
</span><a href="#local-6989586621680964631"><span class="hs-identifier hs-var hs-var">rendered</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isEqual</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v a. Ord v =&gt; a -&gt; Type v a
</span><span class="hs-identifier hs-var">Builtin.Decls.testResultListType</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621680964633"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-543"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Pretty (SyntaxText' TypeReference)
</span><span class="hs-string">&quot;test&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v at ap a.
Var v =&gt;
PrettyPrintEnv
-&gt; HashQualified Name
-&gt; Term2 v at ap v a
-&gt; Pretty (SyntaxText' TypeReference)
</span><span class="hs-identifier hs-var">TermPrinter.prettyBindingWithoutTypeSignature</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621680964637"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680964635"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621680964634"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-544"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall v at ap a.
Var v =&gt;
PrettyPrintEnv
-&gt; HashQualified Name
-&gt; Term2 v at ap v a
-&gt; Pretty (SyntaxText' TypeReference)
</span><span class="hs-identifier hs-var">TermPrinter.prettyBinding</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621680964637"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680964635"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Term v a
</span><a href="#local-6989586621680964634"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span id="local-6989586621680966366"><span id="local-6989586621680966367"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#renderTypeBinding"><span class="hs-identifier hs-type">renderTypeBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621680966367"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-548"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-549"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-550"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-551"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621680966367"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966366"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-552"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Writer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">AccessorName</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-553"></span><span id="renderTypeBinding"><span class="annot"><span class="annottext">renderTypeBinding :: forall v a.
Var v =&gt;
PrettyPrintEnvDecl
-&gt; Name
-&gt; TermReferenceId
-&gt; Decl v a
-&gt; WriterT (Set Name) Identity (Pretty ColorText)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#renderTypeBinding"><span class="hs-identifier hs-var hs-var">renderTypeBinding</span></a></span></span><span> </span><span id="local-6989586621680964622"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680964622"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621680964621"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964621"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680964620"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964620"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621680964619"><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621680964619"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-554"></span><span>  </span><span class="annot"><span class="annottext">forall r. Pretty (SyntaxText' r) -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">Pretty.syntaxToColor</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v a.
Var v =&gt;
PrettyPrintEnvDecl
-&gt; TypeReference
-&gt; HashQualified Name
-&gt; Decl v a
-&gt; Writer (Set Name) (Pretty (SyntaxText' TypeReference))
</span><span class="hs-identifier hs-var">DeclPrinter.prettyDeclW</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621680964622"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermReferenceId -&gt; TypeReference
</span><span class="hs-identifier hs-var">Reference.fromId</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964620"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964621"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621680964619"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#setPpedToConstructorNames"><span class="hs-identifier hs-type">setPpedToConstructorNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span>
</span><span id="line-557"></span><span id="setPpedToConstructorNames"><span class="annot"><span class="annottext">setPpedToConstructorNames :: DeclNameLookup
-&gt; Name
-&gt; TermReferenceId
-&gt; PrettyPrintEnvDecl
-&gt; PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#setPpedToConstructorNames"><span class="hs-identifier hs-var hs-var">setPpedToConstructorNames</span></a></span></span><span> </span><span id="local-6989586621680964616"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964616"><span class="hs-identifier hs-var">declNameLookup</span></a></span></span><span> </span><span id="local-6989586621680964615"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964615"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680964614"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964614"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IsLabel &quot;unsuffixifiedPPE&quot; a =&gt; a
</span><span class="">#unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;termNames&quot; a =&gt; a
</span><span class="">#termNames</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent -&gt; [(HashQualified Name, HashQualified Name)]
</span><a href="#local-6989586621680964612"><span class="hs-identifier hs-var">referentNames</span></a></span><span>
</span><span id="line-559"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IsLabel &quot;suffixifiedPPE&quot; a =&gt; a
</span><span class="">#suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;termNames&quot; a =&gt; a
</span><span class="">#termNames</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent -&gt; [(HashQualified Name, HashQualified Name)]
</span><a href="#local-6989586621680964612"><span class="hs-identifier hs-var">referentNames</span></a></span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-561"></span><span>    </span><span class="annot"><a href="#local-6989586621680964611"><span class="hs-identifier hs-type">constructorNameMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-562"></span><span>    </span><span id="local-6989586621680964611"><span class="annot"><span class="annottext">constructorNameMap :: Map ConstructorReference Name
</span><a href="#local-6989586621680964611"><span class="hs-identifier hs-var hs-var">constructorNameMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-563"></span><span>      </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span>
</span><span id="line-564"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964615"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-565"></span><span>            </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclNameLookup -&gt; Name -&gt; [Name]
</span><span class="hs-identifier hs-var">expectConstructorNames</span></span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964616"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span>
</span><span id="line-566"></span><span>            </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">List.zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-567"></span><span>            </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; Setter (f a) (f b) a b
</span><span class="hs-identifier hs-var">mapped</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r. r -&gt; Word64 -&gt; GConstructorReference r
</span><span class="hs-identifier hs-var">ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermReferenceId -&gt; TypeReference
</span><span class="hs-identifier hs-var">Reference.fromId</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964614"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span>    </span><span class="annot"><a href="#local-6989586621680964612"><span class="hs-identifier hs-type">referentNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-571"></span><span>    </span><span id="local-6989586621680964612"><span class="annot"><span class="annottext">referentNames :: Referent -&gt; [(HashQualified Name, HashQualified Name)]
</span><a href="#local-6989586621680964612"><span class="hs-identifier hs-var hs-var">referentNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-572"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span id="local-6989586621680964606"><span class="annot"><span class="annottext">ConstructorReference
</span><a href="#local-6989586621680964606"><span class="hs-identifier hs-var">conRef</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-573"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ConstructorReference
</span><a href="#local-6989586621680964606"><span class="hs-identifier hs-var">conRef</span></a></span><span> </span><span class="annot"><span class="annottext">Map ConstructorReference Name
</span><a href="#local-6989586621680964611"><span class="hs-identifier hs-var">constructorNameMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-574"></span><span>          </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-575"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680964605"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964605"><span class="hs-identifier hs-var">conName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964604"><span class="annot"><span class="annottext">hqConName :: HashQualified Name
</span><a href="#local-6989586621680964604"><span class="hs-identifier hs-var hs-var">hqConName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964605"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680964604"><span class="hs-identifier hs-var">hqConName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680964604"><span class="hs-identifier hs-var">hqConName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-576"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makePrettyUnisonFile"><span class="hs-identifier hs-type">makePrettyUnisonFile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-579"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-580"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-581"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-582"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span>
</span><span id="line-583"></span><span id="makePrettyUnisonFile"><span class="annot"><span class="annottext">makePrettyUnisonFile :: TwoWay Text
-&gt; TwoWay
     (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
-&gt; TwoWay
     (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
-&gt; Pretty ColorText
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makePrettyUnisonFile"><span class="hs-identifier hs-var hs-var">makePrettyUnisonFile</span></a></span></span><span> </span><span id="local-6989586621680964601"><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621680964601"><span class="hs-identifier hs-var">authors</span></a></span></span><span> </span><span id="local-6989586621680964600"><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964600"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621680964599"><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964599"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-584"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-585"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964600"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-comment">-- Merge the two maps together into one, remembering who authored what</span><span>
</span><span id="line-587"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; a -&gt; b) -&gt; TwoWay a -&gt; b
</span><span class="hs-identifier hs-var">TwoWay.twoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b.
Semialign f =&gt;
f a -&gt; f b -&gt; f (These a b)
</span><span class="hs-identifier hs-var">align</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b.
Semialign f =&gt;
f a -&gt; f b -&gt; f (These a b)
</span><span class="hs-identifier hs-var">align</span></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>        </span><span class="hs-comment">-- Sort alphabetically</span><span>
</span><span id="line-589"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="#local-6989586621680964597"><span class="hs-identifier hs-var">inAlphabeticalOrder</span></a></span><span>
</span><span id="line-590"></span><span>        </span><span class="hs-comment">-- Render each conflict, types then terms (even though a type can conflict with a term, in which case they</span><span>
</span><span id="line-591"></span><span>        </span><span class="hs-comment">-- would not be adjacent in the file), with an author comment above each conflicted thing</span><span>
</span><span id="line-592"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964596"><span class="annot"><span class="annottext">f :: [These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText
</span><a href="#local-6989586621680964596"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-593"></span><span>                  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-594"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">This</span></span><span> </span><span id="local-6989586621680964594"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964594"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621680964593"><span class="hs-identifier hs-var">alice</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964594"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-595"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">That</span></span><span> </span><span id="local-6989586621680964591"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964591"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621680964590"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964591"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-596"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">These</span></span><span> </span><span id="local-6989586621680964588"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964588"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680964587"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964587"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621680964593"><span class="hs-identifier hs-var">alice</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964588"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621680964590"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680964587"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-597"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-598"></span><span>                    </span><span id="local-6989586621680964593"><span class="annot"><span class="annottext">alice :: Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621680964593"><span class="hs-identifier hs-var hs-var">alice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m}. (Monoid m, IsString m) =&gt; Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621680964586"><span class="hs-identifier hs-var">prettyBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">Pretty.text</span></span><span> </span><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621680964601"><span class="hs-identifier hs-var">authors</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>                    </span><span id="local-6989586621680964590"><span class="annot"><span class="annottext">bob :: Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621680964590"><span class="hs-identifier hs-var hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m}. (Monoid m, IsString m) =&gt; Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621680964586"><span class="hs-identifier hs-var">prettyBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">Pretty.text</span></span><span> </span><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621680964601"><span class="hs-identifier hs-var">authors</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">[These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText
</span><a href="#local-6989586621680964596"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText
</span><a href="#local-6989586621680964596"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-601"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-602"></span><span>      </span><span class="hs-comment">-- Show message that delineates where conflicts end and dependents begin only when there are both conflicts and</span><span>
</span><span id="line-603"></span><span>      </span><span class="hs-comment">-- dependents</span><span>
</span><span id="line-604"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964579"><span class="annot"><span class="annottext">thereAre :: TwoWay (Defns (f a) (g b)) -&gt; Bool
</span><a href="#local-6989586621680964579"><span class="hs-identifier hs-var hs-var">thereAre</span></a></span></span><span> </span><span id="local-6989586621680964578"><span class="annot"><span class="annottext">TwoWay (Defns (f a) (g b))
</span><a href="#local-6989586621680964578"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay Bool -&gt; Bool
</span><span class="hs-identifier hs-var">TwoWay.or</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Foldable f, Foldable g) =&gt;
Defns (f a) (g b) -&gt; Bool
</span><span class="hs-identifier hs-var">defnsAreEmpty</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (f a) (g b))
</span><a href="#local-6989586621680964578"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {g :: * -&gt; *} {a} {b}.
(Foldable f, Foldable g) =&gt;
TwoWay (Defns (f a) (g b)) -&gt; Bool
</span><a href="#local-6989586621680964579"><span class="hs-identifier hs-var">thereAre</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964600"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {g :: * -&gt; *} {a} {b}.
(Foldable f, Foldable g) =&gt;
TwoWay (Defns (f a) (g b)) -&gt; Bool
</span><a href="#local-6989586621680964579"><span class="hs-identifier hs-var">thereAre</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964599"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-606"></span><span>            </span><span class="hs-keyword">then</span><span>
</span><span id="line-607"></span><span>              </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-608"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;-- The definitions below are not conflicted, but they each depend on one or more\n&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-609"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;-- conflicted definitions above.\n\n&quot;</span></span><span>
</span><span id="line-610"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-611"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-612"></span><span>      </span><span class="annot"><span class="annottext">TwoWay
  (Defns (Map Name (Pretty ColorText)) (Map Name (Pretty ColorText)))
</span><a href="#local-6989586621680964599"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-comment">-- Merge dependents together into one map (they are disjoint)</span><span>
</span><span id="line-614"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; a -&gt; b) -&gt; TwoWay a -&gt; b
</span><span class="hs-identifier hs-var">TwoWay.twoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>        </span><span class="hs-comment">-- Sort alphabetically</span><span>
</span><span id="line-616"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="#local-6989586621680964597"><span class="hs-identifier hs-var">inAlphabeticalOrder</span></a></span><span>
</span><span id="line-617"></span><span>        </span><span class="hs-comment">-- Render each dependent, types then terms, without bothering to comment attribution</span><span>
</span><span id="line-618"></span><span>        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964570"><span class="annot"><span class="annottext">f :: [Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621680964570"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {m}. (Monoid m, IsString m) =&gt; Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621680964586"><span class="hs-identifier hs-var">prettyBinding</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621680964570"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621680964570"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-621"></span><span>    </span><span id="local-6989586621680964586"><span class="annot"><span class="annottext">prettyBinding :: Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621680964586"><span class="hs-identifier hs-var hs-var">prettyBinding</span></a></span></span><span> </span><span id="local-6989586621680964556"><span class="annot"><span class="annottext">Maybe m
</span><a href="#local-6989586621680964556"><span class="hs-identifier hs-var">maybeComment</span></a></span></span><span> </span><span id="local-6989586621680964555"><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621680964555"><span class="hs-identifier hs-var">binding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-622"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-623"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe m
</span><a href="#local-6989586621680964556"><span class="hs-identifier hs-var">maybeComment</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-624"></span><span>            </span><span class="annot"><span class="annottext">Maybe m
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-625"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680964554"><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621680964554"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;-- &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621680964554"><span class="hs-identifier hs-var">comment</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-626"></span><span>          </span><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621680964555"><span class="hs-identifier hs-var">binding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-627"></span><span>          </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-628"></span><span>          </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-629"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span>    </span><span id="local-6989586621680966221"><span id="local-6989586621680966222"><span class="annot"><a href="#local-6989586621680964597"><span class="hs-identifier hs-type">inAlphabeticalOrder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680966222"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966221"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680966222"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966221"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-632"></span><span>    </span><span id="local-6989586621680964597"><span class="annot"><span class="annottext">inAlphabeticalOrder :: forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="#local-6989586621680964597"><span class="hs-identifier hs-var hs-var">inAlphabeticalOrder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-633"></span><span>      </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall {b}. Map Name b -&gt; [b]
</span><a href="#local-6989586621680964552"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b}. Map Name b -&gt; [b]
</span><a href="#local-6989586621680964552"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-634"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-635"></span><span>        </span><span id="local-6989586621680964552"><span class="annot"><span class="annottext">f :: Map Name b -&gt; [b]
</span><a href="#local-6989586621680964552"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-638"></span><span class="hs-comment">--</span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span class="hs-comment">-- Given just named term/type reference ids, fill out all names that occupy the term and type namespaces. This is simply</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- the given names plus all of the types' constructors.</span><span>
</span><span id="line-642"></span><span class="hs-comment">--</span><span>
</span><span id="line-643"></span><span class="hs-comment">-- For example, if the input is</span><span>
</span><span id="line-644"></span><span class="hs-comment">--</span><span>
</span><span id="line-645"></span><span class="hs-comment">--   declNameLookup = {</span><span>
</span><span id="line-646"></span><span class="hs-comment">--     &quot;Maybe&quot; =&gt; [&quot;Maybe.Nothing&quot;, &quot;Maybe.Just&quot;]</span><span>
</span><span id="line-647"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-648"></span><span class="hs-comment">--   defns = {</span><span>
</span><span id="line-649"></span><span class="hs-comment">--     terms = { &quot;foo&quot; =&gt; #foo }</span><span>
</span><span id="line-650"></span><span class="hs-comment">--     types = { &quot;Maybe&quot; =&gt; #Maybe }</span><span>
</span><span id="line-651"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-652"></span><span class="hs-comment">--</span><span>
</span><span id="line-653"></span><span class="hs-comment">-- then the output is</span><span>
</span><span id="line-654"></span><span class="hs-comment">--</span><span>
</span><span id="line-655"></span><span class="hs-comment">--   defns = {</span><span>
</span><span id="line-656"></span><span class="hs-comment">--     terms = { &quot;foo&quot;, &quot;Maybe.Nothing&quot;, &quot;Maybe.Just&quot; }</span><span>
</span><span id="line-657"></span><span class="hs-comment">--     types = { &quot;Maybe&quot; }</span><span>
</span><span id="line-658"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-659"></span><span id="local-6989586621680966196"><span id="local-6989586621680966197"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#refIdsToNames"><span class="hs-identifier hs-type">refIdsToNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680966197"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966196"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span></span></span><span>
</span><span id="line-660"></span><span id="refIdsToNames"><span class="annot"><span class="annottext">refIdsToNames :: forall term typ.
DeclNameLookup
-&gt; DefnsF (Map Name) term typ -&gt; DefnsF Set Name Name
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#refIdsToNames"><span class="hs-identifier hs-var hs-var">refIdsToNames</span></a></span></span><span> </span><span id="local-6989586621680964542"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964542"><span class="hs-identifier hs-var">declNameLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-661"></span><span>  </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">forall term. Map Name term -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621680964541"><span class="hs-identifier hs-var">goTerms</span></a></span><span> </span><span class="annot"><span class="annottext">forall term. Map Name term -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621680964540"><span class="hs-identifier hs-var">goTypes</span></a></span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-663"></span><span>    </span><span id="local-6989586621680966193"><span class="annot"><a href="#local-6989586621680964541"><span class="hs-identifier hs-type">goTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680966193"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span></span><span>
</span><span id="line-664"></span><span>    </span><span id="local-6989586621680964541"><span class="annot"><span class="annottext">goTerms :: forall term. Map Name term -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621680964541"><span class="hs-identifier hs-var hs-var">goTerms</span></a></span></span><span> </span><span id="local-6989586621680964539"><span class="annot"><span class="annottext">Map Name term
</span><a href="#local-6989586621680964539"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-665"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:terms:Defns :: Set Name
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map Name term
</span><a href="#local-6989586621680964539"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:types:Defns :: Set Name
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">}</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>    </span><span id="local-6989586621680964536"><span class="annot"><a href="#local-6989586621680964540"><span class="hs-identifier hs-type">goTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680964536"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span></span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621680964540"><span class="annot"><span class="annottext">goTypes :: forall term. Map Name term -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621680964540"><span class="hs-identifier hs-var hs-var">goTypes</span></a></span></span><span> </span><span id="local-6989586621680964530"><span class="annot"><span class="annottext">Map Name typ
</span><a href="#local-6989586621680964530"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-669"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span>
</span><span id="line-670"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:terms:Defns :: Set Name
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclNameLookup -&gt; Name -&gt; [Name]
</span><span class="hs-identifier hs-var">expectConstructorNames</span></span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621680964542"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680964528"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-671"></span><span>          </span><span class="annot"><span class="annottext">$sel:types:Defns :: Set Name
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680964528"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-672"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-674"></span><span>        </span><span id="local-6989586621680964528"><span class="annot"><span class="annottext">names :: Set Name
</span><a href="#local-6989586621680964528"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map Name typ
</span><a href="#local-6989586621680964530"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span id="local-6989586621680966353"><span id="local-6989586621680966354"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#defnsAndLibdepsToBranch0"><span class="hs-identifier hs-type">defnsAndLibdepsToBranch0</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680966354"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966353"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-679"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-680"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span></span></span><span>
</span><span id="line-681"></span><span id="defnsAndLibdepsToBranch0"><span class="annot"><span class="annottext">defnsAndLibdepsToBranch0 :: forall v a.
Codebase IO v a
-&gt; DefnsF (Map Name) Referent TypeReference
-&gt; Branch0 Transaction
-&gt; Branch0 IO
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#defnsAndLibdepsToBranch0"><span class="hs-identifier hs-var hs-var">defnsAndLibdepsToBranch0</span></a></span></span><span> </span><span id="local-6989586621680964521"><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621680964521"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621680964520"><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964520"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621680964519"><span class="annot"><span class="annottext">Branch0 Transaction
</span><a href="#local-6989586621680964519"><span class="hs-identifier hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Unflatten the collection of terms into tree, ditto for types</span><span>
</span><span id="line-683"></span><span>      </span><span class="annot"><a href="#local-6989586621680964518"><span class="hs-identifier hs-type">nametrees</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span>
</span><span id="line-684"></span><span>      </span><span id="local-6989586621680964518"><span class="annot"><span class="annottext">nametrees :: DefnsF2 Nametree (Map NameSegment) Referent TypeReference
</span><a href="#local-6989586621680964518"><span class="hs-identifier hs-var hs-var">nametrees</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-685"></span><span>        </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall v. Ord v =&gt; Map Name v -&gt; Nametree (Map NameSegment v)
</span><a href="#local-6989586621680964517"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">forall v. Ord v =&gt; Map Name v -&gt; Nametree (Map NameSegment v)
</span><a href="#local-6989586621680964517"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964520"><span class="hs-identifier hs-var">defns</span></a></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span>      </span><span class="hs-comment">-- Align the tree of terms and tree of types into one tree</span><span>
</span><span id="line-688"></span><span>      </span><span class="annot"><a href="#local-6989586621680964516"><span class="hs-identifier hs-type">nametree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>      </span><span id="local-6989586621680964516"><span class="annot"><span class="annottext">nametree :: Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964516"><span class="hs-identifier hs-var hs-var">nametree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-690"></span><span>        </span><span class="annot"><span class="annottext">DefnsF2 Nametree (Map NameSegment) Referent TypeReference
</span><a href="#local-6989586621680964518"><span class="hs-identifier hs-var">nametrees</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b c.
Semialign f =&gt;
(These a b -&gt; c) -&gt; Defns (f a) (f b) -&gt; f c
</span><span class="hs-identifier hs-var">alignDefnsWith</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-691"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">This</span></span><span> </span><span id="local-6989586621680964515"><span class="annot"><span class="annottext">Map NameSegment Referent
</span><a href="#local-6989586621680964515"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Map NameSegment Referent
terms :: Map NameSegment Referent
$sel:terms:Defns :: Map NameSegment Referent
</span><a href="#local-6989586621680964515"><span class="hs-identifier hs-var hs-var">terms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:types:Defns :: Map NameSegment TypeReference
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">}</span><span>
</span><span id="line-692"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">That</span></span><span> </span><span id="local-6989586621680964514"><span class="annot"><span class="annottext">Map NameSegment TypeReference
</span><a href="#local-6989586621680964514"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:terms:Defns :: Map NameSegment Referent
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NameSegment TypeReference
types :: Map NameSegment TypeReference
$sel:types:Defns :: Map NameSegment TypeReference
</span><a href="#local-6989586621680964514"><span class="hs-identifier hs-var hs-var">types</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-693"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">These</span></span><span> </span><span id="local-6989586621680964513"><span class="annot"><span class="annottext">Map NameSegment Referent
</span><a href="#local-6989586621680964513"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621680964512"><span class="annot"><span class="annottext">Map NameSegment TypeReference
</span><a href="#local-6989586621680964512"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall terms types. terms -&gt; types -&gt; Defns terms types
</span><span class="hs-identifier hs-var">Defns</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment Referent
</span><a href="#local-6989586621680964513"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Map NameSegment TypeReference
</span><a href="#local-6989586621680964512"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span>      </span><span class="hs-comment">-- Convert the tree to a branch0</span><span>
</span><span id="line-696"></span><span>      </span><span id="local-6989586621680964511"><span class="annot"><span class="annottext">branch0 :: Branch0 m
</span><a href="#local-6989586621680964511"><span class="hs-identifier hs-var hs-var">branch0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
-&gt; Branch0 m
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#nametreeToBranch0"><span class="hs-identifier hs-var">nametreeToBranch0</span></a></span><span> </span><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964516"><span class="hs-identifier hs-var">nametree</span></a></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span>      </span><span class="hs-comment">-- Add back the libdeps branch at path &quot;lib&quot;</span><span>
</span><span id="line-699"></span><span>      </span><span id="local-6989586621680964509"><span class="annot"><span class="annottext">branch1 :: Branch0 Transaction
</span><a href="#local-6989586621680964509"><span class="hs-identifier hs-var hs-var">branch1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
NameSegment -&gt; Branch m -&gt; Branch0 m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.setChildBranch</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier hs-var">NameSegment.libSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch0 m -&gt; Branch m
</span><span class="hs-identifier hs-var">Branch.one</span></span><span> </span><span class="annot"><span class="annottext">Branch0 Transaction
</span><a href="#local-6989586621680964519"><span class="hs-identifier hs-var">libdeps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *}. Branch0 m
</span><a href="#local-6989586621680964511"><span class="hs-identifier hs-var">branch0</span></a></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>      </span><span class="hs-comment">-- Awkward: we have a Branch Transaction but we need a Branch IO (because reasons)</span><span>
</span><span id="line-702"></span><span>      </span><span id="local-6989586621680964506"><span class="annot"><span class="annottext">branch2 :: Branch0 IO
</span><a href="#local-6989586621680964506"><span class="hs-identifier hs-var hs-var">branch2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (n :: * -&gt; *).
Functor m =&gt;
(forall a. m a -&gt; n a) -&gt; Branch0 m -&gt; Branch0 n
</span><span class="hs-identifier hs-var">Branch.transform0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v a
</span><a href="#local-6989586621680964521"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch0 Transaction
</span><a href="#local-6989586621680964509"><span class="hs-identifier hs-var">branch1</span></a></span><span>
</span><span id="line-703"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621680964506"><span class="hs-identifier hs-var">branch2</span></a></span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-705"></span><span>    </span><span id="local-6989586621680966184"><span class="annot"><a href="#local-6989586621680964517"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680966184"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680966184"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621680966184"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-706"></span><span>    </span><span id="local-6989586621680964517"><span class="annot"><span class="annottext">go :: forall v. Ord v =&gt; Map Name v -&gt; Nametree (Map NameSegment v)
</span><a href="#local-6989586621680964517"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-707"></span><span>      </span><span class="annot"><span class="annottext">forall a.
Ord a =&gt;
BiMultimap a Name -&gt; Nametree (Map NameSegment a)
</span><span class="hs-identifier hs-var">unflattenNametree</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Ord a, Ord b) =&gt; Map b a -&gt; BiMultimap a b
</span><span class="hs-identifier hs-var">BiMultimap.fromRange</span></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span id="local-6989586621680966178"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#nametreeToBranch0"><span class="hs-identifier hs-type">nametreeToBranch0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621680966178"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-710"></span><span id="nametreeToBranch0"><span class="annot"><span class="annottext">nametreeToBranch0 :: forall (m :: * -&gt; *).
Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
-&gt; Branch0 m
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#nametreeToBranch0"><span class="hs-identifier hs-var hs-var">nametreeToBranch0</span></a></span></span><span> </span><span id="local-6989586621680964487"><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964487"><span class="hs-identifier hs-var">nametree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Star Referent NameSegment
-&gt; Star TypeReference NameSegment
-&gt; Map NameSegment (Branch m)
-&gt; Map NameSegment (PatchHash, m Patch)
-&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.branch0</span></span><span>
</span><span id="line-712"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ref name metadata.
Relation ref name -&gt; Star2 ref name metadata
</span><a href="#local-6989586621680964485"><span class="hs-identifier hs-var">rel2star</span></a></span><span> </span><span class="annot"><span class="annottext">Defns
  (Relation Referent NameSegment)
  (Relation TypeReference NameSegment)
</span><a href="#local-6989586621680964484"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ref name metadata.
Relation ref name -&gt; Star2 ref name metadata
</span><a href="#local-6989586621680964485"><span class="hs-identifier hs-var">rel2star</span></a></span><span> </span><span class="annot"><span class="annottext">Defns
  (Relation Referent NameSegment)
  (Relation TypeReference NameSegment)
</span><a href="#local-6989586621680964484"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Branch0 m -&gt; Branch m
</span><span class="hs-identifier hs-var">Branch.one</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
-&gt; Branch0 m
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#nametreeToBranch0"><span class="hs-identifier hs-var">nametreeToBranch0</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964487"><span class="hs-identifier hs-var">nametree</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">children</span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>    </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><a href="#local-6989586621680964484"><span class="hs-identifier hs-type">defns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Relation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Relation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621680964484"><span class="annot"><span class="annottext">defns :: Defns
  (Relation Referent NameSegment)
  (Relation TypeReference NameSegment)
</span><a href="#local-6989586621680964484"><span class="hs-identifier hs-var hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-719"></span><span>      </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Relation a b -&gt; Relation b a
</span><span class="hs-identifier hs-var">Relation.swap</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Ord a, Ord b) =&gt; Map a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromMap</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Relation a b -&gt; Relation b a
</span><span class="hs-identifier hs-var">Relation.swap</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Ord a, Ord b) =&gt; Map a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromMap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nametree
  (Defns (Map NameSegment Referent) (Map NameSegment TypeReference))
</span><a href="#local-6989586621680964487"><span class="hs-identifier hs-var">nametree</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span>    </span><span id="local-6989586621680966158"><span id="local-6989586621680966159"><span id="local-6989586621680966160"><span class="annot"><a href="#local-6989586621680964485"><span class="hs-identifier hs-type">rel2star</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Relation</span></span><span> </span><span class="annot"><a href="#local-6989586621680966160"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966159"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Star2</span></span><span> </span><span class="annot"><a href="#local-6989586621680966160"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966159"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966158"><span class="hs-identifier hs-type">metadata</span></a></span></span></span></span><span>
</span><span id="line-722"></span><span>    </span><span id="local-6989586621680964485"><span class="annot"><span class="annottext">rel2star :: forall ref name metadata.
Relation ref name -&gt; Star2 ref name metadata
</span><a href="#local-6989586621680964485"><span class="hs-identifier hs-var hs-var">rel2star</span></a></span></span><span> </span><span id="local-6989586621680964481"><span class="annot"><span class="annottext">Relation ref name
</span><a href="#local-6989586621680964481"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-723"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Star2.Star2</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:fact:Star2 :: Set ref
</span><span class="hs-identifier hs-var">fact</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">Relation.dom</span></span><span> </span><span class="annot"><span class="annottext">Relation ref name
</span><a href="#local-6989586621680964481"><span class="hs-identifier hs-var">rel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:d1:Star2 :: Relation ref name
</span><span class="hs-identifier hs-var">d1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Relation ref name
</span><a href="#local-6989586621680964481"><span class="hs-identifier hs-var">rel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:d2:Star2 :: Relation ref metadata
</span><span class="hs-identifier hs-var">d2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. Relation a b
</span><span class="hs-identifier hs-var">Relation.empty</span></span><span class="hs-special">}</span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="hs-comment">-- FIXME: let's come up with a better term for &quot;dependencies&quot; in the implementation of this function</span><span>
</span><span id="line-726"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#identifyDependents"><span class="hs-identifier hs-type">identifyDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-727"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-728"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-729"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unconflicts</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-730"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span id="identifyDependents"><span class="annot"><span class="annottext">identifyDependents :: TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
-&gt; DefnsF Unconflicts Referent TypeReference
-&gt; Transaction
     (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#identifyDependents"><span class="hs-identifier hs-var hs-var">identifyDependents</span></a></span></span><span> </span><span id="local-6989586621680964474"><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964474"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621680964473"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964473"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621680964472"><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964472"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- The other person's (i.e. with &quot;Alice&quot; and &quot;Bob&quot; swapped) solo-deleted and solo-updated names</span><span>
</span><span id="line-733"></span><span>      </span><span class="annot"><a href="#local-6989586621680964471"><span class="hs-identifier hs-type">theirSoloUpdatesAndDeletes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-734"></span><span>      </span><span id="local-6989586621680964471"><span class="annot"><span class="annottext">theirSoloUpdatesAndDeletes :: TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621680964471"><span class="hs-identifier hs-var hs-var">theirSoloUpdatesAndDeletes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-735"></span><span>        </span><span class="annot"><span class="annottext">forall a. TwoWay a -&gt; TwoWay a
</span><span class="hs-identifier hs-var">TwoWay.swap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621680964469"><span class="hs-identifier hs-var">unconflictedSoloDeletedNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621680964468"><span class="hs-identifier hs-var">unconflictedSoloUpdatedNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-737"></span><span>          </span><span class="annot"><a href="#local-6989586621680964469"><span class="hs-identifier hs-type">unconflictedSoloDeletedNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>          </span><span id="local-6989586621680964469"><span class="annot"><span class="annottext">unconflictedSoloDeletedNames :: TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621680964469"><span class="hs-identifier hs-var hs-var">unconflictedSoloDeletedNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-739"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; * -&gt; *) (f :: * -&gt; *) a c b d.
(Bitraversable t, Applicative f) =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; t a b -&gt; f (t c d)
</span><span class="hs-identifier hs-var">bitraverse</span></span><span> </span><span class="annot"><span class="annottext">forall v. Unconflicts v -&gt; TwoWay (Set Name)
</span><span class="hs-identifier hs-var">Unconflicts.soloDeletedNames</span></span><span> </span><span class="annot"><span class="annottext">forall v. Unconflicts v -&gt; TwoWay (Set Name)
</span><span class="hs-identifier hs-var">Unconflicts.soloDeletedNames</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964472"><span class="hs-identifier hs-var">unconflicts</span></a></span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span>          </span><span class="annot"><a href="#local-6989586621680964468"><span class="hs-identifier hs-type">unconflictedSoloUpdatedNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>          </span><span id="local-6989586621680964468"><span class="annot"><span class="annottext">unconflictedSoloUpdatedNames :: TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621680964468"><span class="hs-identifier hs-var hs-var">unconflictedSoloUpdatedNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-743"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; * -&gt; *) (f :: * -&gt; *) a c b d.
(Bitraversable t, Applicative f) =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; t a b -&gt; f (t c d)
</span><span class="hs-identifier hs-var">bitraverse</span></span><span> </span><span class="annot"><span class="annottext">forall v. Unconflicts v -&gt; TwoWay (Set Name)
</span><span class="hs-identifier hs-var">Unconflicts.soloUpdatedNames</span></span><span> </span><span class="annot"><span class="annottext">forall v. Unconflicts v -&gt; TwoWay (Set Name)
</span><span class="hs-identifier hs-var">Unconflicts.soloUpdatedNames</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964472"><span class="hs-identifier hs-var">unconflicts</span></a></span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680964465"><span class="hs-identifier hs-type">dependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>      </span><span id="local-6989586621680964465"><span class="annot"><span class="annottext">dependencies :: TwoWay (Set TypeReference)
</span><a href="#local-6989586621680964465"><span class="hs-identifier hs-var hs-var">dependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-747"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-748"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- One source of dependencies: Alice's versions of Bob's unconflicted deletes and updates, and vice-versa.</span><span>
</span><span id="line-749"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-750"></span><span>            </span><span class="hs-comment">-- This is name-based: if Bob updates the *name* &quot;foo&quot;, then we go find the thing that Alice calls &quot;foo&quot; (if</span><span>
</span><span id="line-751"></span><span>            </span><span class="hs-comment">-- anything), no matter what its hash is.</span><span>
</span><span id="line-752"></span><span>            </span><span class="annot"><span class="annottext">forall name.
Defns (BiMultimap Referent name) (BiMultimap TypeReference name)
-&gt; Set TypeReference
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#defnsReferences"><span class="hs-identifier hs-var">defnsReferences</span></a></span><span>
</span><span id="line-753"></span><span>              </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">forall a b.
(Ord a, Ord b) =&gt;
Set b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><span class="hs-identifier hs-var">BiMultimap.restrictRan</span></span><span> </span><span class="annot"><span class="annottext">forall a b.
(Ord a, Ord b) =&gt;
Set b -&gt; BiMultimap a b -&gt; BiMultimap a b
</span><span class="hs-identifier hs-var">BiMultimap.restrictRan</span></span><span>
</span><span id="line-754"></span><span>                      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621680964471"><span class="hs-identifier hs-var">theirSoloUpdatesAndDeletes</span></a></span><span>
</span><span id="line-755"></span><span>                      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964474"><span class="hs-identifier hs-var">defns</span></a></span><span>
</span><span id="line-756"></span><span>                  </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-757"></span><span>            </span><span class="hs-comment">-- The other source of dependencies: Alice's own conflicted things, and ditto for Bob.</span><span>
</span><span id="line-758"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-759"></span><span>            </span><span class="hs-comment">-- An example: suppose Alice has foo#alice and Bob has foo#bob, so foo is conflicted. Furthermore, suppose</span><span>
</span><span id="line-760"></span><span>            </span><span class="hs-comment">-- Alice has bar#bar that depends on foo#alice.</span><span>
</span><span id="line-761"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-762"></span><span>            </span><span class="hs-comment">-- We want Alice's #alice to be considered a dependency, so that when we go off and find dependents of these</span><span>
</span><span id="line-763"></span><span>            </span><span class="hs-comment">-- dependencies to put in the scratch file for type checking and propagation, we find bar#bar.</span><span>
</span><span id="line-764"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-765"></span><span>            </span><span class="hs-comment">-- Note that this is necessary even if bar#bar is unconflicted! We don't want bar#bar to be put directly</span><span>
</span><span id="line-766"></span><span>            </span><span class="hs-comment">-- into the namespace / parsing context for the conflicted merge, because it has an unnamed reference on</span><span>
</span><span id="line-767"></span><span>            </span><span class="hs-comment">-- foo#alice. It rather ought to be in the scratchfile alongside the conflicted foo#alice and foo#bob, so</span><span>
</span><span id="line-768"></span><span>            </span><span class="hs-comment">-- that when that conflict is resolved, it will propagate to bar.</span><span>
</span><span id="line-769"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680966139"><span class="annot"><a href="#local-6989586621680964462"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621680966139"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966139"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span></span><span>
</span><span id="line-770"></span><span>                </span><span id="local-6989586621680964462"><span class="annot"><span class="annottext">f :: forall (t :: * -&gt; *).
Foldable t =&gt;
t TermReferenceId -&gt; Set TypeReference
</span><a href="#local-6989586621680964462"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-771"></span><span>                  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680964457"><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621680964457"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680964456"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964456"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall h t. Id' h -&gt; Reference' t h
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964456"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621680964457"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Foldable.toList</span></span><span>
</span><span id="line-772"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
Foldable t =&gt;
t TermReferenceId -&gt; Set TypeReference
</span><a href="#local-6989586621680964462"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
Foldable t =&gt;
t TermReferenceId -&gt; Set TypeReference
</span><a href="#local-6989586621680964462"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964473"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-773"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span>  </span><span id="local-6989586621680964452"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964452"><span class="hs-identifier hs-var">dependents0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-776"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964474"><span class="hs-identifier hs-var">defns</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Set TypeReference)
</span><a href="#local-6989586621680964465"><span class="hs-identifier hs-var">dependencies</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964451"><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621680964451"><span class="hs-identifier hs-var">defns1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964450"><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621680964450"><span class="hs-identifier hs-var">dependencies1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-777"></span><span>      </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; Set TypeReference
-&gt; Transaction (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="Unison.Codebase.Editor.HandleInput.Update2.html#getNamespaceDependentsOf2"><span class="hs-identifier hs-var">getNamespaceDependentsOf2</span></a></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621680964451"><span class="hs-identifier hs-var">defns1</span></a></span><span> </span><span class="annot"><span class="annottext">Set TypeReference
</span><a href="#local-6989586621680964450"><span class="hs-identifier hs-var">dependencies1</span></a></span><span>
</span><span id="line-778"></span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-comment">-- There is some subset of Alice's dependents (and ditto for Bob of course) that we don't ultimately want/need to put</span><span>
</span><span id="line-780"></span><span>  </span><span class="hs-comment">-- into the scratch file: those for which any of the following are true:</span><span>
</span><span id="line-781"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-782"></span><span>  </span><span class="hs-comment">--   1. It is Alice-conflicted (since we only want to return *unconflicted* things).</span><span>
</span><span id="line-783"></span><span>  </span><span class="hs-comment">--   2. It was deleted by Bob.</span><span>
</span><span id="line-784"></span><span>  </span><span class="hs-comment">--   3. It was updated by Bob and not updated by Alice.</span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680964449"><span class="hs-identifier hs-type">dependents1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>      </span><span id="local-6989586621680964449"><span class="annot"><span class="annottext">dependents1 :: TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964449"><span class="hs-identifier hs-var hs-var">dependents1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-787"></span><span>        </span><span class="annot"><span class="annottext">forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.withoutKeys</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.withoutKeys</span></span><span>
</span><span id="line-788"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964452"><span class="hs-identifier hs-var">dependents0</span></a></span><span>
</span><span id="line-789"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964473"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set Name Name)
</span><a href="#local-6989586621680964471"><span class="hs-identifier hs-var">theirSoloUpdatesAndDeletes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span>
</span><span id="line-791"></span><span>  </span><span class="hs-comment">-- Of the remaining dependents, it's still possible that the maps are not disjoint. But whenever the same name key</span><span>
</span><span id="line-792"></span><span>  </span><span class="hs-comment">-- exists in Alice's and Bob's dependents, the value will either be equal (by Unison hash)...</span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-794"></span><span>  </span><span class="hs-comment">--   { alice = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-795"></span><span>  </span><span class="hs-comment">--   { bob   = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-comment">-- ...or synhash-equal (i.e. the term or type received different auto-propagated updates)...</span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-comment">--   { alice = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-800"></span><span>  </span><span class="hs-comment">--   { bob   = { terms = {&quot;foo&quot; =&gt; #bob}   } }</span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-802"></span><span>  </span><span class="hs-comment">-- So, we can arbitrarily keep Alice's, because they will render the same.</span><span>
</span><span id="line-803"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-comment">--   { alice = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-805"></span><span>  </span><span class="hs-comment">--   { bob   = { terms = {}                } }</span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680964447"><span class="hs-identifier hs-type">dependents2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>      </span><span id="local-6989586621680964447"><span class="annot"><span class="annottext">dependents2 :: TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964447"><span class="hs-identifier hs-var hs-var">dependents2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-808"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964449"><span class="hs-identifier hs-var">dependents1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;bob&quot; a =&gt; a
</span><span class="">#bob</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964446"><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId
</span><a href="#local-6989586621680964446"><span class="hs-identifier hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-809"></span><span>          </span><span class="annot"><span class="annottext">forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">forall k a b. Ord k =&gt; Map k a -&gt; Map k b -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.difference</span></span><span> </span><span class="annot"><span class="annottext">forall k a b. Ord k =&gt; Map k a -&gt; Map k b -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.difference</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) TermReferenceId TermReferenceId
</span><a href="#local-6989586621680964446"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964449"><span class="hs-identifier hs-var">dependents1</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964447"><span class="hs-identifier hs-var">dependents2</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span id="local-6989586621680966412"><span id="local-6989586621680966413"><span id="local-6989586621680966414"><span id="local-6989586621680966415"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makeStageOne"><span class="hs-identifier hs-type">makeStageOne</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-814"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-815"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680966415"><span class="hs-identifier hs-type">termid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966414"><span class="hs-identifier hs-type">typeid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-816"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unconflicts</span></span><span> </span><span class="annot"><a href="#local-6989586621680966413"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966412"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-817"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680966415"><span class="hs-identifier hs-type">termid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966414"><span class="hs-identifier hs-type">typeid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-818"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680966413"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966412"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-819"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680966413"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966412"><span class="hs-identifier hs-type">typ</span></a></span></span></span></span></span><span>
</span><span id="line-820"></span><span id="makeStageOne"><span class="annot"><span class="annottext">makeStageOne :: forall termid typeid term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (DefnsF (Map Name) termid typeid)
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (DefnsF (Map Name) termid typeid)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makeStageOne"><span class="hs-identifier hs-var hs-var">makeStageOne</span></a></span></span><span> </span><span id="local-6989586621680964443"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964443"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span> </span><span id="local-6989586621680964442"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) termid typeid)
</span><a href="#local-6989586621680964442"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621680964441"><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621680964441"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621680964440"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) termid typeid)
</span><a href="#local-6989586621680964440"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-821"></span><span>  </span><span class="annot"><span class="annottext">forall tm1 tm2 tm3 tm4 ty1 ty2 ty3 ty4.
(tm1 -&gt; tm2 -&gt; tm3 -&gt; tm4)
-&gt; (ty1 -&gt; ty2 -&gt; ty3 -&gt; ty4)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
-&gt; Defns tm4 ty4
</span><span class="hs-identifier hs-var">zipDefnsWith3</span></span><span> </span><span class="annot"><span class="annottext">forall v. Unconflicts v -&gt; Set Name -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makeStageOneV"><span class="hs-identifier hs-var">makeStageOneV</span></a></span><span> </span><span class="annot"><span class="annottext">forall v. Unconflicts v -&gt; Set Name -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makeStageOneV"><span class="hs-identifier hs-var">makeStageOneV</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621680964441"><span class="hs-identifier hs-var">unconflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall term typ.
TwoWay (DefnsF (Map Name) term typ) -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621680964438"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) termid typeid)
</span><a href="#local-6989586621680964442"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall term typ.
TwoWay (DefnsF (Map Name) term typ) -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621680964438"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) termid typeid)
</span><a href="#local-6989586621680964440"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-823"></span><span>    </span><span id="local-6989586621680966114"><span id="local-6989586621680966115"><span class="annot"><a href="#local-6989586621680964438"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680966115"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966114"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span></span></span><span>
</span><span id="line-824"></span><span>    </span><span id="local-6989586621680964438"><span class="annot"><span class="annottext">f :: forall term typ.
TwoWay (DefnsF (Map Name) term typ) -&gt; DefnsF Set Name Name
</span><a href="#local-6989586621680964438"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680964431"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621680964431"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-825"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall term typ.
DeclNameLookup
-&gt; DefnsF (Map Name) term typ -&gt; DefnsF Set Name Name
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#refIdsToNames"><span class="hs-identifier hs-var">refIdsToNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964443"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621680964431"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span id="local-6989586621680966116"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makeStageOneV"><span class="hs-identifier hs-type">makeStageOneV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unconflicts</span></span><span> </span><span class="annot"><a href="#local-6989586621680966116"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680966116"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680966116"><span class="hs-identifier hs-type">v</span></a></span></span><span>
</span><span id="line-828"></span><span id="makeStageOneV"><span class="annot"><span class="annottext">makeStageOneV :: forall v. Unconflicts v -&gt; Set Name -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#makeStageOneV"><span class="hs-identifier hs-var hs-var">makeStageOneV</span></a></span></span><span> </span><span id="local-6989586621680964429"><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621680964429"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621680964428"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680964428"><span class="hs-identifier hs-var">namesToDelete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.withoutKeys`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621680964428"><span class="hs-identifier hs-var">namesToDelete</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall v. Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><span class="hs-identifier hs-var">Unconflicts.apply</span></span><span> </span><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621680964429"><span class="hs-identifier hs-var">unconflicts</span></a></span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span id="local-6989586621680966142"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#defnsReferences"><span class="hs-identifier hs-type">defnsReferences</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><a href="#local-6989586621680966142"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><a href="#local-6989586621680966142"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span></span><span>
</span><span id="line-832"></span><span id="defnsReferences"><span class="annot"><span class="annottext">defnsReferences :: forall name.
Defns (BiMultimap Referent name) (BiMultimap TypeReference name)
-&gt; Set TypeReference
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#defnsReferences"><span class="hs-identifier hs-var hs-var">defnsReferences</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-833"></span><span>  </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; TypeReference
</span><span class="hs-identifier hs-var">Referent.toReference</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Set a
</span><span class="hs-identifier hs-var">BiMultimap.dom</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Set a
</span><span class="hs-identifier hs-var">BiMultimap.dom</span></span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#defnsToNames"><span class="hs-identifier hs-type">defnsToNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-836"></span><span id="defnsToNames"><span class="annot"><span class="annottext">defnsToNames :: Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; Names
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#defnsToNames"><span class="hs-identifier hs-var hs-var">defnsToNames</span></a></span></span><span> </span><span id="local-6989586621680964420"><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621680964420"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-837"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names.Names</span></span><span>
</span><span id="line-838"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">terms :: Relation Name Referent
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Ord a, Ord b) =&gt; Map a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621680964420"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-839"></span><span>      </span><span class="annot"><span class="annottext">types :: Relation Name TypeReference
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Ord a, Ord b) =&gt; Map a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621680964420"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#findTemporaryBranchName"><span class="hs-identifier hs-type">findTemporaryBranchName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSourceAndTarget"><span class="hs-identifier hs-type">MergeSourceAndTarget</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span>
</span><span id="line-843"></span><span id="findTemporaryBranchName"><span class="annot"><span class="annottext">findTemporaryBranchName :: ProjectId -&gt; MergeSourceAndTarget -&gt; Transaction ProjectBranchName
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#findTemporaryBranchName"><span class="hs-identifier hs-var hs-var">findTemporaryBranchName</span></a></span></span><span> </span><span id="local-6989586621680964416"><span class="annot"><span class="annottext">ProjectId
</span><a href="#local-6989586621680964416"><span class="hs-identifier hs-var">projectId</span></a></span></span><span> </span><span id="local-6989586621680964415"><span class="annot"><span class="annottext">MergeSourceAndTarget
</span><a href="#local-6989586621680964415"><span class="hs-identifier hs-var">mergeSourceAndTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-844"></span><span>  </span><span class="annot"><span class="annottext">ProjectId -&gt; ProjectBranchName -&gt; Transaction ProjectBranchName
</span><a href="Unison.Cli.ProjectUtils.html#findTemporaryBranchName"><span class="hs-identifier hs-var">ProjectUtils.findTemporaryBranchName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectId
</span><a href="#local-6989586621680964416"><span class="hs-identifier hs-var">projectId</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964413"><span class="hs-identifier hs-var">preferred</span></a></span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-846"></span><span>    </span><span class="annot"><a href="#local-6989586621680964413"><span class="hs-identifier hs-type">preferred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span>
</span><span id="line-847"></span><span>    </span><span id="local-6989586621680964413"><span class="annot"><span class="annottext">preferred :: ProjectBranchName
</span><a href="#local-6989586621680964413"><span class="hs-identifier hs-var hs-var">preferred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-848"></span><span>      </span><span class="annot"><span class="annottext">forall source target.
(HasCallStack, TryFrom source target, Show source, Typeable source,
 Typeable target) =&gt;
source -&gt; target
</span><span class="hs-identifier hs-var">unsafeFrom</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-849"></span><span>        </span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><span class="hs-identifier hs-var">Text.Builder.run</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-850"></span><span>          </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;merge-&quot;</span></span><span>
</span><span id="line-851"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MergeSource -&gt; Builder
</span><a href="#local-6989586621680964411"><span class="hs-identifier hs-var">mangleMergeSource</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceAndTarget
</span><a href="#local-6989586621680964415"><span class="hs-identifier hs-var">mergeSourceAndTarget</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span>
</span><span id="line-852"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;-into-&quot;</span></span><span>
</span><span id="line-853"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName -&gt; Builder
</span><a href="#local-6989586621680964410"><span class="hs-identifier hs-var">mangleBranchName</span></a></span><span> </span><span class="annot"><span class="annottext">MergeSourceAndTarget
</span><a href="#local-6989586621680964415"><span class="hs-identifier hs-var">mergeSourceAndTarget</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">branch</span><span>
</span><span id="line-854"></span><span>
</span><span id="line-855"></span><span>    </span><span class="annot"><a href="#local-6989586621680964411"><span class="hs-identifier hs-type">mangleMergeSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSource"><span class="hs-identifier hs-type">MergeSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text.Builder</span></span><span>
</span><span id="line-856"></span><span>    </span><span id="local-6989586621680964411"><span class="annot"><span class="annottext">mangleMergeSource :: MergeSource -&gt; Builder
</span><a href="#local-6989586621680964411"><span class="hs-identifier hs-var hs-var">mangleMergeSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-857"></span><span>      </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSource%27LocalProjectBranch"><span class="hs-identifier hs-type">MergeSource'LocalProjectBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span id="local-6989586621680964409"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621680964409"><span class="hs-identifier hs-var">_project</span></a></span></span><span> </span><span id="local-6989586621680964408"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964408"><span class="hs-identifier hs-var">branch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProjectBranchName -&gt; Builder
</span><a href="#local-6989586621680964410"><span class="hs-identifier hs-var">mangleBranchName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964408"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-858"></span><span>      </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSource%27RemoteProjectBranch"><span class="hs-identifier hs-type">MergeSource'RemoteProjectBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProjectAndBranch</span></span><span> </span><span id="local-6989586621680964407"><span class="annot"><span class="annottext">ProjectName
</span><a href="#local-6989586621680964407"><span class="hs-identifier hs-var">_project</span></a></span></span><span> </span><span id="local-6989586621680964406"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964406"><span class="hs-identifier hs-var">branch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;remote-&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName -&gt; Builder
</span><a href="#local-6989586621680964410"><span class="hs-identifier hs-var">mangleBranchName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964406"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-859"></span><span>      </span><span class="annot"><a href="Unison.Cli.MergeTypes.html#MergeSource%27RemoteLooseCode"><span class="hs-identifier hs-type">MergeSource'RemoteLooseCode</span></a></span><span> </span><span id="local-6989586621680964405"><span class="annot"><span class="annottext">ReadShareLooseCode
</span><a href="#local-6989586621680964405"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Builder
</span><a href="#local-6989586621680964404"><span class="hs-identifier hs-var">manglePath</span></a></span><span> </span><span class="annot"><span class="annottext">ReadShareLooseCode
</span><a href="#local-6989586621680964405"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">path</span><span>
</span><span id="line-860"></span><span>    </span><span class="annot"><a href="#local-6989586621680964410"><span class="hs-identifier hs-type">mangleBranchName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text.Builder</span></span><span>
</span><span id="line-861"></span><span>    </span><span id="local-6989586621680964410"><span class="annot"><span class="annottext">mangleBranchName :: ProjectBranchName -&gt; Builder
</span><a href="#local-6989586621680964410"><span class="hs-identifier hs-var hs-var">mangleBranchName</span></a></span></span><span> </span><span id="local-6989586621680964403"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964403"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-862"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProjectBranchName -&gt; ProjectBranchNameKind
</span><span class="hs-identifier hs-var">classifyProjectBranchName</span></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964403"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-863"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchNameKind'Contributor</span></span><span> </span><span id="local-6989586621680964401"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964401"><span class="hs-identifier hs-var">user</span></a></span></span><span> </span><span id="local-6989586621680964400"><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964400"><span class="hs-identifier hs-var">name1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-864"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">Text.Builder.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964401"><span class="hs-identifier hs-var">user</span></a></span><span>
</span><span id="line-865"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Builder
</span><span class="hs-identifier hs-var">Text.Builder.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'-'</span></span><span>
</span><span id="line-866"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName -&gt; Builder
</span><a href="#local-6989586621680964410"><span class="hs-identifier hs-var">mangleBranchName</span></a></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964400"><span class="hs-identifier hs-var">name1</span></a></span><span>
</span><span id="line-867"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchNameKind'DraftRelease</span></span><span> </span><span id="local-6989586621680964396"><span class="annot"><span class="annottext">Semver
</span><a href="#local-6989586621680964396"><span class="hs-identifier hs-var">semver</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;releases-drafts-&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Semver -&gt; Builder
</span><a href="#local-6989586621680964395"><span class="hs-identifier hs-var">mangleSemver</span></a></span><span> </span><span class="annot"><span class="annottext">Semver
</span><a href="#local-6989586621680964396"><span class="hs-identifier hs-var">semver</span></a></span><span>
</span><span id="line-868"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ProjectBranchNameKind'Release</span></span><span> </span><span id="local-6989586621680964393"><span class="annot"><span class="annottext">Semver
</span><a href="#local-6989586621680964393"><span class="hs-identifier hs-var">semver</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;releases-&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Semver -&gt; Builder
</span><a href="#local-6989586621680964395"><span class="hs-identifier hs-var">mangleSemver</span></a></span><span> </span><span class="annot"><span class="annottext">Semver
</span><a href="#local-6989586621680964393"><span class="hs-identifier hs-var">semver</span></a></span><span>
</span><span id="line-869"></span><span>        </span><span class="annot"><span class="annottext">ProjectBranchNameKind
</span><span class="hs-identifier hs-var">ProjectBranchNameKind'NothingSpecial</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">Text.Builder.text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall target source. From source target =&gt; source -&gt; target
</span><span class="hs-identifier hs-var">into</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="annottext">ProjectBranchName
</span><a href="#local-6989586621680964403"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span>    </span><span class="annot"><a href="#local-6989586621680964404"><span class="hs-identifier hs-type">manglePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text.Builder</span></span><span>
</span><span id="line-872"></span><span>    </span><span id="local-6989586621680964404"><span class="annot"><span class="annottext">manglePath :: Path -&gt; Builder
</span><a href="#local-6989586621680964404"><span class="hs-identifier hs-var hs-var">manglePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-873"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
(Foldable t, Monoid a) =&gt;
a -&gt; (b -&gt; a) -&gt; t b -&gt; a
</span><span class="hs-identifier hs-var">Monoid.intercalateMap</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">Text.Builder.text</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toUnescapedText</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; [NameSegment]
</span><span class="hs-identifier hs-var">Path.toList</span></span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span>    </span><span class="annot"><a href="#local-6989586621680964395"><span class="hs-identifier hs-type">mangleSemver</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semver</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text.Builder</span></span><span>
</span><span id="line-876"></span><span>    </span><span id="local-6989586621680964395"><span class="annot"><span class="annottext">mangleSemver :: Semver -&gt; Builder
</span><a href="#local-6989586621680964395"><span class="hs-identifier hs-var hs-var">mangleSemver</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Semver</span></span><span> </span><span id="local-6989586621680964387"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680964387"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680964386"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680964386"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621680964385"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680964385"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-877"></span><span>      </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; Builder
</span><span class="hs-identifier hs-var">Text.Builder.decimal</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680964387"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-878"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Builder
</span><span class="hs-identifier hs-var">Text.Builder.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span>
</span><span id="line-879"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; Builder
</span><span class="hs-identifier hs-var">Text.Builder.decimal</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680964386"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-880"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Builder
</span><span class="hs-identifier hs-var">Text.Builder.char</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span>
</span><span id="line-881"></span><span>        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; Builder
</span><span class="hs-identifier hs-var">Text.Builder.decimal</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680964385"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span class="hs-comment">-- Load all &quot;namespace definitions&quot; of a branch, which are all terms and type declarations *except* those defined</span><span>
</span><span id="line-884"></span><span class="hs-comment">-- in the &quot;lib&quot; namespace.</span><span>
</span><span id="line-885"></span><span class="hs-comment">--</span><span>
</span><span id="line-886"></span><span class="hs-comment">-- Fails if there is a conflicted name.</span><span>
</span><span id="line-887"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#loadNamespaceDefinitions"><span class="hs-identifier hs-type">loadNamespaceDefinitions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680966452"><span class="annot"><a href="#local-6989586621680966452"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-889"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680966452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-890"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2.Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680966452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-891"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">V2.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621680966452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-892"></span><span>  </span><span class="annot"><a href="#local-6989586621680966452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName"><span class="hs-identifier hs-type">ConflictedName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-893"></span><span id="loadNamespaceDefinitions"><span class="annot"><span class="annottext">loadNamespaceDefinitions :: forall (m :: * -&gt; *).
Monad m =&gt;
(Referent -&gt; m Referent)
-&gt; Branch m
-&gt; m (Either
        ConflictedName
        (Nametree
           (Defns
              (Map NameSegment Referent) (Map NameSegment TypeReference))))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#loadNamespaceDefinitions"><span class="hs-identifier hs-var hs-var">loadNamespaceDefinitions</span></a></span></span><span> </span><span id="local-6989586621680964361"><span class="annot"><span class="annottext">Referent -&gt; m Referent
</span><a href="#local-6989586621680964361"><span class="hs-identifier hs-var">referent2to1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-894"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Nametree (DefnsF2 (Map NameSegment) NESet Referent TypeReference)
-&gt; Either
     ConflictedName
     (Nametree
        (Defns (Map NameSegment Referent) (Map NameSegment TypeReference)))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#assertNamespaceHasNoConflictedNames"><span class="hs-identifier hs-var">assertNamespaceHasNoConflictedNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall x. Map NameSegment x -&gt; Map NameSegment x)
-&gt; Branch m
-&gt; m (Nametree
        (DefnsF2 (Map NameSegment) NESet Referent TypeReference))
</span><a href="#local-6989586621680964359"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier hs-var">NameSegment.libSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-896"></span><span>    </span><span class="annot"><a href="#local-6989586621680964359"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-897"></span><span>      </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680966091"><span class="annot"><a href="#local-6989586621680966091"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621680966091"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621680966091"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-898"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">V2.Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621680966452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-899"></span><span>      </span><span class="annot"><a href="#local-6989586621680966452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span>    </span><span id="local-6989586621680964359"><span class="annot"><span class="annottext">go :: (forall x. Map NameSegment x -&gt; Map NameSegment x)
-&gt; Branch m
-&gt; m (Nametree
        (DefnsF2 (Map NameSegment) NESet Referent TypeReference))
</span><a href="#local-6989586621680964359"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680964356"><span class="annot"><span class="annottext">forall x. Map NameSegment x -&gt; Map NameSegment x
</span><a href="#local-6989586621680964356"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680964355"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680964355"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-901"></span><span>      </span><span id="local-6989586621680964354"><span class="annot"><span class="annottext">Map NameSegment (NESet Referent)
</span><a href="#local-6989586621680964354"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680964355"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; NonEmpty a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">List.NonEmpty.fromList</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; m Referent
</span><a href="#local-6989586621680964361"><span class="hs-identifier hs-var">referent2to1</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span class="hs-special">)</span><span>
</span><span id="line-902"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964350"><span class="annot"><span class="annottext">types :: Map NameSegment (NESet TypeReference)
</span><a href="#local-6989586621680964350"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Set a -&gt; NESet a
</span><span class="hs-identifier hs-var">Set.NonEmpty.unsafeFromSet</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680964355"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-903"></span><span>      </span><span id="local-6989586621680964347"><span class="annot"><span class="annottext">Map
  NameSegment
  (Nametree (DefnsF2 (Map NameSegment) NESet Referent TypeReference))
</span><a href="#local-6989586621680964347"><span class="hs-identifier hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-904"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall x. Map NameSegment x -&gt; Map NameSegment x
</span><a href="#local-6989586621680964356"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680964355"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">children</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964346"><span class="annot"><span class="annottext">CausalBranch m
</span><a href="#local-6989586621680964346"><span class="hs-identifier hs-var">childCausal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-905"></span><span>          </span><span id="local-6989586621680964345"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680964345"><span class="hs-identifier hs-var">child</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CausalBranch m
</span><a href="#local-6989586621680964346"><span class="hs-identifier hs-var">childCausal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">value</span><span>
</span><span id="line-906"></span><span>          </span><span class="annot"><span class="annottext">(forall x. Map NameSegment x -&gt; Map NameSegment x)
-&gt; Branch m
-&gt; m (Nametree
        (DefnsF2 (Map NameSegment) NESet Referent TypeReference))
</span><a href="#local-6989586621680964359"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621680964345"><span class="hs-identifier hs-var">child</span></a></span><span>
</span><span id="line-907"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:Nametree :: DefnsF2 (Map NameSegment) NESet Referent TypeReference
</span><span class="hs-identifier hs-var">value</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Map NameSegment (NESet Referent)
terms :: Map NameSegment (NESet Referent)
$sel:terms:Defns :: Map NameSegment (NESet Referent)
</span><a href="#local-6989586621680964354"><span class="hs-identifier hs-var hs-var">terms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (NESet TypeReference)
types :: Map NameSegment (NESet TypeReference)
$sel:types:Defns :: Map NameSegment (NESet TypeReference)
</span><a href="#local-6989586621680964350"><span class="hs-identifier hs-var hs-var">types</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map
  NameSegment
  (Nametree (DefnsF2 (Map NameSegment) NESet Referent TypeReference))
children :: Map
  NameSegment
  (Nametree (DefnsF2 (Map NameSegment) NESet Referent TypeReference))
$sel:children:Nametree :: Map
  NameSegment
  (Nametree (DefnsF2 (Map NameSegment) NESet Referent TypeReference))
</span><a href="#local-6989586621680964347"><span class="hs-identifier hs-var hs-var">children</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="hs-keyword">data</span><span> </span><span id="ConflictedName"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName"><span class="hs-identifier hs-var">ConflictedName</span></a></span></span><span>
</span><span id="line-910"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ConflictedName%27Term"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName%27Term"><span class="hs-identifier hs-var">ConflictedName'Term</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ConflictedName%27Type"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName%27Type"><span class="hs-identifier hs-var">ConflictedName'Type</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span class="hs-comment">-- | Assert that there are no unconflicted names in a namespace.</span><span>
</span><span id="line-914"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#assertNamespaceHasNoConflictedNames"><span class="hs-identifier hs-type">assertNamespaceHasNoConflictedNames</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-915"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-916"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName"><span class="hs-identifier hs-type">ConflictedName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nametree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span id="assertNamespaceHasNoConflictedNames"><span class="annot"><span class="annottext">assertNamespaceHasNoConflictedNames :: Nametree (DefnsF2 (Map NameSegment) NESet Referent TypeReference)
-&gt; Either
     ConflictedName
     (Nametree
        (Defns (Map NameSegment Referent) (Map NameSegment TypeReference)))
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#assertNamespaceHasNoConflictedNames"><span class="hs-identifier hs-var hs-var">assertNamespaceHasNoConflictedNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-918"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b.
Applicative f =&gt;
([NameSegment] -&gt; a -&gt; f b) -&gt; Nametree a -&gt; f (Nametree b)
</span><span class="hs-identifier hs-var">traverseNametreeWithName</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964344"><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621680964344"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621680964343"><span class="annot"><span class="annottext">DefnsF2 (Map NameSegment) NESet Referent TypeReference
</span><a href="#local-6989586621680964343"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-919"></span><span>    </span><span id="local-6989586621680964342"><span class="annot"><span class="annottext">Map NameSegment Referent
</span><a href="#local-6989586621680964342"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-920"></span><span>      </span><span class="annot"><span class="annottext">DefnsF2 (Map NameSegment) NESet Referent TypeReference
</span><a href="#local-6989586621680964343"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) k a b.
Applicative t =&gt;
(k -&gt; a -&gt; t b) -&gt; Map k a -&gt; t (Map k b)
</span><span class="hs-identifier hs-var">Map.traverseWithKey</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964341"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964341"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-921"></span><span>        </span><span class="annot"><span class="annottext">forall ref.
(NESet ref -&gt; ConflictedName)
-&gt; NESet ref -&gt; Either ConflictedName ref
</span><a href="#local-6989586621680964340"><span class="hs-identifier hs-var">assertUnconflicted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NESet Referent -&gt; ConflictedName
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName%27Term"><span class="hs-identifier hs-var">ConflictedName'Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromReverseSegments</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964341"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621680964344"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>    </span><span id="local-6989586621680964338"><span class="annot"><span class="annottext">Map NameSegment TypeReference
</span><a href="#local-6989586621680964338"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-923"></span><span>      </span><span class="annot"><span class="annottext">DefnsF2 (Map NameSegment) NESet Referent TypeReference
</span><a href="#local-6989586621680964343"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) k a b.
Applicative t =&gt;
(k -&gt; a -&gt; t b) -&gt; Map k a -&gt; t (Map k b)
</span><span class="hs-identifier hs-var">Map.traverseWithKey</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680964337"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964337"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-924"></span><span>        </span><span class="annot"><span class="annottext">forall ref.
(NESet ref -&gt; ConflictedName)
-&gt; NESet ref -&gt; Either ConflictedName ref
</span><a href="#local-6989586621680964340"><span class="hs-identifier hs-var">assertUnconflicted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NESet TypeReference -&gt; ConflictedName
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName%27Type"><span class="hs-identifier hs-var">ConflictedName'Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromReverseSegments</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964337"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621680964344"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Map NameSegment Referent
terms :: Map NameSegment Referent
$sel:terms:Defns :: Map NameSegment Referent
</span><a href="#local-6989586621680964342"><span class="hs-identifier hs-var hs-var">terms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NameSegment TypeReference
types :: Map NameSegment TypeReference
$sel:types:Defns :: Map NameSegment TypeReference
</span><a href="#local-6989586621680964338"><span class="hs-identifier hs-var hs-var">types</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-926"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-927"></span><span>    </span><span id="local-6989586621680966077"><span class="annot"><a href="#local-6989586621680964340"><span class="hs-identifier hs-type">assertUnconflicted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621680966077"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName"><span class="hs-identifier hs-type">ConflictedName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><a href="#local-6989586621680966077"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#ConflictedName"><span class="hs-identifier hs-type">ConflictedName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966077"><span class="hs-identifier hs-type">ref</span></a></span></span><span>
</span><span id="line-928"></span><span>    </span><span id="local-6989586621680964340"><span class="annot"><span class="annottext">assertUnconflicted :: forall ref.
(NESet ref -&gt; ConflictedName)
-&gt; NESet ref -&gt; Either ConflictedName ref
</span><a href="#local-6989586621680964340"><span class="hs-identifier hs-var hs-var">assertUnconflicted</span></a></span></span><span> </span><span id="local-6989586621680964332"><span class="annot"><span class="annottext">NESet ref -&gt; ConflictedName
</span><a href="#local-6989586621680964332"><span class="hs-identifier hs-var">conflicted</span></a></span></span><span> </span><span id="local-6989586621680964331"><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680964331"><span class="hs-identifier hs-var">refs</span></a></span></span><span>
</span><span id="line-929"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. NESet a -&gt; Int
</span><span class="hs-identifier hs-var">Set.NonEmpty.size</span></span><span> </span><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680964331"><span class="hs-identifier hs-var">refs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NESet a -&gt; a
</span><span class="hs-identifier hs-var">Set.NonEmpty.findMin</span></span><span> </span><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680964331"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-930"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NESet ref -&gt; ConflictedName
</span><a href="#local-6989586621680964332"><span class="hs-identifier hs-var">conflicted</span></a></span><span> </span><span class="annot"><span class="annottext">NESet ref
</span><a href="#local-6989586621680964331"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span class="hs-comment">-- @findConflictedAlias namespace diff@, given an old namespace and a diff to a new namespace, will return the first</span><span>
</span><span id="line-933"></span><span class="hs-comment">-- &quot;conflicted alias&quot; encountered (if any), where a &quot;conflicted alias&quot; is a pair of names that referred to the same</span><span>
</span><span id="line-934"></span><span class="hs-comment">-- thing in the old namespace, but different things in the new one.</span><span>
</span><span id="line-935"></span><span class="hs-comment">--</span><span>
</span><span id="line-936"></span><span class="hs-comment">-- For example, if the old namespace was</span><span>
</span><span id="line-937"></span><span class="hs-comment">--</span><span>
</span><span id="line-938"></span><span class="hs-comment">--   foo = #foo</span><span>
</span><span id="line-939"></span><span class="hs-comment">--   bar = #foo</span><span>
</span><span id="line-940"></span><span class="hs-comment">--</span><span>
</span><span id="line-941"></span><span class="hs-comment">-- and the new namespace is</span><span>
</span><span id="line-942"></span><span class="hs-comment">--</span><span>
</span><span id="line-943"></span><span class="hs-comment">--   foo = #baz</span><span>
</span><span id="line-944"></span><span class="hs-comment">--   bar = #qux</span><span>
</span><span id="line-945"></span><span class="hs-comment">--</span><span>
</span><span id="line-946"></span><span class="hs-comment">-- then (foo, bar) is a conflicted alias.</span><span>
</span><span id="line-947"></span><span class="hs-comment">--</span><span>
</span><span id="line-948"></span><span class="hs-comment">-- This function currently doesn't return whether the conflicted alias is a decl or a term, but it certainly could.</span><span>
</span><span id="line-949"></span><span id="local-6989586621680966419"><span id="local-6989586621680966420"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#findConflictedAlias"><span class="hs-identifier hs-type">findConflictedAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-950"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680966420"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680966419"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-951"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><a href="#local-6989586621680966420"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><a href="#local-6989586621680966419"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-952"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffOp</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Synhashed</span></span><span> </span><span class="annot"><a href="#local-6989586621680966420"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966419"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-953"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-954"></span><span id="findConflictedAlias"><span class="annot"><span class="annottext">findConflictedAlias :: forall term typ.
(Ord term, Ord typ) =&gt;
Defns (BiMultimap term Name) (BiMultimap typ Name)
-&gt; DefnsF3 (Map Name) DiffOp Synhashed term typ
-&gt; Maybe (Name, Name)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#findConflictedAlias"><span class="hs-identifier hs-var hs-var">findConflictedAlias</span></a></span></span><span> </span><span id="local-6989586621680964317"><span class="annot"><span class="annottext">Defns (BiMultimap term Name) (BiMultimap typ Name)
</span><a href="#local-6989586621680964317"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621680964316"><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed term typ
</span><a href="#local-6989586621680964316"><span class="hs-identifier hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-955"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Foldable t, Alternative f) =&gt;
t (f a) -&gt; f a
</span><span class="hs-identifier hs-var">asum</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall ref.
Ord ref =&gt;
BiMultimap ref Name
-&gt; Map Name (DiffOp (Synhashed ref)) -&gt; Maybe (Name, Name)
</span><a href="#local-6989586621680964314"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap term Name) (BiMultimap typ Name)
</span><a href="#local-6989586621680964317"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span> </span><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed term typ
</span><a href="#local-6989586621680964316"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall ref.
Ord ref =&gt;
BiMultimap ref Name
-&gt; Map Name (DiffOp (Synhashed ref)) -&gt; Maybe (Name, Name)
</span><a href="#local-6989586621680964314"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap term Name) (BiMultimap typ Name)
</span><a href="#local-6989586621680964317"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span> </span><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed term typ
</span><a href="#local-6989586621680964316"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">]</span><span>
</span><span id="line-956"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-957"></span><span>    </span><span class="annot"><a href="#local-6989586621680964314"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680966065"><span class="annot"><a href="#local-6989586621680966065"><span class="hs-identifier hs-type">ref</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680966065"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><a href="#local-6989586621680966065"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DiffOp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Synhashed</span></span><span> </span><span class="annot"><a href="#local-6989586621680966065"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-958"></span><span>    </span><span id="local-6989586621680964314"><span class="annot"><span class="annottext">go :: forall ref.
Ord ref =&gt;
BiMultimap ref Name
-&gt; Map Name (DiffOp (Synhashed ref)) -&gt; Maybe (Name, Name)
</span><a href="#local-6989586621680964314"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680964300"><span class="annot"><span class="annottext">BiMultimap ref Name
</span><a href="#local-6989586621680964300"><span class="hs-identifier hs-var">namespace</span></a></span></span><span> </span><span id="local-6989586621680964299"><span class="annot"><span class="annottext">Map Name (DiffOp (Synhashed ref))
</span><a href="#local-6989586621680964299"><span class="hs-identifier hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-959"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Foldable t, Alternative f) =&gt;
t (f a) -&gt; f a
</span><span class="hs-identifier hs-var">asum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, DiffOp (Synhashed ref)) -&gt; Maybe (Name, Name)
</span><a href="#local-6989586621680964298"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Name (DiffOp (Synhashed ref))
</span><a href="#local-6989586621680964299"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-961"></span><span>        </span><span class="annot"><a href="#local-6989586621680964298"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffOp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Synhashed</span></span><span> </span><span class="annot"><a href="#local-6989586621680966065"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>        </span><span id="local-6989586621680964298"><span class="annot"><span class="annottext">f :: (Name, DiffOp (Synhashed ref)) -&gt; Maybe (Name, Name)
</span><a href="#local-6989586621680964298"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680964297"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964297"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964296"><span class="annot"><span class="annottext">DiffOp (Synhashed ref)
</span><a href="#local-6989586621680964296"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-963"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DiffOp (Synhashed ref)
</span><a href="#local-6989586621680964296"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-964"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">DiffOp'Add</span></span><span> </span><span class="annot"><span class="annottext">Synhashed ref
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-965"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">DiffOp'Delete</span></span><span> </span><span class="annot"><span class="annottext">Synhashed ref
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-966"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">DiffOp'Update</span></span><span> </span><span id="local-6989586621680964292"><span class="annot"><span class="annottext">Updated (Synhashed ref)
</span><a href="#local-6989586621680964292"><span class="hs-identifier hs-var">hashed1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-967"></span><span>              </span><span class="annot"><span class="annottext">forall a b. (Ord a, Ord b) =&gt; b -&gt; BiMultimap a b -&gt; Set b
</span><span class="hs-identifier hs-var">BiMultimap.lookupPreimage</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964297"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">BiMultimap ref Name
</span><a href="#local-6989586621680964300"><span class="hs-identifier hs-var">namespace</span></a></span><span>
</span><span id="line-968"></span><span>                </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964297"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-969"></span><span>                </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span>
</span><span id="line-970"></span><span>                </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Synhashed ref -&gt; Name -&gt; Maybe (Name, Name)
</span><a href="#local-6989586621680964288"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Updated (Synhashed ref)
</span><a href="#local-6989586621680964292"><span class="hs-identifier hs-var">hashed1</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">new</span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>                </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Foldable t, Alternative f) =&gt;
t (f a) -&gt; f a
</span><span class="hs-identifier hs-var">asum</span></span><span>
</span><span id="line-972"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-973"></span><span>            </span><span class="annot"><a href="#local-6989586621680964288"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Synhashed</span></span><span> </span><span class="annot"><a href="#local-6989586621680966065"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>            </span><span id="local-6989586621680964288"><span class="annot"><span class="annottext">g :: Synhashed ref -&gt; Name -&gt; Maybe (Name, Name)
</span><a href="#local-6989586621680964288"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680964287"><span class="annot"><span class="annottext">Synhashed ref
</span><a href="#local-6989586621680964287"><span class="hs-identifier hs-var">hashed1</span></a></span></span><span> </span><span id="local-6989586621680964286"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964286"><span class="hs-identifier hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-975"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964286"><span class="hs-identifier hs-var">alias</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (DiffOp (Synhashed ref))
</span><a href="#local-6989586621680964299"><span class="hs-identifier hs-var">diff</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-976"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DiffOp'Update</span></span><span> </span><span id="local-6989586621680964285"><span class="annot"><span class="annottext">Updated (Synhashed ref)
</span><a href="#local-6989586621680964285"><span class="hs-identifier hs-var">hashed2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Synhashed ref
</span><a href="#local-6989586621680964287"><span class="hs-identifier hs-var">hashed1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Updated (Synhashed ref)
</span><a href="#local-6989586621680964285"><span class="hs-identifier hs-var">hashed2</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">new</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-977"></span><span>                </span><span class="hs-comment">-- If &quot;foo&quot; was updated but its alias &quot;bar&quot; was deleted, that's ok</span><span>
</span><span id="line-978"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DiffOp'Delete</span></span><span> </span><span class="annot"><span class="annottext">Synhashed ref
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-979"></span><span>                </span><span class="annot"><span class="annottext">Maybe (DiffOp (Synhashed ref))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964297"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964286"><span class="hs-identifier hs-var">alias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span class="hs-comment">-- Given a name like &quot;base&quot;, try &quot;base__1&quot;, then &quot;base__2&quot;, etc, until we find a name that doesn't</span><span>
</span><span id="line-982"></span><span class="hs-comment">-- clash with any existing dependencies.</span><span>
</span><span id="line-983"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#getTwoFreshNames"><span class="hs-identifier hs-type">getTwoFreshNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span id="getTwoFreshNames"><span class="annot"><span class="annottext">getTwoFreshNames :: Set NameSegment -&gt; NameSegment -&gt; (NameSegment, NameSegment)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#getTwoFreshNames"><span class="hs-identifier hs-var hs-var">getTwoFreshNames</span></a></span></span><span> </span><span id="local-6989586621680964284"><span class="annot"><span class="annottext">Set NameSegment
</span><a href="#local-6989586621680964284"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621680964283"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964283"><span class="hs-identifier hs-var">name0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-985"></span><span>  </span><span class="annot"><span class="annottext">Integer -&gt; (NameSegment, NameSegment)
</span><a href="#local-6989586621680964282"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-986"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-987"></span><span>    </span><span class="hs-comment">-- if</span><span>
</span><span id="line-988"></span><span>    </span><span class="hs-comment">--   name0 = &quot;base&quot;</span><span>
</span><span id="line-989"></span><span>    </span><span class="hs-comment">--   names = {&quot;base__5&quot;, &quot;base__6&quot;}</span><span>
</span><span id="line-990"></span><span>    </span><span class="hs-comment">-- then</span><span>
</span><span id="line-991"></span><span>    </span><span class="hs-comment">--   go2 4 = (&quot;base__4&quot;, &quot;base__7&quot;)</span><span>
</span><span id="line-992"></span><span>    </span><span class="annot"><a href="#local-6989586621680964282"><span class="hs-identifier hs-type">go2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>    </span><span id="local-6989586621680964282"><span class="annot"><span class="annottext">go2 :: Integer -&gt; (NameSegment, NameSegment)
</span><a href="#local-6989586621680964282"><span class="hs-identifier hs-var hs-var">go2</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680964281"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680964281"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-994"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964280"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Set NameSegment
</span><a href="#local-6989586621680964284"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; (NameSegment, NameSegment)
</span><a href="#local-6989586621680964282"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680964281"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964280"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; NameSegment
</span><a href="#local-6989586621680964278"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680964281"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-997"></span><span>        </span><span id="local-6989586621680964280"><span class="annot"><span class="annottext">name :: NameSegment
</span><a href="#local-6989586621680964280"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; NameSegment
</span><a href="#local-6989586621680964277"><span class="hs-identifier hs-var">mangled</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680964281"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-998"></span><span>
</span><span id="line-999"></span><span>    </span><span class="hs-comment">-- if</span><span>
</span><span id="line-1000"></span><span>    </span><span class="hs-comment">--   name0 = &quot;base&quot;</span><span>
</span><span id="line-1001"></span><span>    </span><span class="hs-comment">--   names = {&quot;base__5&quot;, &quot;base__6&quot;}</span><span>
</span><span id="line-1002"></span><span>    </span><span class="hs-comment">-- then</span><span>
</span><span id="line-1003"></span><span>    </span><span class="hs-comment">--   go1 5 = &quot;base__7&quot;</span><span>
</span><span id="line-1004"></span><span>    </span><span class="annot"><a href="#local-6989586621680964278"><span class="hs-identifier hs-type">go1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span>
</span><span id="line-1005"></span><span>    </span><span id="local-6989586621680964278"><span class="annot"><span class="annottext">go1 :: Integer -&gt; NameSegment
</span><a href="#local-6989586621680964278"><span class="hs-identifier hs-var hs-var">go1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680964276"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680964276"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-1006"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964275"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Set NameSegment
</span><a href="#local-6989586621680964284"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; NameSegment
</span><a href="#local-6989586621680964278"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680964276"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1007"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964275"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1008"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1009"></span><span>        </span><span id="local-6989586621680964275"><span class="annot"><span class="annottext">name :: NameSegment
</span><a href="#local-6989586621680964275"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; NameSegment
</span><a href="#local-6989586621680964277"><span class="hs-identifier hs-var">mangled</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680964276"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1010"></span><span>
</span><span id="line-1011"></span><span>    </span><span class="annot"><a href="#local-6989586621680964277"><span class="hs-identifier hs-type">mangled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span>
</span><span id="line-1012"></span><span>    </span><span id="local-6989586621680964277"><span class="annot"><span class="annottext">mangled :: Integer -&gt; NameSegment
</span><a href="#local-6989586621680964277"><span class="hs-identifier hs-var hs-var">mangled</span></a></span></span><span> </span><span id="local-6989586621680964274"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680964274"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1013"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; NameSegment
</span><span class="hs-identifier hs-var">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var">NameSegment.toUnescapedText</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621680964283"><span class="hs-identifier hs-var">name0</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680964274"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#libdepsToBranch0"><span class="hs-identifier hs-type">libdepsToBranch0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MergeDatabase</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span class="hs-special">)</span><span>
</span><span id="line-1016"></span><span id="libdepsToBranch0"><span class="annot"><span class="annottext">libdepsToBranch0 :: MergeDatabase
-&gt; Map NameSegment (CausalBranch Transaction)
-&gt; Transaction (Branch0 Transaction)
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#libdepsToBranch0"><span class="hs-identifier hs-var hs-var">libdepsToBranch0</span></a></span></span><span> </span><span id="local-6989586621680964272"><span class="annot"><span class="annottext">MergeDatabase
</span><a href="#local-6989586621680964272"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621680964271"><span class="annot"><span class="annottext">Map NameSegment (CausalBranch Transaction)
</span><a href="#local-6989586621680964271"><span class="hs-identifier hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1017"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680964270"><span class="hs-identifier hs-type">branch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2.Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span>
</span><span id="line-1018"></span><span>      </span><span id="local-6989586621680964270"><span class="annot"><span class="annottext">branch :: Branch Transaction
</span><a href="#local-6989586621680964270"><span class="hs-identifier hs-var hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1019"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">V2.Branch</span></span><span>
</span><span id="line-1020"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:terms:Branch :: Map NameSegment (Map Referent (Transaction MdValues))
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-1021"></span><span>            </span><span class="annot"><span class="annottext">$sel:types:Branch :: Map NameSegment (Map TypeReference (Transaction MdValues))
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-1022"></span><span>            </span><span class="annot"><span class="annottext">$sel:patches:Branch :: Map NameSegment (PatchHash, Transaction Patch)
</span><span class="hs-identifier hs-var">patches</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-1023"></span><span>            </span><span class="annot"><span class="annottext">$sel:children:Branch :: Map NameSegment (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">children</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (CausalBranch Transaction)
</span><a href="#local-6989586621680964271"><span class="hs-identifier hs-var">libdeps</span></a></span><span>
</span><span id="line-1024"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1025"></span><span>
</span><span id="line-1026"></span><span>  </span><span class="hs-comment">-- We make a fresh branch cache to load the branch of libdeps.</span><span>
</span><span id="line-1027"></span><span>  </span><span class="hs-comment">-- It would probably be better to reuse the codebase's branch cache.</span><span>
</span><span id="line-1028"></span><span>  </span><span class="hs-comment">-- FIXME how slow/bad is this without that branch cache?</span><span>
</span><span id="line-1029"></span><span>  </span><span id="local-6989586621680964264"><span class="annot"><span class="annottext">BranchCache Transaction
</span><a href="#local-6989586621680964264"><span class="hs-identifier hs-var">branchCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; Transaction a
</span><span class="hs-identifier hs-var">Sqlite.unsafeIO</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadIO m =&gt; m (BranchCache Transaction)
</span><span class="hs-identifier hs-var">newBranchCache</span></span><span>
</span><span id="line-1030"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
BranchCache m
-&gt; (TypeReference -&gt; m ConstructorType)
-&gt; Branch m
-&gt; m (Branch0 m)
</span><span class="hs-identifier hs-var">Conversions.branch2to1</span></span><span> </span><span class="annot"><span class="annottext">BranchCache Transaction
</span><a href="#local-6989586621680964264"><span class="hs-identifier hs-var">branchCache</span></a></span><span> </span><span class="annot"><span class="annottext">MergeDatabase
</span><a href="#local-6989586621680964272"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">loadDeclType</span><span> </span><span class="annot"><span class="annottext">Branch Transaction
</span><a href="#local-6989586621680964270"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-1033"></span><span class="hs-comment">-- Debugging by printing a bunch of stuff out</span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span class="hs-keyword">data</span><span> </span><span id="DebugFunctions"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#DebugFunctions"><span class="hs-identifier hs-var">DebugFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DebugFunctions"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#DebugFunctions"><span class="hs-identifier hs-var">DebugFunctions</span></a></span></span><span>
</span><span id="line-1036"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AdebugCausals%3ADebugFunctions"><span class="annot"><span class="annottext">DebugFunctions -&gt; TwoOrThreeWay (CausalBranch Transaction) -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugCausals%3ADebugFunctions"><span class="hs-identifier hs-var hs-var">debugCausals</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoOrThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1037"></span><span>    </span><span id="%24sel%3AdebugDefns%3ADebugFunctions"><span class="annot"><span class="annottext">DebugFunctions
-&gt; ThreeWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay DeclNameLookup
-&gt; Map Name [Maybe Name]
-&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugDefns%3ADebugFunctions"><span class="hs-identifier hs-var hs-var">debugDefns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1038"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">ThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1039"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1040"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1041"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1042"></span><span>    </span><span id="%24sel%3AdebugDiffs%3ADebugFunctions"><span class="annot"><span class="annottext">DebugFunctions
-&gt; TwoWay
     (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
-&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugDiffs%3ADebugFunctions"><span class="hs-identifier hs-var hs-var">debugDiffs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffOp</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Synhashed</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1043"></span><span>    </span><span id="%24sel%3AdebugCombinedDiff%3ADebugFunctions"><span class="annot"><span class="annottext">DebugFunctions
-&gt; DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
-&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugCombinedDiff%3ADebugFunctions"><span class="hs-identifier hs-var hs-var">debugCombinedDiff</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CombinedDiffOp</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1044"></span><span>    </span><span id="%24sel%3AdebugPartitionedDiff%3ADebugFunctions"><span class="annot"><span class="annottext">DebugFunctions
-&gt; TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
-&gt; DefnsF Unconflicts Referent TypeReference
-&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugPartitionedDiff%3ADebugFunctions"><span class="hs-identifier hs-var hs-var">debugPartitionedDiff</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1045"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1046"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unconflicts</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1047"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1048"></span><span>    </span><span id="%24sel%3AdebugDependents%3ADebugFunctions"><span class="annot"><span class="annottext">DebugFunctions
-&gt; TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
-&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugDependents%3ADebugFunctions"><span class="hs-identifier hs-var hs-var">debugDependents</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1049"></span><span>    </span><span id="%24sel%3AdebugStageOne%3ADebugFunctions"><span class="annot"><span class="annottext">DebugFunctions -&gt; DefnsF (Map Name) Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugStageOne%3ADebugFunctions"><span class="hs-identifier hs-var hs-var">debugStageOne</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugFunctions"><span class="hs-identifier hs-type">realDebugFunctions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#DebugFunctions"><span class="hs-identifier hs-type">DebugFunctions</span></a></span><span>
</span><span id="line-1053"></span><span id="realDebugFunctions"><span class="annot"><span class="annottext">realDebugFunctions :: DebugFunctions
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugFunctions"><span class="hs-identifier hs-var hs-var">realDebugFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1054"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#DebugFunctions"><span class="hs-identifier hs-type">DebugFunctions</span></a></span><span>
</span><span id="line-1055"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:debugCausals:DebugFunctions :: TwoOrThreeWay (CausalBranch Transaction) -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugCausals%3ADebugFunctions"><span class="hs-identifier hs-var">debugCausals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction) -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugCausals"><span class="hs-identifier hs-var">realDebugCausals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1056"></span><span>      </span><span class="annot"><span class="annottext">$sel:debugDefns:DebugFunctions :: ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay DeclNameLookup -&gt; Map Name [Maybe Name] -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugDefns%3ADebugFunctions"><span class="hs-identifier hs-var">debugDefns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay DeclNameLookup -&gt; Map Name [Maybe Name] -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugDefns"><span class="hs-identifier hs-var">realDebugDefns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1057"></span><span>      </span><span class="annot"><span class="annottext">$sel:debugDiffs:DebugFunctions :: TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
-&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugDiffs%3ADebugFunctions"><span class="hs-identifier hs-var">debugDiffs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
-&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugDiffs"><span class="hs-identifier hs-var">realDebugDiffs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1058"></span><span>      </span><span class="annot"><span class="annottext">$sel:debugCombinedDiff:DebugFunctions :: DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugCombinedDiff%3ADebugFunctions"><span class="hs-identifier hs-var">debugCombinedDiff</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugCombinedDiff"><span class="hs-identifier hs-var">realDebugCombinedDiff</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1059"></span><span>      </span><span class="annot"><span class="annottext">$sel:debugPartitionedDiff:DebugFunctions :: TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
-&gt; DefnsF Unconflicts Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugPartitionedDiff%3ADebugFunctions"><span class="hs-identifier hs-var">debugPartitionedDiff</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
-&gt; DefnsF Unconflicts Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugPartitionedDiff"><span class="hs-identifier hs-var">realDebugPartitionedDiff</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1060"></span><span>      </span><span class="annot"><span class="annottext">$sel:debugDependents:DebugFunctions :: TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId) -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugDependents%3ADebugFunctions"><span class="hs-identifier hs-var">debugDependents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId) -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugDependents"><span class="hs-identifier hs-var">realDebugDependents</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1061"></span><span>      </span><span class="annot"><span class="annottext">$sel:debugStageOne:DebugFunctions :: DefnsF (Map Name) Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#%24sel%3AdebugStageOne%3ADebugFunctions"><span class="hs-identifier hs-var">debugStageOne</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugStageOne"><span class="hs-identifier hs-var">realDebugStageOne</span></a></span><span>
</span><span id="line-1062"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#fakeDebugFunctions"><span class="hs-identifier hs-type">fakeDebugFunctions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#DebugFunctions"><span class="hs-identifier hs-type">DebugFunctions</span></a></span><span>
</span><span id="line-1065"></span><span id="fakeDebugFunctions"><span class="annot"><span class="annottext">fakeDebugFunctions :: DebugFunctions
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#fakeDebugFunctions"><span class="hs-identifier hs-var hs-var">fakeDebugFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1066"></span><span>  </span><span class="annot"><span class="annottext">(TwoOrThreeWay (CausalBranch Transaction) -&gt; IO ())
-&gt; (ThreeWay
      (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
    -&gt; TwoWay DeclNameLookup -&gt; Map Name [Maybe Name] -&gt; IO ())
-&gt; (TwoWay
      (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
    -&gt; IO ())
-&gt; (DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
    -&gt; IO ())
-&gt; (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
    -&gt; DefnsF Unconflicts Referent TypeReference -&gt; IO ())
-&gt; (TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
    -&gt; IO ())
-&gt; (DefnsF (Map Name) Referent TypeReference -&gt; IO ())
-&gt; DebugFunctions
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#DebugFunctions"><span class="hs-identifier hs-var">DebugFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1067"></span><span>
</span><span id="line-1068"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugCausals"><span class="hs-identifier hs-type">realDebugCausals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoOrThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2.CausalBranch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transaction</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1069"></span><span id="realDebugCausals"><span class="annot"><span class="annottext">realDebugCausals :: TwoOrThreeWay (CausalBranch Transaction) -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugCausals"><span class="hs-identifier hs-var hs-var">realDebugCausals</span></a></span></span><span> </span><span id="local-6989586621680964246"><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964246"><span class="hs-identifier hs-var">causals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1070"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Alice causal hash ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1071"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; Text
</span><span class="hs-identifier hs-var">Hash.toBase32HexText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Hash
</span><span class="hs-identifier hs-var">unCausalHash</span></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964246"><span class="hs-identifier hs-var">causals</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Bob causal hash ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1073"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; Text
</span><span class="hs-identifier hs-var">Hash.toBase32HexText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Hash
</span><span class="hs-identifier hs-var">unCausalHash</span></span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964246"><span class="hs-identifier hs-var">causals</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1074"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== LCA causal hash ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1075"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TwoOrThreeWay (CausalBranch Transaction)
</span><a href="#local-6989586621680964246"><span class="hs-identifier hs-var">causals</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1076"></span><span>    </span><span class="annot"><span class="annottext">Maybe (CausalBranch Transaction)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Nothing&quot;</span></span><span>
</span><span id="line-1077"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680964242"><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964242"><span class="hs-identifier hs-var">causal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Just &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Text
</span><span class="hs-identifier hs-var">Hash.toBase32HexText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Hash
</span><span class="hs-identifier hs-var">unCausalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalBranch Transaction
</span><a href="#local-6989586621680964242"><span class="hs-identifier hs-var">causal</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">causalHash</span><span class="hs-special">)</span><span>
</span><span id="line-1078"></span><span>
</span><span id="line-1079"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugDefns"><span class="hs-identifier hs-type">realDebugDefns</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1080"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ThreeWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1081"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1082"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1083"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span id="realDebugDefns"><span class="annot"><span class="annottext">realDebugDefns :: ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay DeclNameLookup -&gt; Map Name [Maybe Name] -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugDefns"><span class="hs-identifier hs-var hs-var">realDebugDefns</span></a></span></span><span> </span><span id="local-6989586621680964241"><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964241"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621680964240"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964240"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span> </span><span id="local-6989586621680964239"><span class="annot"><span class="annottext">Map Name [Maybe Name]
</span><a href="#local-6989586621680964239"><span class="hs-identifier hs-var">_lcaDeclNameLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1085"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Alice definitions ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>  </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#debugDefns1"><span class="hs-identifier hs-var">debugDefns1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964241"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Bob definitions ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>  </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#debugDefns1"><span class="hs-identifier hs-var">debugDefns1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
</span><a href="#local-6989586621680964241"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span>
</span><span id="line-1090"></span><span>
</span><span id="line-1091"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Alice constructor names ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1092"></span><span>  </span><span class="annot"><span class="annottext">Map Name [Name] -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#debugConstructorNames"><span class="hs-identifier hs-var">debugConstructorNames</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964240"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">declToConstructors</span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Bob constructor names ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>  </span><span class="annot"><span class="annottext">Map Name [Name] -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#debugConstructorNames"><span class="hs-identifier hs-var">debugConstructorNames</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621680964240"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">declToConstructors</span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugDiffs"><span class="hs-identifier hs-type">realDebugDiffs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffOp</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Synhashed</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1098"></span><span id="realDebugDiffs"><span class="annot"><span class="annottext">realDebugDiffs :: TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
-&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugDiffs"><span class="hs-identifier hs-var hs-var">realDebugDiffs</span></a></span></span><span> </span><span id="local-6989586621680964236"><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
</span><a href="#local-6989586621680964236"><span class="hs-identifier hs-var">diffs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1099"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== LCA&#8594;Alice diff ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1100"></span><span>  </span><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference -&gt; IO ()
</span><a href="#local-6989586621680964235"><span class="hs-identifier hs-var">renderDiff</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
</span><a href="#local-6989586621680964236"><span class="hs-identifier hs-var">diffs</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-1101"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== LCA&#8594;Bob diff ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>  </span><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference -&gt; IO ()
</span><a href="#local-6989586621680964235"><span class="hs-identifier hs-var">renderDiff</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference)
</span><a href="#local-6989586621680964236"><span class="hs-identifier hs-var">diffs</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span>
</span><span id="line-1103"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1104"></span><span>    </span><span class="annot"><a href="#local-6989586621680964235"><span class="hs-identifier hs-type">renderDiff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffOp</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Synhashed</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>    </span><span id="local-6989586621680964235"><span class="annot"><span class="annottext">renderDiff :: DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference -&gt; IO ()
</span><a href="#local-6989586621680964235"><span class="hs-identifier hs-var hs-var">renderDiff</span></a></span></span><span> </span><span id="local-6989586621680964234"><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference
</span><a href="#local-6989586621680964234"><span class="hs-identifier hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1106"></span><span>      </span><span class="annot"><span class="annottext">forall ref.
(ref -&gt; Text) -&gt; Map Name (DiffOp (Synhashed ref)) -&gt; IO ()
</span><a href="#local-6989586621680964233"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference
</span><a href="#local-6989586621680964234"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span>
</span><span id="line-1107"></span><span>      </span><span class="annot"><span class="annottext">forall ref.
(ref -&gt; Text) -&gt; Map Name (DiffOp (Synhashed ref)) -&gt; IO ()
</span><a href="#local-6989586621680964233"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DefnsF3 (Map Name) DiffOp Synhashed Referent TypeReference
</span><a href="#local-6989586621680964234"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>    </span><span id="local-6989586621680966051"><span class="annot"><a href="#local-6989586621680964233"><span class="hs-identifier hs-type">renderThings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680966051"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DiffOp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Synhashed</span></span><span> </span><span class="annot"><a href="#local-6989586621680966051"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1110"></span><span>    </span><span id="local-6989586621680964233"><span class="annot"><span class="annottext">renderThings :: forall ref.
(ref -&gt; Text) -&gt; Map Name (DiffOp (Synhashed ref)) -&gt; IO ()
</span><a href="#local-6989586621680964233"><span class="hs-identifier hs-var hs-var">renderThings</span></a></span></span><span> </span><span id="local-6989586621680964215"><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964215"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621680964214"><span class="annot"><span class="annottext">Map Name (DiffOp (Synhashed ref))
</span><a href="#local-6989586621680964214"><span class="hs-identifier hs-var">things</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1111"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Name (DiffOp (Synhashed ref))
</span><a href="#local-6989586621680964214"><span class="hs-identifier hs-var">things</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964213"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964213"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964212"><span class="annot"><span class="annottext">DiffOp (Synhashed ref)
</span><a href="#local-6989586621680964212"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1112"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680964211"><span class="annot"><span class="annottext">go :: (Text -&gt; Text) -&gt; Text -&gt; Synhashed ref -&gt; Text
</span><a href="#local-6989586621680964211"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680964210"><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621680964210"><span class="hs-identifier hs-var">color</span></a></span></span><span> </span><span id="local-6989586621680964209"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964209"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621680964208"><span class="annot"><span class="annottext">Synhashed ref
</span><a href="#local-6989586621680964208"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1113"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621680964210"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1114"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964209"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-1115"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1116"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964215"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Synhashed a -&gt; a
</span><span class="hs-identifier hs-var">Synhashed.value</span></span><span> </span><span class="annot"><span class="annottext">Synhashed ref
</span><a href="#local-6989586621680964208"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1118"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964213"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1119"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; #&quot;</span></span><span>
</span><span id="line-1120"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Text
</span><span class="hs-identifier hs-var">Hash.toBase32HexText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Synhashed a -&gt; Hash
</span><span class="hs-identifier hs-var">Synhashed.hash</span></span><span> </span><span class="annot"><span class="annottext">Synhashed ref
</span><a href="#local-6989586621680964208"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1121"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DiffOp (Synhashed ref)
</span><a href="#local-6989586621680964212"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1122"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">DiffOp'Add</span></span><span> </span><span id="local-6989586621680964204"><span class="annot"><span class="annottext">Synhashed ref
</span><a href="#local-6989586621680964204"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Synhashed ref -&gt; Text
</span><a href="#local-6989586621680964211"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.green</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="annot"><span class="annottext">Synhashed ref
</span><a href="#local-6989586621680964204"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1123"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">DiffOp'Delete</span></span><span> </span><span id="local-6989586621680964202"><span class="annot"><span class="annottext">Synhashed ref
</span><a href="#local-6989586621680964202"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Synhashed ref -&gt; Text
</span><a href="#local-6989586621680964211"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.red</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Synhashed ref
</span><a href="#local-6989586621680964202"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1124"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">DiffOp'Update</span></span><span> </span><span id="local-6989586621680964200"><span class="annot"><span class="annottext">Updated (Synhashed ref)
</span><a href="#local-6989586621680964200"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Synhashed ref -&gt; Text
</span><a href="#local-6989586621680964211"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.yellow</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;%&quot;</span></span><span> </span><span class="annot"><span class="annottext">Updated (Synhashed ref)
</span><a href="#local-6989586621680964200"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">new</span><span>
</span><span id="line-1125"></span><span>
</span><span id="line-1126"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugCombinedDiff"><span class="hs-identifier hs-type">realDebugCombinedDiff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CombinedDiffOp</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1127"></span><span id="realDebugCombinedDiff"><span class="annot"><span class="annottext">realDebugCombinedDiff :: DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugCombinedDiff"><span class="hs-identifier hs-var hs-var">realDebugCombinedDiff</span></a></span></span><span> </span><span id="local-6989586621680964198"><span class="annot"><span class="annottext">DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
</span><a href="#local-6989586621680964198"><span class="hs-identifier hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1128"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Combined diff ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(ref -&gt; Text)
-&gt; (ref -&gt; Text) -&gt; Map Name (CombinedDiffOp ref) -&gt; IO ()
</span><a href="#local-6989586621680964197"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
</span><a href="#local-6989586621680964198"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span>
</span><span id="line-1130"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(ref -&gt; Text)
-&gt; (ref -&gt; Text) -&gt; Map Name (CombinedDiffOp ref) -&gt; IO ()
</span><a href="#local-6989586621680964197"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF2 (Map Name) CombinedDiffOp Referent TypeReference
</span><a href="#local-6989586621680964198"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-1131"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1132"></span><span>    </span><span id="local-6989586621680966045"><span class="annot"><a href="#local-6989586621680964197"><span class="hs-identifier hs-type">renderThings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680966045"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680966045"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CombinedDiffOp</span></span><span> </span><span class="annot"><a href="#local-6989586621680966045"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1133"></span><span>    </span><span id="local-6989586621680964197"><span class="annot"><span class="annottext">renderThings :: forall ref.
(ref -&gt; Text)
-&gt; (ref -&gt; Text) -&gt; Map Name (CombinedDiffOp ref) -&gt; IO ()
</span><a href="#local-6989586621680964197"><span class="hs-identifier hs-var hs-var">renderThings</span></a></span></span><span> </span><span id="local-6989586621680964133"><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964133"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621680964132"><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964132"><span class="hs-identifier hs-var">renderRef</span></a></span></span><span> </span><span id="local-6989586621680964131"><span class="annot"><span class="annottext">Map Name (CombinedDiffOp ref)
</span><a href="#local-6989586621680964131"><span class="hs-identifier hs-var">things</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1134"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Name (CombinedDiffOp ref)
</span><a href="#local-6989586621680964131"><span class="hs-identifier hs-var">things</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964130"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964130"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964129"><span class="annot"><span class="annottext">CombinedDiffOp ref
</span><a href="#local-6989586621680964129"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1135"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CombinedDiffOp ref
</span><a href="#local-6989586621680964129"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1136"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">CombinedDiffOp'Add</span></span><span> </span><span id="local-6989586621680964127"><span class="annot"><span class="annottext">EitherWayI ref
</span><a href="#local-6989586621680964127"><span class="hs-identifier hs-var">who</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1137"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.green</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1138"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+ &quot;</span></span><span>
</span><span id="line-1139"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964133"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. EitherWayI a -&gt; a
</span><span class="hs-identifier hs-var">EitherWayI.value</span></span><span> </span><span class="annot"><span class="annottext">EitherWayI ref
</span><a href="#local-6989586621680964127"><span class="hs-identifier hs-var">who</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1140"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1141"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964130"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1142"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1143"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964132"><span class="hs-identifier hs-var">renderRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. EitherWayI a -&gt; a
</span><span class="hs-identifier hs-var">EitherWayI.value</span></span><span> </span><span class="annot"><span class="annottext">EitherWayI ref
</span><a href="#local-6989586621680964127"><span class="hs-identifier hs-var">who</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1144"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; (&quot;</span></span><span>
</span><span id="line-1145"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v. EitherWayI v -&gt; Text
</span><a href="#local-6989586621680964125"><span class="hs-identifier hs-var">renderWho</span></a></span><span> </span><span class="annot"><span class="annottext">EitherWayI ref
</span><a href="#local-6989586621680964127"><span class="hs-identifier hs-var">who</span></a></span><span>
</span><span id="line-1146"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-1147"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">CombinedDiffOp'Delete</span></span><span> </span><span id="local-6989586621680964123"><span class="annot"><span class="annottext">EitherWayI ref
</span><a href="#local-6989586621680964123"><span class="hs-identifier hs-var">who</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1148"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.red</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1149"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;- &quot;</span></span><span>
</span><span id="line-1150"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964133"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. EitherWayI a -&gt; a
</span><span class="hs-identifier hs-var">EitherWayI.value</span></span><span> </span><span class="annot"><span class="annottext">EitherWayI ref
</span><a href="#local-6989586621680964123"><span class="hs-identifier hs-var">who</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1152"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964130"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1153"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1154"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964132"><span class="hs-identifier hs-var">renderRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. EitherWayI a -&gt; a
</span><span class="hs-identifier hs-var">EitherWayI.value</span></span><span> </span><span class="annot"><span class="annottext">EitherWayI ref
</span><a href="#local-6989586621680964123"><span class="hs-identifier hs-var">who</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1155"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; (&quot;</span></span><span>
</span><span id="line-1156"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v. EitherWayI v -&gt; Text
</span><a href="#local-6989586621680964125"><span class="hs-identifier hs-var">renderWho</span></a></span><span> </span><span class="annot"><span class="annottext">EitherWayI ref
</span><a href="#local-6989586621680964123"><span class="hs-identifier hs-var">who</span></a></span><span>
</span><span id="line-1157"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-1158"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">CombinedDiffOp'Update</span></span><span> </span><span id="local-6989586621680964121"><span class="annot"><span class="annottext">EitherWayI (Updated ref)
</span><a href="#local-6989586621680964121"><span class="hs-identifier hs-var">who</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1159"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.yellow</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1160"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;% &quot;</span></span><span>
</span><span id="line-1161"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964133"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. EitherWayI a -&gt; a
</span><span class="hs-identifier hs-var">EitherWayI.value</span></span><span> </span><span class="annot"><span class="annottext">EitherWayI (Updated ref)
</span><a href="#local-6989586621680964121"><span class="hs-identifier hs-var">who</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span class="hs-identifier">new</span><span class="hs-special">)</span><span>
</span><span id="line-1162"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1163"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964130"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1164"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1165"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964132"><span class="hs-identifier hs-var">renderRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. EitherWayI a -&gt; a
</span><span class="hs-identifier hs-var">EitherWayI.value</span></span><span> </span><span class="annot"><span class="annottext">EitherWayI (Updated ref)
</span><a href="#local-6989586621680964121"><span class="hs-identifier hs-var">who</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span class="hs-identifier">new</span><span>
</span><span id="line-1166"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; (&quot;</span></span><span>
</span><span id="line-1167"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall v. EitherWayI v -&gt; Text
</span><a href="#local-6989586621680964125"><span class="hs-identifier hs-var">renderWho</span></a></span><span> </span><span class="annot"><span class="annottext">EitherWayI (Updated ref)
</span><a href="#local-6989586621680964121"><span class="hs-identifier hs-var">who</span></a></span><span>
</span><span id="line-1168"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-1169"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">CombinedDiffOp'Conflict</span></span><span> </span><span id="local-6989586621680964119"><span class="annot"><span class="annottext">TwoWay ref
</span><a href="#local-6989586621680964119"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1170"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.magenta</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1171"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;! &quot;</span></span><span>
</span><span id="line-1172"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964133"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay ref
</span><a href="#local-6989586621680964119"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span>
</span><span id="line-1173"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-1174"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964133"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay ref
</span><a href="#local-6989586621680964119"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1176"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964130"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1177"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1178"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964132"><span class="hs-identifier hs-var">renderRef</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay ref
</span><a href="#local-6989586621680964119"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-1179"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-1180"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964132"><span class="hs-identifier hs-var">renderRef</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay ref
</span><a href="#local-6989586621680964119"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span>
</span><span id="line-1181"></span><span>
</span><span id="line-1182"></span><span>    </span><span id="local-6989586621680966041"><span class="annot"><a href="#local-6989586621680964125"><span class="hs-identifier hs-type">renderWho</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EitherWayI</span></span><span> </span><span class="annot"><a href="#local-6989586621680966041"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-1183"></span><span>    </span><span id="local-6989586621680964125"><span class="annot"><span class="annottext">renderWho :: forall v. EitherWayI v -&gt; Text
</span><a href="#local-6989586621680964125"><span class="hs-identifier hs-var hs-var">renderWho</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1184"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">OnlyAlice</span></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Alice&quot;</span></span><span>
</span><span id="line-1185"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">OnlyBob</span></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Bob&quot;</span></span><span>
</span><span id="line-1186"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">AliceAndBob</span></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Alice and Bob&quot;</span></span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugPartitionedDiff"><span class="hs-identifier hs-type">realDebugPartitionedDiff</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1189"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1190"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unconflicts</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1191"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span id="realDebugPartitionedDiff"><span class="annot"><span class="annottext">realDebugPartitionedDiff :: TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
-&gt; DefnsF Unconflicts Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugPartitionedDiff"><span class="hs-identifier hs-var hs-var">realDebugPartitionedDiff</span></a></span></span><span> </span><span id="local-6989586621680964111"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964111"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621680964110"><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1193"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Alice conflicts ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Map Name TermReferenceId -&gt; EitherWay () -&gt; IO ()
</span><a href="#local-6989586621680964109"><span class="hs-identifier hs-var">renderConflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;termid&quot;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964111"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWay a
</span><span class="hs-identifier hs-var">Alice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Map Name TermReferenceId -&gt; EitherWay () -&gt; IO ()
</span><a href="#local-6989586621680964109"><span class="hs-identifier hs-var">renderConflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;typeid&quot;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964111"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWay a
</span><span class="hs-identifier hs-var">Alice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1196"></span><span>
</span><span id="line-1197"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Bob conflicts ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1198"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Map Name TermReferenceId -&gt; EitherWay () -&gt; IO ()
</span><a href="#local-6989586621680964109"><span class="hs-identifier hs-var">renderConflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;termid&quot;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964111"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWay a
</span><span class="hs-identifier hs-var">Bob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1199"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Map Name TermReferenceId -&gt; EitherWay () -&gt; IO ()
</span><a href="#local-6989586621680964109"><span class="hs-identifier hs-var">renderConflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;typeid&quot;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964111"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWay a
</span><span class="hs-identifier hs-var">Bob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span>
</span><span id="line-1201"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Alice unconflicts ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1202"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.green</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-operator">.</span><span class="hs-identifier">adds</span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyAlice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1203"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.green</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-operator">.</span><span class="hs-identifier">adds</span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyAlice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1204"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.red</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-operator">.</span><span class="hs-identifier">deletes</span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyAlice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1205"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.red</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-operator">.</span><span class="hs-identifier">deletes</span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyAlice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.yellow</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;%&quot;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-operator">.</span><span class="hs-identifier">updates</span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyAlice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.yellow</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;%&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-operator">.</span><span class="hs-identifier">updates</span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyAlice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1208"></span><span>
</span><span id="line-1209"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Bob unconflicts ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1210"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.green</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-operator">.</span><span class="hs-identifier">adds</span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1211"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.green</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-operator">.</span><span class="hs-identifier">adds</span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.red</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-operator">.</span><span class="hs-identifier">deletes</span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1213"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.red</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-operator">.</span><span class="hs-identifier">deletes</span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.yellow</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;%&quot;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-operator">.</span><span class="hs-identifier">updates</span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1215"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.yellow</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;%&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-operator">.</span><span class="hs-identifier">updates</span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">OnlyBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span>
</span><span id="line-1217"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Alice-and-Bob unconflicts ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1218"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.green</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-operator">.</span><span class="hs-identifier">adds</span><span class="hs-operator">.</span><span class="hs-identifier">both</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">AliceAndBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.green</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-operator">.</span><span class="hs-identifier">adds</span><span class="hs-operator">.</span><span class="hs-identifier">both</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">AliceAndBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1220"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.red</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-operator">.</span><span class="hs-identifier">deletes</span><span class="hs-operator">.</span><span class="hs-identifier">both</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">AliceAndBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.red</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-operator">.</span><span class="hs-identifier">deletes</span><span class="hs-operator">.</span><span class="hs-identifier">both</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">AliceAndBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.yellow</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;%&quot;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-operator">.</span><span class="hs-identifier">updates</span><span class="hs-operator">.</span><span class="hs-identifier">both</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">AliceAndBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>  </span><span class="annot"><span class="annottext">forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var">renderUnconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.yellow</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;%&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TypeReference
</span><a href="#local-6989586621680964110"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-operator">.</span><span class="hs-identifier">updates</span><span class="hs-operator">.</span><span class="hs-identifier">both</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; EitherWayI a
</span><span class="hs-identifier hs-var">AliceAndBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1224"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1225"></span><span>    </span><span class="annot"><a href="#local-6989586621680964109"><span class="hs-identifier hs-type">renderConflicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EitherWay</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>    </span><span id="local-6989586621680964109"><span class="annot"><span class="annottext">renderConflicts :: Text -&gt; Map Name TermReferenceId -&gt; EitherWay () -&gt; IO ()
</span><a href="#local-6989586621680964109"><span class="hs-identifier hs-var hs-var">renderConflicts</span></a></span></span><span> </span><span id="local-6989586621680964105"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964105"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621680964104"><span class="annot"><span class="annottext">Map Name TermReferenceId
</span><a href="#local-6989586621680964104"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621680964103"><span class="annot"><span class="annottext">EitherWay ()
</span><a href="#local-6989586621680964103"><span class="hs-identifier hs-var">who</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1227"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Name TermReferenceId
</span><a href="#local-6989586621680964104"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964102"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964102"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964101"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964101"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1228"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1229"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.magenta</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1230"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;! &quot;</span></span><span>
</span><span id="line-1231"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964105"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-1232"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1233"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964102"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1234"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1235"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId -&gt; Text
</span><span class="hs-identifier hs-var">Reference.idToText</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964101"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1236"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; (&quot;</span></span><span>
</span><span id="line-1237"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EitherWay ()
</span><a href="#local-6989586621680964103"><span class="hs-identifier hs-var">who</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Alice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Alice&quot;</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Bob&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1238"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>    </span><span id="local-6989586621680966037"><span class="annot"><a href="#local-6989586621680964106"><span class="hs-identifier hs-type">renderUnconflicts</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1241"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1242"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1243"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680966037"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1244"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680966037"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1245"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680966037"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1246"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">EitherWayI</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1247"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1248"></span><span>    </span><span id="local-6989586621680964106"><span class="annot"><span class="annottext">renderUnconflicts :: forall ref.
(Text -&gt; Text)
-&gt; Text
-&gt; (ref -&gt; Text)
-&gt; (ref -&gt; Text)
-&gt; Map Name ref
-&gt; EitherWayI ()
-&gt; IO ()
</span><a href="#local-6989586621680964106"><span class="hs-identifier hs-var hs-var">renderUnconflicts</span></a></span></span><span> </span><span id="local-6989586621680964080"><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621680964080"><span class="hs-identifier hs-var">color</span></a></span></span><span> </span><span id="local-6989586621680964079"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964079"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621680964078"><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964078"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621680964077"><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964077"><span class="hs-identifier hs-var">renderRef</span></a></span></span><span> </span><span id="local-6989586621680964076"><span class="annot"><span class="annottext">Map Name ref
</span><a href="#local-6989586621680964076"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621680964075"><span class="annot"><span class="annottext">EitherWayI ()
</span><a href="#local-6989586621680964075"><span class="hs-identifier hs-var">who</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1249"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Name ref
</span><a href="#local-6989586621680964076"><span class="hs-identifier hs-var">unconflicts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964074"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964074"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964073"><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621680964073"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1250"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1251"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621680964080"><span class="hs-identifier hs-var">color</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1252"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964079"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-1253"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1254"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964078"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621680964073"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1256"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964074"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1257"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1258"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964077"><span class="hs-identifier hs-var">renderRef</span></a></span><span> </span><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621680964073"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1259"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; (&quot;</span></span><span>
</span><span id="line-1260"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EitherWayI ()
</span><a href="#local-6989586621680964075"><span class="hs-identifier hs-var">who</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnlyAlice</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Alice&quot;</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnlyBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Bob&quot;</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AliceAndBob</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Alice and Bob&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1261"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-1262"></span><span>
</span><span id="line-1263"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugDependents"><span class="hs-identifier hs-type">realDebugDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TwoWay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1264"></span><span id="realDebugDependents"><span class="annot"><span class="annottext">realDebugDependents :: TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId) -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugDependents"><span class="hs-identifier hs-var hs-var">realDebugDependents</span></a></span></span><span> </span><span id="local-6989586621680964072"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964072"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1265"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Alice dependents of Bob deletes, Bob updates, and Alice conflicts ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Map Name TermReferenceId -&gt; IO ()
</span><a href="#local-6989586621680964071"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;termid&quot;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964072"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span>
</span><span id="line-1267"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Map Name TermReferenceId -&gt; IO ()
</span><a href="#local-6989586621680964071"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;typeid&quot;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964072"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-1268"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Bob dependents of Alice deletes, Alice updates, and Bob conflicts ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1269"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Map Name TermReferenceId -&gt; IO ()
</span><a href="#local-6989586621680964071"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;termid&quot;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964072"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span>
</span><span id="line-1270"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Map Name TermReferenceId -&gt; IO ()
</span><a href="#local-6989586621680964071"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;typeid&quot;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReferenceId TermReferenceId)
</span><a href="#local-6989586621680964072"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-1271"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1272"></span><span>    </span><span class="annot"><a href="#local-6989586621680964071"><span class="hs-identifier hs-type">renderThings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1273"></span><span>    </span><span id="local-6989586621680964071"><span class="annot"><span class="annottext">renderThings :: Text -&gt; Map Name TermReferenceId -&gt; IO ()
</span><a href="#local-6989586621680964071"><span class="hs-identifier hs-var hs-var">renderThings</span></a></span></span><span> </span><span id="local-6989586621680964070"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964070"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621680964069"><span class="annot"><span class="annottext">Map Name TermReferenceId
</span><a href="#local-6989586621680964069"><span class="hs-identifier hs-var">things</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1274"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Name TermReferenceId
</span><a href="#local-6989586621680964069"><span class="hs-identifier hs-var">things</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964068"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964068"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964067"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964067"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1275"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1276"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680964070"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-1277"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1278"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964068"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1279"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1280"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId -&gt; Text
</span><span class="hs-identifier hs-var">Reference.idToText</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621680964067"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1281"></span><span>
</span><span id="line-1282"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugStageOne"><span class="hs-identifier hs-type">realDebugStageOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1283"></span><span id="realDebugStageOne"><span class="annot"><span class="annottext">realDebugStageOne :: DefnsF (Map Name) Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#realDebugStageOne"><span class="hs-identifier hs-var hs-var">realDebugStageOne</span></a></span></span><span> </span><span id="local-6989586621680964066"><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964066"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1284"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.bold</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n=== Stage 1 ===&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>  </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#debugDefns1"><span class="hs-identifier hs-var">debugDefns1</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964066"><span class="hs-identifier hs-var">defns</span></a></span><span>
</span><span id="line-1286"></span><span>
</span><span id="line-1287"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#debugConstructorNames"><span class="hs-identifier hs-type">debugConstructorNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1288"></span><span id="debugConstructorNames"><span class="annot"><span class="annottext">debugConstructorNames :: Map Name [Name] -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#debugConstructorNames"><span class="hs-identifier hs-var hs-var">debugConstructorNames</span></a></span></span><span> </span><span id="local-6989586621680964065"><span class="annot"><span class="annottext">Map Name [Name]
</span><a href="#local-6989586621680964065"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1289"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Name [Name]
</span><a href="#local-6989586621680964065"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964064"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964064"><span class="hs-identifier hs-var">typeName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964063"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680964063"><span class="hs-identifier hs-var">conNames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1290"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964064"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; =&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621680964063"><span class="hs-identifier hs-var">conNames</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1291"></span><span>
</span><span id="line-1292"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#debugDefns1"><span class="hs-identifier hs-type">debugDefns1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span><span id="debugDefns1"><span class="annot"><span class="annottext">debugDefns1 :: DefnsF (Map Name) Referent TypeReference -&gt; IO ()
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#debugDefns1"><span class="hs-identifier hs-var hs-var">debugDefns1</span></a></span></span><span> </span><span id="local-6989586621680964061"><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964061"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1294"></span><span>  </span><span class="annot"><span class="annottext">forall ref. (ref -&gt; Text) -&gt; (ref -&gt; Text) -&gt; Map Name ref -&gt; IO ()
</span><a href="#local-6989586621680964060"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var">referentLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964061"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span>
</span><span id="line-1295"></span><span>  </span><span class="annot"><span class="annottext">forall ref. (ref -&gt; Text) -&gt; (ref -&gt; Text) -&gt; Map Name ref -&gt; IO ()
</span><a href="#local-6989586621680964060"><span class="hs-identifier hs-var">renderThings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeReference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) Referent TypeReference
</span><a href="#local-6989586621680964061"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-1296"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1297"></span><span>    </span><span id="local-6989586621680966034"><span class="annot"><a href="#local-6989586621680964060"><span class="hs-identifier hs-type">renderThings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680966034"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680966034"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621680966034"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1298"></span><span>    </span><span id="local-6989586621680964060"><span class="annot"><span class="annottext">renderThings :: forall ref. (ref -&gt; Text) -&gt; (ref -&gt; Text) -&gt; Map Name ref -&gt; IO ()
</span><a href="#local-6989586621680964060"><span class="hs-identifier hs-var hs-var">renderThings</span></a></span></span><span> </span><span id="local-6989586621680964051"><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964051"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621680964050"><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964050"><span class="hs-identifier hs-var">renderRef</span></a></span></span><span> </span><span id="local-6989586621680964049"><span class="annot"><span class="annottext">Map Name ref
</span><a href="#local-6989586621680964049"><span class="hs-identifier hs-var">things</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1299"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Name ref
</span><a href="#local-6989586621680964049"><span class="hs-identifier hs-var">things</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680964048"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964048"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680964047"><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621680964047"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1300"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.italic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964051"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621680964047"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680964048"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ref -&gt; Text
</span><a href="#local-6989586621680964050"><span class="hs-identifier hs-var">renderRef</span></a></span><span> </span><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621680964047"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1301"></span><span>
</span><span id="line-1302"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-type">referentLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-1303"></span><span id="referentLabel"><span class="annot"><span class="annottext">referentLabel :: Referent -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.Merge2.html#referentLabel"><span class="hs-identifier hs-var hs-var">referentLabel</span></a></span></span><span> </span><span id="local-6989586621680964046"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680964046"><span class="hs-identifier hs-var">ref</span></a></span></span><span>
</span><span id="line-1304"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall r. Referent' r -&gt; Bool
</span><span class="hs-identifier hs-var">Referent'.isConstructor</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621680964046"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;constructor&quot;</span></span><span>
</span><span id="line-1305"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;term&quot;</span></span><span>
</span><span id="line-1306"></span></pre></body></html>