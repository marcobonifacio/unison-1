<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ApplicativeDo #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-partial-type-signatures #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Main</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Main.html#main"><span class="hs-identifier">main</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="ArgParse.html"><span class="hs-identifier">ArgParse</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier">CodebasePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="ArgParse.html#Command"><span class="hs-identifier">Command</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#Init"><span class="hs-identifier">Init</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#Launch"><span class="hs-identifier">Launch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#PrintVersion"><span class="hs-identifier">PrintVersion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier">Run</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#Transcript"><span class="hs-identifier">Transcript</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="ArgParse.html#GlobalOptions"><span class="hs-identifier">GlobalOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="ArgParse.html#IsHeadless"><span class="hs-identifier">IsHeadless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#Headless"><span class="hs-identifier">Headless</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#WithCLI"><span class="hs-identifier">WithCLI</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="ArgParse.html#RunSource"><span class="hs-identifier">RunSource</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="ArgParse.html#ShouldExit"><span class="hs-identifier">ShouldExit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#DoNotExit"><span class="hs-identifier">DoNotExit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ArgParse.html#Exit"><span class="hs-identifier">Exit</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="ArgParse.html#ShouldForkCodebase"><span class="hs-identifier">ShouldForkCodebase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="ArgParse.html#ShouldSaveCodebase"><span class="hs-identifier">ShouldSaveCodebase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="ArgParse.html#UsageRenderer"><span class="hs-identifier">UsageRenderer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="ArgParse.html#parseCLIArgs"><span class="hs-identifier">parseCLIArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Compat.html"><span class="hs-identifier">Compat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Compat.html#defaultInterruptHandler"><span class="hs-identifier">defaultInterruptHandler</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Compat.html#withInterruptHandler"><span class="hs-identifier">withInterruptHandler</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newEmptyMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runInUnboundThread</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeMVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">displayException</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evaluate</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Configurator.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Config</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either.Validation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Validation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Conc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">setUncaughtExceptionHandler</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Conc</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ki</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client.TLS</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Stats.html"><span class="hs-identifier">Stats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Stats.html#recordRtsStats"><span class="hs-identifier">recordRtsStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">canonicalizePath</span></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-identifier">exeExtension</span></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-identifier">getCurrentDirectory</span></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="hs-identifier">removeDirectoryRecursive</span></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getExecutablePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getProgName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withArgs</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Exit</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">replaceExtension</span></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-identifier">takeDirectory</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="hs-identifier">takeExtension</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-operator">(&lt;.&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">stderr</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.CodePage</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">withCP65001</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catchIOError</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Temp</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Temp</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Path.html"><span class="hs-identifier">System.Path</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.HashTags</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CausalHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Queries</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Queries</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CodebasePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html"><span class="hs-identifier">Unison.Codebase.Editor.Input</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Input</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Execute</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">execute</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Init</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CodebaseInitOptions</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">InitError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">InitResult</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SpecifiedCodebase</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Init</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CodebaseInit</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Init.OpenCodebaseError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OpenCodebaseError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SqliteCodebase</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SC</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.TranscriptParser.html"><span class="hs-identifier">Unison.Codebase.TranscriptParser</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TR</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Verbosity</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Verbosity</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.html"><span class="hs-identifier">Unison.CommandLine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.CommandLine.html#plural%27"><span class="hs-identifier">plural'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.CommandLine.html#watchConfig"><span class="hs-identifier">watchConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.Main.html"><span class="hs-identifier">Unison.CommandLine.Main</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CommandLine</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.Types.html"><span class="hs-identifier">Unison.CommandLine.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CommandLine</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.Welcome.html"><span class="hs-identifier">Unison.CommandLine.Welcome</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.CommandLine.Welcome.html#CodebaseInitStatus"><span class="hs-identifier">CodebaseInitStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.CommandLine.Welcome.html"><span class="hs-identifier">Unison.CommandLine.Welcome</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Welcome</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.LSP.html"><span class="hs-identifier">Unison.LSP</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LSP</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyTerminal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PT</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Runtime.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">RuntimeExn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Runtime.Interface</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RTI</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.Backend</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Backend</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.CodebaseServer</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Server</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Version.html"><span class="hs-identifier">Unison.Version</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier">Version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Version.html"><span class="hs-identifier">Unison.Version</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Version</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getHomeDirectory</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">type</span><span> </span><span id="Runtimes"><span class="annot"><a href="Unison.Main.html#Runtimes"><span class="hs-identifier hs-var">Runtimes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RTI.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RTI.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RTI.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="Unison.Main.html#fixNativeRuntimePath"><span class="hs-identifier hs-type">fixNativeRuntimePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-101"></span><span id="fixNativeRuntimePath"><span class="annot"><span class="annottext">fixNativeRuntimePath :: Maybe FilePath -&gt; IO FilePath
</span><a href="Unison.Main.html#fixNativeRuntimePath"><span class="hs-identifier hs-var hs-var">fixNativeRuntimePath</span></a></span></span><span> </span><span id="local-6989586621680982335"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621680982335"><span class="hs-identifier hs-var">override</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621680982334"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982334"><span class="hs-identifier hs-var">ucm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><span class="hs-identifier hs-var">getExecutablePath</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982333"><span class="annot"><span class="annottext">ucr :: FilePath
</span><a href="#local-6989586621680982333"><span class="hs-identifier hs-var hs-var">ucr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982334"><span class="hs-identifier hs-var">ucm</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;runtime&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;unison-runtime&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;.&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier hs-var">exeExtension</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982333"><span class="hs-identifier hs-var">ucr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621680982335"><span class="hs-identifier hs-var">override</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Unison.Main.html#main"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span id="main"><span class="annot"><span class="annottext">main :: Version -&gt; IO ()
</span><a href="Unison.Main.html#main"><span class="hs-identifier hs-var hs-var">main</span></a></span></span><span> </span><span id="local-6989586621680982330"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-comment">-- Replace the default exception handler with one complains loudly, because we shouldn't have any uncaught exceptions.</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-comment">-- Sometimes `show` and `displayException` are different strings; in this case, we want to show them both, so this</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">-- issue is easier to debug.</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="annottext">(SomeException -&gt; IO ()) -&gt; IO ()
</span><span class="hs-identifier hs-var">setUncaughtExceptionHandler</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680982329"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680982329"><span class="hs-identifier hs-var">exception</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982328"><span class="annot"><span class="annottext">shown :: Text
</span><a href="#local-6989586621680982328"><span class="hs-identifier hs-var hs-var">shown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680982329"><span class="hs-identifier hs-var">exception</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982326"><span class="annot"><span class="annottext">displayed :: Text
</span><a href="#local-6989586621680982326"><span class="hs-identifier hs-var hs-var">displayed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e. Exception e =&gt; e -&gt; FilePath
</span><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680982329"><span class="hs-identifier hs-var">exception</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982322"><span class="annot"><span class="annottext">indented :: Text -&gt; Text
</span><a href="#local-6989586621680982322"><span class="hs-identifier hs-var hs-var">indented</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.unlines</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;  &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text]
</span><span class="hs-identifier hs-var">Text.lines</span></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">Handle -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.unlines</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Uh oh, an unexpected exception brought the process down! That should never happen. Please file a bug report.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Here's a stringy rendering of the exception:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621680982322"><span class="hs-identifier hs-var">indented</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982328"><span class="hs-identifier hs-var">shown</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982328"><span class="hs-identifier hs-var">shown</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982326"><span class="hs-identifier hs-var">displayed</span></a></span><span>
</span><span id="line-124"></span><span>          </span><span class="hs-keyword">then</span><span>
</span><span id="line-125"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;And here's a different one, in case it's easier to understand:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621680982322"><span class="hs-identifier hs-var">indented</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982326"><span class="hs-identifier hs-var">displayed</span></a></span><span>
</span><span id="line-128"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-129"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">withCP65001</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">runInUnboundThread</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. (Scope -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">Ki.scoped</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680982314"><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680982314"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621680982313"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680982313"><span class="hs-identifier hs-var">interruptHandler</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IO ())
</span><a href="Compat.html#defaultInterruptHandler"><span class="hs-identifier hs-var">defaultInterruptHandler</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">forall a. IO () -&gt; IO a -&gt; IO a
</span><a href="Compat.html#withInterruptHandler"><span class="hs-identifier hs-var">withInterruptHandler</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680982313"><span class="hs-identifier hs-var">interruptHandler</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Scope -&gt; IO a -&gt; IO (Thread a)
</span><span class="hs-identifier hs-var">Ki.fork</span></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680982314"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; IO ()
</span><a href="Unison.Main.html#initHTTPClient"><span class="hs-identifier hs-var">initHTTPClient</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>      </span><span id="local-6989586621680982309"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982309"><span class="hs-identifier hs-var">progName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><span class="hs-identifier hs-var">getProgName</span></span><span>
</span><span id="line-137"></span><span>      </span><span class="hs-comment">-- hSetBuffering stdout NoBuffering -- cool</span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680982308"><span class="annot"><span class="annottext">UsageRenderer
</span><a href="#local-6989586621680982308"><span class="hs-identifier hs-var">renderUsageInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982307"><span class="annot"><span class="annottext">GlobalOptions
</span><a href="#local-6989586621680982307"><span class="hs-identifier hs-var">globalOptions</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982306"><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621680982306"><span class="hs-identifier hs-var">command</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO (UsageRenderer, GlobalOptions, Command)
</span><a href="ArgParse.html#parseCLIArgs"><span class="hs-identifier hs-var">parseCLIArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982309"><span class="hs-identifier hs-var">progName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>      </span><span id="local-6989586621680982303"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982303"><span class="hs-identifier hs-var">nrtp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; IO FilePath
</span><a href="Unison.Main.html#fixNativeRuntimePath"><span class="hs-identifier hs-var">fixNativeRuntimePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalOptions -&gt; Maybe FilePath
</span><a href="ArgParse.html#%24sel%3AnativeRuntimePath%3AGlobalOptions"><span class="hs-identifier hs-var">nativeRuntimePath</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalOptions
</span><a href="#local-6989586621680982307"><span class="hs-identifier hs-var">globalOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="ArgParse.html#GlobalOptions"><span class="hs-identifier hs-type">GlobalOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:codebasePathOption:GlobalOptions :: GlobalOptions -&gt; Maybe CodebasePathOption
</span><a href="ArgParse.html#%24sel%3AcodebasePathOption%3AGlobalOptions"><span class="hs-identifier hs-var">codebasePathOption</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680982299"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982299"><span class="hs-identifier hs-var">mCodePathOption</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982298"><span class="annot"><span class="annottext">ShouldExit
$sel:exitOption:GlobalOptions :: GlobalOptions -&gt; ShouldExit
exitOption :: ShouldExit
</span><a href="ArgParse.html#%24sel%3AexitOption%3AGlobalOptions"><span class="hs-identifier hs-var hs-var">exitOption</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982296"><span class="annot"><span class="annottext">LspFormattingConfig
$sel:lspFormattingConfig:GlobalOptions :: GlobalOptions -&gt; LspFormattingConfig
lspFormattingConfig :: LspFormattingConfig
</span><a href="ArgParse.html#%24sel%3AlspFormattingConfig%3AGlobalOptions"><span class="hs-identifier hs-var hs-var">lspFormattingConfig</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalOptions
</span><a href="#local-6989586621680982307"><span class="hs-identifier hs-var">globalOptions</span></a></span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><span class="annottext">forall a. Maybe CodebasePathOption -&gt; (Config -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680982294"><span class="hs-identifier hs-var">withConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982299"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680982293"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680982293"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>        </span><span id="local-6989586621680982292"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">currentDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><span class="hs-identifier hs-var">getCurrentDirectory</span></span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Command
</span><a href="#local-6989586621680982306"><span class="hs-identifier hs-var">command</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-144"></span><span>          </span><span class="annot"><span class="annottext">Command
</span><a href="ArgParse.html#PrintVersion"><span class="hs-identifier hs-var">PrintVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-145"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">Text.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982309"><span class="hs-identifier hs-var">progName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; version: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-146"></span><span>          </span><span class="annot"><span class="annottext">Command
</span><a href="ArgParse.html#Init"><span class="hs-identifier hs-var">Init</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-147"></span><span>            </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span>
</span><span id="line-148"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-149"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;The Init command has been removed&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>                    </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>                    </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Use --codebase-create to create a codebase at a specified location and open it:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>                    </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.hiBlue</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;$ ucm --codebase-create myNewCodebase&quot;</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Running UCM without the --codebase-create flag: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>                    </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.hiBlue</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;$ ucm&quot;</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>                    </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;will &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.bold</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;always&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; create a codebase in your home directory if one does not already exist.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>          </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier hs-type">Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#RunFromSymbol"><span class="hs-identifier hs-type">RunFromSymbol</span></a></span><span> </span><span id="local-6989586621680982282"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680982282"><span class="hs-identifier hs-var">mainName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982281"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982281"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>            </span><span class="annot"><span class="annottext">forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982299"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982276"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982276"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
Bool -&gt; RuntimeHost -&gt; Text -&gt; (Runtime Symbol -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">RTI.withRuntime</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><span class="hs-identifier hs-var">RTI.OneOff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680982273"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982273"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-161"></span><span>                </span><span class="annot"><span class="annottext">forall a. [FilePath] -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">withArgs</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982281"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; HashQualified Name
-&gt; IO (Either (Pretty ColorText) ())
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982276"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982273"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680982282"><span class="hs-identifier hs-var">mainName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-162"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680982272"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680982272"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680982272"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-163"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>          </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier hs-type">Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#RunFromFile"><span class="hs-identifier hs-type">RunFromFile</span></a></span><span> </span><span id="local-6989586621680982270"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982270"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621680982269"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680982269"><span class="hs-identifier hs-var">mainName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982268"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982268"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-165"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="Unison.Main.html#isDotU"><span class="hs-identifier hs-var">isDotU</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982270"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Files must have a .u extension.&quot;</span></span><span>
</span><span id="line-166"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>                </span><span id="local-6989586621680982265"><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621680982265"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Either IOException Text)
</span><span class="hs-identifier hs-var">safeReadUtf8</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982270"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-168"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621680982265"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I couldn't find that file or it is for some reason unreadable.&quot;</span></span><span>
</span><span id="line-170"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680982263"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982263"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>                    </span><span class="annot"><span class="annottext">forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982299"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982262"><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680982262"><span class="hs-identifier hs-var">initRes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982261"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982261"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>                      </span><span class="annot"><span class="annottext">forall a. FilePath -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680982260"><span class="hs-identifier hs-var">withRuntimes</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982303"><span class="hs-identifier hs-var">nrtp</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><span class="hs-identifier hs-var">RTI.OneOff</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982259"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982259"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982258"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982258"><span class="hs-identifier hs-var">sbrt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982257"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982257"><span class="hs-identifier hs-var">nrt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982256"><span class="annot"><span class="annottext">fileEvent :: Event
</span><a href="#local-6989586621680982256"><span class="hs-identifier hs-var hs-var">fileEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Event
</span><a href="Unison.Codebase.Editor.Input.html#UnisonFileChanged"><span class="hs-identifier hs-var">Input.UnisonFileChanged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982270"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982263"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-174"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982252"><span class="annot"><span class="annottext">noOpRootNotifier :: p -&gt; f ()
</span><a href="#local-6989586621680982252"><span class="hs-identifier hs-var hs-var">noOpRootNotifier</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982249"><span class="annot"><span class="annottext">noOpPathNotifier :: p -&gt; f ()
</span><a href="#local-6989586621680982249"><span class="hs-identifier hs-var hs-var">noOpPathNotifier</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982248"><span class="annot"><span class="annottext">serverUrl :: Maybe a
</span><a href="#local-6989586621680982248"><span class="hs-identifier hs-var hs-var">serverUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-177"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982247"><span class="annot"><span class="annottext">startPath :: Maybe a
</span><a href="#local-6989586621680982247"><span class="hs-identifier hs-var hs-var">startPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-178"></span><span>                        </span><span class="annot"><span class="annottext">Version
-&gt; FilePath
-&gt; Config
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; [Either Event Input]
-&gt; Maybe BaseUrl
-&gt; Maybe Absolute
-&gt; InitResult
-&gt; (CausalHash -&gt; STM ())
-&gt; (Absolute -&gt; STM ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.Main.html#launch"><span class="hs-identifier hs-var">launch</span></a></span><span>
</span><span id="line-179"></span><span>                          </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-180"></span><span>                          </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">currentDir</span></a></span><span>
</span><span id="line-181"></span><span>                          </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680982293"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-182"></span><span>                          </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982259"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-183"></span><span>                          </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982258"><span class="hs-identifier hs-var">sbrt</span></a></span><span>
</span><span id="line-184"></span><span>                          </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982257"><span class="hs-identifier hs-var">nrt</span></a></span><span>
</span><span id="line-185"></span><span>                          </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982261"><span class="hs-identifier hs-var">theCodebase</span></a></span><span>
</span><span id="line-186"></span><span>                          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Event
</span><a href="#local-6989586621680982256"><span class="hs-identifier hs-var">fileEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [FilePath] -&gt; Input
</span><a href="Unison.Codebase.Editor.Input.html#ExecuteI"><span class="hs-identifier hs-var">Input.ExecuteI</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680982269"><span class="hs-identifier hs-var">mainName</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982268"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#QuitI"><span class="hs-identifier hs-var">Input.QuitI</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-187"></span><span>                          </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621680982248"><span class="hs-identifier hs-var">serverUrl</span></a></span><span>
</span><span id="line-188"></span><span>                          </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621680982247"><span class="hs-identifier hs-var">startPath</span></a></span><span>
</span><span id="line-189"></span><span>                          </span><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680982262"><span class="hs-identifier hs-var">initRes</span></a></span><span>
</span><span id="line-190"></span><span>                          </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {p}. Applicative f =&gt; p -&gt; f ()
</span><a href="#local-6989586621680982252"><span class="hs-identifier hs-var">noOpRootNotifier</span></a></span><span>
</span><span id="line-191"></span><span>                          </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {p}. Applicative f =&gt; p -&gt; f ()
</span><a href="#local-6989586621680982249"><span class="hs-identifier hs-var">noOpPathNotifier</span></a></span><span>
</span><span id="line-192"></span><span>                          </span><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="Unison.CommandLine.Types.html#ShouldNotWatchFiles"><span class="hs-identifier hs-var">CommandLine.ShouldNotWatchFiles</span></a></span><span>
</span><span id="line-193"></span><span>          </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier hs-type">Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#RunFromPipe"><span class="hs-identifier hs-type">RunFromPipe</span></a></span><span> </span><span id="local-6989586621680982241"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680982241"><span class="hs-identifier hs-var">mainName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982240"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982240"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>            </span><span id="local-6989586621680982239"><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621680982239"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either IOException Text)
</span><span class="hs-identifier hs-var">safeReadUtf8StdIn</span></span><span>
</span><span id="line-195"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException Text
</span><a href="#local-6989586621680982239"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-196"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I had trouble reading this input.&quot;</span></span><span>
</span><span id="line-197"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680982237"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982237"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>                </span><span class="annot"><span class="annottext">forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982299"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982236"><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680982236"><span class="hs-identifier hs-var">initRes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982235"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982235"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>                  </span><span class="annot"><span class="annottext">forall a. FilePath -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680982260"><span class="hs-identifier hs-var">withRuntimes</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982303"><span class="hs-identifier hs-var">nrtp</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><span class="hs-identifier hs-var">RTI.OneOff</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982234"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982234"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982233"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982233"><span class="hs-identifier hs-var">sbrt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982232"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982232"><span class="hs-identifier hs-var">nrt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982231"><span class="annot"><span class="annottext">fileEvent :: Event
</span><a href="#local-6989586621680982231"><span class="hs-identifier hs-var hs-var">fileEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Event
</span><a href="Unison.Codebase.Editor.Input.html#UnisonFileChanged"><span class="hs-identifier hs-var">Input.UnisonFileChanged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&lt;standard input&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982237"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-201"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982228"><span class="annot"><span class="annottext">noOpRootNotifier :: p -&gt; f ()
</span><a href="#local-6989586621680982228"><span class="hs-identifier hs-var hs-var">noOpRootNotifier</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982225"><span class="annot"><span class="annottext">noOpPathNotifier :: p -&gt; f ()
</span><a href="#local-6989586621680982225"><span class="hs-identifier hs-var hs-var">noOpPathNotifier</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982224"><span class="annot"><span class="annottext">serverUrl :: Maybe a
</span><a href="#local-6989586621680982224"><span class="hs-identifier hs-var hs-var">serverUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-204"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982223"><span class="annot"><span class="annottext">startPath :: Maybe a
</span><a href="#local-6989586621680982223"><span class="hs-identifier hs-var hs-var">startPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-205"></span><span>                    </span><span class="annot"><span class="annottext">Version
-&gt; FilePath
-&gt; Config
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; [Either Event Input]
-&gt; Maybe BaseUrl
-&gt; Maybe Absolute
-&gt; InitResult
-&gt; (CausalHash -&gt; STM ())
-&gt; (Absolute -&gt; STM ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.Main.html#launch"><span class="hs-identifier hs-var">launch</span></a></span><span>
</span><span id="line-206"></span><span>                      </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-207"></span><span>                      </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">currentDir</span></a></span><span>
</span><span id="line-208"></span><span>                      </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680982293"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-209"></span><span>                      </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982234"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-210"></span><span>                      </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982233"><span class="hs-identifier hs-var">sbrt</span></a></span><span>
</span><span id="line-211"></span><span>                      </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982232"><span class="hs-identifier hs-var">nrt</span></a></span><span>
</span><span id="line-212"></span><span>                      </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982235"><span class="hs-identifier hs-var">theCodebase</span></a></span><span>
</span><span id="line-213"></span><span>                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Event
</span><a href="#local-6989586621680982231"><span class="hs-identifier hs-var">fileEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [FilePath] -&gt; Input
</span><a href="Unison.Codebase.Editor.Input.html#ExecuteI"><span class="hs-identifier hs-var">Input.ExecuteI</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621680982241"><span class="hs-identifier hs-var">mainName</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982240"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#QuitI"><span class="hs-identifier hs-var">Input.QuitI</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>                      </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621680982224"><span class="hs-identifier hs-var">serverUrl</span></a></span><span>
</span><span id="line-215"></span><span>                      </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="#local-6989586621680982223"><span class="hs-identifier hs-var">startPath</span></a></span><span>
</span><span id="line-216"></span><span>                      </span><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680982236"><span class="hs-identifier hs-var">initRes</span></a></span><span>
</span><span id="line-217"></span><span>                      </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {p}. Applicative f =&gt; p -&gt; f ()
</span><a href="#local-6989586621680982228"><span class="hs-identifier hs-var">noOpRootNotifier</span></a></span><span>
</span><span id="line-218"></span><span>                      </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {p}. Applicative f =&gt; p -&gt; f ()
</span><a href="#local-6989586621680982225"><span class="hs-identifier hs-var">noOpPathNotifier</span></a></span><span>
</span><span id="line-219"></span><span>                      </span><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="Unison.CommandLine.Types.html#ShouldNotWatchFiles"><span class="hs-identifier hs-var">CommandLine.ShouldNotWatchFiles</span></a></span><span>
</span><span id="line-220"></span><span>          </span><span class="annot"><a href="ArgParse.html#Run"><span class="hs-identifier hs-type">Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#RunCompiled"><span class="hs-identifier hs-type">RunCompiled</span></a></span><span> </span><span id="local-6989586621680982221"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982221"><span class="hs-identifier hs-var">file</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982220"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982220"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>            </span><span class="annot"><span class="annottext">FilePath -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BL.readFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982221"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680982218"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680982218"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadUnliftIO m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">evaluate</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either FilePath (Text, Text, Word64, StoredCache)
</span><span class="hs-identifier hs-var">RTI.decodeStandalone</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680982218"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-223"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PE</span></span><span> </span><span id="local-6989586621680982214"><span class="annot"><span class="annottext">CallStack
</span><a href="#local-6989586621680982214"><span class="hs-identifier hs-var">_cs</span></a></span></span><span> </span><span id="local-6989586621680982213"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680982213"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-225"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-226"></span><span>                        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I was unable to parse this file as a compiled\
                        \ program. The parser generated the following error:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-228"></span><span>                      </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span>                      </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680982213"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-230"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-231"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680982211"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982211"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-233"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-234"></span><span>                        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I was unable to parse this file as a compiled\
                        \ program. The parser generated the following error:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-236"></span><span>                      </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-237"></span><span>                      </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982211"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-238"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-239"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">RuntimeExn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>                  </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-241"></span><span>                    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I was unable to parse this file as a compiled\
                    \ program. The parser generated an unrecognized error.&quot;</span></span><span>
</span><span id="line-243"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982209"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982209"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982208"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982208"><span class="hs-identifier hs-var">rf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982207"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680982207"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982206"><span class="annot"><span class="annottext">StoredCache
</span><a href="#local-6989586621680982206"><span class="hs-identifier hs-var">sto</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982205"><span class="hs-identifier hs-var">vmatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680982204"><span class="hs-identifier hs-var">mismatchMsg</span></a></span><span>
</span><span id="line-245"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-246"></span><span>                      </span><span class="annot"><span class="annottext">forall a. [FilePath] -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">withArgs</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982220"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StoredCache -&gt; Word64 -&gt; IO (Either (Pretty ColorText) ())
</span><span class="hs-identifier hs-var">RTI.runStandalone</span></span><span> </span><span class="annot"><span class="annottext">StoredCache
</span><a href="#local-6989586621680982206"><span class="hs-identifier hs-var">sto</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680982207"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-247"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680982202"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680982202"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680982202"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-248"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>                    </span><span id="local-6989586621680982205"><span class="annot"><span class="annottext">vmatch :: Bool
</span><a href="#local-6989586621680982205"><span class="hs-identifier hs-var hs-var">vmatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982209"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-251"></span><span>                    </span><span id="local-6989586621680982196"><span class="annot"><span class="annottext">ws :: Text -&gt; Pretty s
</span><a href="#local-6989586621680982196"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span> </span><span id="local-6989586621680982195"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982195"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982195"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>                    </span><span id="local-6989586621680982194"><span class="annot"><span class="annottext">ifile :: FilePath
</span><a href="#local-6989586621680982194"><span class="hs-identifier hs-var hs-var">ifile</span></a></span></span><span>
</span><span id="line-253"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'c'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'u'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680982193"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982193"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982221"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982193"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-254"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982221"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-255"></span><span>                    </span><span id="local-6989586621680982204"><span class="annot"><span class="annottext">mismatchMsg :: IO ()
</span><a href="#local-6989586621680982204"><span class="hs-identifier hs-var hs-var">mismatchMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>                      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-257"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall {s}. (ListLike s Char, IsString s) =&gt; Text -&gt; Pretty s
</span><a href="#local-6989586621680982196"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-258"></span><span>                            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;I can't run this compiled program since \
                            \it works with a different version of Unison \
                            \than the one you're running.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-261"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-262"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Compiled file version&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-263"></span><span>                          </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982209"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-264"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-265"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Your version&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-266"></span><span>                          </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-268"></span><span>                          </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-269"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;The program was compiled from hash &quot;</span></span><span>
</span><span id="line-270"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;`&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982208"><span class="hs-identifier hs-var">rf</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;`.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;If you have that hash in your codebase,&quot;</span></span><span>
</span><span id="line-272"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;you can do:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-274"></span><span>                          </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-275"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;.&gt; compile &quot;</span></span><span>
</span><span id="line-276"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982208"><span class="hs-identifier hs-var">rf</span></a></span><span>
</span><span id="line-277"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-278"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982194"><span class="hs-identifier hs-var">ifile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>                          </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span>
</span><span id="line-281"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;to produce a new compiled program \
                            \that matches your version of Unison.&quot;</span></span><span>
</span><span id="line-283"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>          </span><span class="annot"><a href="ArgParse.html#Transcript"><span class="hs-identifier hs-type">Transcript</span></a></span><span> </span><span id="local-6989586621680982190"><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680982190"><span class="hs-identifier hs-var">shouldFork</span></a></span></span><span> </span><span id="local-6989586621680982189"><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680982189"><span class="hs-identifier hs-var">shouldSaveCodebase</span></a></span></span><span> </span><span id="local-6989586621680982188"><span class="annot"><span class="annottext">Maybe RtsStatsPath
</span><a href="#local-6989586621680982188"><span class="hs-identifier hs-var">mrtsStatsFp</span></a></span></span><span> </span><span id="local-6989586621680982187"><span class="annot"><span class="annottext">NonEmpty FilePath
</span><a href="#local-6989586621680982187"><span class="hs-identifier hs-var">transcriptFiles</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982186"><span class="annot"><span class="annottext">action :: IO ()
</span><a href="#local-6989586621680982186"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version
-&gt; Verbosity
-&gt; UsageRenderer
-&gt; ShouldForkCodebase
-&gt; ShouldSaveCodebase
-&gt; Maybe CodebasePathOption
-&gt; FilePath
-&gt; NonEmpty FilePath
-&gt; IO ()
</span><a href="Unison.Main.html#runTranscripts"><span class="hs-identifier hs-var">runTranscripts</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><span class="hs-identifier hs-var">Verbosity.Verbose</span></span><span> </span><span class="annot"><span class="annottext">UsageRenderer
</span><a href="#local-6989586621680982308"><span class="hs-identifier hs-var">renderUsageInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680982190"><span class="hs-identifier hs-var">shouldFork</span></a></span><span> </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680982189"><span class="hs-identifier hs-var">shouldSaveCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982299"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982303"><span class="hs-identifier hs-var">nrtp</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty FilePath
</span><a href="#local-6989586621680982187"><span class="hs-identifier hs-var">transcriptFiles</span></a></span><span>
</span><span id="line-286"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe RtsStatsPath
</span><a href="#local-6989586621680982188"><span class="hs-identifier hs-var">mrtsStatsFp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-287"></span><span>              </span><span class="annot"><span class="annottext">Maybe RtsStatsPath
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680982186"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-288"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680982183"><span class="annot"><span class="annottext">RtsStatsPath
</span><a href="#local-6989586621680982183"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. RtsStatsPath -&gt; IO a -&gt; IO a
</span><a href="Stats.html#recordRtsStats"><span class="hs-identifier hs-var">recordRtsStats</span></a></span><span> </span><span class="annot"><span class="annottext">RtsStatsPath
</span><a href="#local-6989586621680982183"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680982186"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="annot"><a href="ArgParse.html#Launch"><span class="hs-identifier hs-type">Launch</span></a></span><span> </span><span id="local-6989586621680982182"><span class="annot"><span class="annottext">IsHeadless
</span><a href="#local-6989586621680982182"><span class="hs-identifier hs-var">isHeadless</span></a></span></span><span> </span><span id="local-6989586621680982181"><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621680982181"><span class="hs-identifier hs-var">codebaseServerOpts</span></a></span></span><span> </span><span id="local-6989586621680982180"><span class="annot"><span class="annottext">Maybe Absolute
</span><a href="#local-6989586621680982180"><span class="hs-identifier hs-var">mayStartingPath</span></a></span></span><span> </span><span id="local-6989586621680982179"><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="#local-6989586621680982179"><span class="hs-identifier hs-var">shouldWatchFiles</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>            </span><span class="annot"><span class="annottext">forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982299"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAfterPrompt</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982177"><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680982177"><span class="hs-identifier hs-var">initRes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982176"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982176"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>              </span><span class="annot"><span class="annottext">forall a. FilePath -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680982260"><span class="hs-identifier hs-var">withRuntimes</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982303"><span class="hs-identifier hs-var">nrtp</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><span class="hs-identifier hs-var">RTI.Persistent</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982174"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982174"><span class="hs-identifier hs-var">runtime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982173"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982173"><span class="hs-identifier hs-var">sbRuntime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982172"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982172"><span class="hs-identifier hs-var">nRuntime</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>                </span><span id="local-6989586621680982171"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680982171"><span class="hs-identifier hs-var">startingPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsHeadless
</span><a href="#local-6989586621680982182"><span class="hs-identifier hs-var">isHeadless</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-293"></span><span>                  </span><span class="annot"><span class="annottext">IsHeadless
</span><a href="ArgParse.html#WithCLI"><span class="hs-identifier hs-var">WithCLI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>                    </span><span class="hs-comment">-- If the user didn't provide a starting path on the command line, put them in the most recent</span><span>
</span><span id="line-295"></span><span>                    </span><span class="hs-comment">-- path they cd'd to</span><span>
</span><span id="line-296"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Absolute
</span><a href="#local-6989586621680982180"><span class="hs-identifier hs-var">mayStartingPath</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-297"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680982170"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680982170"><span class="hs-identifier hs-var">startingPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680982170"><span class="hs-identifier hs-var">startingPath</span></a></span><span>
</span><span id="line-298"></span><span>                      </span><span class="annot"><span class="annottext">Maybe Absolute
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>                        </span><span id="local-6989586621680982169"><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621680982169"><span class="hs-identifier hs-var">segments</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982176"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction [NameSegment]
</span><span class="hs-identifier hs-var">Queries.expectMostRecentNamespace</span></span><span>
</span><span id="line-300"></span><span>                        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Absolute
</span><span class="hs-identifier hs-var">Path.Absolute</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NameSegment] -&gt; Path
</span><span class="hs-identifier hs-var">Path.fromList</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621680982169"><span class="hs-identifier hs-var">segments</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>                  </span><span class="annot"><span class="annottext">IsHeadless
</span><a href="ArgParse.html#Headless"><span class="hs-identifier hs-var">Headless</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="Unison.Main.html#defaultInitialPath"><span class="hs-identifier hs-var">defaultInitialPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Absolute
</span><a href="#local-6989586621680982180"><span class="hs-identifier hs-var">mayStartingPath</span></a></span><span>
</span><span id="line-302"></span><span>                </span><span id="local-6989586621680982162"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680982162"><span class="hs-identifier hs-var">rootCausalHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982176"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transaction CausalHashId
</span><span class="hs-identifier hs-var">Queries.expectNamespaceRoot</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">CausalHashId -&gt; Transaction CausalHash
</span><span class="hs-identifier hs-var">Queries.expectCausalHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>                </span><span id="local-6989586621680982159"><span class="annot"><span class="annottext">TVar CausalHash
</span><a href="#local-6989586621680982159"><span class="hs-identifier hs-var">rootCausalHashVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680982162"><span class="hs-identifier hs-var">rootCausalHash</span></a></span><span>
</span><span id="line-304"></span><span>                </span><span id="local-6989586621680982157"><span class="annot"><span class="annottext">TVar Absolute
</span><a href="#local-6989586621680982157"><span class="hs-identifier hs-var">pathVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680982171"><span class="hs-identifier hs-var">startingPath</span></a></span><span>
</span><span id="line-305"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680982156"><span class="hs-identifier hs-type">notifyOnRootChanges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>                    </span><span id="local-6989586621680982156"><span class="annot"><span class="annottext">notifyOnRootChanges :: CausalHash -&gt; STM ()
</span><a href="#local-6989586621680982156"><span class="hs-identifier hs-var hs-var">notifyOnRootChanges</span></a></span></span><span> </span><span id="local-6989586621680982155"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680982155"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>                      </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar CausalHash
</span><a href="#local-6989586621680982159"><span class="hs-identifier hs-var">rootCausalHashVar</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621680982155"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-308"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680982153"><span class="hs-identifier hs-type">notifyOnPathChanges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>                    </span><span id="local-6989586621680982153"><span class="annot"><span class="annottext">notifyOnPathChanges :: Absolute -&gt; STM ()
</span><a href="#local-6989586621680982153"><span class="hs-identifier hs-var hs-var">notifyOnPathChanges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Absolute
</span><a href="#local-6989586621680982157"><span class="hs-identifier hs-var">pathVar</span></a></span><span>
</span><span id="line-310"></span><span>                </span><span class="hs-comment">-- Unfortunately, the windows IO manager on GHC 8.* is prone to just hanging forever</span><span>
</span><span id="line-311"></span><span>                </span><span class="hs-comment">-- when waiting for input on handles, so if we listen for LSP connections it will</span><span>
</span><span id="line-312"></span><span>                </span><span class="hs-comment">-- prevent UCM from shutting down properly. Hopefully we can re-enable LSP on</span><span>
</span><span id="line-313"></span><span>                </span><span class="hs-comment">-- Windows when we move to GHC 9.*</span><span>
</span><span id="line-314"></span><span>                </span><span class="hs-comment">-- https://gitlab.haskell.org/ghc/ghc/-/merge_requests/1224</span><span>
</span><span id="line-315"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Scope -&gt; IO a -&gt; IO (Thread a)
</span><span class="hs-identifier hs-var">Ki.fork</span></span><span> </span><span class="annot"><span class="annottext">Scope
</span><a href="#local-6989586621680982314"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LspFormattingConfig
-&gt; Codebase IO Symbol Ann
-&gt; Runtime Symbol
-&gt; STM CausalHash
-&gt; STM Absolute
-&gt; IO ()
</span><a href="Unison.LSP.html#spawnLsp"><span class="hs-identifier hs-var">LSP.spawnLsp</span></a></span><span> </span><span class="annot"><span class="annottext">LspFormattingConfig
</span><a href="#local-6989586621680982296"><span class="hs-identifier hs-var">lspFormattingConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982176"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982174"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar CausalHash
</span><a href="#local-6989586621680982159"><span class="hs-identifier hs-var">rootCausalHashVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Absolute
</span><a href="#local-6989586621680982157"><span class="hs-identifier hs-var">pathVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>                </span><span class="annot"><span class="annottext">forall a.
BackendEnv
-&gt; CodebaseServerOpts
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; (BaseUrl -&gt; IO a)
-&gt; IO a
</span><span class="hs-identifier hs-var">Server.startServer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Backend.BackendEnv</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:useNamesIndex:BackendEnv :: Bool
</span><span class="hs-identifier hs-var">Backend.useNamesIndex</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621680982181"><span class="hs-identifier hs-var">codebaseServerOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982173"><span class="hs-identifier hs-var">sbRuntime</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982176"><span class="hs-identifier hs-var">theCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680982147"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680982147"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShouldExit
</span><a href="#local-6989586621680982298"><span class="hs-identifier hs-var">exitOption</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-318"></span><span>                    </span><span class="annot"><span class="annottext">ShouldExit
</span><a href="ArgParse.html#DoNotExit"><span class="hs-identifier hs-var">DoNotExit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsHeadless
</span><a href="#local-6989586621680982182"><span class="hs-identifier hs-var">isHeadless</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-320"></span><span>                        </span><span class="annot"><span class="annottext">IsHeadless
</span><a href="ArgParse.html#Headless"><span class="hs-identifier hs-var">Headless</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-321"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-322"></span><span>                            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-323"></span><span>                              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I've started the Codebase API server at&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>                                </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Service -&gt; BaseUrl -&gt; Text
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="annot"><span class="annottext">Service
</span><span class="hs-identifier hs-var">Server.Api</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680982147"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-325"></span><span>                                </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;and the Codebase UI at&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-326"></span><span>                                </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Service -&gt; BaseUrl -&gt; Text
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Maybe DefinitionReference -&gt; Service
</span><span class="hs-identifier hs-var">Server.LooseCodeUI</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680982147"><span class="hs-identifier hs-var">baseUrl</span></a></span><span>
</span><span id="line-327"></span><span>                              </span><span class="hs-special">]</span><span>
</span><span id="line-328"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-329"></span><span>                            </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Running the codebase manager headless with &quot;</span></span><span>
</span><span id="line-330"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a s. (Show a, IsString s) =&gt; a -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.shown</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier hs-var">GHC.Conc.numCapabilities</span></span><span>
</span><span id="line-331"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-332"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Integral a =&gt; a -&gt; b -&gt; b -&gt; b
</span><a href="Unison.CommandLine.html#plural%27"><span class="hs-identifier hs-var">plural'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier hs-var">GHC.Conc.numCapabilities</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;cpu&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;cpus&quot;</span></span><span>
</span><span id="line-333"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-334"></span><span>                          </span><span id="local-6989586621680982140"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680982140"><span class="hs-identifier hs-var">mvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-335"></span><span>                          </span><span class="annot"><span class="annottext">forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680982140"><span class="hs-identifier hs-var">mvar</span></a></span><span>
</span><span id="line-336"></span><span>                        </span><span class="annot"><span class="annottext">IsHeadless
</span><a href="ArgParse.html#WithCLI"><span class="hs-identifier hs-var">WithCLI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>                          </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Now starting the Unison Codebase Manager (UCM)...&quot;</span></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>                          </span><span class="annot"><span class="annottext">Version
-&gt; FilePath
-&gt; Config
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; [Either Event Input]
-&gt; Maybe BaseUrl
-&gt; Maybe Absolute
-&gt; InitResult
-&gt; (CausalHash -&gt; STM ())
-&gt; (Absolute -&gt; STM ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.Main.html#launch"><span class="hs-identifier hs-var">launch</span></a></span><span>
</span><span id="line-340"></span><span>                            </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-341"></span><span>                            </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">currentDir</span></a></span><span>
</span><span id="line-342"></span><span>                            </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680982293"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-343"></span><span>                            </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982174"><span class="hs-identifier hs-var">runtime</span></a></span><span>
</span><span id="line-344"></span><span>                            </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982173"><span class="hs-identifier hs-var">sbRuntime</span></a></span><span>
</span><span id="line-345"></span><span>                            </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982172"><span class="hs-identifier hs-var">nRuntime</span></a></span><span>
</span><span id="line-346"></span><span>                            </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982176"><span class="hs-identifier hs-var">theCodebase</span></a></span><span>
</span><span id="line-347"></span><span>                            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-348"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621680982147"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621680982171"><span class="hs-identifier hs-var">startingPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>                            </span><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680982177"><span class="hs-identifier hs-var">initRes</span></a></span><span>
</span><span id="line-351"></span><span>                            </span><span class="annot"><span class="annottext">CausalHash -&gt; STM ()
</span><a href="#local-6989586621680982156"><span class="hs-identifier hs-var">notifyOnRootChanges</span></a></span><span>
</span><span id="line-352"></span><span>                            </span><span class="annot"><span class="annottext">Absolute -&gt; STM ()
</span><a href="#local-6989586621680982153"><span class="hs-identifier hs-var">notifyOnPathChanges</span></a></span><span>
</span><span id="line-353"></span><span>                            </span><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="#local-6989586621680982179"><span class="hs-identifier hs-var">shouldWatchFiles</span></a></span><span>
</span><span id="line-354"></span><span>                    </span><span class="annot"><span class="annottext">ShouldExit
</span><a href="ArgParse.html#Exit"><span class="hs-identifier hs-var">Exit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">forall a. IO a
</span><span class="hs-identifier hs-var">Exit.exitSuccess</span></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-comment">-- (runtime, sandboxed runtime)</span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621680982904"><span class="annot"><a href="#local-6989586621680982260"><span class="hs-identifier hs-type">withRuntimes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RTI.RuntimeHost</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Main.html#Runtimes"><span class="hs-identifier hs-type">Runtimes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680982904"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680982904"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621680982260"><span class="annot"><span class="annottext">withRuntimes :: forall a. FilePath -&gt; RuntimeHost -&gt; (Runtimes -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680982260"><span class="hs-identifier hs-var hs-var">withRuntimes</span></a></span></span><span> </span><span id="local-6989586621680982135"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982135"><span class="hs-identifier hs-var">nrtp</span></a></span></span><span> </span><span id="local-6989586621680982134"><span class="annot"><span class="annottext">RuntimeHost
</span><a href="#local-6989586621680982134"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621680982133"><span class="annot"><span class="annottext">Runtimes -&gt; IO a
</span><a href="#local-6989586621680982133"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-359"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
Bool -&gt; RuntimeHost -&gt; Text -&gt; (Runtime Symbol -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">RTI.withRuntime</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><a href="#local-6989586621680982134"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680982132"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982132"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
Bool -&gt; RuntimeHost -&gt; Text -&gt; (Runtime Symbol -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">RTI.withRuntime</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">RuntimeHost
</span><a href="#local-6989586621680982134"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680982131"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982131"><span class="hs-identifier hs-var">sbRuntime</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-361"></span><span>          </span><span class="annot"><span class="annottext">Runtimes -&gt; IO a
</span><a href="#local-6989586621680982133"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982132"><span class="hs-identifier hs-var">runtime</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982131"><span class="hs-identifier hs-var">sbRuntime</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>            </span><span class="hs-comment">-- startNativeRuntime saves the path to `unison-runtime`</span><span>
</span><span id="line-363"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath -&gt; IO (Runtime Symbol)
</span><span class="hs-identifier hs-var">RTI.startNativeRuntime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982135"><span class="hs-identifier hs-var">nrtp</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621680982932"><span class="annot"><a href="#local-6989586621680982294"><span class="hs-identifier hs-type">withConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Config</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680982932"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680982932"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621680982294"><span class="annot"><span class="annottext">withConfig :: forall a. Maybe CodebasePathOption -&gt; (Config -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621680982294"><span class="hs-identifier hs-var hs-var">withConfig</span></a></span></span><span> </span><span id="local-6989586621680982124"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982124"><span class="hs-identifier hs-var">mCodePathOption</span></a></span></span><span> </span><span id="local-6989586621680982123"><span class="annot"><span class="annottext">Config -&gt; IO a
</span><a href="#local-6989586621680982123"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
MonadUnliftIO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c
</span><span class="hs-identifier hs-var">UnliftIO.bracket</span></span><span>
</span><span id="line-367"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-368"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982121"><span class="annot"><span class="annottext">mcodepath :: Maybe FilePath
</span><a href="#local-6989586621680982121"><span class="hs-identifier hs-var hs-var">mcodepath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CodebasePathOption -&gt; FilePath
</span><a href="Unison.Main.html#codebasePathOptionToPath"><span class="hs-identifier hs-var">codebasePathOptionToPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982124"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span>
</span><span id="line-369"></span><span>            </span><span id="local-6989586621680982119"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982119"><span class="hs-identifier hs-var">configFilePath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; IO FilePath
</span><a href="Unison.Main.html#getConfigFilePath"><span class="hs-identifier hs-var">getConfigFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621680982121"><span class="hs-identifier hs-var">mcodepath</span></a></span><span>
</span><span id="line-370"></span><span>            </span><span class="annot"><span class="annottext">forall a. IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">catchIOError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; IO (Config, IO ())
</span><a href="Unison.CommandLine.html#watchConfig"><span class="hs-identifier hs-var">watchConfig</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982119"><span class="hs-identifier hs-var">configFilePath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-371"></span><span>              </span><span class="annot"><span class="annottext">forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var">exitError</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Your .unisonConfig could not be loaded. Check that it's correct!&quot;</span></span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982117"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680982117"><span class="hs-identifier hs-var">_config</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982116"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680982116"><span class="hs-identifier hs-var">cancel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680982116"><span class="hs-identifier hs-var">cancel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982115"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680982115"><span class="hs-identifier hs-var">config</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982114"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680982114"><span class="hs-identifier hs-var">_cancel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Config -&gt; IO a
</span><a href="#local-6989586621680982123"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680982115"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">-- | Set user agent and configure TLS on global http client.</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- Note that the authorized http client is distinct from the global http client.</span><span>
</span><span id="line-378"></span><span class="annot"><a href="Unison.Main.html#initHTTPClient"><span class="hs-identifier hs-type">initHTTPClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span id="initHTTPClient"><span class="annot"><span class="annottext">initHTTPClient :: Version -&gt; IO ()
</span><a href="Unison.Main.html#initHTTPClient"><span class="hs-identifier hs-var hs-var">initHTTPClient</span></a></span></span><span> </span><span id="local-6989586621680982113"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982113"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982112"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982112"><span class="hs-identifier hs-var">ucmVersion</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982111"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982111"><span class="hs-identifier hs-var">_date</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; (Text, Text)
</span><a href="Unison.Version.html#%24sel%3AgitDescribe%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribe</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982113"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982109"><span class="annot"><span class="annottext">userAgent :: ByteString
</span><a href="#local-6989586621680982109"><span class="hs-identifier hs-var hs-var">userAgent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">Text.encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;UCM/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982112"><span class="hs-identifier hs-var">ucmVersion</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982107"><span class="annot"><span class="annottext">addUserAgent :: Request -&gt; IO Request
</span><a href="#local-6989586621680982107"><span class="hs-identifier hs-var hs-var">addUserAgent</span></a></span></span><span> </span><span id="local-6989586621680982106"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621680982106"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621680982106"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">requestHeaders :: RequestHeaders
</span><span class="hs-identifier hs-var">HTTP.requestHeaders</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;User-Agent&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680982109"><span class="hs-identifier hs-var">userAgent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; RequestHeaders
</span><span class="hs-identifier hs-var">HTTP.requestHeaders</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621680982106"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982104"><span class="annot"><span class="annottext">managerSettings :: ManagerSettings
</span><a href="#local-6989586621680982104"><span class="hs-identifier hs-var hs-var">managerSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ManagerSettings
</span><span class="hs-identifier hs-var">HTTP.tlsManagerSettings</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">managerModifyRequest :: Request -&gt; IO Request
</span><span class="hs-identifier hs-var">HTTP.managerModifyRequest</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO Request
</span><a href="#local-6989586621680982107"><span class="hs-identifier hs-var">addUserAgent</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-385"></span><span>  </span><span id="local-6989586621680982101"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621680982101"><span class="hs-identifier hs-var">manager</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadIO m =&gt; ManagerSettings -&gt; m Manager
</span><span class="hs-identifier hs-var">HTTP.newTlsManagerWith</span></span><span> </span><span class="annot"><span class="annottext">ManagerSettings
</span><a href="#local-6989586621680982104"><span class="hs-identifier hs-var">managerSettings</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><span class="annottext">Manager -&gt; IO ()
</span><span class="hs-identifier hs-var">HTTP.setGlobalManager</span></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621680982101"><span class="hs-identifier hs-var">manager</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="annot"><a href="Unison.Main.html#prepareTranscriptDir"><span class="hs-identifier hs-type">prepareTranscriptDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Verbosity.Verbosity</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ArgParse.html#ShouldForkCodebase"><span class="hs-identifier hs-type">ShouldForkCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ArgParse.html#ShouldSaveCodebase"><span class="hs-identifier hs-type">ShouldSaveCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-389"></span><span id="prepareTranscriptDir"><span class="annot"><span class="annottext">prepareTranscriptDir :: Verbosity
-&gt; ShouldForkCodebase
-&gt; Maybe CodebasePathOption
-&gt; ShouldSaveCodebase
-&gt; IO FilePath
</span><a href="Unison.Main.html#prepareTranscriptDir"><span class="hs-identifier hs-var hs-var">prepareTranscriptDir</span></a></span></span><span> </span><span id="local-6989586621680982097"><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680982097"><span class="hs-identifier hs-var">verbosity</span></a></span></span><span> </span><span id="local-6989586621680982096"><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680982096"><span class="hs-identifier hs-var">shouldFork</span></a></span></span><span> </span><span id="local-6989586621680982095"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982095"><span class="hs-identifier hs-var">mCodePathOption</span></a></span></span><span> </span><span id="local-6989586621680982094"><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680982094"><span class="hs-identifier hs-var">shouldSaveCodebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-390"></span><span>  </span><span id="local-6989586621680982093"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982093"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680982094"><span class="hs-identifier hs-var">shouldSaveCodebase</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><a href="ArgParse.html#SaveCodebase"><span class="hs-identifier hs-type">SaveCodebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680982091"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982091"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982091"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><span class="hs-identifier hs-var">Temp.getCanonicalTemporaryDirectory</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO FilePath
</span><span class="hs-operator hs-var">`Temp.createTempDirectory`</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;transcript&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982085"><span class="annot"><span class="annottext">cbInit :: Init IO Symbol Ann
</span><a href="#local-6989586621680982085"><span class="hs-identifier hs-var hs-var">cbInit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(HasCallStack, MonadUnliftIO m) =&gt;
Init m Symbol Ann
</span><span class="hs-identifier hs-var">SC.init</span></span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680982096"><span class="hs-identifier hs-var">shouldFork</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="ArgParse.html#UseFork"><span class="hs-identifier hs-var">UseFork</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-comment">-- A forked codebase does not need to Create a codebase, because it already exists</span><span>
</span><span id="line-397"></span><span>      </span><span class="annot"><span class="annottext">forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982095"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>      </span><span id="local-6989586621680982081"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982081"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadIO m =&gt; Maybe FilePath -&gt; m FilePath
</span><span class="hs-identifier hs-var">Codebase.getCodebaseDir</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CodebasePathOption -&gt; FilePath
</span><a href="Unison.Main.html#codebasePathOptionToPath"><span class="hs-identifier hs-var">codebasePathOptionToPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982095"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Verbosity -&gt; Bool
</span><span class="hs-identifier hs-var">Verbosity.isSilent</span></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680982097"><span class="hs-identifier hs-var">verbosity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-400"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-401"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Transcript will be run on a copy of the codebase at: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-402"></span><span>            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-403"></span><span>            </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982081"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-405"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO ()
</span><a href="System.Path.html#copyDir"><span class="hs-identifier hs-var">Path.copyDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a. Init m v a -&gt; FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">CodebaseInit.codebasePath</span></span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
</span><a href="#local-6989586621680982085"><span class="hs-identifier hs-var">cbInit</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982081"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a. Init m v a -&gt; FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">CodebaseInit.codebasePath</span></span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
</span><a href="#local-6989586621680982085"><span class="hs-identifier hs-var">cbInit</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982093"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="ArgParse.html#DontFork"><span class="hs-identifier hs-var">DontFork</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-407"></span><span>      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Transcript will be run on a new, empty codebase.&quot;</span></span><span>
</span><span id="line-408"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
MonadIO m =&gt;
Init m Symbol Ann
-&gt; Verbosity
-&gt; FilePath
-&gt; FilePath
-&gt; CodebaseLockOption
-&gt; (Codebase m Symbol Ann -&gt; m r)
-&gt; m r
</span><span class="hs-identifier hs-var">CodebaseInit.withNewUcmCodebaseOrExit</span></span><span> </span><span class="annot"><span class="annottext">Init IO Symbol Ann
</span><a href="#local-6989586621680982085"><span class="hs-identifier hs-var">cbInit</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680982097"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;main.transcript&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982093"><span class="hs-identifier hs-var">tmp</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseLockOption
</span><span class="hs-identifier hs-var">SC.DoLock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982093"><span class="hs-identifier hs-var">tmp</span></a></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="annot"><a href="Unison.Main.html#runTranscripts%27"><span class="hs-identifier hs-type">runTranscripts'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-413"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-417"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-type">MarkdownFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-419"></span><span id="runTranscripts%27"><span class="annot"><span class="annottext">runTranscripts' :: Version
-&gt; FilePath
-&gt; Maybe FilePath
-&gt; FilePath
-&gt; FilePath
-&gt; NonEmpty MarkdownFile
-&gt; IO Bool
</span><a href="Unison.Main.html#runTranscripts%27"><span class="hs-identifier hs-var hs-var">runTranscripts'</span></a></span></span><span> </span><span id="local-6989586621680982071"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982071"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680982070"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982070"><span class="hs-identifier hs-var">progName</span></a></span></span><span> </span><span id="local-6989586621680982069"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621680982069"><span class="hs-identifier hs-var">mcodepath</span></a></span></span><span> </span><span id="local-6989586621680982068"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982068"><span class="hs-identifier hs-var">nativeRtp</span></a></span></span><span> </span><span id="local-6989586621680982067"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982067"><span class="hs-identifier hs-var">transcriptDir</span></a></span></span><span> </span><span id="local-6989586621680982066"><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680982066"><span class="hs-identifier hs-var">markdownFiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-420"></span><span>  </span><span id="local-6989586621680982065"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982065"><span class="hs-identifier hs-var">currentDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><span class="hs-identifier hs-var">getCurrentDirectory</span></span><span>
</span><span id="line-421"></span><span>  </span><span id="local-6989586621680982064"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982064"><span class="hs-identifier hs-var">configFilePath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; IO FilePath
</span><a href="Unison.Main.html#getConfigFilePath"><span class="hs-identifier hs-var">getConfigFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621680982069"><span class="hs-identifier hs-var">mcodepath</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-comment">-- We don't need to create a codebase through `getCodebaseOrExit` as we've already done so previously.</span><span>
</span><span id="line-423"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var">getCodebaseOrExit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; CodebasePathOption
</span><a href="ArgParse.html#DontCreateCodebaseWhenMissing"><span class="hs-identifier hs-var">DontCreateCodebaseWhenMissing</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982067"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackupStrategy -&gt; VacuumStrategy -&gt; MigrationStrategy
</span><span class="hs-identifier hs-var">SC.MigrateAutomatically</span></span><span> </span><span class="annot"><span class="annottext">BackupStrategy
</span><span class="hs-identifier hs-var">SC.Backup</span></span><span> </span><span class="annot"><span class="annottext">VacuumStrategy
</span><span class="hs-identifier hs-var">SC.Vacuum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982060"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982060"><span class="hs-identifier hs-var">codebasePath</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982059"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982059"><span class="hs-identifier hs-var">theCodebase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r.
MonadUnliftIO m =&gt;
Verbosity
-&gt; Text
-&gt; FilePath
-&gt; Maybe FilePath
-&gt; (TranscriptRunner -&gt; m r)
-&gt; m r
</span><a href="Unison.Codebase.TranscriptParser.html#withTranscriptRunner"><span class="hs-identifier hs-var">TR.withTranscriptRunner</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><span class="hs-identifier hs-var">Verbosity.Verbose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Text
</span><a href="Unison.Version.html#%24sel%3AgitDescribeWithDate%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribeWithDate</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982071"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982068"><span class="hs-identifier hs-var">nativeRtp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982064"><span class="hs-identifier hs-var">configFilePath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680982057"><span class="annot"><span class="annottext">TranscriptRunner
</span><a href="#local-6989586621680982057"><span class="hs-identifier hs-var">runTranscript</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-425"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680982066"><span class="hs-identifier hs-var">markdownFiles</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-type">MarkdownFile</span></a></span><span> </span><span id="local-6989586621680982054"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982054"><span class="hs-identifier hs-var">fileName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>        </span><span id="local-6989586621680982053"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982053"><span class="hs-identifier hs-var">transcriptSrc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Text
</span><span class="hs-identifier hs-var">readUtf8</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982054"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-427"></span><span>        </span><span id="local-6989586621680982051"><span class="annot"><span class="annottext">Either TranscriptError Text
</span><a href="#local-6989586621680982051"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TranscriptRunner
</span><a href="#local-6989586621680982057"><span class="hs-identifier hs-var">runTranscript</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982054"><span class="hs-identifier hs-var">fileName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982053"><span class="hs-identifier hs-var">transcriptSrc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982060"><span class="hs-identifier hs-var">codebasePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982059"><span class="hs-identifier hs-var">theCodebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982050"><span class="annot"><span class="annottext">outputFile :: FilePath
</span><a href="#local-6989586621680982050"><span class="hs-identifier hs-var hs-var">outputFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">replaceExtension</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982065"><span class="hs-identifier hs-var">currentDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982054"><span class="hs-identifier hs-var">fileName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.output.md&quot;</span></span><span>
</span><span id="line-429"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680982049"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982049"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982048"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982048"><span class="hs-identifier hs-var">succeeded</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either TranscriptError Text
</span><a href="#local-6989586621680982051"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-430"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680982047"><span class="annot"><span class="annottext">TranscriptError
</span><a href="#local-6989586621680982047"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TranscriptError
</span><a href="#local-6989586621680982047"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-431"></span><span>            </span><span class="annot"><a href="Unison.Codebase.TranscriptParser.html#TranscriptParseError"><span class="hs-identifier hs-type">TR.TranscriptParseError</span></a></span><span> </span><span id="local-6989586621680982045"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982045"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-432"></span><span>              </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-433"></span><span>                </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span>
</span><span id="line-434"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#10067;&quot;</span></span><span>
</span><span id="line-435"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-436"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;An error occurred while parsing the following file: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982054"><span class="hs-identifier hs-var">fileName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-437"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-438"></span><span>                        </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982045"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-439"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-440"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>              </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982045"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>            </span><span class="annot"><a href="Unison.Codebase.TranscriptParser.html#TranscriptRunFailure"><span class="hs-identifier hs-type">TR.TranscriptRunFailure</span></a></span><span> </span><span id="local-6989586621680982042"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982042"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span>              </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-444"></span><span>                </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span>
</span><span id="line-445"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#10067;&quot;</span></span><span>
</span><span id="line-446"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-447"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;An error occurred while running the following file: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982054"><span class="hs-identifier hs-var">fileName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-448"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-449"></span><span>                        </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982042"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-450"></span><span>                        </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-451"></span><span>                          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Run `&quot;</span></span><span>
</span><span id="line-452"></span><span>                            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982070"><span class="hs-identifier hs-var">progName</span></a></span><span>
</span><span id="line-453"></span><span>                            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; --codebase &quot;</span></span><span>
</span><span id="line-454"></span><span>                            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982060"><span class="hs-identifier hs-var">codebasePath</span></a></span><span>
</span><span id="line-455"></span><span>                            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;` &quot;</span></span><span>
</span><span id="line-456"></span><span>                            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;to do more work with it.&quot;</span></span><span>
</span><span id="line-457"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>              </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982042"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680982041"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982041"><span class="hs-identifier hs-var">mdOut</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-461"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982041"><span class="hs-identifier hs-var">mdOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">writeUtf8</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982050"><span class="hs-identifier hs-var">outputFile</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982049"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-463"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&#128190;  Wrote &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982050"><span class="hs-identifier hs-var">outputFile</span></a></span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982048"><span class="hs-identifier hs-var">succeeded</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="annot"><a href="Unison.Main.html#runTranscripts"><span class="hs-identifier hs-type">runTranscripts</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-468"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Verbosity.Verbosity</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-469"></span><span>  </span><span class="annot"><a href="ArgParse.html#UsageRenderer"><span class="hs-identifier hs-type">UsageRenderer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-470"></span><span>  </span><span class="annot"><a href="ArgParse.html#ShouldForkCodebase"><span class="hs-identifier hs-type">ShouldForkCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-471"></span><span>  </span><span class="annot"><a href="ArgParse.html#ShouldSaveCodebase"><span class="hs-identifier hs-type">ShouldSaveCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-472"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-473"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-475"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span id="runTranscripts"><span class="annot"><span class="annottext">runTranscripts :: Version
-&gt; Verbosity
-&gt; UsageRenderer
-&gt; ShouldForkCodebase
-&gt; ShouldSaveCodebase
-&gt; Maybe CodebasePathOption
-&gt; FilePath
-&gt; NonEmpty FilePath
-&gt; IO ()
</span><a href="Unison.Main.html#runTranscripts"><span class="hs-identifier hs-var hs-var">runTranscripts</span></a></span></span><span> </span><span id="local-6989586621680982038"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982038"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680982037"><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680982037"><span class="hs-identifier hs-var">verbosity</span></a></span></span><span> </span><span id="local-6989586621680982036"><span class="annot"><span class="annottext">UsageRenderer
</span><a href="#local-6989586621680982036"><span class="hs-identifier hs-var">renderUsageInfo</span></a></span></span><span> </span><span id="local-6989586621680982035"><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680982035"><span class="hs-identifier hs-var">shouldFork</span></a></span></span><span> </span><span id="local-6989586621680982034"><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680982034"><span class="hs-identifier hs-var">shouldSaveTempCodebase</span></a></span></span><span> </span><span id="local-6989586621680982033"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982033"><span class="hs-identifier hs-var">mCodePathOption</span></a></span></span><span> </span><span id="local-6989586621680982032"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982032"><span class="hs-identifier hs-var">nativeRtp</span></a></span></span><span> </span><span id="local-6989586621680982031"><span class="annot"><span class="annottext">NonEmpty FilePath
</span><a href="#local-6989586621680982031"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-477"></span><span>  </span><span id="local-6989586621680982030"><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680982030"><span class="hs-identifier hs-var">markdownFiles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Validation FilePath MarkdownFile
</span><a href="Unison.Main.html#markdownFile"><span class="hs-identifier hs-var">markdownFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty FilePath
</span><a href="#local-6989586621680982031"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-478"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Failure</span></span><span> </span><span id="local-6989586621680982025"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982025"><span class="hs-identifier hs-var">invalidArgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-480"></span><span>        </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span>
</span><span id="line-481"></span><span>          </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#10067;&quot;</span></span><span>
</span><span id="line-482"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-483"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Transcripts must have an .md or .markdown extension.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-484"></span><span>                </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-485"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, ListLike s Char, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.bulleted</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.bold</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621680982025"><span class="hs-identifier hs-var">invalidArgs</span></a></span><span>
</span><span id="line-486"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-487"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UsageRenderer
</span><a href="#local-6989586621680982036"><span class="hs-identifier hs-var">renderUsageInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;transcript&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>      </span><span class="annot"><span class="annottext">forall a. ExitCode -&gt; IO a
</span><span class="hs-identifier hs-var">Exit.exitWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ExitCode
</span><span class="hs-identifier hs-var">Exit.ExitFailure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Success</span></span><span> </span><span id="local-6989586621680982020"><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680982020"><span class="hs-identifier hs-var">markdownFiles</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680982020"><span class="hs-identifier hs-var">markdownFiles</span></a></span><span>
</span><span id="line-491"></span><span>  </span><span id="local-6989586621680982019"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982019"><span class="hs-identifier hs-var">progName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><span class="hs-identifier hs-var">getProgName</span></span><span>
</span><span id="line-492"></span><span>  </span><span id="local-6989586621680982018"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982018"><span class="hs-identifier hs-var">transcriptDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Verbosity
-&gt; ShouldForkCodebase
-&gt; Maybe CodebasePathOption
-&gt; ShouldSaveCodebase
-&gt; IO FilePath
</span><a href="Unison.Main.html#prepareTranscriptDir"><span class="hs-identifier hs-var">prepareTranscriptDir</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621680982037"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">ShouldForkCodebase
</span><a href="#local-6989586621680982035"><span class="hs-identifier hs-var">shouldFork</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680982033"><span class="hs-identifier hs-var">mCodePathOption</span></a></span><span> </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680982034"><span class="hs-identifier hs-var">shouldSaveTempCodebase</span></a></span><span>
</span><span id="line-493"></span><span>  </span><span id="local-6989586621680982017"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982017"><span class="hs-identifier hs-var">completed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><span class="annottext">Version
-&gt; FilePath
-&gt; Maybe FilePath
-&gt; FilePath
-&gt; FilePath
-&gt; NonEmpty MarkdownFile
-&gt; IO Bool
</span><a href="Unison.Main.html#runTranscripts%27"><span class="hs-identifier hs-var">runTranscripts'</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982038"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982019"><span class="hs-identifier hs-var">progName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982018"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982032"><span class="hs-identifier hs-var">nativeRtp</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982018"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty MarkdownFile
</span><a href="#local-6989586621680982030"><span class="hs-identifier hs-var">markdownFiles</span></a></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="#local-6989586621680982034"><span class="hs-identifier hs-var">shouldSaveTempCodebase</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-496"></span><span>    </span><span class="annot"><span class="annottext">ShouldSaveCodebase
</span><a href="ArgParse.html#DontSaveCodebase"><span class="hs-identifier hs-var">DontSaveCodebase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">removeDirectoryRecursive</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982018"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span>
</span><span id="line-497"></span><span>    </span><span class="annot"><a href="ArgParse.html#SaveCodebase"><span class="hs-identifier hs-type">SaveCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-498"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982017"><span class="hs-identifier hs-var">completed</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>        </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-500"></span><span>          </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span>
</span><span id="line-501"></span><span>            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#127800;&quot;</span></span><span>
</span><span id="line-502"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-503"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I've finished running the transcript(s) in this codebase:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-504"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-505"></span><span>                  </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982018"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-506"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-507"></span><span>                  </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-508"></span><span>                    </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;You can run&quot;</span></span><span>
</span><span id="line-509"></span><span>                      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.backticked</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982019"><span class="hs-identifier hs-var">progName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; --codebase &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982018"><span class="hs-identifier hs-var">transcriptDir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>                      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;to do more work with it.&quot;</span></span><span>
</span><span id="line-511"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-512"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982017"><span class="hs-identifier hs-var">completed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. ExitCode -&gt; IO a
</span><span class="hs-identifier hs-var">Exit.exitWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ExitCode
</span><span class="hs-identifier hs-var">Exit.ExitFailure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="annot"><a href="Unison.Main.html#defaultInitialPath"><span class="hs-identifier hs-type">defaultInitialPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span>
</span><span id="line-516"></span><span id="defaultInitialPath"><span class="annot"><span class="annottext">defaultInitialPath :: Absolute
</span><a href="Unison.Main.html#defaultInitialPath"><span class="hs-identifier hs-var hs-var">defaultInitialPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="annot"><a href="Unison.Main.html#launch"><span class="hs-identifier hs-type">launch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-519"></span><span>  </span><span class="annot"><a href="Unison.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-520"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Config</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-522"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-523"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-524"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rt.Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-525"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase.Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Event"><span class="hs-identifier hs-type">Input.Event</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier hs-type">Input.Input</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-527"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server.BaseUrl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-528"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-529"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">InitResult</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-532"></span><span>  </span><span class="annot"><a href="Unison.CommandLine.Types.html#ShouldWatchFiles"><span class="hs-identifier hs-type">CommandLine.ShouldWatchFiles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-533"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span id="launch"><span class="annot"><span class="annottext">launch :: Version
-&gt; FilePath
-&gt; Config
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; [Either Event Input]
-&gt; Maybe BaseUrl
-&gt; Maybe Absolute
-&gt; InitResult
-&gt; (CausalHash -&gt; STM ())
-&gt; (Absolute -&gt; STM ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.Main.html#launch"><span class="hs-identifier hs-var hs-var">launch</span></a></span></span><span> </span><span id="local-6989586621680982013"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982013"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span id="local-6989586621680982012"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982012"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621680982011"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680982011"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621680982010"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982010"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span id="local-6989586621680982009"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982009"><span class="hs-identifier hs-var">sbRuntime</span></a></span></span><span> </span><span id="local-6989586621680982008"><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982008"><span class="hs-identifier hs-var">nRuntime</span></a></span></span><span> </span><span id="local-6989586621680982007"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982007"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621680982006"><span class="annot"><span class="annottext">[Either Event Input]
</span><a href="#local-6989586621680982006"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span id="local-6989586621680982005"><span class="annot"><span class="annottext">Maybe BaseUrl
</span><a href="#local-6989586621680982005"><span class="hs-identifier hs-var">serverBaseUrl</span></a></span></span><span> </span><span id="local-6989586621680982004"><span class="annot"><span class="annottext">Maybe Absolute
</span><a href="#local-6989586621680982004"><span class="hs-identifier hs-var">mayStartingPath</span></a></span></span><span> </span><span id="local-6989586621680982003"><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680982003"><span class="hs-identifier hs-var">initResult</span></a></span></span><span> </span><span id="local-6989586621680982002"><span class="annot"><span class="annottext">CausalHash -&gt; STM ()
</span><a href="#local-6989586621680982002"><span class="hs-identifier hs-var">notifyRootChange</span></a></span></span><span> </span><span id="local-6989586621680982001"><span class="annot"><span class="annottext">Absolute -&gt; STM ()
</span><a href="#local-6989586621680982001"><span class="hs-identifier hs-var">notifyPathChange</span></a></span></span><span> </span><span id="local-6989586621680982000"><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="#local-6989586621680982000"><span class="hs-identifier hs-var">shouldWatchFiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-535"></span><span>  </span><span id="local-6989586621680981999"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680981999"><span class="hs-identifier hs-var">showWelcomeHint</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982007"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction Bool
</span><span class="hs-identifier hs-var">Queries.doProjectsExist</span></span><span>
</span><span id="line-536"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680981997"><span class="annot"><span class="annottext">isNewCodebase :: CodebaseInitStatus
</span><a href="#local-6989586621680981997"><span class="hs-identifier hs-var hs-var">isNewCodebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InitResult
</span><a href="#local-6989586621680982003"><span class="hs-identifier hs-var">initResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-537"></span><span>        </span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier hs-var">CreatedCodebase</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodebaseInitStatus
</span><a href="Unison.CommandLine.Welcome.html#NewlyCreatedCodebase"><span class="hs-identifier hs-var">NewlyCreatedCodebase</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier hs-var">OpenedCodebase</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodebaseInitStatus
</span><a href="Unison.CommandLine.Welcome.html#PreviouslyCreatedCodebase"><span class="hs-identifier hs-var">PreviouslyCreatedCodebase</span></a></span><span>
</span><span id="line-539"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680981992"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680981992"><span class="hs-identifier hs-var">ucmVersion</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680981991"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680981991"><span class="hs-identifier hs-var">_date</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; (Text, Text)
</span><a href="Unison.Version.html#%24sel%3AgitDescribe%3AVersion"><span class="hs-identifier hs-var">Version.gitDescribe</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621680982013"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-540"></span><span>      </span><span id="local-6989586621680981990"><span class="annot"><span class="annottext">welcome :: Welcome
</span><a href="#local-6989586621680981990"><span class="hs-identifier hs-var hs-var">welcome</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodebaseInitStatus -&gt; Text -&gt; Bool -&gt; Welcome
</span><a href="Unison.CommandLine.Welcome.html#welcome"><span class="hs-identifier hs-var">Welcome.welcome</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseInitStatus
</span><a href="#local-6989586621680981997"><span class="hs-identifier hs-var">isNewCodebase</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680981992"><span class="hs-identifier hs-var">ucmVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680981999"><span class="hs-identifier hs-var">showWelcomeHint</span></a></span><span>
</span><span id="line-541"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; Welcome
-&gt; Absolute
-&gt; Config
-&gt; [Either Event Input]
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Runtime Symbol
-&gt; Codebase IO Symbol Ann
-&gt; Maybe BaseUrl
-&gt; Text
-&gt; (CausalHash -&gt; STM ())
-&gt; (Absolute -&gt; STM ())
-&gt; ShouldWatchFiles
-&gt; IO ()
</span><a href="Unison.CommandLine.Main.html#main"><span class="hs-identifier hs-var">CommandLine.main</span></a></span><span>
</span><span id="line-542"></span><span>        </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680982012"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-543"></span><span>        </span><span class="annot"><span class="annottext">Welcome
</span><a href="#local-6989586621680981990"><span class="hs-identifier hs-var">welcome</span></a></span><span>
</span><span id="line-544"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="Unison.Main.html#defaultInitialPath"><span class="hs-identifier hs-var">defaultInitialPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Absolute
</span><a href="#local-6989586621680982004"><span class="hs-identifier hs-var">mayStartingPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>        </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680982011"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-546"></span><span>        </span><span class="annot"><span class="annottext">[Either Event Input]
</span><a href="#local-6989586621680982006"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-547"></span><span>        </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982010"><span class="hs-identifier hs-var">runtime</span></a></span><span>
</span><span id="line-548"></span><span>        </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982009"><span class="hs-identifier hs-var">sbRuntime</span></a></span><span>
</span><span id="line-549"></span><span>        </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621680982008"><span class="hs-identifier hs-var">nRuntime</span></a></span><span>
</span><span id="line-550"></span><span>        </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621680982007"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-551"></span><span>        </span><span class="annot"><span class="annottext">Maybe BaseUrl
</span><a href="#local-6989586621680982005"><span class="hs-identifier hs-var">serverBaseUrl</span></a></span><span>
</span><span id="line-552"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680981992"><span class="hs-identifier hs-var">ucmVersion</span></a></span><span>
</span><span id="line-553"></span><span>        </span><span class="annot"><span class="annottext">CausalHash -&gt; STM ()
</span><a href="#local-6989586621680982002"><span class="hs-identifier hs-var">notifyRootChange</span></a></span><span>
</span><span id="line-554"></span><span>        </span><span class="annot"><span class="annottext">Absolute -&gt; STM ()
</span><a href="#local-6989586621680982001"><span class="hs-identifier hs-var">notifyPathChange</span></a></span><span>
</span><span id="line-555"></span><span>        </span><span class="annot"><span class="annottext">ShouldWatchFiles
</span><a href="#local-6989586621680982000"><span class="hs-identifier hs-var">shouldWatchFiles</span></a></span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="hs-keyword">newtype</span><span> </span><span id="MarkdownFile"><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-var">MarkdownFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MarkdownFile"><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-var">MarkdownFile</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span class="annot"><a href="Unison.Main.html#markdownFile"><span class="hs-identifier hs-type">markdownFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-type">MarkdownFile</span></a></span><span>
</span><span id="line-560"></span><span id="markdownFile"><span class="annot"><span class="annottext">markdownFile :: FilePath -&gt; Validation FilePath MarkdownFile
</span><a href="Unison.Main.html#markdownFile"><span class="hs-identifier hs-var hs-var">markdownFile</span></a></span></span><span> </span><span id="local-6989586621680981987"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981987"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">takeExtension</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981987"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-561"></span><span>  </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.md&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e a. a -&gt; Validation e a
</span><span class="hs-identifier hs-var">Success</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; MarkdownFile
</span><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-var">MarkdownFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981987"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.markdown&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e a. a -&gt; Validation e a
</span><span class="hs-identifier hs-var">Success</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; MarkdownFile
</span><a href="Unison.Main.html#MarkdownFile"><span class="hs-identifier hs-var">MarkdownFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981987"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e a. e -&gt; Validation e a
</span><span class="hs-identifier hs-var">Failure</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981987"><span class="hs-identifier hs-var">md</span></a></span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="annot"><a href="Unison.Main.html#isDotU"><span class="hs-identifier hs-type">isDotU</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-566"></span><span id="isDotU"><span class="annot"><span class="annottext">isDotU :: FilePath -&gt; Bool
</span><a href="Unison.Main.html#isDotU"><span class="hs-identifier hs-var hs-var">isDotU</span></a></span></span><span> </span><span id="local-6989586621680981986"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981986"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">takeExtension</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981986"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.u&quot;</span></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="annot"><a href="Unison.Main.html#getConfigFilePath"><span class="hs-identifier hs-type">getConfigFilePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-569"></span><span id="getConfigFilePath"><span class="annot"><span class="annottext">getConfigFilePath :: Maybe FilePath -&gt; IO FilePath
</span><a href="Unison.Main.html#getConfigFilePath"><span class="hs-identifier hs-var hs-var">getConfigFilePath</span></a></span></span><span> </span><span id="local-6989586621680981985"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621680981985"><span class="hs-identifier hs-var">mcodepath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.unisonConfig&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadIO m =&gt; Maybe FilePath -&gt; m FilePath
</span><span class="hs-identifier hs-var">Codebase.getCodebaseDir</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621680981985"><span class="hs-identifier hs-var">mcodepath</span></a></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span id="local-6989586621680982917"><span class="annot"><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-type">getCodebaseOrExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SC.MigrationStrategy</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InitResult</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CodebasePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680982917"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680982917"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-572"></span><span id="getCodebaseOrExit"><span class="annot"><span class="annottext">getCodebaseOrExit :: forall r.
Maybe CodebasePathOption
-&gt; MigrationStrategy
-&gt; ((InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r)
-&gt; IO r
</span><a href="Unison.Main.html#getCodebaseOrExit"><span class="hs-identifier hs-var hs-var">getCodebaseOrExit</span></a></span></span><span> </span><span id="local-6989586621680981913"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680981913"><span class="hs-identifier hs-var">codebasePathOption</span></a></span></span><span> </span><span id="local-6989586621680981912"><span class="annot"><span class="annottext">MigrationStrategy
</span><a href="#local-6989586621680981912"><span class="hs-identifier hs-var">migrationStrategy</span></a></span></span><span> </span><span id="local-6989586621680981911"><span class="annot"><span class="annottext">(InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r
</span><a href="#local-6989586621680981911"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-573"></span><span>  </span><span id="local-6989586621680981910"><span class="annot"><span class="annottext">CodebaseInitOptions
</span><a href="#local-6989586621680981910"><span class="hs-identifier hs-var">initOptions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption -&gt; IO CodebaseInitOptions
</span><a href="Unison.Main.html#argsToCodebaseInitOptions"><span class="hs-identifier hs-var">argsToCodebaseInitOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680981913"><span class="hs-identifier hs-var">codebasePathOption</span></a></span><span>
</span><span id="line-574"></span><span>  </span><span id="local-6989586621680981908"><span class="annot"><span class="annottext">Either (FilePath, InitError) r
</span><a href="#local-6989586621680981908"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) v a r.
MonadIO m =&gt;
Init m v a
-&gt; FilePath
-&gt; CodebaseInitOptions
-&gt; CodebaseLockOption
-&gt; MigrationStrategy
-&gt; ((InitResult, FilePath, Codebase m v a) -&gt; m r)
-&gt; m (Either (FilePath, InitError) r)
</span><span class="hs-identifier hs-var">CodebaseInit.withOpenOrCreateCodebase</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(HasCallStack, MonadUnliftIO m) =&gt;
Init m Symbol Ann
</span><span class="hs-identifier hs-var">SC.init</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;main&quot;</span></span><span> </span><span class="annot"><span class="annottext">CodebaseInitOptions
</span><a href="#local-6989586621680981910"><span class="hs-identifier hs-var">initOptions</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseLockOption
</span><span class="hs-identifier hs-var">SC.DoLock</span></span><span> </span><span class="annot"><span class="annottext">MigrationStrategy
</span><a href="#local-6989586621680981912"><span class="hs-identifier hs-var">migrationStrategy</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-575"></span><span>    </span><span id="local-6989586621680981906"><span class="annot"><span class="annottext">cbInit :: (InitResult, FilePath, Codebase IO Symbol Ann)
</span><a href="#local-6989586621680981906"><span class="hs-identifier hs-var">cbInit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier hs-var">CreatedCodebase</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680981905"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981905"><span class="hs-identifier hs-var">dir</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-576"></span><span>      </span><span id="local-6989586621680981904"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981904"><span class="hs-identifier hs-var">pDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {s}. IsString s =&gt; FilePath -&gt; IO (Pretty s)
</span><a href="#local-6989586621680981903"><span class="hs-identifier hs-var">prettyDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981905"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-577"></span><span>      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn'</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-578"></span><span>      </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn'</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. (ListLike s Char, IsString s) =&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.wrap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I created a new codebase for you at&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.blue</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981904"><span class="hs-identifier hs-var">pDir</span></a></span><span>
</span><span id="line-579"></span><span>      </span><span class="annot"><span class="annottext">(InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r
</span><a href="#local-6989586621680981911"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">(InitResult, FilePath, Codebase IO Symbol Ann)
</span><a href="#local-6989586621680981906"><span class="hs-identifier hs-var">cbInit</span></a></span><span>
</span><span id="line-580"></span><span>    </span><span id="local-6989586621680981900"><span class="annot"><span class="annottext">cbInit :: (InitResult, FilePath, Codebase IO Symbol Ann)
</span><a href="#local-6989586621680981900"><span class="hs-identifier hs-var">cbInit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitResult
</span><span class="hs-identifier hs-var">OpenedCodebase</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-581"></span><span>      </span><span class="annot"><span class="annottext">(InitResult, FilePath, Codebase IO Symbol Ann) -&gt; IO r
</span><a href="#local-6989586621680981911"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">(InitResult, FilePath, Codebase IO Symbol Ann)
</span><a href="#local-6989586621680981900"><span class="hs-identifier hs-var">cbInit</span></a></span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (FilePath, InitError) r
</span><a href="#local-6989586621680981908"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680981899"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680981899"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680981899"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-585"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680981898"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981898"><span class="hs-identifier hs-var">dir</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680981897"><span class="annot"><span class="annottext">InitError
</span><a href="#local-6989586621680981897"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-586"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680981896"><span class="annot"><span class="annottext">message :: IO (Pretty ColorText)
</span><a href="#local-6989586621680981896"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-587"></span><span>            </span><span id="local-6989586621680981895"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981895"><span class="hs-identifier hs-var">pDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {s}. IsString s =&gt; FilePath -&gt; IO (Pretty s)
</span><a href="#local-6989586621680981903"><span class="hs-identifier hs-var">prettyDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981898"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-588"></span><span>            </span><span id="local-6989586621680981894"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981894"><span class="hs-identifier hs-var">executableName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><span class="hs-identifier hs-var">getProgName</span></span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InitError
</span><a href="#local-6989586621680981897"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-591"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">InitErrorOpen</span></span><span> </span><span id="local-6989586621680981892"><span class="annot"><span class="annottext">OpenCodebaseError
</span><a href="#local-6989586621680981892"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-592"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OpenCodebaseError
</span><a href="#local-6989586621680981892"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-593"></span><span>                  </span><span class="annot"><span class="annottext">OpenCodebaseError
</span><span class="hs-identifier hs-var">OpenCodebaseFileLockFailed</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-594"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-595"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-596"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Failed to obtain a file lock on the codebase. &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-597"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Perhaps you are running multiple ucm processes against the same codebase.&quot;</span></span><span>
</span><span id="line-598"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-599"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>                  </span><span class="annot"><span class="annottext">OpenCodebaseError
</span><span class="hs-identifier hs-var">OpenCodebaseDoesntExist</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-601"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-602"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-603"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;No codebase exists in &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981895"><span class="hs-identifier hs-var">pDir</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-604"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Run `&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981894"><span class="hs-identifier hs-var">executableName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; --codebase-create &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981898"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; to create one, then try again!&quot;</span></span><span>
</span><span id="line-605"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-606"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OpenCodebaseUnknownSchemaVersion</span></span><span> </span><span class="annot"><span class="annottext">SchemaVersion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-608"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-609"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-610"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;I can't read the codebase in &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981895"><span class="hs-identifier hs-var">pDir</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot; because it was constructed using a newer version of unison.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-611"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Please upgrade your version of UCM.&quot;</span></span><span>
</span><span id="line-612"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-613"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OpenCodebaseRequiresMigration</span></span><span> </span><span class="annot"><span class="annottext">SchemaVersion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SchemaVersion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-615"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-616"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-617"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;The codebase is from an older version of UCM, it needs to be migrated before it can be used.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-618"></span><span>                            </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;You can migrate it by opening it in UCM, e.g. ucm -c mycodebase&quot;</span></span><span>
</span><span id="line-619"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-620"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>              </span><span class="annot"><span class="annottext">InitError
</span><span class="hs-identifier hs-var">FoundV1Codebase</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-622"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-623"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-624"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Found a v1 codebase at &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981895"><span class="hs-identifier hs-var">pDir</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-625"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;v1 codebases are no longer supported in this version of the UCM.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-626"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;Please download version M2g of the UCM to upgrade.&quot;</span></span><span>
</span><span id="line-627"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-628"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">CouldntCreateCodebase</span></span><span> </span><span id="local-6989586621680981885"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981885"><span class="hs-identifier hs-var">errMessage</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-630"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981885"><span class="hs-identifier hs-var">errMessage</span></a></span><span>
</span><span id="line-631"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-632"></span><span>            </span><span id="local-6989586621680981884"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981884"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Pretty ColorText)
</span><a href="#local-6989586621680981896"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-633"></span><span>            </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn'</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981884"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-634"></span><span>            </span><span class="annot"><span class="annottext">forall a. IO a
</span><span class="hs-identifier hs-var">Exit.exitFailure</span></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-636"></span><span>    </span><span id="local-6989586621680981903"><span class="annot"><span class="annottext">prettyDir :: FilePath -&gt; IO (Pretty s)
</span><a href="#local-6989586621680981903"><span class="hs-identifier hs-var hs-var">prettyDir</span></a></span></span><span> </span><span id="local-6989586621680981879"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981879"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. IsString s =&gt; FilePath -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.string</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO FilePath
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981879"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span id="local-6989586621680982931"><span class="annot"><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-type">exitError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.ColorText</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680982931"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-639"></span><span id="exitError"><span class="annot"><span class="annottext">exitError :: forall a. Pretty ColorText -&gt; IO a
</span><a href="Unison.Main.html#exitError"><span class="hs-identifier hs-var hs-var">exitError</span></a></span></span><span> </span><span id="local-6989586621680981873"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981873"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-640"></span><span>  </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; IO ()
</span><span class="hs-identifier hs-var">PT.putPrettyLn</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s.
(ListLike s Char, IsString s) =&gt;
Pretty s -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.callout</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;&#9888;&#65039;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621680981873"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-641"></span><span>  </span><span class="annot"><span class="annottext">forall a. IO a
</span><span class="hs-identifier hs-var">Exit.exitFailure</span></span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span class="annot"><a href="Unison.Main.html#argsToCodebaseInitOptions"><span class="hs-identifier hs-type">argsToCodebaseInitOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CodebaseInit.CodebaseInitOptions</span></span><span>
</span><span id="line-644"></span><span id="argsToCodebaseInitOptions"><span class="annot"><span class="annottext">argsToCodebaseInitOptions :: Maybe CodebasePathOption -&gt; IO CodebaseInitOptions
</span><a href="Unison.Main.html#argsToCodebaseInitOptions"><span class="hs-identifier hs-var hs-var">argsToCodebaseInitOptions</span></a></span></span><span> </span><span id="local-6989586621680981872"><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680981872"><span class="hs-identifier hs-var">pathOption</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><a href="#local-6989586621680981872"><span class="hs-identifier hs-var">pathOption</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#CreateCodebaseWhenMissing"><span class="hs-identifier hs-type">CreateCodebaseWhenMissing</span></a></span><span> </span><span id="local-6989586621680981870"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981870"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SpecifiedCodebase -&gt; CodebaseInitOptions
</span><span class="hs-identifier hs-var">Specified</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SpecifiedCodebase
</span><span class="hs-identifier hs-var">CreateWhenMissing</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981870"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ArgParse.html#DontCreateCodebaseWhenMissing"><span class="hs-identifier hs-type">DontCreateCodebaseWhenMissing</span></a></span><span> </span><span id="local-6989586621680981867"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981867"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SpecifiedCodebase -&gt; CodebaseInitOptions
</span><span class="hs-identifier hs-var">Specified</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SpecifiedCodebase
</span><span class="hs-identifier hs-var">DontCreateWhenMissing</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981867"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>    </span><span class="annot"><span class="annottext">Maybe CodebasePathOption
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; CodebaseInitOptions
</span><span class="hs-identifier hs-var">Home</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadIO m =&gt; m FilePath
</span><span class="hs-identifier hs-var">getHomeDirectory</span></span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="annot"><a href="Unison.Main.html#codebasePathOptionToPath"><span class="hs-identifier hs-type">codebasePathOptionToPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ArgParse.html#CodebasePathOption"><span class="hs-identifier hs-type">CodebasePathOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-651"></span><span id="codebasePathOptionToPath"><span class="annot"><span class="annottext">codebasePathOptionToPath :: CodebasePathOption -&gt; FilePath
</span><a href="Unison.Main.html#codebasePathOptionToPath"><span class="hs-identifier hs-var hs-var">codebasePathOptionToPath</span></a></span></span><span> </span><span id="local-6989586621680981864"><span class="annot"><span class="annottext">CodebasePathOption
</span><a href="#local-6989586621680981864"><span class="hs-identifier hs-var">codebasePathOption</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebasePathOption
</span><a href="#local-6989586621680981864"><span class="hs-identifier hs-var">codebasePathOption</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-653"></span><span>    </span><span class="annot"><a href="ArgParse.html#CreateCodebaseWhenMissing"><span class="hs-identifier hs-type">CreateCodebaseWhenMissing</span></a></span><span> </span><span id="local-6989586621680981863"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981863"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981863"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-654"></span><span>    </span><span class="annot"><a href="ArgParse.html#DontCreateCodebaseWhenMissing"><span class="hs-identifier hs-type">DontCreateCodebaseWhenMissing</span></a></span><span> </span><span id="local-6989586621680981862"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981862"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680981862"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-655"></span></pre></body></html>